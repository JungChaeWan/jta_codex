<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="user">

<resultMap id="USER_R_00" class="oss.user.vo.USERVO">
    <result property="userId" 			column="USER_ID" />
    <result property="authNm" 			column="AUTH_NM" />
    <result property="userNm" 			column="USER_NM" />
    <result property="email" 			column="EMAIL" />
    <result property="telNum" 			column="TEL_NUM" />
    <result property="pwd" 				column="PWD" />
    <result property="postNum" 			column="POST_NUM" />
    <result property="roadNmAddr" 		column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			column="DTL_ADDR" />
    <result property="marketingRcvAgrYn" 	column="MARKETING_RCV_AGR_YN" />
    <result property="qutYn" 			column="QUT_YN" />
    <result property="lastLoginDttm" 	column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		column="FRST_REG_DTTM" />
    <result property="lastModDttm" 		column="LAST_MOD_DTTM" />
</resultMap>

<resultMap id="USER_R_02" class="oss.user.vo.USERVO">
    <result property="userId" 			column="USER_ID" />
    <result property="authNm" 			column="AUTH_NM" />
    <result property="userNm" 			column="USER_NM" />
    <result property="email" 			column="EMAIL" />
    <result property="telNum" 			column="TEL_NUM" />
    <result property="pwd" 				column="PWD" />
    <result property="postNum" 			column="POST_NUM" />
    <result property="roadNmAddr" 		column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			column="DTL_ADDR" />
    <result property="qutYn" 			column="QUT_YN" />
    <result property="lastLoginDttm" 	column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		column="FRST_REG_DTTM" />
    <result property="lastModDttm" 		column="LAST_MOD_DTTM" />
    <result property="corpAdmYn" 		column="CORP_ADM_YN" />
    <result property="badUserYn" 		column="BAD_USER_YN" />
    <result property="badUserRsn" 		column="BAD_USER_RSN" />
    <result property="sex" 				column="SEX" />
    <result property="bth" 				column="BTH" />
    <result property="snsDiv" 			column="SNS_DIV" />
    <result property="partnerCd" 			column="PARTNER_CD" />
    <result property="marketingRcvAgrYn"    column="MARKETING_RCV_AGR_YN" />
</resultMap>

<resultMap id="USER_R_03" class="oss.user.vo.USERVO">
    <result property="userId" 			column="USER_ID" />
    <result property="authNm" 			column="AUTH_NM" />
    <result property="userNm" 			column="USER_NM" />
    <result property="email" 			column="EMAIL" />
    <result property="telNum" 			column="TEL_NUM" />
    <result property="pwd" 				column="PWD" />
    <result property="postNum" 			column="POST_NUM" />
    <result property="roadNmAddr" 		column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			column="DTL_ADDR" />
    <result property="qutYn" 			column="QUT_YN" />
    <result property="lastLoginDttm" 	column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		column="FRST_REG_DTTM" />
    <result property="lastModDttm" 		column="LAST_MOD_DTTM" />
    <result property="corpAdmYn" 		column="CORP_ADM_YN" />
    <result property="badUserYn" 		column="BAD_USER_YN" />
    <result property="badUserRsn" 		column="BAD_USER_RSN" />
    <result property="sex" 				column="SEX" />
    <result property="bth" 				column="BTH" />
    <result property="snsDiv" 			column="SNS_DIV" />
    <result property="marketingRcvAgrYn"    column="MARKETING_RCV_AGR_YN" />
    <result property="restYn" 			column="REST_YN" />
    <result property="partnerCode" 		column="PARTNER_CODE" />
</resultMap>

<resultMap id="USER_R_04" class="oss.user.vo.USERVO">
    <result property="userId" 			column="USER_ID" />
    <result property="authNm" 			column="AUTH_NM" />
    <result property="userNm" 			column="USER_NM" />
    <result property="email" 			column="EMAIL" />
    <result property="telNum" 			column="TEL_NUM" />
    <result property="pwd" 				column="PWD" />
    <result property="postNum" 			column="POST_NUM" />
    <result property="roadNmAddr" 		column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			column="DTL_ADDR" />
    <result property="emailRcvAgrYn" 	column="EMAIL_RCV_AGR_YN" />
    <result property="smsRcvAgrYn" 		column="SMS_RCV_AGR_YN" />
    <result property="qutYn" 			column="QUT_YN" />
    <result property="lastLoginDttm" 	column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		column="FRST_REG_DTTM" />
    <result property="lastModDttm" 		column="LAST_MOD_DTTM" />
    <result property="qutRsn" 			column="QUT_RSN" />
</resultMap>

<resultMap id="USER_R_06" class="oss.user.vo.USERVO">
    <result property="userId" 			column="USER_ID" />
    <result property="authNm" 			column="AUTH_NM" />
    <result property="userNm" 			column="USER_NM" />
    <result property="email" 			column="EMAIL" />
    <result property="telNum" 			column="TEL_NUM" />
    <result property="pwd" 				column="PWD" />
    <result property="postNum" 			column="POST_NUM" />
    <result property="roadNmAddr" 		column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			column="DTL_ADDR" />
    <result property="emailRcvAgrYn" 	column="EMAIL_RCV_AGR_YN" />
    <result property="smsRcvAgrYn" 		column="SMS_RCV_AGR_YN" />
    <result property="qutYn" 			column="QUT_YN" />
    <result property="lastLoginDttm" 	column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		column="FRST_REG_DTTM" />
    <result property="lastModDttm" 		column="LAST_MOD_DTTM" />
    <result property="smsAuthNum" 		column="SMS_AUTH_NUM" />
    <result property="restYn"	 		column="REST_YN" />
    <result property="partnerCode" 		column="PARTNER_CODE" />
</resultMap>

<resultMap id="USER_R_07" class="oss.user.vo.USERVO">
    <result property="userId" 			column="USER_ID" />
    <result property="authNm" 			column="AUTH_NM" />
    <result property="userNm" 			column="USER_NM" />
    <result property="email" 			column="EMAIL" />
    <result property="telNum" 			column="TEL_NUM" />
    <result property="postNum" 			column="POST_NUM" />
    <result property="roadNmAddr" 		column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			column="DTL_ADDR" />
    <result property="emailRcvAgrYn" 	column="EMAIL_RCV_AGR_YN" />
    <result property="smsRcvAgrYn" 		column="SMS_RCV_AGR_YN" />
    <result property="qutYn" 			column="QUT_YN" />
    <result property="lastLoginDttm" 	column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		column="FRST_REG_DTTM" />
    <result property="lastModDttm" 		column="LAST_MOD_DTTM" />
    <result property="corpId"	 		column="CORP_ID" />
    <result property="corpNm"	 		column="CORP_NM" />
    <result property="corpCd" 			column="CORP_CD" />
    <result property="corpSubCd" 		column="CORP_SUB_CD" />
    <result property="tradeStatusCd" 	column="TRADE_STATUS_CD" />
    <result property="corpEmail" 		column="CORP_EMAIL" />
    <result property="rsvTelNum" 		column="RSV_TEL_NUM" />
</resultMap>

<resultMap id="USER_R_15" class="oss.user.vo.USERVO">
    <result property="email" 			column="EMAIL" />
</resultMap>

<resultMap id="LOGINLOG_R_00" class="oss.user.vo.LOGINLOGVO">
    <result property="loginDttm"    column="LOGIN_DTTM" />
    <result property="id"           column="ID" />
    <result property="pcYn"         column="PC_YN" />
    <result property="ip"           column="IP" />
    <result property="telnum"       column="TELNUM" />
</resultMap>

<resultMap id="USER_R_08" class="oss.user.vo.USERVO">
    <result property="userId" 			    column="USER_ID" />
    <result property="authNm" 			    column="AUTH_NM" />
    <result property="userNm" 			    column="USER_NM" />
    <result property="email" 			    column="EMAIL" />
    <result property="telNum" 			    column="TEL_NUM" />
    <result property="pwd" 				    column="PWD" />
    <result property="qutYn" 			    column="QUT_YN" />
    <result property="lastLoginDttm" 	    column="LAST_LOGIN_DTTM" />
    <result property="lastLoginIp" 		    column="LAST_LOGIN_IP" />
    <result property="frstRegDttm" 		    column="FRST_REG_DTTM" />
    <result property="partnerCd" 			column="PARTNER_CD" />
    <result property="marketingRcvAgrYn"    column="MARKETING_RCV_AGR_YN" />
    <result property="plusPoint" 			column="PLUS_POINT" />
    <result property="minusPoint" 			column="MINUS_POINT" />
</resultMap>

<resultMap id="USER_R_09" class="oss.point.vo.POINTVO">
    <result property="partnerBudget"        column="PARTNER_BUDGET" />
    <result property="plusPoint" 			column="PLUS_POINT" />
    <result property="minusPoint" 			column="MINUS_POINT" />
</resultMap>

<select id="USER_S_00">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
FROM TB_USER
</select>

<select id="USER_S_01" resultMap="USER_R_03">
SELECT T_USER.USER_ID          /*사용자 아이디*/
    , T_USER.AUTH_NM          /*권한 명*/
    , T_USER.USER_NM          /*사용자 명*/
    , T_USER.EMAIL            /*이메일*/
    , T_USER.TEL_NUM          /*전화 번호*/
    , T_USER.PWD              /*패스워드*/
    , T_USER.POST_NUM         /*우편번호*/
    , T_USER.ROAD_NM_ADDR     /*도로명 주소*/
    , T_USER.DTL_ADDR         /*상세 주소*/
    , T_USER.MARKETING_RCV_AGR_YN   /*마케팅 수신 여부*/
    , T_USER.QUT_YN           /*탈퇴 여부*/
    , T_USER.LAST_LOGIN_DTTM  /*최종 로그인 일시*/
    , T_USER.LAST_LOGIN_IP    /*최종 로그인 아이피*/
    , T_USER.FRST_REG_DTTM    /*최초 등록 일시*/
    , T_USER.LAST_MOD_DTTM    /*최종 수정 일시*/
    , T_USER.PARTNER_CODE
    , (
    CASE
      WHEN (SELECT COUNT(USER_ID) FROM TB_CORPADM WHERE USER_ID = T_USER.USER_ID) > 0 THEN 'Y'
      ELSE 'N'
    END
    ) AS CORP_ADM_YN
    , T_USER.BAD_USER_YN
    , T_USER.BAD_USER_RSN
    , T_USER.SEX
    , T_USER.BTH
    , (
     SELECT LISTAGG(SNS_DIV, ',') WITHIN GROUP (ORDER BY SNS_DIV) SNS_DIV FROM
    		TB_USERSNS WHERE USER_ID = T_USER.USER_ID
		GROUP BY USER_ID
    ) AS SNS_DIV
    ,T_USER.MARKETING_RCV_AGR_YN
    ,T_USER.REST_YN             /*휴면계정여부*/
FROM TB_USER T_USER
WHERE T_USER.QUT_YN = 'N'
    <isNotEmpty property="userId">
        AND T_USER.USER_ID = #userId#
    </isNotEmpty>
    <isNotEmpty property="email">
        AND T_USER.EMAIL = #email#
    </isNotEmpty>
</select>

<select id="USER_S_02" resultMap="USER_R_02">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , CORP_ADM_YN      /*입점업체 관리자 여부*/
     , BAD_USER_YN
     , BAD_USER_RSN
     , SEX
     , BTH
     , SNS_DIV
     , PARTNER_CD
FROM (SELECT ROWNUM AS RN
            , USER_ID          /*사용자 아이디*/
            , AUTH_NM          /*권한 명*/
            , USER_NM          /*사용자 명*/
            , EMAIL            /*이메일*/
            , TEL_NUM          /*전화 번호*/
            , PWD              /*패스워드*/
            , POST_NUM         /*우편번호*/
            , ROAD_NM_ADDR     /*도로명 주소*/
            , DTL_ADDR         /*상세 주소*/
            , MARKETING_RCV_AGR_YN  /*마케팅 수신 여부*/
            , QUT_YN           /*탈퇴 여부*/
            , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
            , LAST_LOGIN_IP    /*최종 로그인 아이피*/
            , FRST_REG_DTTM    /*최초 등록 일시*/
            , LAST_MOD_DTTM    /*최종 수정 일시*/
            , CORP_ADM_YN      /*입점업체 관리자 여부*/
            , BAD_USER_YN
            , BAD_USER_RSN
            , SEX
            , BTH
            , SNS_DIV
            , PARTNER_CD
      FROM (SELECT /*+ INDEX_DESC(T_USER IDX_USER_01)  */
                  T_USER.USER_ID          /*사용자 아이디*/
                , T_USER.AUTH_NM          /*권한 명*/
                , T_USER.USER_NM          /*사용자 명*/
                , T_USER.EMAIL            /*이메일*/
                , T_USER.TEL_NUM          /*전화 번호*/
                , T_USER.PWD              /*패스워드*/
                , T_USER.POST_NUM         /*우편번호*/
                , T_USER.ROAD_NM_ADDR     /*도로명 주소*/
                , T_USER.DTL_ADDR         /*상세 주소*/
                , T_USER.MARKETING_RCV_AGR_YN /*마케팅 수신 여부*/
                , T_USER.QUT_YN           /*탈퇴 여부*/
                , T_USER.LAST_LOGIN_DTTM  /*최종 로그인 일시*/
                , T_USER.LAST_LOGIN_IP    /*최종 로그인 아이피*/
                , T_USER.FRST_REG_DTTM    /*최초 등록 일시*/
                , T_USER.LAST_MOD_DTTM    /*최종 수정 일시*/
                , (
                CASE WHEN (SELECT COUNT(USER_ID) FROM TB_CORPADM WHERE USER_ID = T_USER.USER_ID) > 0 THEN 'Y'
                     ELSE 'N'
                END
                ) AS CORP_ADM_YN
                 , T_USER.BAD_USER_YN
                 , T_USER.BAD_USER_RSN
                 , T_USER.SEX
                 , T_USER.BTH
                 , (
                 SELECT LISTAGG(SNS_DIV, ',') WITHIN GROUP (ORDER BY SNS_DIV) SNS_DIV FROM
                        TB_USERSNS WHERE USER_ID = T_USER.USER_ID
                 GROUP BY USER_ID
                 ) AS SNS_DIV
                 , T_USER.PARTNER_CD
            FROM TB_USER T_USER
            WHERE T_USER.QUT_YN = 'N'
            <isNotEmpty property="sUserNm">
                AND T_USER.USER_NM LIKE '%'||#sUserNm#||'%'
            </isNotEmpty>
            <isNotEmpty property="sTelNum">
                AND T_USER.TEL_NUM LIKE '%'||#sTelNum#||'%'
            </isNotEmpty>
            <isNotEmpty property="sUserId">
                AND T_USER.USER_ID LIKE '%'||#sUserId#||'%'
            </isNotEmpty>
            <isNotEmpty property="sEmail">
                AND T_USER.EMAIL LIKE '%'||#sEmail#||'%'
            </isNotEmpty>
            <isEqual property="sCorpAdminDiv" compareValue="A">
                AND T_USER.AUTH_NM = 'ADMIN'
            </isEqual>
            <isEqual property="sCorpAdminDiv" compareValue="N">
                AND T_USER.AUTH_NM = 'USER'
            </isEqual>
            <isNotEmpty property="sBadUserYn">
                AND T_USER.BAD_USER_YN = #sBadUserYn#
            </isNotEmpty>
            <isNotEmpty property="sPartnerCd">
                AND T_USER.PARTNER_CD = #sPartnerCd#
            </isNotEmpty>
            <isNotEmpty property="partnerCode">
                <isNotEqual property="partnerCode" compareValue="tamnao">
                    AND T_USER.USER_ID IN (
                        SELECT USER_ID  FROM TB_POINT WHERE PARTNER_CODE = #partnerCode#
                        GROUP BY USER_ID )
                </isNotEqual>
            </isNotEmpty>
      )
      WHERE 1=1
      <isEqual property="sCorpAdminDiv" compareValue="N">
          AND CORP_ADM_YN = 'N'
      </isEqual>
      <isEqual property="sCorpAdminDiv" compareValue="C">
          AND CORP_ADM_YN = 'Y'
      </isEqual>
)
WHERE RN BETWEEN TO_NUMBER(#firstIndex#) + 1 AND TO_NUMBER(#lastIndex#)
</select>

<select id="USER_S_03" resultClass="int">
SELECT COUNT(USER_ID) AS CNT
FROM (SELECT USER_ID          /*사용자 아이디*/
        , AUTH_NM          /*권한 명*/
        , USER_NM          /*사용자 명*/
        , EMAIL            /*이메일*/
        , TEL_NUM          /*전화 번호*/
        , PWD              /*패스워드*/
        , POST_NUM         /*우편번호*/
        , ROAD_NM_ADDR     /*도로명 주소*/
        , DTL_ADDR         /*상세 주소*/
        , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
        , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
        , QUT_YN           /*탈퇴 여부*/
        , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
        , LAST_LOGIN_IP    /*최종 로그인 아이피*/
        , FRST_REG_DTTM    /*최초 등록 일시*/
        , LAST_MOD_DTTM    /*최종 수정 일시*/
        , (CASE
            WHEN (SELECT COUNT(USER_ID) FROM TB_CORPADM WHERE USER_ID = T_USER.USER_ID) > 0 THEN 'Y'
            ELSE 'N'
        END) AS CORP_ADM_YN
    FROM TB_USER T_USER
    WHERE QUT_YN = 'N'
        <isNotEmpty property="sUserNm">
            AND USER_NM LIKE '%'||#sUserNm#||'%'
        </isNotEmpty>
        <isNotEmpty property="sTelNum">
            AND TEL_NUM LIKE '%'||#sTelNum#||'%'
        </isNotEmpty>
        <isNotEmpty property="sUserId">
            AND USER_ID LIKE '%'||#sUserId#||'%'
        </isNotEmpty>
        <isNotEmpty property="sEmail">
            AND EMAIL LIKE '%'||#sEmail#||'%'
        </isNotEmpty>
        <isEqual property="sCorpAdminDiv" compareValue="A">
            AND AUTH_NM = 'ADMIN'
        </isEqual>
        <isEqual property="sCorpAdminDiv" compareValue="N">
            AND AUTH_NM = 'USER'
        </isEqual>
        <isNotEmpty property="sBadUserYn">
            AND BAD_USER_YN = #sBadUserYn#
        </isNotEmpty>
        <isNotEmpty property="sPartnerCd">
            AND T_USER.PARTNER_CD = #sPartnerCd#
        </isNotEmpty>
        <isNotEmpty property="partnerCode">
            <isNotEqual property="partnerCode" compareValue="tamnao">
                AND T_USER.USER_ID IN (
                SELECT USER_ID  FROM TB_POINT WHERE PARTNER_CODE = #partnerCode#
                GROUP BY USER_ID )
            </isNotEqual>
        </isNotEmpty>
)
WHERE 1=1
    <isEqual property="sCorpAdminDiv" compareValue="N">
        AND CORP_ADM_YN = 'N'
    </isEqual>
    <isEqual property="sCorpAdminDiv" compareValue="C">
        AND CORP_ADM_YN = 'Y'
    </isEqual>
</select>

<select id="USER_S_04" resultMap="USER_R_04">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , QUT_RSN          /*탈퇴 사유*/
  FROM (SELECT ROWNUM AS RN
             , USER_ID          /*사용자 아이디*/
             , AUTH_NM          /*권한 명*/
             , USER_NM          /*사용자 명*/
             , EMAIL            /*이메일*/
             , TEL_NUM          /*전화 번호*/
             , PWD              /*패스워드*/
             , POST_NUM         /*우편번호*/
             , ROAD_NM_ADDR     /*도로명 주소*/
             , DTL_ADDR         /*상세 주소*/
             , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
             , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
             , QUT_YN           /*탈퇴 여부*/
             , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
             , LAST_LOGIN_IP    /*최종 로그인 아이피*/
             , FRST_REG_DTTM    /*최초 등록 일시*/
             , LAST_MOD_DTTM    /*최종 수정 일시*/
             , QUT_RSN          /*탈퇴 사유*/
          	FROM (SELECT USER_ID          /*사용자 아이디*/
		             , AUTH_NM          /*권한 명*/
		             , USER_NM          /*사용자 명*/
		             , EMAIL            /*이메일*/
		             , TEL_NUM          /*전화 번호*/
		             , PWD              /*패스워드*/
		             , POST_NUM         /*우편번호*/
		             , ROAD_NM_ADDR     /*도로명 주소*/
		             , DTL_ADDR         /*상세 주소*/
		             , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
		             , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
		             , QUT_YN           /*탈퇴 여부*/
		             , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
		             , LAST_LOGIN_IP    /*최종 로그인 아이피*/
		             , FRST_REG_DTTM    /*최초 등록 일시*/
		             , LAST_MOD_DTTM    /*최종 수정 일시*/
		             , QUT_RSN          /*탈퇴 사유*/
		          FROM TB_USER
	    	     WHERE QUT_YN = 'Y'
	        	 ORDER BY LAST_MOD_DTTM DESC
	       	 )
       )
 WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
 </select>

 <select id="USER_S_05" resultClass="int">
SELECT COUNT(USER_ID) AS CNT
  FROM TB_USER
 WHERE QUT_YN = 'Y'
 </select>

 <select id="USER_S_06" resultMap="USER_R_06">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , SMS_AUTH_NUM
     , REST_YN
     , PARTNER_CODE
  FROM TB_USER
 WHERE EMAIL = #email#
 AND PWD   = #pwd#
 <isNotEmpty property="authNm">
   AND AUTH_NM = #authNm#
 </isNotEmpty>
 <isNotEmpty property="partnerCode">
   AND PARTNER_CODE = #partnerCode#
 </isNotEmpty>
 </select>

 <select id="USER_S_07" resultMap="USER_R_07">
SELECT T_USER.USER_ID          /*사용자 아이디*/
     , T_USER.AUTH_NM          /*권한 명*/
     , T_USER.USER_NM          /*사용자 명*/
     , T_USER.EMAIL            /*이메일*/
     , T_USER.TEL_NUM          /*전화 번호*/
     , T_USER.POST_NUM         /*우편번호*/
     , T_USER.ROAD_NM_ADDR     /*도로명 주소*/
     , T_USER.DTL_ADDR         /*상세 주소*/
     , T_USER.EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , T_USER.SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , T_USER.QUT_YN           /*탈퇴 여부*/
     , T_USER.LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , T_USER.LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , T_USER.FRST_REG_DTTM    /*최초 등록 일시*/
     , T_USER.LAST_MOD_DTTM    /*최종 수정 일시*/
     , T_CORP.CORP_ID          /*업체 아이디*/
     , T_CORP.CORP_NM          /*업체 명*/
     , T_CORP.CORP_CD          /*업체 코드*/
     , T_CORP.TRADE_STATUS_CD  /*거래 상태 코드*/
     , T_CORP.CORP_SUB_CD	/* 업체 서브 코드 */
     , T_CORP.CORP_EMAIL	   /*업체 이메일*/
     , T_CORP.RSV_TEL_NUM	   /*예약 전화 번호*/
  FROM TB_USER         T_USER
 INNER JOIN TB_CORPADM T_CORPADM
    ON T_CORPADM.USER_ID = T_USER.USER_ID
 INNER JOIN TB_CORP    T_CORP
    ON T_CORP.CORP_ID     = UPPER(#corpId#)
   AND T_CORP.CORP_ID    = T_CORPADM.CORP_ID
   AND T_CORP.TRADE_STATUS_CD IN ('TS03', 'TS05')
 WHERE T_USER.PWD        = #pwd#
   <!-- AND T_USER.EMAIL      = #email# -->
</select>

<select id="USER_S_08" resultMap="USER_R_06">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , SMS_AUTH_NUM     /*SMS 인증 번호*/
     , REST_YN
     , PARTNER_CODE
  FROM TB_USER
 WHERE USER_NM = #sUserNm#
   AND TEL_NUM = #sTelNum#
<isNotEmpty property="sEmail">
   AND EMAIL = #sEmail#
 </isNotEmpty>

</select>

<!-- 협회 관리자가 입점업체로 로그인 하는 경우 -->
<select id="USER_S_09" resultMap="USER_R_07">
SELECT T_USER.USER_ID          /*사용자 아이디*/
     , T_USER.AUTH_NM          /*권한 명*/
     , T_USER.USER_NM          /*사용자 명*/
     , T_USER.EMAIL            /*이메일*/
     , T_USER.TEL_NUM          /*전화 번호*/
     , T_USER.POST_NUM         /*우편번호*/
     , T_USER.ROAD_NM_ADDR     /*도로명 주소*/
     , T_USER.DTL_ADDR         /*상세 주소*/
     , T_USER.EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , T_USER.SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , T_USER.QUT_YN           /*탈퇴 여부*/
     , T_USER.LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , T_USER.LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , T_USER.FRST_REG_DTTM    /*최초 등록 일시*/
     , T_USER.LAST_MOD_DTTM    /*최종 수정 일시*/
     , T_CORP.CORP_ID          /*업체 아이디*/
     , T_CORP.CORP_NM          /*업체 명*/
     , T_CORP.CORP_CD          /*업체 코드*/
     , T_CORP.TRADE_STATUS_CD  /*거래 상태 코드*/
     , T_CORP.CORP_SUB_CD	/* 업체 서브 코드 */
     , T_CORP.CORP_EMAIL	   /*업체 이메일*/
     , T_CORP.RSV_TEL_NUM	   /*예약 전화 번호*/
  FROM TB_USER         T_USER
     , TB_CORP         T_CORP
 WHERE T_CORP.CORP_ID     = #corpId#
   AND T_USER.USER_ID     = #userId#
   AND T_USER.AUTH_NM     = 'ADMIN'
</select>


<select id="USER_S_10" resultMap="USER_R_00">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , MARKETING_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
  FROM TB_USER
 WHERE QUT_YN = 'N'
 <isNotEmpty property="marketingRcvAgrYn">
   AND MARKETING_RCV_AGR_YN = #marketingRcvAgrYn#
 </isNotEmpty>
</select>

<select id="USER_S_11" resultMap="USER_R_06">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , SMS_AUTH_NUM     /*SMS 인증 번호*/
     , REST_YN
     , PARTNER_CODE
  FROM TB_USER
 WHERE REPLACE(TEL_NUM, '-', '') = REPLACE(#sTelNum#, '-', '')
    AND QUT_YN = 'N'
 <isNotEmpty property="sUserId">
   AND USER_ID LIKE '%'||#sUserId#||'%'
 </isNotEmpty>
 <isNotEmpty property="sEmail">
   AND EMAIL LIKE '%'||#sEmail#||'%'
 </isNotEmpty>
</select>

<!-- 통합운영 사용자 엑셀 다운로드용 -->
<select id="USER_S_12" resultMap="USER_R_02" fetchSize="1">
SELECT USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , CASE WHEN LENGTH(USER_NM) > 1 THEN SUBSTR(USER_NM, 1, LENGTH(USER_NM) - 1) || '*'
        ELSE '*' END AS USER_NM
     , EMAIL            /*이메일*/
     ,  CASE
        WHEN LENGTH(TEL_NUM) >= 4 THEN SUBSTR(TEL_NUM, 1, LENGTH(TEL_NUM) - 4) || '****'
        ELSE '****'
        END AS TEL_NUM
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , CORP_ADM_YN      /*입점업체 관리자 여부*/
     , MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
     , BAD_USER_YN
     , BAD_USER_RSN
     , SEX
     , BTH
     , SNS_DIV
     , PARTNER_CD
  FROM (SELECT ROWNUM AS RN
             , USER_ID          /*사용자 아이디*/
		     , AUTH_NM          /*권한 명*/
		     , USER_NM          /*사용자 명*/
		     , EMAIL            /*이메일*/
		     , TEL_NUM          /*전화 번호*/
		     , PWD              /*패스워드*/
		     , POST_NUM         /*우편번호*/
		     , ROAD_NM_ADDR     /*도로명 주소*/
		     , DTL_ADDR         /*상세 주소*/
		     , QUT_YN           /*탈퇴 여부*/
		     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
		     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
		     , FRST_REG_DTTM    /*최초 등록 일시*/
		     , LAST_MOD_DTTM    /*최종 수정 일시*/
		     , CORP_ADM_YN      /*입점업체 관리자 여부*/
             , MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
		     , BAD_USER_YN
     		 , BAD_USER_RSN
     		 , SEX
     		 , BTH
     		 , SNS_DIV
     		 , PARTNER_CD
		  FROM (SELECT T_USER.USER_ID          /*사용자 아이디*/
				     , T_USER.AUTH_NM          /*권한 명*/
				     , T_USER.USER_NM          /*사용자 명*/
				     , T_USER.EMAIL            /*이메일*/
				     , T_USER.TEL_NUM          /*전화 번호*/
				     , T_USER.PWD              /*패스워드*/
				     , T_USER.POST_NUM         /*우편번호*/
				     , T_USER.ROAD_NM_ADDR     /*도로명 주소*/
				     , T_USER.DTL_ADDR         /*상세 주소*/
				     , T_USER.QUT_YN           /*탈퇴 여부*/
				     , T_USER.LAST_LOGIN_DTTM  /*최종 로그인 일시*/
				     , T_USER.LAST_LOGIN_IP    /*최종 로그인 아이피*/
				     , T_USER.FRST_REG_DTTM    /*최초 등록 일시*/
				     , T_USER.LAST_MOD_DTTM    /*최종 수정 일시*/
                     , T_USER.MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
		             , (CASE WHEN (SELECT COUNT(USER_ID)
		                             FROM TB_CORPADM
		                            WHERE USER_ID = T_USER.USER_ID) > 0
		                     THEN 'Y'
		                     ELSE 'N'
		                 END
		               ) AS CORP_ADM_YN
		             , T_USER.BAD_USER_YN
     				 , T_USER.BAD_USER_RSN
     				 , T_USER.SEX
     				 , T_USER.BTH
     				 , T_SNS.SNS_DIV
     				 , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = T_USER.PARTNER_CD) AS  PARTNER_CD
				  FROM TB_USER T_USER
				  LEFT OUTER JOIN TB_USERSNS T_SNS
    				ON T_SNS.USER_ID = T_USER.USER_ID
				 WHERE T_USER.QUT_YN = 'N'
				 <isNotEmpty property="sUserNm">
				   AND T_USER.USER_NM LIKE '%'||#sUserNm#||'%'
				 </isNotEmpty>
				 <isNotEmpty property="sTelNum">
				   AND T_USER.TEL_NUM LIKE '%'||#sTelNum#||'%'
				 </isNotEmpty>
				 <isNotEmpty property="sUserId">
				   AND T_USER.USER_ID LIKE '%'||#sUserId#||'%'
				 </isNotEmpty>
				 <isNotEmpty property="sEmail">
				   AND T_USER.EMAIL LIKE '%'||#sEmail#||'%'
				 </isNotEmpty>
				 <isEqual property="sCorpAdminDiv" compareValue="A">
				   AND T_USER.AUTH_NM = 'ADMIN'
				 </isEqual>
				 <isEqual property="sCorpAdminDiv" compareValue="N">
				   AND T_USER.AUTH_NM = 'USER'
				 </isEqual>
				 <isNotEmpty property="sBadUserYn">
				   AND T_USER.BAD_USER_YN = #sBadUserYn#
				 </isNotEmpty>
		         <isNotEmpty property="sPartnerCd">
		           AND T_USER.PARTNER_CD = #sPartnerCd#
		         </isNotEmpty>      				 
		       )
		 WHERE 1=1
		 <isEqual property="sCorpAdminDiv" compareValue="N">
		   AND CORP_ADM_YN = 'N'
		 </isEqual>
		 <isEqual property="sCorpAdminDiv" compareValue="C">
		   AND CORP_ADM_YN = 'Y'
		 </isEqual>
       )
</select>


<!-- 사용자 자동 분류 사용 -->
<select id="USER_S_13" resultMap="USER_R_02">
SELECT *
FROM
(
	SELECT T_USER.USER_ID          /*사용자 아이디*/
	     , AUTH_NM          /*권한 명*/
	     , USER_NM          /*사용자 명*/
	     , EMAIL            /*이메일*/
	     , TEL_NUM          /*전화 번호*/
	     , PWD              /*패스워드*/
	     , POST_NUM         /*우편번호*/
	     , ROAD_NM_ADDR     /*도로명 주소*/
	     , DTL_ADDR         /*상세 주소*/
         , MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
	     , QUT_YN           /*탈퇴 여부*/
	     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
	     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
	     , FRST_REG_DTTM    /*최초 등록 일시*/
	     , LAST_MOD_DTTM    /*최종 수정 일시*/
	     , (CASE WHEN (SELECT COUNT(USER_ID)
	                     FROM TB_CORPADM
	                    WHERE USER_ID = T_USER.USER_ID) > 0
	             THEN 'Y'
	             ELSE 'N'
	         END
	       ) AS CORP_ADM_YN
	     , BAD_USER_YN
	     , BAD_USER_RSN
	     , SEX
	     , BTH
	     , NVL(RSV_CNT, 0) RSV_CNT
	     , NVL(RSV_AMT, 0) RSV_AMT
	     , (SELECT COUNT(*) FROM TB_LOGIN_LOG
	     	WHERE ID=T_USER.USER_ID
	     	AND LOGIN_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
	     	) LOGIN_CNT
	     , (SELECT COUNT(*) FROM TB_PRMT_CMT
	     	WHERE USER_ID = T_USER.USER_ID
	     	AND FRST_REG_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
	     	) PRMT_CMT_CNT
	     , ( SELECT COUNT(*) FROM TB_USEEPIL
	     	 WHERE USER_ID = T_USER.USER_ID
	     	 AND FRST_REG_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
	     	)  USEEPIL_CNT
	     , ( SELECT NVL(SUM(LPOINT_USE_POINT),0) FROM TB_RSV
	     	 WHERE USER_ID = T_USER.USER_ID
	     	 AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
	     	)  LPOINT_USE
	     , ( SELECT NVL(SUM(TOTAL_DIS_AMT-TOTAL_DIS_CANCEL_AMT),0) FROM TB_RSV
           	 WHERE USER_ID=T_USER.USER_ID
           	 AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
        	) TOTAL_DIS_AMT

         , ( SELECT COUNT(PAY_DIV)  FROM TB_RSV
           	 WHERE USER_ID=T_USER.USER_ID
             AND PAY_DIV ='L100'
             AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
        	) PAY_DIV_CNT_L100
        , ( SELECT COUNT(PAY_DIV)  FROM TB_RSV
           	 WHERE USER_ID=T_USER.USER_ID
             AND PAY_DIV ='L200'
             AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
        	) PAY_DIV_CNT_L200
        , ( SELECT COUNT(PAY_DIV)  FROM TB_RSV
           	 WHERE USER_ID=T_USER.USER_ID
             AND PAY_DIV ='L300'
             AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
        	) PAY_DIV_CNT_L300
        , ( SELECT COUNT(PAY_DIV)  FROM TB_RSV
           	 WHERE USER_ID=T_USER.USER_ID
             AND PAY_DIV ='L400'
             AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
        	) PAY_DIV_CNT_L400

		, ( SELECT COUNT(T_RSV1.RSV_NUM)
             FROM TB_AD_RSV TP_RSV INNER JOIN TB_RSV T_RSV1 ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
            ) RSV_AD_CNT
        , ( SELECT COUNT(T_RSV1.RSV_NUM)
             FROM TB_RC_RSV TP_RSV INNER JOIN TB_RSV T_RSV1 ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
            ) RSV_RC_CNT
        , ( SELECT COUNT(TP_RSV.RSV_NUM)
             FROM TB_SP_RSV TP_RSV
             INNER JOIN TB_RSV T_RSV1
             ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM =TP_RSV.PRDT_NUM) LIKE 'C2%'
             AND USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
           ) RSV_SPC200_CNT
        , ( SELECT COUNT(TP_RSV.RSV_NUM)
             FROM TB_SP_RSV TP_RSV
             INNER JOIN TB_RSV T_RSV1
             ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM =TP_RSV.PRDT_NUM) LIKE 'C3%'
             AND USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
           ) RSV_SPC300_CNT
        , ( SELECT COUNT(TP_RSV.RSV_NUM)
             FROM TB_SP_RSV TP_RSV
             INNER JOIN TB_RSV T_RSV1
             ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM =TP_RSV.PRDT_NUM) = '130'
             AND USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
           ) RSV_SPC130_CNT
        , ( SELECT COUNT(TP_RSV.RSV_NUM)
             FROM TB_SP_RSV TP_RSV
             INNER JOIN TB_RSV T_RSV1
             ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM =TP_RSV.PRDT_NUM) = '170'
             AND USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
           ) RSV_SPC170_CNT
        , ( SELECT COUNT(TP_RSV.RSV_NUM)
             FROM TB_SP_RSV TP_RSV
             INNER JOIN TB_RSV T_RSV1
             ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM =TP_RSV.PRDT_NUM) = '160'
             AND USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
           ) RSV_SPC160_CNT
        , ( SELECT COUNT(T_RSV1.RSV_NUM)
             FROM TB_SV_RSV TP_RSV INNER JOIN TB_RSV T_RSV1 ON T_RSV1.RSV_NUM = TP_RSV.RSV_NUM
             WHERE USER_ID=T_USER.USER_ID
             AND T_RSV1.MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
            ) RSV_SV_CNT
		, PARTNER_CD
	 FROM TB_USER T_USER
   LEFT JOIN
   <!-- INNER JOIN -->
	(
	    SELECT USER_ID
	        ,COUNT(RSV_NUM) RSV_CNT
	        ,SUM(TOTAL_SALE_AMT) RSV_AMT
	    FROM TB_RSV
	    WHERE RSV_STATUS_CD IN ('RS02', 'RS03', 'RS11', 'RS12','RS30', 'RS32')
	    AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1

	    <!-- 구매시기-1 -->
		<isNotEmpty property="sBuyDateS">
		 		<![CDATA[
		 		AND TO_DATE(#sBuyDateS#, 'YYYYMMDDHH') <= MOD_DTTM
		 		]]>
		</isNotEmpty>
		<isNotEmpty property="sBuyDateE">
		 		<![CDATA[
		 		AND MOD_DTTM <= TO_DATE(#sBuyDateE#, 'YYYYMMDDHH')
		 		]]>
		</isNotEmpty>

	    GROUP BY USER_ID
	)T_RSV
	ON T_RSV.USER_ID = T_USER.USER_ID
	 WHERE QUT_YN = 'N'
 )
 WHERE 1=1
 <isNotEmpty property="sMarketingRcvAgrYn">
  AND MARKETING_RCV_AGR_YN = #sMarketingRcvAgrYn#
 </isNotEmpty>
 <isNotEmpty property="sSex">
   AND SEX = #sSex#
 </isNotEmpty>
 <!-- 나이대 -->
 <isNotEmpty property="sAge">
 		<isEqual property="sAge" compareValue="10" >
 			<![CDATA[
	 		AND 0 <= (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4))
	 		AND (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4)) < 20
	 		]]>
	 	</isEqual>
	 	<isEqual property="sAge" compareValue="20" >
	 		<![CDATA[
	 		AND 20 <= (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4))
	 		AND (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4)) < 30
	 		]]>
	 	</isEqual>
	 	<isEqual property="sAge" compareValue="30" >
	 		<![CDATA[
	 		AND 30 <= (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4))
	 		AND (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4)) < 40
	 		]]>
	 	</isEqual>
	 	<isEqual property="sAge" compareValue="40" >
	 		<![CDATA[
	 		AND 40 <= (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4))
	 		AND (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4)) < 50
	 		]]>
	 	</isEqual>
	 	<isEqual property="sAge" compareValue="50" >
	 		<![CDATA[
	 		AND 50 <= (TO_CHAR(SYSDATE, 'YYYY') - SUBSTR(BTH, 1, 4))
	 		]]>
	 	</isEqual>
 </isNotEmpty>
 <!-- 지역 -->
 <isNotEmpty property="sArea">
 		<isEqual property="sArea" compareValue="1" >AND ROAD_NM_ADDR LIKE '서울%'</isEqual>
 		<isEqual property="sArea" compareValue="2" >AND ROAD_NM_ADDR LIKE '경기%'</isEqual>
 		<isEqual property="sArea" compareValue="3" >AND ROAD_NM_ADDR LIKE '인천%'</isEqual>
 		<isEqual property="sArea" compareValue="4" >AND ROAD_NM_ADDR LIKE '부산%'</isEqual>
 		<isEqual property="sArea" compareValue="5" >AND ROAD_NM_ADDR LIKE '대구%'</isEqual>
 		<isEqual property="sArea" compareValue="6" >AND ROAD_NM_ADDR LIKE '대전%'</isEqual>
 		<isEqual property="sArea" compareValue="7" >AND ROAD_NM_ADDR LIKE '광주%'</isEqual>
 		<isEqual property="sArea" compareValue="8" >AND ROAD_NM_ADDR LIKE '울산%'</isEqual>
 		<isEqual property="sArea" compareValue="9" >AND ROAD_NM_ADDR LIKE '강원%'</isEqual>
 		<isEqual property="sArea" compareValue="10">AND ROAD_NM_ADDR LIKE '경남%'</isEqual>
 		<isEqual property="sArea" compareValue="11">AND ROAD_NM_ADDR LIKE '경북%'</isEqual>
 		<isEqual property="sArea" compareValue="12">AND ROAD_NM_ADDR LIKE '전남%'</isEqual>
 		<isEqual property="sArea" compareValue="13">AND ROAD_NM_ADDR LIKE '전북%'</isEqual>
 		<isEqual property="sArea" compareValue="14">AND ROAD_NM_ADDR LIKE '충남%'</isEqual>
 		<isEqual property="sArea" compareValue="15">AND ROAD_NM_ADDR LIKE '충북%'</isEqual>
 		<isEqual property="sArea" compareValue="16">AND ROAD_NM_ADDR LIKE '제주%'</isEqual>
 		<isEqual property="sArea" compareValue="17">AND ROAD_NM_ADDR LIKE '세종%'</isEqual>
 </isNotEmpty>
 <isNotEmpty property="sBlkList">
   AND BAD_USER_YN = #sBlkList#
 </isNotEmpty>

 <!-- 로그인 숫자 -->
 <isNotEmpty property="sLoginCntS">
 		<![CDATA[
 		AND #sLoginCntS# <= LOGIN_CNT
 		]]>
 </isNotEmpty>
  <isNotEmpty property="sLoginCntE">
 		<![CDATA[
 		AND LOGIN_CNT <= #sLoginCntE#
 		]]>
 </isNotEmpty>

 <!-- 구매횟수 -->
 <isNotEmpty property="sBuyCntS">
 		<![CDATA[
 		AND #sBuyCntS# <= RSV_CNT
 		]]>
 </isNotEmpty>
 <isNotEmpty property="sBuyCntE">
 		<![CDATA[
 		AND RSV_CNT <= #sBuyCntE#
 		]]>
 </isNotEmpty>

 <!-- 구매금액 -->
 <isNotEmpty property="sBuyAmtS">
 		<![CDATA[
 		AND #sBuyAmtS# <= RSV_AMT
 		]]>
 </isNotEmpty>
 <isNotEmpty property="sBuyAmtE">
 		<![CDATA[
 		AND RSV_AMT <= #sBuyAmtE#
 		]]>
 </isNotEmpty>

<!-- 구매상품 -->
<isNotEmpty property="sCate">
		AND( 1!=1
 		<isEqual property="sCateAD" compareValue="Y" >OR RSV_AD_CNT > 0</isEqual>
 		<isEqual property="sCateRC" compareValue="Y" >OR RSV_RC_CNT > 0</isEqual>
 		<isEqual property="sCateSPC200" compareValue="Y" >OR RSV_SPC200_CNT > 0</isEqual>
 		<isEqual property="sCateSPC300" compareValue="Y" >OR RSV_SPC300_CNT > 0</isEqual>
 		<isEqual property="sCateSPC130" compareValue="Y" >OR RSV_SPC130_CNT > 0</isEqual>
 		<isEqual property="sCateSPC170" compareValue="Y" >OR RSV_SPC170_CNT > 0</isEqual>
 		<isEqual property="sCateSPC160" compareValue="Y" >OR RSV_SPC160_CNT > 0</isEqual>
 		<isEqual property="sCateSV" compareValue="Y" >OR RSV_SV_CNT > 0</isEqual>
 		)
</isNotEmpty>

<!-- 구매시기-2 -->
<isNotEmpty property="sBuyDateS">
 		AND RSV_CNT != 0
</isNotEmpty>
<isNotEmpty property="sBuyDateE">
 		AND RSV_CNT != 0
</isNotEmpty>

 <!-- 이벤트 -->
 <isNotEmpty property="sEvent">
 		<isEqual property="sEvent" compareValue="Y" > AND PRMT_CMT_CNT > 0 </isEqual>
 		<isEqual property="sEvent" compareValue="N" > AND PRMT_CMT_CNT = 0 </isEqual>
 </isNotEmpty>
 <!-- 상품평 -->
 <isNotEmpty property="sUseepil">
 		<isEqual property="sUseepil" compareValue="Y" > AND USEEPIL_CNT > 0 </isEqual>
 		<isEqual property="sUseepil" compareValue="N" > AND USEEPIL_CNT = 0 </isEqual>
 </isNotEmpty>
 <!-- L-Point -->
 <isNotEmpty property="sLPointYn">
 		<isEqual property="sLPointYn" compareValue="Y" > AND LPOINT_USE > 0 </isEqual>
 		<isEqual property="sLPointYn" compareValue="N" > AND LPOINT_USE = 0 </isEqual>
 </isNotEmpty>
 <!-- 쿠폰사용여부 -->
 <isNotEmpty property="sCuponYn">
 		<isEqual property="sCuponYn" compareValue="Y" > AND TOTAL_DIS_AMT > 0 </isEqual>
 		<isEqual property="sCuponYn" compareValue="N" > AND TOTAL_DIS_AMT = 0 </isEqual>
 </isNotEmpty>

  <!-- 결제방법 -->
 <isNotEmpty property="sPayDiv">
 		<isEqual property="sPayDiv" compareValue="L100" > AND PAY_DIV_CNT_L100 > 0 </isEqual>
 		<isEqual property="sPayDiv" compareValue="L200" > AND PAY_DIV_CNT_L200 > 0 </isEqual>
 		<isEqual property="sPayDiv" compareValue="L300" > AND PAY_DIV_CNT_L300 > 0 </isEqual>
 		<isEqual property="sPayDiv" compareValue="L400" > AND PAY_DIV_CNT_L400 > 0 </isEqual>
 </isNotEmpty>

</select>


<!-- 사용자 자동 분류 사용 -기간내 재구매 검색-->
<select id="USER_S_14" resultClass="int">
<!-- SELECT NVL(SUM(RSV_CNT),0) RSV_CNT -->
SELECT NVL(COUNT(DECODE(RSV_CNT, 0, '','1')),0) RSV_CNT
FROM(
    SELECT RSV_NUM
         , MOD_DTTM
         , (SELECT COUNT(RSV_NUM)
             FROM TB_RSV
            WHERE USER_ID = #sUserId#
            AND RSV_STATUS_CD IN ('RS02', 'RS03', 'RS11', 'RS12','RS30', 'RS32')
            <![CDATA[
            AND T_R.MOD_DTTM < MOD_DTTM
            AND MOD_DTTM <= T_R.MOD_DTTM+(#sReBuy#*7)
            ]]>
            AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
            ) RSV_CNT
     FROM TB_RSV T_R
    WHERE USER_ID = #sUserId#
    AND RSV_STATUS_CD IN ('RS02', 'RS03', 'RS11', 'RS12','RS30', 'RS32')
    AND MOD_DTTM BETWEEN TO_DATE(#sProcStdS#, 'YYYYMMDDHH') AND TO_DATE(#sProcStdE#, 'YYYYMMDDHH')+ 1
)
</select>

<select id="USER_S_15" resultMap="USER_R_15">
SELECT EMAIL 
	FROM TB_USER
    WHERE QUT_YN = 'N'
      AND EMAIL != ' '
      AND REST_YN = 'N'
      <![CDATA[
      AND TO_CHAR(LAST_LOGIN_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE - 358, 'YYYYMMDD')
      ]]>
</select>

<select id="USER_S_16" resultMap="USER_R_15">
SELECT EMAIL 
	FROM TB_USER
    WHERE QUT_YN = 'N'
      AND EMAIL! = ' '
      AND REST_YN = 'N'
      <![CDATA[
      AND TO_CHAR(LAST_LOGIN_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE - 365, 'YYYYMMDD')
      ]]>
</select>

<select id="USER_S_17" resultMap="USER_R_15">
SELECT EMAIL 
	FROM TB_USER
    WHERE QUT_YN = 'N'
      AND EMAIL! = ' '
      AND REST_YN = 'N'
      AND EMAIL_RCV_AGR_YN = 'Y'
      <![CDATA[
      AND TO_CHAR(LAST_LOGIN_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE - 300, 'YYYYMMDD')
      ]]>
</select>

<select id="USER_S_18" resultClass="int">
SELECT COUNT(EMAIL) 
	FROM TB_USER
    WHERE USER_ID = #userId#
      AND QUT_YN = 'N'
      AND EMAIL != ' '
      AND REST_YN ='N'
      AND EMAIL_RCV_AGR_YN = 'Y'
      <![CDATA[
      AND TO_CHAR(LAST_LOGIN_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE - 300, 'YYYYMMDD')
      ]]>
</select>

<select id="USER_S_19" resultMap="USER_R_15">
SELECT EMAIL 
FROM TB_USER T_USER
  INNER JOIN TB_USER_CP T_CP ON T_CP.USER_ID=T_USER.USER_ID
WHERE QUT_YN = 'N'
  AND EMAIL != ' '
  AND REST_YN = 'N'
  AND EMAIL_RCV_AGR_YN = 'Y'
  AND CP_ID = #cpId#
</select>

<select id="USER_S_20" resultMap="USER_R_15">
SELECT EMAIL
FROM TB_USER
WHERE QUT_YN = 'N'
  AND EMAIL_RCV_AGR_YN = 'Y'
  /*AND USER_ID NOT IN (SELECT USER_ID FROM TB_CORPADM)*/
</select>

<insert id="USER_I_00">
INSERT INTO TB_USER
     ( USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , EMAIL_RCV_AGR_YN /*이메일 수신 동의 여부*/
     , SMS_RCV_AGR_YN   /*SMS 수신 동의 여부*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     )
VALUES
     ( #userId#
     , #authNm#
     , #userNm#
     , #email#
     , #telNum#
     , #pwd#
     , #postNum#
     , #roadNmAddr#
     , #dtlAddr#
     , #emailRcvAgrYn#
     , #smsRcvAgrYn#
     , #qutYn#
     , SYSDATE
     , ''
     , SYSDATE
     , SYSDATE
     )
</insert>

<!-- User 등록 -->
<insert id="USER_I_01">
<selectKey keyProperty="userId" resultClass="String">
(SELECT 'U' || LPAD(TO_CHAR(NVL(TO_NUMBER(SUBSTR(USER_ID,-9)), 0) + 1), 9, '0') AS USER_ID
FROM (
    SELECT USER_ID
    FROM TB_USER
    WHERE USER_ID LIKE 'U%'
    ORDER BY USER_ID DESC
) WHERE ROWNUM = 1)
</selectKey>
INSERT INTO TB_USER
     ( USER_ID          /*사용자 아이디*/
     , AUTH_NM          /*권한 명*/
     , USER_NM          /*사용자 명*/
     , EMAIL            /*이메일*/
     , TEL_NUM          /*전화 번호*/
     , PWD              /*패스워드*/
     , POST_NUM         /*우편번호*/
     , ROAD_NM_ADDR     /*도로명 주소*/
     , DTL_ADDR         /*상세 주소*/
     , QUT_YN           /*탈퇴 여부*/
     , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
     , LAST_LOGIN_IP    /*최종 로그인 아이피*/
     , FRST_REG_DTTM    /*최초 등록 일시*/
     , LAST_MOD_DTTM    /*최종 수정 일시*/
     , BAD_USER_YN
     , BAD_USER_RSN
     , SEX
     , BTH
     , MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
     , PARTNER_CD
     , PARTNER_CODE
     )
VALUES
     ( #userId#
     , #authNm#
     , #userNm#
     , #email#
     , #telNum#
     , #pwd#
     , #postNum#
     , #roadNmAddr#
     , #dtlAddr#
     , 'N'
     , SYSDATE
     , ''
     , SYSDATE
     , SYSDATE
     , #badUserYn#
     , #badUserRsn#
     , #sex#
     , #bth#
     , #marketingRcvAgrYn#
     , #partnerCd#
     , #partnerCode#
     )
</insert>

<update id="USER_U_00">
UPDATE TB_USER
   SET AUTH_NM          = #authNm#
     , USER_NM          = #userNm#
     , EMAIL            = #email#
     , TEL_NUM          = #telNum#
     , PWD              = #pwd#
     , POST_NUM         = #postNum#
     , ROAD_NM_ADDR     = #roadNmAddr#
     , DTL_ADDR         = #dtlAddr#
     , EMAIL_RCV_AGR_YN = #emailRcvAgrYn#
     , SMS_RCV_AGR_YN   = #smsRcvAgrYn#
     , QUT_YN           = #qutYn#
     , LAST_MOD_DTTM    = SYSDATE
 WHERE USER_ID          = #userId#
</update>

<update id="USER_U_01">
UPDATE TB_USER
   SET EMAIL            = #email#
     , USER_NM          = #userNm#
     <isNotEmpty property="authNm">
     , AUTH_NM          = #authNm#
     </isNotEmpty>
     , TEL_NUM          = #telNum#
     , POST_NUM         = #postNum#
     , ROAD_NM_ADDR     = #roadNmAddr#
     , DTL_ADDR         = #dtlAddr#
     , LAST_MOD_DTTM    = SYSDATE
     , BAD_USER_YN    = #badUserYn#
     , BAD_USER_RSN    = #badUserRsn#
     , SEX = #sex#
     , BTH = #bth#
     , MARKETING_RCV_AGR_YN = #marketingRcvAgrYn#
     , PARTNER_CODE     = #partnerCode#
 WHERE USER_ID          = #userId#
</update>

<!-- 유저 탈퇴처리 -->
<update id="USER_U_02">
UPDATE TB_USER
   SET USER_NM 			= ''
     , EMAIL   			= ''
     , TEL_NUM 			= ''
     , PWD              = ''
     , POST_NUM         = ''
     , ROAD_NM_ADDR     = ''
     , DTL_ADDR         = ''
     , EMAIL_RCV_AGR_YN = 'N'
     , SMS_RCV_AGR_YN   = 'N'
     , QUT_YN  			= 'Y'
     , QUT_RSN          = #qutRsn#
     , LAST_MOD_DTTM    = SYSDATE
 WHERE USER_ID 			= #userId#
</update>

<!-- 최종 로그인 IP,시간 업데이트 -->
<update id="USER_U_03">
UPDATE TB_USER
   SET LAST_LOGIN_IP = #lastLoginIp#
     , LAST_LOGIN_DTTM = SYSDATE
 WHERE USER_ID = #userId#
</update>

<update id="USER_U_04">
UPDATE TB_USER
   SET PWD = #newPwd#
     , LAST_MOD_DTTM = SYSDATE
 WHERE USER_ID = #userId#
</update>

<update id="USER_U_05">
UPDATE TB_USER
   SET SMS_AUTH_NUM = #smsAuthNum#
 WHERE EMAIL = #email#
   AND TEL_NUM = #telNum#
</update>

<update id="USER_U_06">
UPDATE TB_USER
   SET REST_YN = 'Y'
 WHERE QUT_YN='N'
      AND EMAIL!=' '
      AND REST_YN='N'
      <![CDATA[
      AND TO_CHAR(LAST_LOGIN_DTTM, 'YYYYMMDD')<=TO_CHAR(SYSDATE - 365, 'YYYYMMDD')
      ]]>
</update>

<update id="USER_U_07">
UPDATE TB_USER
   SET REST_YN='N'
 WHERE USER_ID = #sUserId#
 	AND REST_YN='Y'
</update>


<update id="USER_U_08">
UPDATE TB_USER
   SET SNS_IDV = #sSnsDiv#
 WHERE USER_ID = #sUserId#
</update>



<select id="LOGINLOG_S_00" resultMap="LOGINLOG_R_00">
SELECT LOGIN_DTTM
     , ID
     , PC_YN
     , IP
     , TELNUM
FROM TB_LOGIN_LOG
</select>

<update id="LOGINLOG_I_00">
INSERT INTO TB_LOGIN_LOG
   	( LOGIN_DTTM
    , ID
    , PC_YN
    , IP
    , TELNUM
    )
VALUES
	( SYSDATE
	, #id#
	, #pcYn#
	, #ip#
    , #telnum#
	)
</update>
<select id="USER_S_21" resultMap="USER_R_08">
    SELECT USER_ID          /*사용자 아이디*/
    , AUTH_NM          /*권한 명*/
    , USER_NM          /*사용자 명*/
    , EMAIL            /*이메일*/
    , TEL_NUM          /*전화 번호*/
    , PWD              /*패스워드*/
    , MARKETING_RCV_AGR_YN /*마케팅 수신여부*/
    , QUT_YN           /*탈퇴 여부*/
    , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
    , LAST_LOGIN_IP    /*최종 로그인 아이피*/
    , FRST_REG_DTTM    /*최초 등록 일시*/
    , PARTNER_CD
    , PLUS_POINT
    , MINUS_POINT
    FROM (SELECT ROWNUM AS RN
        , USER_ID          /*사용자 아이디*/
        , AUTH_NM          /*권한 명*/
        , USER_NM          /*사용자 명*/
        , EMAIL            /*이메일*/
        , TEL_NUM          /*전화 번호*/
        , PWD              /*패스워드*/
        , MARKETING_RCV_AGR_YN  /*마케팅 수신 여부*/
        , QUT_YN           /*탈퇴 여부*/
        , LAST_LOGIN_DTTM  /*최종 로그인 일시*/
        , LAST_LOGIN_IP    /*최종 로그인 아이피*/
        , FRST_REG_DTTM    /*최초 등록 일시*/
        , PARTNER_CD
        , PLUS_POINT
        , MINUS_POINT
        FROM (SELECT /*+ INDEX_DESC(T_USER IDX_USER_01) */ T_USER.USER_ID /*사용자 아이디*/
                , T_USER.AUTH_NM /*권한 명*/
                , T_USER.USER_NM /*사용자 명*/
                , T_USER.EMAIL /*이메일*/
                , T_USER.TEL_NUM /*전화 번호*/
                , T_USER.PWD /*패스워드*/
                , T_USER.MARKETING_RCV_AGR_YN /*마케팅 수신 여부*/
                , T_USER.QUT_YN /*탈퇴 여부*/
                , T_USER.LAST_LOGIN_DTTM /*최종 로그인 일시*/
                , T_USER.LAST_LOGIN_IP /*최종 로그인 아이피*/
                , T_USER.FRST_REG_DTTM /*최초 등록 일시*/
                , T_USER.LAST_MOD_DTTM /*최종 수정 일시*/
                , T_USER.PARTNER_CD
                , PLUS_POINT
                ,MINUS_POINT
                FROM TB_USER T_USER
                INNER JOIN (
                    SELECT
                    NVL(SUM(CASE WHEN PLUS_MINUS = 'P' AND TYPES != 'CANCEL' THEN POINT ELSE 0 END),0) AS PLUS_POINT
                    ,NVL(SUM(CASE WHEN PLUS_MINUS = 'M' THEN POINT ELSE 0 END) - SUM(CASE WHEN TYPES='CANCEL' THEN POINT ELSE 0 END),0) AS MINUS_POINT
                    , USER_ID
                    FROM TB_POINT
                    WHERE PARTNER_CODE =  #partnerCode#
                    GROUP BY USER_ID
                ) TP
                ON T_USER.USER_ID = TP.USER_ID
            WHERE 1=1
            <isNotEmpty property="sUserNm">
                AND T_USER.USER_NM LIKE '%'||#sUserNm#||'%'
            </isNotEmpty>
            <isNotEmpty property="sTelNum">
                AND T_USER.TEL_NUM LIKE '%'||#sTelNum#||'%'
            </isNotEmpty>
            <isNotEmpty property="sUserId">
                AND T_USER.USER_ID LIKE '%'||#sUserId#||'%'
            </isNotEmpty>
            <isNotEmpty property="sEmail">
                AND T_USER.EMAIL LIKE '%'||#sEmail#||'%'
            </isNotEmpty>
        )
    )
    <!--엑셀다운일때는 실행하지 않음-->
    <isNotEqual property="lastIndex" compareValue="0">
        WHERE RN BETWEEN TO_NUMBER(#firstIndex#) + 1 AND TO_NUMBER(#lastIndex#)
    </isNotEqual>

</select>

<select id="USER_S_22" resultClass="int">
    SELECT COUNT(1) FROM (
        SELECT T_USER.USER_ID
        FROM TB_USER T_USER
        INNER JOIN TB_POINT TP ON T_USER.USER_ID = TP.USER_ID
        WHERE TP.PARTNER_CODE = #partnerCode#
        <isNotEmpty property="sUserNm">
            AND T_USER.USER_NM LIKE '%'||#sUserNm#||'%'
        </isNotEmpty>
        <isNotEmpty property="sTelNum">
            AND T_USER.TEL_NUM LIKE '%'||#sTelNum#||'%'
        </isNotEmpty>
        <isNotEmpty property="sUserId">
            AND T_USER.USER_ID LIKE '%'||#sUserId#||'%'
        </isNotEmpty>
        <isNotEmpty property="sEmail">
            AND T_USER.EMAIL LIKE '%'||#sEmail#||'%'
        </isNotEmpty>
        GROUP BY T_USER.USER_ID
    )
</select>

<select id="USER_S_23" resultMap="USER_R_09">
SELECT
    (SELECT NVL(PARTNER_BUDGET,0) FROM TB_POINT_CP WHERE PARTNER_CODE = #partnerCode# ) AS PARTNER_BUDGET
     , (SELECT NVL(SUM(POINT),0) FROM TB_POINT  WHERE PARTNER_CODE = #partnerCode# AND PLUS_MINUS ='P' AND TYPES != 'CANCEL' ) AS PLUS_POINT
     , (SELECT NVL(SUM(POINT),0) FROM TB_POINT WHERE PARTNER_CODE = #partnerCode# AND PLUS_MINUS ='M') - (SELECT NVL(SUM(POINT),0) FROM TB_POINT WHERE PARTNER_CODE = #partnerCode# AND TYPES = 'CANCEL') AS MINUS_POINT
FROM DUAL
</select>

<select id="USER_S_24" resultClass="common.LowerHashMap">
    SELECT USER_ID,USE_TELNUM FROM (
	SELECT
		B.USER_ID,
		B.USE_TELNUM,
		TO_CHAR(SYSDATE,'YYYYMMDD') AS CURDATE
	FROM TB_USER AS A
	JOIN
		(
		SELECT USER_ID, USE_TELNUM FROM TB_RSV WHERE RSV_NUM IN (
		SELECT RSV_NUM FROM TB_RC_RSV WHERE RSV_STATUS_CD = 'RS30' AND RENT_END_DT = TO_CHAR(SYSDATE-1,'YYYYMMDD')
		UNION
		SELECT RSV_NUM FROM TB_SP_RSV WHERE RSV_STATUS_CD = 'RS30' AND CORP_ID NOT LIKE 'CSPF%' AND CORP_ID NOT LIKE 'CSPC%' AND CORP_ID NOT LIKE 'CSPT%' AND TO_CHAR(USE_DTTM,'YYYYMMDD') = TO_CHAR(SYSDATE-1,'YYYYMMDD')
		)
		GROUP BY USER_ID, USE_TELNUM
		HAVING USER_ID != 'GUEST'
	) AS B
	ON A.USER_ID = B.USER_ID
	WHERE MARKETING_RCV_AGR_YN = 'Y'
) AS T1
JOIN EVENT AS T2
ON EVENT_NM = 'ohmyjeju' AND T1.CURDATE <![CDATA[<=]]> T2.CONDITION1
</select>

</sqlMap>
