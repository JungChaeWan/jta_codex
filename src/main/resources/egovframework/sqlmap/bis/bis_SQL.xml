<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="bis">

<resultMap id="BIS_R_00" class="oss.bis.vo.BISVO">
<result property="totalMemCnt" column="TOTAL_MEM_CNT" />
</resultMap>

<resultMap id="BIS_R_01" class="oss.anls.vo.ANLS10VO">
<result property="totalCnt" 	column="TOTAL_CNT"/>
<result property="qutCnt" 		column="QUT_CNT"/>
<result property="qutPer" 		column="QUT_PER"/>
<result property="rsvCnt" 		column="RSV_CNT"/>
<result property="rsvPer" 		column="RSV_PER"/>
<result property="duplRsvCnt" 	column="DUPL_RSV_CNT"/>
<result property="duplPer" 		column="DUPL_PER"/>
<result property="reRsvCnt" 	column="RE_RSV_CNT"/>
<result property="reRsvPer" 	column="RE_RSV_PER"/>
</resultMap>

<resultMap id="BIS_R_02" class="oss.anls.vo.ANLS11VO">
<result property="totalAmt" 	column="TOTAL_AMT"/>
<result property="totalCnt" 	column="TOTAL_CNT"/>
</resultMap>

<resultMap id="BIS_R_03" class="oss.bis.vo.BISVO">
<result property="area" column="AREA" />
<result property="areaMemCnt" column="AREA_MEM_CNT" />
<result property="areaMemPer" column="AREA_MEM_PER" />
<result property="areaCusCnt" column="AREA_CUS_CNT" />
<result property="areaCusPer" column="AREA_CUS_PER" />
</resultMap>

<resultMap id="BIS_R_04" class="oss.bis.vo.BISVO">
<result property="corpNm" column="CORP_NM" />
<result property="tradeStatusCd" column="TRADE_STATUS_CD" />
<result property="rsvCnt" column="RSV_CNT" />
<result property="nmlAmt" column="NML_AMT" />
<result property="cancelCnt" column="CANCEL_CNT" />
<result property="gpaAvg" column="GPA_AVG" />
<result property="useepilCnt" column="USEEPIL_CNT" />
<result property="otoinqCnt" column="OTOINQ_CNT" />
<result property="snsCnt" column="SNS_CNT" />
<result property="viewCnt" column="VIEW_CNT" />
<result property="duplCnt" column="DUPL_CNT" />
<result property="rn" column="RN" />
</resultMap>

<resultMap id="BIS_R_06" class="oss.bis.vo.BISVO">
<result property="totalRsvCnt" column="TOTAL_RSV_CNT" />
<result property="totalCancelCnt" column="TOTAL_CANCEL_CNT" />
<result property="totalGpaAvg" column="TOTAL_GPA_AVG" />
<result property="totalUseepilCnt" column="TOTAL_USEEPIL_CNT" />
<result property="totalOtoinqCnt" column="TOTAL_OTOINQ_CNT" />
<result property="totalSnsCnt" column="TOTAL_SNS_CNT" />
<result property="totalViewCnt" column="TOTAL_VIEW_CNT" />
<result property="totalDuplCnt" column="TOTAL_DUPL_CNT" />
</resultMap>

<resultMap id="BIS_R_07" class="oss.anls.vo.ANLS11VO">
<result property="dt" 			column="DT"/>
<result property="saleAmt" 		column="SALE_AMT"/>
<result property="cancelAmt" 	column="CANCEL_AMT"/>
<result property="totalAmt" 	column="TOTAL_AMT"/>
<result property="totalAmtPer" 	column="TOTAL_AMT_PER"/>
</resultMap>

<resultMap id="BIS_R_08" class="oss.bis.vo.BISVO">
<result property="rsvDt" column="RSV_DT" />
<result property="totalRsvCnt" column="TOTAL_RSV_CNT" />
<result property="totalRsvAmt" column="TOTAL_RSV_AMT" />
</resultMap>

<resultMap id="BIS_R_09" class="oss.bis.vo.BISVO">
<result property="rsvDt" column="RSV_DT" />
<result property="prdtGubun" column="PRDT_GUBUN" />
<result property="prdtCateNm" column="PRDT_CATE_NM" />
<result property="totalRsvAmt" column="TOTAL_RSV_AMT" />
</resultMap>

<resultMap id="BIS_R_10" class="oss.bis.vo.BISVO">
<result property="prdtCateNm" column="PRDT_CATE_NM" />
<result property="rsvNum" column="RSV_NUM" />
<result property="rsvDt" column="RSV_DT" />
<result property="cancelRequestDttm" column="CANCEL_REQUEST_DTTM" />
<result property="cancelAmt" column="CANCEL_AMT" />
<result property="cmssAmt" column="CMSS_AMT" />
<result property="corpNm" column="CORP_NM" />
<result property="prdtNm" column="PRDT_NM" />
<result property="prdtInf" column="PRDT_INF" />
<result property="cancelRsn" column="CANCEL_RSN" />
</resultMap>

<resultMap id="BIS_R_11" class="oss.bis.vo.BISVO">
<result property="prdtCateNm" column="PRDT_CATE_NM" />
<result property="rsvNum" column="RSV_NUM" />
<result property="cancelRequestDttm" column="CANCEL_REQUEST_DTTM" />
<result property="cancelAmt" column="CANCEL_AMT" />
<result property="cmssAmt" column="CMSS_AMT" />
<result property="corpNm" column="CORP_NM" />
<result property="prdtNm" column="PRDT_NM" />
<result property="prdtInf" column="PRDT_INF" />
</resultMap>

<resultMap id="BIS_R_12" class="oss.bis.vo.BISVO">
<result property="totalRsvAmt" column="TOTAL_RSV_AMT" />
<result property="totalCancelAmt" column="TOTAL_CANCEL_AMT" />
</resultMap>

<resultMap id="BIS_R_13" class="oss.bis.vo.BISVO">
<result property="prdtGubun" column="PRDT_GUBUN" />
<result property="rsvWeekGubun" column="RSV_WEEK_GUBUN" />
<result property="rsvCnt" column="RSV_CNT" />
</resultMap>

<resultMap id="BIS_R_14" class="oss.bis.vo.BISVO">
<result property="cancelWeekGubun" column="CANCEL_WEEK_GUBUN" />
<result property="cancelCnt" column="CANCEL_CNT" />
</resultMap>

<resultMap id="BIS_R_17" class="oss.bis.vo.BISVO">
<result property="prdtGubun" column="PRDT_GUBUN" />
<result property="prdtNm" column="PRDT_NM" />
<result property="rsvCnt" column="RSV_CNT" />
<result property="rsvCntPer" column="RSV_CNT_PER" />
</resultMap>

<resultMap id="BIS_R_21" class="oss.bis.vo.BISVO">
<result property="rsvCnt" column="RSV_CNT" />
<result property="rsvCntPer" column="RSV_CNT_PER" />
<result property="otherRsvCnt" column="OTHER_RSV_CNT" />
<result property="otherRsvPer" column="OTHER_RSV_PER" />
</resultMap>

<resultMap id="BIS_R_45" class="oss.bis.vo.BISVO">
<result property="rsvDt" column="RSV_DT" />
<result property="totalRsvAmt" column="TOTAL_RSV_AMT" />
<result property="totalRsvCnt" column="TOTAL_RSV_CNT" />
<result property="adtmAmt" column="ADTM_AMT" />
<result property="roasPer" column="ROAS_PER" />
<result property="cpaAmt" column="CPA_AMT" />
</resultMap>

<resultMap id="BIS_R_47" class="oss.bis.vo.BISVO">
<result property="prdtGubun" column="PRDT_GUBUN" />
<result property="rsvCnt" column="RSV_CNT" />
<result property="accountCnt" column="ACCOUNT_CNT" />
<result property="saleAmt" column="SALE_AMT" />
<result property="disAmt" column="DIS_AMT" />
<result property="cancelReqAmt" column="CANCEL_REQ_AMT" />
<result property="refundReqAmt" column="REFUND_REQ_AMT" />
<result property="disAccountCnt" column="DIS_ACCOUNT_CNT" />
<result property="pointAmt" column="POINT_AMT" />
</resultMap>

<resultMap id="BIS_R_48" class="oss.bis.vo.BISVO">
<result property="userJoinCnt" column="USER_JOIN_CNT" />
<result property="nowJoinCnt" column="NOW_JOIN_CNT" />
<result property="nowQutCnt" column="NOW_QUT_CNT" />
<result property="allQutCnt" column="ALL_QUT_CNT" />
<result property="month1JoinCnt" column="MONTH1_JOIN_CNT" />
<result property="month2JoinCnt" column="MONTH2_JOIN_CNT" />
<result property="month3JoinCnt" column="MONTH3_JOIN_CNT" />
</resultMap>

<resultMap id="BIS_R_49" class="oss.bis.vo.BISVO">
<result property="totalRsvAmt" column="TOTAL_RSV_AMT" />
<result property="totalDisAmt" column="TOTAL_DIS_AMT" />
<result property="totalCmssAmt" column="TOTAL_CMSS_AMT" />
<result property="totalSaleCmss" column="TOTAL_SALE_CMSS" />
<result property="totalAdjAmt" column="TOTAL_ADJ_AMT" />
</resultMap>

<resultMap id="BIS_R_50" class="oss.bis.vo.BISVO">
<result property="corpId" column="CORP_ID" />
<result property="corpNm" column="CORP_NM" />
<result property="saleAmt" column="SALE_AMT" />
<result property="cmssAmt" column="CMSS_AMT" />
<result property="disAmt" column="DIS_AMT" />
<result property="saleCmssAmt" column="SALE_CMSS_AMT" />
<result property="adjAmt" column="ADJ_AMT" />
</resultMap>

<resultMap id="BIS_R_54" class="oss.bis.vo.BISVO">
<result property="corpNm" column="CORP_NM" />
</resultMap>

<resultMap id="BIS_R_57" class="oss.adj.vo.ADJVO">
<result property="adjItdDt" column="ADJ_ITD_DT" />
<result property="saleAmt" column="SALE_AMT" />
<result property="cmssAmt" column="CMSS_AMT" />
<result property="saleCmss" column="SALE_CMSS" />
<result property="adjAmt" column="ADJ_AMT" />
<result property="disAmt" column="DIS_AMT" />
<result property="lastAdjAmt" column="LAST_ADJ_AMT" />
</resultMap>

<resultMap id="BIS_R_62" class="oss.bis.vo.BIS62VO">
<result property="corpDivNm" 	column="CORP_DIV_NM" />
<result property="corpDiv" 		column="CORP_DIV" />
<result property="totalCorpCnt" column="TOTAL_CORP_CNT" />
<result property="confCorpCnt" 	column="CONF_CORP_CNT" />
<result property="memCorpCnt" 	column="MEM_CORP_CNT" />
<result property="totalPrdtCnt" column="TOTAL_PRDT_CNT" />
<result property="prdtCnt01" 	column="PRDT_CNT01" />
<result property="prdtCnt02" 	column="PRDT_CNT02" />
<result property="prdtCnt03" 	column="PRDT_CNT03" />
<result property="prdtCnt04" 	column="PRDT_CNT04" />
<result property="prdtCnt05" 	column="PRDT_CNT05" />
<result property="prdtCnt06" 	column="PRDT_CNT06" />
<result property="prdtCnt07" 	column="PRDT_CNT07" />
</resultMap>

<resultMap id="BIS_R_63" class="oss.bis.vo.BIS62VO">
<result property="corpDiv" 		column="CORP_DIV" />
<result property="prdtDiv" 		column="PRDT_DIV" />
<result property="prdtDivNm" 	column="PRDT_DIV_NM" />
<result property="totalPrdtCnt" column="TOTAL_PRDT_CNT" />
<result property="prdtCnt01" 	column="PRDT_CNT01" />
<result property="prdtCnt02" 	column="PRDT_CNT02" />
<result property="prdtCnt03" 	column="PRDT_CNT03" />
<result property="prdtCnt04" 	column="PRDT_CNT04" />
<result property="prdtCnt05" 	column="PRDT_CNT05" />
<result property="prdtCnt06" 	column="PRDT_CNT06" />
<result property="prdtCnt07" 	column="PRDT_CNT07" />
</resultMap>

<resultMap id="BIS_R_64" class="oss.bis.vo.BISVO">
<result property="yearVisitorCnt" column="YEAR_VISITOR_CNT" />
<result property="month1VisitorCnt" column="MONTH1_VISITOR_CNT" />
<result property="month2VisitorCnt" column="MONTH2_VISITOR_CNT" />
<result property="month3VisitorCnt" column="MONTH3_VISITOR_CNT" />
</resultMap>

<resultMap id="BIS_R_66" class="oss.bis.vo.BISVO">
<result property="totalAvJlCnt" column="TOTAL_AV_JL_CNT" />
<result property="totalAvJlSaleamt" column="TOTAL_AV_JL_SALEAMT" />
<result property="yearAvJlCnt" column="YEAR_AV_JL_CNT" />
<result property="yearAvJlSaleamt" column="YEAR_AV_JL_SALEAMT" />
<result property="prevAvJlCnt" column="PREV_JL_CNT" />
<result property="prevAvJlSaleamt" column="PREV_JL_SALEAMT" />
<result property="month1AvJlCnt" column="MONTH1_AV_JL_CNT" />
<result property="month1AvJlSaleamt" column="MONTH1_AV_JL_SALEAMT" />
<result property="month2AvJlCnt" column="MONTH2_AV_JL_CNT" />
<result property="month2AvJlSaleamt" column="MONTH2_AV_JL_SALEAMT" />
<result property="month3AvJlCnt" column="MONTH3_AV_JL_CNT" />
<result property="month3AvJlSaleamt" column="MONTH3_AV_JL_SALEAMT" />
<result property="totalAvJcCnt" column="TOTAL_AV_JC_CNT" />
<result property="totalAvJcSaleamt" column="TOTAL_AV_JC_SALEAMT" />
<result property="yearAvJcCnt" column="YEAR_AV_JC_CNT" />
<result property="yearAvJcSaleamt" column="YEAR_AV_JC_SALEAMT" />
<result property="prevAvJcCnt" column="PREV_JC_CNT" />
<result property="prevAvJcSaleamt" column="PREV_JC_SALEAMT" />
<result property="month1AvJcCnt" column="MONTH1_AV_JC_CNT" />
<result property="month1AvJcSaleamt" column="MONTH1_AV_JC_SALEAMT" />
<result property="month2AvJcCnt" column="MONTH2_AV_JC_CNT" />
<result property="month2AvJcSaleamt" column="MONTH2_AV_JC_SALEAMT" />
<result property="month3AvJcCnt" column="MONTH3_AV_JC_CNT" />
<result property="month3AvJcSaleamt" column="MONTH3_AV_JC_SALEAMT" />
</resultMap>

<resultMap id="BIS_R_67" class="oss.bis.vo.BISVO">
<result property="prdtGubun" column="PRDT_GUBUN" />
<result property="rsvCnt" column="RSV_CNT" />
<result property="saleAmt" column="SALE_AMT" />
<result property="prevRsvCnt" column="PREV_RSV_CNT" />
<result property="prevSaleAmt" column="PREV_SALE_AMT" />
<result property="month3RsvCnt" column="MONTH3_RSV_CNT" />
<result property="month3SaleAmt" column="MONTH3_SALE_AMT" />
<result property="month2RsvCnt" column="MONTH2_RSV_CNT" />
<result property="month2SaleAmt" column="MONTH2_SALE_AMT" />
<result property="month1RsvCnt" column="MONTH1_RSV_CNT" />
<result property="month1SaleAmt" column="MONTH1_SALE_AMT" />
<result property="yearRsvCnt" column="YEAR_RSV_CNT" />
<result property="yearSaleAmt" column="YEAR_SALE_AMT" />
<result property="totalRsvCnt" column="TOTAL_RSV_CNT" />
<result property="totalSaleAmt" column="TOTAL_SALE_AMT" />
</resultMap>

<resultMap id="BIS_R_68" class="oss.bis.vo.BISVO">
<result property="prevMonth3SaleAmt" column="PREV_MONTH3_SALE_AMT" />
<result property="prevMonth2SaleAmt" column="PREV_MONTH2_SALE_AMT" />
<result property="prevMonth1SaleAmt" column="PREV_MONTH1_SALE_AMT" />
</resultMap>

<resultMap id="BIS_R_69" class="oss.bis.vo.BISVO">
    <result property="rn" column="RN" />
    <result property="cdNm" column="CD_NM" />
    <result property="corpNm" column="CORP_NM" />
    <result property="prdtNm" column="PRDT_NM" />
    <result property="saleAmt" column="SALE_AMT" />
    <result property="saleCnt" column="SALE_CNT" />
    <result property="cancelAmt" column="CANCEL_AMT" />
    <result property="cancelCnt" column="CANCEL_CNT" />
    <result property="rSaleAmt" column="R_SALE_AMT" />
    <result property="rSaleCnt" column="R_SALE_CNT" />

</resultMap>

<resultMap id="BIS_R_71" class="oss.bis.vo.BISVO">
    <result property="rn"     column="RN" />
    <result property="corpNm" column="CORP_NM" />
    <result property="prdtNm" column="PRDT_NM" />
</resultMap>

<resultMap id="DAY_R_00" class="oss.bis.vo.BISVO">
<result property="avJlCnt" column="AV_JL_CNT" />
<result property="avJlSaleamt" column="AV_JL_SALEAMT" />
<result property="avJcCnt" column="AV_JC_CNT" />
<result property="avJcSaleamt" column="AV_JC_SALEAMT" />
<result property="visitorNum" column="VISITOR_NUM" />
</resultMap>

<select id="BIS_S_00" resultMap="BIS_R_00">
WITH T_RSV_NUM AS (
    (SELECT RSV_NUM FROM TB_AD_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_RC_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_GL_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_SP_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_SV_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
)
(SELECT COUNT(*) AS TOTAL_MEM_CNT FROM TB_USER
    WHERE QUT_YN='N'
    )
UNION ALL
(SELECT COUNT(*) AS TOTAL_MEM_CNT FROM TB_USER
    WHERE QUT_YN='N'
      AND USER_ID IN (
            SELECT DISTINCT USER_ID FROM TB_RSV
                WHERE USER_ID!='GUEST'
                    AND RSV_NUM IN (SELECT RSV_NUM FROM T_RSV_NUM)
        ));
</select>

<!-- 고객 효율성 -->
<select id="BIS_S_01" resultMap="BIS_R_01">
WITH T_RSV_NUM AS ( (SELECT RSV_NUM
                  FROM TB_AD_RSV
                 WHERE RSV_STATUS_CD IN ('RS02',
                               'RS12',
                               'RS30',
                               'RS32'))
         UNION (SELECT RSV_NUM
                  FROM TB_RC_RSV
                 WHERE RSV_STATUS_CD IN ('RS02',
                               'RS12',
                               'RS30',
                               'RS32'))
         UNION (SELECT RSV_NUM
                  FROM TB_GL_RSV
                 WHERE RSV_STATUS_CD IN ('RS02',
                               'RS12',
                               'RS30',
                               'RS32'))
         UNION (SELECT RSV_NUM
                  FROM TB_SP_RSV
                 WHERE RSV_STATUS_CD IN ('RS02',
                               'RS12',
                               'RS30',
                               'RS32'))
         UNION (SELECT RSV_NUM
                  FROM TB_SV_RSV
                 WHERE RSV_STATUS_CD IN ('RS02',
                               'RS12',
                               'RS30',
                               'RS32')) )
                               
<![CDATA[
SELECT TOTAL_CNT
     , NVL(QUT_CNT, 0) AS QUT_CNT
     , DECODE(TOTAL_CNT, 0, 0, CEIL((QUT_CNT / TOTAL_CNT) * 10000) / 100) AS QUT_PER
     , RSV_CNT
     , DECODE(TOTAL_CNT, 0, 0, CEIL((RSV_CNT / TOTAL_CNT) * 10000) / 100) AS RSV_PER
     , DUPL_RSV_CNT
     , DECODE(RSV_CNT, 0, 0, CEIL((DUPL_RSV_CNT / RSV_CNT) * 10000) / 100) AS DUPL_PER
     , RE_RSV_CNT
     , DECODE(RSV_CNT, 0, 0, CEIL((RE_RSV_CNT / RSV_CNT) * 10000) / 100) AS RE_RSV_PER
  FROM (SELECT SUM(DECODE(QUT_YN, 'N', 1, 0))    AS TOTAL_CNT
             , SUM(DECODE(QUT_YN, 'Y', 1, 0))    AS QUT_CNT             
             , (SELECT COUNT(*)
		          FROM TB_USER
		         WHERE QUT_YN='N'
		           AND USER_ID IN (SELECT DISTINCT USER_ID
		                  FROM TB_RSV
		                 WHERE USER_ID<>'GUEST'
		                   AND TO_CHAR(REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
		                   AND RSV_NUM IN (SELECT RSV_NUM
		                          FROM T_RSV_NUM) )) AS RSV_CNT             
             , (SELECT COUNT(*)
                  FROM TB_USER
                 WHERE QUT_YN='N'
                   AND USER_ID IN (SELECT DISTINCT USER_ID
                          FROM TB_RSV
                         WHERE USER_ID<>'GUEST'
                           AND TO_CHAR(REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
                           AND RSV_NUM IN (SELECT RSV_NUM
                                  FROM T_RSV_NUM)
                         GROUP BY USER_ID
                        HAVING COUNT(RSV_NUM) > 1)) AS DUPL_RSV_CNT
             , (SELECT COUNT(DISTINCT USER_ID)
                  FROM (SELECT T1.RSV_NUM
                             , T2.RSV_NUM
                             , T1.USER_ID
                             , T1.RSV_NM
                             , T1.REG_DTTM
                             , T2.REG_DTTM
                             , (T1.REG_DTTM - T2.REG_DTTM)
                          FROM TB_RSV T1
                         INNER JOIN TB_RSV T2
                            ON T2.RSV_STATUS_CD = 'RS02'
                           AND T1.USER_ID = T2.USER_ID
                           AND (T1.REG_DTTM - T2.REG_DTTM) >= 7
                         WHERE T1.USER_ID <> 'GUEST'
                           AND TO_CHAR(T1.REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
                           AND T1.USER_ID IN (
                        SELECT USER_ID
                          FROM TB_RSV
                         WHERE RSV_STATUS_CD = 'RS02'
                         GROUP BY USER_ID
                        HAVING COUNT(RSV_NUM) > 1)
                           AND T1.RSV_STATUS_CD = 'RS02'
                    )) AS RE_RSV_CNT
          FROM TB_USER T_USER
         WHERE TO_CHAR(FRST_REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
       )
]]>
</select>

<!-- 누적 매출 금액 & 건수 -->
<select id="BIS_S_02" resultMap="BIS_R_02">
<![CDATA[
WITH T_RSVAMT AS (
SELECT A.RSV_DT
     , A.SALE_AMT
     , A.SALE_CNT
     , NVL(B.CANCEL_AMT, 0) AS CANCEL_AMT
     , NVL(B.CANCEL_CNT, 0) AS CANCEL_CNT
     , A.SALE_AMT - NVL(B.CANCEL_AMT, 0) AS TOTAL_AMT
     , A.SALE_CNT - NVL(B.CANCEL_CNT, 0) AS TOTAL_CNT
  FROM (SELECT RSV_DT
             , SUM(SALE_AMT) AS SALE_AMT
             , COUNT(SALE_AMT) AS SALE_CNT
          FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY') AS RSV_DT
                     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYYMMDD') AS RSV_CANCEL_DT
                     , 'AD' AS CTGR
                     , T_DTLRSV.CORP_ID
                     , T_DTLRSV.AD_RSV_NUM AS RSV_NUM
                     , T_DTLRSV.RSV_STATUS_CD
                     , T_RSV.USER_ID
                     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                             ELSE T_DTLRSV.NML_AMT
                         END
                       ) AS NML_AMT
                     , T_DTLRSV.SALE_AMT
                     , T_DTLRSV.CANCEL_AMT
                     , T_DTLRSV.CMSS_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                    AND TO_CHAR(T_RSV.REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
                 UNION
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY') AS RSV_DT
                     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYYMMDD') AS RSV_CANCEL_DT
                     , 'RC' AS CTGR
                     , T_DTLRSV.CORP_ID
                     , T_DTLRSV.RC_RSV_NUM AS RSV_NUM
                     , T_DTLRSV.RSV_STATUS_CD
                     , T_RSV.USER_ID
                     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                             ELSE T_DTLRSV.NML_AMT
                         END
                       ) AS NML_AMT
                     , T_DTLRSV.SALE_AMT
                     , T_DTLRSV.CANCEL_AMT
                     , T_DTLRSV.CMSS_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                    AND TO_CHAR(T_RSV.REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
                 UNION
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY') AS RSV_DT
                     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYYMMDD') AS RSV_CANCEL_DT
                     , 'SV' AS CTGR
                     , T_DTLRSV.CORP_ID
                     , T_DTLRSV.SV_RSV_NUM AS RSV_NUM
                     , T_DTLRSV.RSV_STATUS_CD
                     , T_RSV.USER_ID
                     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                             ELSE T_DTLRSV.NML_AMT
                         END
                       ) AS NML_AMT
                     , T_DTLRSV.SALE_AMT
                     , T_DTLRSV.CANCEL_AMT
                     , T_DTLRSV.CMSS_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                    AND TO_CHAR(T_RSV.REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#
                 UNION
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY') AS RSV_DT
                     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYYMMDD') AS RSV_CANCEL_DT
                     , CASE SUBSTR(T_SPPRDT.CTGR,0,2) WHEN 'C1' THEN T_SPPRDT.CTGR
                     								  WHEN 'C4' THEN T_SPPRDT.CTGR
                                                      ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                        END AS CTGR
                     , T_DTLRSV.CORP_ID
                     , T_DTLRSV.SP_RSV_NUM AS RSV_NUM
                     , T_DTLRSV.RSV_STATUS_CD
                     , T_RSV.USER_ID
                     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                             ELSE T_DTLRSV.NML_AMT
                         END
                       ) AS NML_AMT
                     , T_DTLRSV.SALE_AMT
                     , T_DTLRSV.CANCEL_AMT
                     , T_DTLRSV.CMSS_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                    AND TO_CHAR(T_RSV.REG_DTTM, 'YYYYMM') <= #sYear# || #sMonth#)
           GROUP BY RSV_DT
       ) A
  LEFT OUTER JOIN (SELECT RSV_CANCEL_DT
                        , SUM(CANCEL_AMT) AS CANCEL_AMT
                        , COUNT(CANCEL_AMT) AS CANCEL_CNT
                     FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
                                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY') AS RSV_CANCEL_DT
                                , 'AD' AS CTGR
                                , T_DTLRSV.CORP_ID
                                , T_DTLRSV.AD_RSV_NUM AS RSV_NUM
                                , T_DTLRSV.RSV_STATUS_CD
                                , T_RSV.USER_ID
                                , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                                        ELSE T_DTLRSV.NML_AMT
                                    END
                                  ) AS NML_AMT
                                , T_DTLRSV.SALE_AMT
                                , T_DTLRSV.CANCEL_AMT
                                , T_DTLRSV.CMSS_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_AD_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION
                           SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
                                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY') AS RSV_CANCEL_DT
                                , 'RC' AS CTGR
                                , T_DTLRSV.CORP_ID
                                , T_DTLRSV.RC_RSV_NUM AS RSV_NUM
                                , T_DTLRSV.RSV_STATUS_CD
                                , T_RSV.USER_ID
                                , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                                        ELSE T_DTLRSV.NML_AMT
                                    END
                                  ) AS NML_AMT
                                , T_DTLRSV.SALE_AMT
                                , T_DTLRSV.CANCEL_AMT
                                , T_DTLRSV.CMSS_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_RC_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION
                           SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
                                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY') AS RSV_CANCEL_DT
                                , 'SV' AS CTGR
                                , T_DTLRSV.CORP_ID
                                , T_DTLRSV.SV_RSV_NUM AS RSV_NUM
                                , T_DTLRSV.RSV_STATUS_CD
                                , T_RSV.USER_ID
                                , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                                        ELSE T_DTLRSV.NML_AMT
                                    END
                                  ) AS NML_AMT
                                , T_DTLRSV.SALE_AMT
                                , T_DTLRSV.CANCEL_AMT
                                , T_DTLRSV.CMSS_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SV_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION
                           SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
                                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY') AS RSV_CANCEL_DT
                                , CASE SUBSTR(T_SPPRDT.CTGR,0,2) WHEN 'C1' THEN T_SPPRDT.CTGR
                                								 WHEN 'C4' THEN T_SPPRDT.CTGR
                                                                 ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                                   END AS CTGR
                                , T_DTLRSV.CORP_ID
                                , T_DTLRSV.SP_RSV_NUM AS RSV_NUM
                                , T_DTLRSV.RSV_STATUS_CD
                                , T_RSV.USER_ID
                                , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS20', 'RS99') THEN 0
                                        ELSE T_DTLRSV.NML_AMT
                                    END
                                  ) AS NML_AMT
                                , T_DTLRSV.SALE_AMT
                                , T_DTLRSV.CANCEL_AMT
                                , T_DTLRSV.CMSS_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SP_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                            INNER JOIN TB_SP_PRDTINF T_SPPRDT
                               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                          )
                    GROUP BY RSV_CANCEL_DT
                  ) B
    ON B.RSV_CANCEL_DT = A.RSV_DT
)
SELECT NVL(SUM(TOTAL_AMT), 0) AS TOTAL_AMT
     , NVL(SUM(TOTAL_CNT), 0) AS TOTAL_CNT
      FROM T_RSVAMT
]]>
</select>

<!-- 지역별 회원 & 고객 -->
<select id="BIS_S_03" resultMap="BIS_R_03">
WITH T_RSV_NUM AS (
    (SELECT RSV_NUM FROM TB_AD_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_RC_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_GL_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_SP_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
    UNION
    (SELECT RSV_NUM FROM TB_SV_RSV WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32'))
), 
T_TOTAL_MEM AS (
    SELECT COUNT(*) AS CNT FROM TB_USER WHERE QUT_YN='N' AND TRIM(ROAD_NM_ADDR)!=' '
        AND USER_ID NOT IN (
            SELECT DISTINCT USER_ID FROM TB_RSV                
                WHERE USER_ID!='GUEST'
                    AND RSV_NUM IN (SELECT RSV_NUM FROM T_RSV_NUM)
        )
), 
T_TOTAL_CUS AS (
    SELECT COUNT(*) AS CNT FROM TB_USER WHERE QUT_YN='N' AND TRIM(ROAD_NM_ADDR)!=' '
        AND USER_ID IN (
            SELECT DISTINCT USER_ID FROM TB_RSV                
                WHERE USER_ID!='GUEST'
                    AND RSV_NUM IN (SELECT RSV_NUM FROM T_RSV_NUM)
        )
)
SELECT TRIM(T_USER.AREA) AS AREA, NVL(T_MEM.MEM_CNT, 0) AS AREA_MEM_CNT, ROUND(NVL(T_MEM.MEM_CNT, 0)/(SELECT CNT FROM T_TOTAL_MEM) * 100, 2) AS AREA_MEM_PER, NVL(T_CUS.MEM_CNT, 0) AS AREA_CUS_CNT, ROUND(NVL(T_CUS.MEM_CNT, 0)/(SELECT CNT FROM T_TOTAL_CUS) * 100, 2) AS AREA_CUS_PER FROM (
    SELECT DISTINCT SUBSTR(ROAD_NM_ADDR, 0, INSTR(ROAD_NM_ADDR, ' ')) AS AREA FROM TB_USER 
        WHERE TRIM(ROAD_NM_ADDR) IS NOT NULL
    ) T_USER
    LEFT OUTER JOIN (
        SELECT AREA, COUNT(*) AS MEM_CNT FROM 
        (SELECT SUBSTR(ROAD_NM_ADDR, 0, INSTR(ROAD_NM_ADDR, ' ')) AS AREA FROM TB_USER WHERE QUT_YN='N' AND TRIM(ROAD_NM_ADDR) IS NOT NULL
            AND USER_ID NOT IN (
                SELECT DISTINCT USER_ID FROM TB_RSV                
                    WHERE USER_ID!='GUEST'
                        AND RSV_NUM IN (SELECT RSV_NUM FROM T_RSV_NUM)
            )
        )        
        GROUP BY AREA
    ) T_MEM ON T_MEM.AREA=T_USER.AREA
    LEFT OUTER JOIN (
        SELECT AREA, COUNT(*) AS MEM_CNT FROM 
        (SELECT SUBSTR(ROAD_NM_ADDR, 0, INSTR(ROAD_NM_ADDR, ' ')) AS AREA FROM TB_USER WHERE QUT_YN='N' AND TRIM(ROAD_NM_ADDR) IS NOT NULL
            AND USER_ID IN (
                SELECT DISTINCT USER_ID FROM TB_RSV                
                    WHERE USER_ID!='GUEST'
                        AND RSV_NUM IN (SELECT RSV_NUM FROM T_RSV_NUM)
            )
        )        
        GROUP BY AREA
    ) T_CUS ON T_CUS.AREA=T_USER.AREA
    WHERE T_USER.AREA != ' '
</select>

<!-- 입점업체 통계 (예약 건수, 예약 취소건수, 평점, 이용후기 건수, 1:1문의 건수, SNS 공유 건수, View Click 건수, 재구매 건수) -->
<select id="BIS_S_04" resultMap="BIS_R_04">  
WITH RSV_PERIOD AS (
    SELECT RSV_NUM FROM TB_RSV
        WHERE REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
)
SELECT RN, 
	   CORP_NM, 
       TRADE_STATUS_CD, 
       RSV_CNT,
       NML_AMT,
       CANCEL_CNT, 
       GPA_AVG, 
       USEEPIL_CNT,
       OTOINQ_CNT,
       SNS_CNT,
       VIEW_CNT,
       DUPL_CNT
    FROM (
        SELECT ROWNUM AS RN,
               CORP_NM, 
               TRADE_STATUS_CD, 
               RSV_CNT,
               NML_AMT,
               CANCEL_CNT, 
               GPA_AVG, 
               USEEPIL_CNT,
               OTOINQ_CNT,
               SNS_CNT,
       		   VIEW_CNT,
               DUPL_CNT
            FROM (
                SELECT 
                       T_CORP.CORP_NM, 
                       TRADE_STATUS_CD, 
                       NVL(T_RSV.RSV_CNT, 0) AS RSV_CNT,
                       NVL(T_RSV.NML_AMT, 0) AS NML_AMT,
                       NVL(T_CANCEL.CANCEL_CNT, 0) AS CANCEL_CNT,
                       NVL(T_GPA.GPA_AVG, 0) AS GPA_AVG, 
                       NVL(T_USEEPIL.USEEPIL_CNT, 0) AS USEEPIL_CNT,
                       NVL(T_OTOINQ.OTOINQ_CNT, 0) AS OTOINQ_CNT,
                       NVL(T_SNS.SNS_CNT, 0) AS SNS_CNT,
                       NVL(T_VIEW.VIEW_CNT, 0) AS VIEW_CNT,
                       NVL(T_DUPL.DUPL_CNT, 0) AS DUPL_CNT
                            FROM TB_CORP T_CORP 
                    LEFT OUTER JOIN (
                        (SELECT CORP_ID, COUNT(*) AS RSV_CNT, SUM(NML_AMT) AS NML_AMT FROM TB_AD_RSV
                            WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, COUNT(*) AS RSV_CNT, SUM(NML_AMT) AS NML_AMT FROM TB_RC_RSV
                            WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                            GROUP BY CORP_ID)                        
                        UNION
                        (SELECT CORP_ID, COUNT(*) AS RSV_CNT, SUM(NML_AMT) AS NML_AMT FROM TB_SP_RSV
                            WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                                <!-- <isEqual property="sCategory" compareValue="SPC"> -->
                                <isEqual property="sCategory" compareValue="CSPT">
                                AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
                    	  	  	  <isNotEmpty property="sType">
                    	  			<isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  			</isNotNull>
                    	  	  	  </isNotEmpty>
                    			)
                    			</isEqual>
                    		
                    			<!-- <isEqual property="sCategory" compareValue="SPF"> -->
                    			<isEqual property="sCategory" compareValue="CSPF">
                    			AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'                    	
                    	  	  	  <isNotEmpty property="sType">
                    	  			<isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  			</isNotNull>
                    	  	  	  </isNotEmpty>
                    			)
                    			</isEqual>
                    	
                    			<!-- <isEqual property="sCategory" compareValue="SPT"> -->
                    			<isEqual property="sCategory" compareValue="CSPU">
                    			AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE 1=1 <!-- PRDT_DIV='TOUR'  -->
                    	  	  	  <isNotEmpty property="sType">
                    	  			<isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  			</isNotNull>
                    	  	  	  </isNotEmpty>
                    			)
                    			</isEqual>
                                
                            GROUP BY CORP_ID)  
                        UNION
                        (SELECT CORP_ID, COUNT(*) AS RSV_CNT, SUM(NML_AMT) AS NML_AMT FROM TB_SV_RSV
                            WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                            GROUP BY CORP_ID)        
                    ) T_RSV ON T_RSV.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_AD_RSV
                            WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_RC_RSV
                            WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                            GROUP BY CORP_ID)
                        UNION                        
                        (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_SP_RSV
                            WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                                <!-- <isEqual property="sCategory" compareValue="SPC"> -->
                                <isEqual property="sCategory" compareValue="CSPT">
                                AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
                    	  	  	  <isNotEmpty property="sType">
                    	  			<isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  			</isNotNull>
                    	  	  	  </isNotEmpty>
                    			)
                    			</isEqual>
                    		
                    			<!-- <isEqual property="sCategory" compareValue="SPF"> -->
                    			<isEqual property="sCategory" compareValue="CSPF">
                    			AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'                    	
                    	  	  	  <isNotEmpty property="sType">
                    	  			<isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  			</isNotNull>
                    	  	  	  </isNotEmpty>
                    			)
                    			</isEqual>
                    	
                    			<!-- <isEqual property="sCategory" compareValue="SPT"> -->
                    			<isEqual property="sCategory" compareValue="CSPU">
                    			AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE 1=1 <!-- PRDT_DIV='TOUR' --> 
                    	  	  	  <isNotEmpty property="sType">
                    	  			<isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  			</isNotNull>
                    	  	  	  </isNotEmpty>
                    			)
                    			</isEqual>
                            GROUP BY CORP_ID)
                        UNION                        
                        (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_SV_RSV
                            WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                                AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                            GROUP BY CORP_ID)
                    ) T_CANCEL ON T_CANCEL.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        (SELECT LINK_NUM AS CORP_ID, SUM(GPA_AVG)/COUNT(GPA_AVG) AS GPA_AVG FROM TB_GPA_ANLS 
				            WHERE LINK_NUM IN (SELECT CORP_ID FROM TB_CORP WHERE CORP_CD='AD') 
				            GROUP BY LINK_NUM)
				        UNION
				        (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				            LEFT OUTER JOIN TB_RC_PRDTINF T_RC ON T_RC.PRDT_NUM=T_GA.LINK_NUM
				            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_RC_PRDTINF)
				            GROUP BY CORP_ID)
				        UNION
				        (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				            LEFT OUTER JOIN TB_GL_PRDTINF T_GL ON T_GL.PRDT_NUM=T_GA.LINK_NUM
				            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_GL_PRDTINF)
				            GROUP BY CORP_ID)
				        UNION
				        (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				            LEFT OUTER JOIN TB_SP_PRDTINF T_SP ON T_SP.PRDT_NUM=T_GA.LINK_NUM
				              <!-- <isEqual property="sCategory" compareValue="SPC"> -->
				              <isEqual property="sCategory" compareValue="CSPT">
				              AND PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
                                <isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>                    			
                    		  </isEqual>
                    		
                    		  <!-- <isEqual property="sCategory" compareValue="SPF"> -->
                    		  <isEqual property="sCategory" compareValue="CSPF">
                    		  AND PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'                    	
                    	  	  	<isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>
                    		  </isEqual>
                    	
                    		  <!-- <isEqual property="sCategory" compareValue="SPT"> -->
                    		  <isEqual property="sCategory" compareValue="CSPU">
                    		  <!-- AND PRDT_DIV='TOUR'  -->
                    	  	  	<isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>
                    		  </isEqual>				              
				            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF)
				            GROUP BY CORP_ID)
				        UNION
				        (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				            LEFT OUTER JOIN TB_SV_PRDTINF T_SV ON T_SV.PRDT_NUM=T_GA.LINK_NUM
				            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SV_PRDTINF)
				            GROUP BY CORP_ID)
                    ) T_GPA ON T_GPA.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        SELECT CORP_ID, COUNT(*) AS USEEPIL_CNT FROM TB_USEEPIL
                            WHERE FRST_REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
                            GROUP BY CORP_ID
                    ) T_USEEPIL ON T_USEEPIL.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        SELECT CORP_ID, COUNT(*) AS OTOINQ_CNT FROM TB_OTOINQ                        	
                            WHERE FRST_REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
                            GROUP BY CORP_ID
                    ) T_OTOINQ ON T_OTOINQ.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        (SELECT LINK_NUM AS CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ 
                            WHERE LINK_NUM IN (SELECT CORP_ID FROM TB_CORP WHERE CORP_CD='AD') 
                                 AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY LINK_NUM)
                        UNION
                        (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_RC_PRDTINF T_RC ON T_RC.PRDT_NUM=T_PI.LINK_NUM
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_RC_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_GL_PRDTINF T_GL ON T_GL.PRDT_NUM=T_PI.LINK_NUM
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_GL_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_SP_PRDTINF T_SP ON T_SP.PRDT_NUM=T_PI.LINK_NUM
                              <!-- <isEqual property="sCategory" compareValue="SPC"> -->
                              <isEqual property="sCategory" compareValue="CSPT">
				              AND PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
                                <isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>                    			
                    		  </isEqual>
                    		
                    		  <!-- <isEqual property="sCategory" compareValue="SPF"> -->
                    		  <isEqual property="sCategory" compareValue="CSPF">
                    		  AND PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'                    	
                    	  	  	<isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>
                    		  </isEqual>
                    	
                    		  <!-- <isEqual property="sCategory" compareValue="SPT"> -->
                    		  <isEqual property="sCategory" compareValue="CSPU">
                    		  <!-- AND PRDT_DIV='TOUR'  -->
                    	  	  	<isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>
                    		  </isEqual>
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_SV_PRDTINF T_SV ON T_SV.PRDT_NUM=T_PI.LINK_NUM
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SV_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                    ) T_SNS ON T_SNS.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        (SELECT LINK_NUM AS CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ 
                            WHERE LINK_NUM IN (SELECT CORP_ID FROM TB_CORP WHERE CORP_CD='AD') 
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY LINK_NUM)
                        UNION
                        (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_RC_PRDTINF T_RC ON T_RC.PRDT_NUM=T_PI.LINK_NUM
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_RC_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_GL_PRDTINF T_GL ON T_GL.PRDT_NUM=T_PI.LINK_NUM
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_GL_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_SP_PRDTINF T_SP ON T_SP.PRDT_NUM=T_PI.LINK_NUM
                              <!-- <isEqual property="sCategory" compareValue="SPC"> -->
                              <isEqual property="sCategory" compareValue="CSPT">
				              AND PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
                                <isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>                    			
                    		  </isEqual>
                    		
                    		  <!-- <isEqual property="sCategory" compareValue="SPF"> -->
                    		  <isEqual property="sCategory" compareValue="CSPF">
                    		  AND PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'                    	
                    	  	  	<isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>
                    		  </isEqual>
                    	
                    		  <!-- <isEqual property="sCategory" compareValue="SPT"> -->
                    		  <isEqual property="sCategory" compareValue="CSPU">
                    		  <!-- AND PRDT_DIV='TOUR' --> 
                    	  	  	<isNotEmpty property="sType">
                    	  		  <isNotNull property="sType">
                    	  			AND CTGR=#sType#
                    	  		  </isNotNull>
                    	  	  	</isNotEmpty>
                    		  </isEqual>
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
                            LEFT OUTER JOIN TB_SV_PRDTINF T_SV ON T_SV.PRDT_NUM=T_PI.LINK_NUM
                            WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SV_PRDTINF)
                                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                            GROUP BY CORP_ID)
                    ) T_VIEW ON T_VIEW.CORP_ID=T_CORP.CORP_ID
                    LEFT OUTER JOIN (
                        (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                            (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_AD_RSV T_AD_RSV
                                LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_AD_RSV.RSV_NUM
                                WHERE USER_ID!='GUEST' AND T_AD_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                    AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                                GROUP BY CORP_ID, USER_ID
                                HAVING COUNT(*)-1 > 0
                            )
                        GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                            (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_RC_RSV T_RC_RSV
                                LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_RC_RSV.RSV_NUM
                                WHERE USER_ID!='GUEST' AND T_RC_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                    AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                                GROUP BY CORP_ID, USER_ID
                                HAVING COUNT(*)-1 > 0
                            )
                        GROUP BY CORP_ID)                        
                        UNION
                        (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                            (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_SP_RSV T_SP_RSV
                                LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_SP_RSV.RSV_NUM
                                WHERE USER_ID!='GUEST' AND T_SP_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                    AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                                    <!-- <isEqual property="sCategory" compareValue="SPC"> -->
                                    <isEqual property="sCategory" compareValue="CSPT">
	                                AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
	                    	  	  	  <isNotEmpty property="sType">
	                    	  			<isNotNull property="sType">
	                    	  			AND CTGR=#sType#
	                    	  			</isNotNull>
	                    	  	  	  </isNotEmpty>
	                    			)
	                    			</isEqual>
	                    		
	                    			<!-- <isEqual property="sCategory" compareValue="SPF"> -->
	                    			<isEqual property="sCategory" compareValue="CSPF">
	                    			AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'                    	
	                    	  	  	  <isNotEmpty property="sType">
	                    	  			<isNotNull property="sType">
	                    	  			AND CTGR=#sType#
	                    	  			</isNotNull>
	                    	  	  	  </isNotEmpty>
	                    			)
	                    			</isEqual>
	                    	
	                    			<!-- <isEqual property="sCategory" compareValue="SPT"> -->
	                    			<isEqual property="sCategory" compareValue="CSPU">
	                    			AND PRDT_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF WHERE 1=1 <!-- PRDT_DIV='TOUR'  -->
	                    	  	  	  <isNotEmpty property="sType">
	                    	  			<isNotNull property="sType">
	                    	  			AND CTGR=#sType#
	                    	  			</isNotNull>
	                    	  	  	  </isNotEmpty>
	                    			)
	                    			</isEqual>
                                GROUP BY CORP_ID, USER_ID
                                HAVING COUNT(*)-1 > 0
                            )
                        GROUP BY CORP_ID)
                        UNION
                        (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                            (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_SV_RSV T_SV_RSV
                                LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_SV_RSV.RSV_NUM
                                WHERE USER_ID!='GUEST' AND T_SV_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                                    AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                                GROUP BY CORP_ID, USER_ID
                                HAVING COUNT(*)-1 > 0
                            )
                        GROUP BY CORP_ID)
                    ) T_DUPL ON T_DUPL.CORP_ID=T_CORP.CORP_ID
                    WHERE TRADE_STATUS_CD NOT IN ('TS01', 'TS02')
                    	<isNotEmpty property="sCategory">
						  <isNotNull property="sCategory"> 
                    	<!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2) -->
                    	AND CORP_MOD_CD=#sCategory#
                    	
                    		<!-- <isEqual property="sCategory" compareValue="AD"> -->
                    		<isEqual property="sCategory" compareValue="CADO">
                    	  	  <isNotEmpty property="sType">
                    	  		<isNotNull property="sType">
                    	AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_AD_DFTINF WHERE AD_DIV=#sType#)
                    	  		</isNotNull>
                    	  	  </isNotEmpty>
                    		</isEqual>
                    	
                    		<!-- <isEqual property="sCategory" compareValue="SPC"> -->
                    		<!-- <isEqual property="sCategory" compareValue="CSPT">
                    	AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
                    	  	  <isNotEmpty property="sType">
                    	  		<isNotNull property="sType">
                    	  	AND CTGR=#sType#
                    	  		</isNotNull>
                    	  	  </isNotEmpty>
                    	)
                    		</isEqual> -->
                    		
                    		<!-- <isEqual property="sCategory" compareValue="SPF"> -->
                    		<!-- <isEqual property="sCategory" compareValue="CSPF">
                    	AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3' 
                    	  	  <isNotEmpty property="sType">
                    	  		<isNotNull property="sType">
                    	  	AND CTGR=#sType#
                    	  		</isNotNull>
                    	  	  </isNotEmpty>
                    	)
                    		</isEqual> -->
                    	
                    		<!-- <isEqual property="sCategory" compareValue="SPT"> -->
                    		<!-- <isEqual property="sCategory" compareValue="CSPU">
                    	AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV='TOUR' 
                    	  	  <isNotEmpty property="sType">
                    	  		<isNotNull property="sType">
                    	  	AND CTGR=#sType#
                    	  		</isNotNull>
                    	  	  </isNotEmpty>
                    	)
                    		</isEqual> -->       
                    		
                    		<!-- <isEqual property="sCategory" compareValue="SV"> -->
                    		<!-- <isEqual property="sCategory" compareValue="CSVS">
                    	AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SV_PRDTINF WHERE 1=1 
                    	  	  <isNotEmpty property="sType">
                    	  		<isNotNull property="sType">
                    	  	AND CTGR=#sType#
                    	  		</isNotNull>
                    	  	  </isNotEmpty>
                    	)
                    		</isEqual> -->
                    		
                    		<!-- <isEqual property="sCategory" compareValue="CSVM">
                    	AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SV_PRDTINF WHERE 1=1 
                    	  	  <isNotEmpty property="sType">
                    	  		<isNotNull property="sType">
                    	  	AND CTGR=#sType#
                    	  		</isNotNull>
                    	  	  </isNotEmpty>
                    	)
                    		</isEqual> -->                    	
                    		
                    	  </isNotNull>
                    	</isNotEmpty>                    	
                    	<isNotEmpty property="sCorpNm">
							<isNotNull property="sCorpNm">
                        AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
                        	</isNotNull>
                        </isNotEmpty>
                    ORDER BY 
                    <isEqual property="sSortField" compareValue="RSV_CNT">
                     RSV_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="CANCEL_CNT">
                     CANCEL_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="GPA_AVG">
                     GPA_AVG 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="USEEPIL_CNT">
                     USEEPIL_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="OTOINQ_CNT">
                     OTOINQ_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="SNS_CNT">
                     SNS_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="VIEW_CNT">
                     VIEW_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="DUPL_CNT">
                     DUPL_CNT 
                    	<isEqual property="sSortOption" compareValue="ASC"> 
                      ASC
                     	</isEqual>
                     	<isEqual property="sSortOption" compareValue="DESC"> 
                      DESC
                     	</isEqual>
                    </isEqual>
                    <isEqual property="sSortField" compareValue="NML_AMT">
                        NML_AMT
                        <isEqual property="sSortOption" compareValue="ASC">
                            ASC
                        </isEqual>
                        <isEqual property="sSortOption" compareValue="DESC">
                            DESC
                        </isEqual>
                    </isEqual>
            )                
    )
    <isEqual property="sFlag" compareValue="Y">
    WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
    </isEqual>
</select>

<!-- 입점업체 통계 리스트 총 건수 -->
<select id="BIS_S_05" resultClass="int">
SELECT COUNT(*) AS CNT FROM TB_CORP T_CORP
	WHERE TRADE_STATUS_CD NOT IN ('TS01', 'TS02')
		<isNotEmpty property="sCategory">
		  <isNotNull property="sCategory"> 
		<!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2) -->
		AND CORP_MOD_CD=#sCategory#
                	
        	<!-- <isEqual property="sCategory" compareValue="AD"> -->
        	<isEqual property="sCategory" compareValue="CADO">
              <isNotEmpty property="sType">
              	<isNotNull property="sType">
		AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_AD_DFTINF WHERE AD_DIV=#sType#)
        	  	</isNotNull>
              </isNotEmpty>
            </isEqual>
                	
            <!-- <isEqual property="sCategory" compareValue="SPC"> -->
            <!-- <isEqual property="sCategory" compareValue="CSPT">
		AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
          	  <isNotEmpty property="sType">
              	<isNotNull property="sType">
        	AND CTGR=#sType#
              	</isNotNull>
              </isNotEmpty>
		)
			</isEqual> -->
			
			<!-- <isEqual property="sCategory" compareValue="SPF"> -->
			<!-- <isEqual property="sCategory" compareValue="CSPF">
		AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
          	  <isNotEmpty property="sType">
              	<isNotNull property="sType">
        	AND CTGR=#sType#
              	</isNotNull>
              </isNotEmpty>
		)
			</isEqual> -->
                	
            <!-- <isEqual property="sCategory" compareValue="SPT"> -->
            <!-- <isEqual property="sCategory" compareValue="CSPU">
		AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV='TOUR' 
        	  <isNotEmpty property="sType">
            	<isNotNull property="sType">
			AND CTGR=#sType#
				</isNotNull>
			  </isNotEmpty>
		)
			</isEqual> -->
			
			<!-- <isEqual property="sCategory" compareValue="SV"> -->
			<!-- <isEqual property="sCategory" compareValue="CSVS">
		AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SV_PRDTINF WHERE 1=1
        	  <isNotEmpty property="sType">
            	<isNotNull property="sType">
			AND CTGR=#sType#
				</isNotNull>
			  </isNotEmpty>
		)
			</isEqual>    -->
			
			<!-- <isEqual property="sCategory" compareValue="CSVM">
		AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SV_PRDTINF WHERE 1=1
        	  <isNotEmpty property="sType">
            	<isNotNull property="sType">
			AND CTGR=#sType#
				</isNotNull>
			  </isNotEmpty>
		)
			</isEqual> -->                    	
                		
		  </isNotNull>
		</isNotEmpty>                     	
      	<isNotEmpty property="sCorpNm">
		  <isNotNull property="sCorpNm">
      AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
           </isNotNull>
      	</isNotEmpty>
</select>

<!-- 입점업체 전체 건수 -->
<select id="BIS_S_06" resultMap="BIS_R_06"> 
WITH RSV_PERIOD AS (
    SELECT RSV_NUM FROM TB_RSV
        WHERE REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
)
SELECT NVL(SUM(RSV_CNT), 0) AS TOTAL_RSV_CNT, 
   NVL(SUM(CANCEL_CNT), 0) AS TOTAL_CANCEL_CNT, 
   NVL(ROUND(SUM(GPA_AVG) / COUNT(GPA_AVG), 1), 0) AS TOTAL_GPA_AVG, 
   NVL(SUM(USEEPIL_CNT), 0) AS TOTAL_USEEPIL_CNT,
   NVL(SUM(OTOINQ_CNT), 0) AS TOTAL_OTOINQ_CNT,
   NVL(SUM(SNS_CNT), 0) AS TOTAL_SNS_CNT,
   NVL(SUM(VIEW_CNT), 0) AS TOTAL_VIEW_CNT,
   NVL(SUM(DUPL_CNT), 0) AS TOTAL_DUPL_CNT
FROM (
    SELECT 
           T_CORP.CORP_NM, 
           TRADE_STATUS_CD, 
           NVL(T_RSV.RSV_CNT, 0) AS RSV_CNT, 
           NVL(T_CANCEL.CANCEL_CNT, 0) AS CANCEL_CNT, 
           NVL(T_GPA.GPA_AVG, 0) AS GPA_AVG, 
           NVL(T_USEEPIL.USEEPIL_CNT, 0) AS USEEPIL_CNT,
           NVL(T_OTOINQ.OTOINQ_CNT, 0) AS OTOINQ_CNT,
           NVL(T_SNS.SNS_CNT, 0) AS SNS_CNT,
           NVL(T_VIEW.VIEW_CNT, 0) AS VIEW_CNT,
           NVL(T_DUPL.DUPL_CNT, 0) AS DUPL_CNT
                FROM TB_CORP T_CORP 
        LEFT OUTER JOIN (
            (SELECT CORP_ID, COUNT(*) AS RSV_CNT FROM TB_AD_RSV
                WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS RSV_CNT FROM TB_RC_RSV
                WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS RSV_CNT FROM TB_GL_RSV
                WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS RSV_CNT FROM TB_SP_RSV
                WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS RSV_CNT FROM TB_SV_RSV
                WHERE RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
        ) T_RSV ON T_RSV.CORP_ID=T_CORP.CORP_ID
        LEFT OUTER JOIN (
            (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_AD_RSV
                WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_RC_RSV
                WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_GL_RSV
                WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_SP_RSV
                WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, COUNT(*) AS CANCEL_CNT FROM TB_SV_RSV
                WHERE RSV_STATUS_CD IN ('RS13', 'RS20')
                    AND RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                GROUP BY CORP_ID)
        ) T_CANCEL ON T_CANCEL.CORP_ID=T_CORP.CORP_ID
        LEFT OUTER JOIN (
            (SELECT LINK_NUM AS CORP_ID, SUM(GPA_AVG)/COUNT(GPA_AVG) AS GPA_AVG FROM TB_GPA_ANLS 
				WHERE LINK_NUM IN (SELECT CORP_ID FROM TB_CORP WHERE CORP_CD='AD') 
				GROUP BY LINK_NUM)
		    UNION
		    (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				LEFT OUTER JOIN TB_RC_PRDTINF T_RC ON T_RC.PRDT_NUM=T_GA.LINK_NUM
				WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_RC_PRDTINF)
				GROUP BY CORP_ID)
		    UNION
		    (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				LEFT OUTER JOIN TB_GL_PRDTINF T_GL ON T_GL.PRDT_NUM=T_GA.LINK_NUM
				WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_GL_PRDTINF)
				GROUP BY CORP_ID)
		    UNION
		    (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				LEFT OUTER JOIN TB_SP_PRDTINF T_SP ON T_SP.PRDT_NUM=T_GA.LINK_NUM
				WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF)
				GROUP BY CORP_ID)
			UNION
		    (SELECT CORP_ID, ROUND(SUM(GPA_AVG)/COUNT(GPA_AVG), 1) AS GPA_AVG FROM TB_GPA_ANLS T_GA 
				LEFT OUTER JOIN TB_SV_PRDTINF T_SV ON T_SV.PRDT_NUM=T_GA.LINK_NUM
				WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SV_PRDTINF)
				GROUP BY CORP_ID)
        ) T_GPA ON T_GPA.CORP_ID=T_CORP.CORP_ID
        LEFT OUTER JOIN (
            SELECT CORP_ID, COUNT(*) AS USEEPIL_CNT FROM TB_USEEPIL 
                WHERE FRST_REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
                GROUP BY CORP_ID
        ) T_USEEPIL ON T_USEEPIL.CORP_ID=T_CORP.CORP_ID
        LEFT OUTER JOIN (
            SELECT CORP_ID, COUNT(*) AS OTOINQ_CNT FROM TB_OTOINQ
                WHERE FRST_REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
                GROUP BY CORP_ID
        ) T_OTOINQ ON T_OTOINQ.CORP_ID=T_CORP.CORP_ID
        LEFT OUTER JOIN (
	       (SELECT LINK_NUM AS CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ 
	           WHERE LINK_NUM IN (SELECT CORP_ID FROM TB_CORP WHERE CORP_CD='AD') 
	                AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY LINK_NUM)
	       UNION
	       (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_RC_PRDTINF T_RC ON T_RC.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_RC_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	       UNION
	       (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_GL_PRDTINF T_GL ON T_GL.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_GL_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	       UNION
	       (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_SP_PRDTINF T_SP ON T_SP.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	       UNION
	       (SELECT CORP_ID, SUM(SNS_PUBLIC_NUM) AS SNS_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_SV_PRDTINF T_SV ON T_SV.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SV_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	   ) T_SNS ON T_SNS.CORP_ID=T_CORP.CORP_ID
	   LEFT OUTER JOIN (
	       (SELECT LINK_NUM AS CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ 
	           WHERE LINK_NUM IN (SELECT CORP_ID FROM TB_CORP WHERE CORP_CD='AD') 
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY LINK_NUM)
	       UNION
	       (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_RC_PRDTINF T_RC ON T_RC.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_RC_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	       UNION
	       (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_GL_PRDTINF T_GL ON T_GL.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_GL_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	       UNION
	       (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_SP_PRDTINF T_SP ON T_SP.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SP_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	       UNION
	       (SELECT CORP_ID, SUM(INQ_NUM) AS VIEW_CNT FROM TB_PRDT_INQ T_PI 
	           LEFT OUTER JOIN TB_SV_PRDTINF T_SV ON T_SV.PRDT_NUM=T_PI.LINK_NUM
	           WHERE LINK_NUM IN (SELECT PRDT_NUM FROM TB_SV_PRDTINF)
	               AND INQ_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
	           GROUP BY CORP_ID)
	   ) T_VIEW ON T_VIEW.CORP_ID=T_CORP.CORP_ID
        LEFT OUTER JOIN (
            (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_AD_RSV T_AD_RSV
                    LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_AD_RSV.RSV_NUM
                    WHERE USER_ID!='GUEST' AND T_AD_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                        AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                    GROUP BY CORP_ID, USER_ID
                    HAVING COUNT(*)-1 > 0
                )
            GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_RC_RSV T_RC_RSV
                    LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_RC_RSV.RSV_NUM
                    WHERE USER_ID!='GUEST' AND T_RC_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                        AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                    GROUP BY CORP_ID, USER_ID
                    HAVING COUNT(*)-1 > 0
                )
            GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_GL_RSV T_GL_RSV
                    LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_GL_RSV.RSV_NUM
                    WHERE USER_ID!='GUEST' AND T_GL_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                        AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                    GROUP BY CORP_ID, USER_ID
                    HAVING COUNT(*)-1 > 0
                )
            GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_SP_RSV T_SP_RSV
                    LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_SP_RSV.RSV_NUM
                    WHERE USER_ID!='GUEST' AND T_SP_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                        AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                    GROUP BY CORP_ID, USER_ID
                    HAVING COUNT(*)-1 > 0
                )
            GROUP BY CORP_ID)
            UNION
            (SELECT CORP_ID, SUM(RSV_CNT) AS DUPL_CNT FROM 
                (SELECT CORP_ID, USER_ID, COUNT(*)-1 AS RSV_CNT FROM TB_SV_RSV T_SV_RSV
                    LEFT OUTER JOIN TB_RSV T_RSV ON T_RSV.RSV_NUM=T_SV_RSV.RSV_NUM
                    WHERE USER_ID!='GUEST' AND T_SV_RSV.RSV_STATUS_CD IN ('RS02', 'RS12', 'RS30', 'RS32')
                        AND T_RSV.RSV_NUM IN (SELECT RSV_NUM FROM RSV_PERIOD)
                    GROUP BY CORP_ID, USER_ID
                    HAVING COUNT(*)-1 > 0
                )
            GROUP BY CORP_ID)
        ) T_DUPL ON T_DUPL.CORP_ID=T_CORP.CORP_ID
        WHERE TRADE_STATUS_CD NOT IN ('TS01', 'TS02')
        	<isNotEmpty property="sCategory">
			  <isNotNull property="sCategory"> 
            <!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2) -->
            AND CORP_MOD_CD=#sCategory#
            	<!-- <isEqual property="sCategory" compareValue="AD"> -->
            	<isEqual property="sCategory" compareValue="CADO">
	              <isNotEmpty property="sType">
	              	<isNotNull property="sType">
			AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_AD_DFTINF WHERE AD_DIV=#sType#)
	        	  	</isNotNull>
	              </isNotEmpty>
	            </isEqual>
	                	
	            <!-- <isEqual property="sCategory" compareValue="SPC"> -->
	            <isEqual property="sCategory" compareValue="CSPT">
			AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
	          	  <isNotEmpty property="sType">
	              	<isNotNull property="sType">
	        	AND CTGR=#sType#
	              	</isNotNull>
	              </isNotEmpty>
			)
				</isEqual>
				
				<!-- <isEqual property="sCategory" compareValue="SPF"> -->
				<isEqual property="sCategory" compareValue="CSPF">
			AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
	          	  <isNotEmpty property="sType">
	              	<isNotNull property="sType">
	        	AND CTGR=#sType#
	              	</isNotNull>
	              </isNotEmpty>
			)
				</isEqual>
	                	
	            <!-- <isEqual property="sCategory" compareValue="SPT"> -->
	            <isEqual property="sCategory" compareValue="CSPU">
			AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SP_PRDTINF WHERE PRDT_DIV='TOUR' 
	        	  <isNotEmpty property="sType">
	            	<isNotNull property="sType">
				AND CTGR=#sType#
					</isNotNull>
				  </isNotEmpty>
			)
				</isEqual> 
				
				<!-- <isEqual property="sCategory" compareValue="SV"> -->
				<isEqual property="sCategory" compareValue="CSVS">
			AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SV_PRDTINF WHERE 1=1 
	        	  <isNotEmpty property="sType">
	            	<isNotNull property="sType">
				AND CTGR=#sType#
					</isNotNull>
				  </isNotEmpty>
			)
				</isEqual>
				
				<isEqual property="sCategory" compareValue="CSVM">
			AND T_CORP.CORP_ID IN (SELECT CORP_ID FROM TB_SV_PRDTINF WHERE 1=1 
	        	  <isNotEmpty property="sType">
	            	<isNotNull property="sType">
				AND CTGR=#sType#
					</isNotNull>
				  </isNotEmpty>
			)
				</isEqual> 
				  
              </isNotNull>
            </isNotEmpty>                    	
            <isNotEmpty property="sCorpNm">
				<isNotNull property="sCorpNm">
                     AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
               	</isNotNull>
            </isNotEmpty>
)
</select>

<!-- 월간 매출 현황 통계 -->
<select id="BIS_S_07" resultMap="BIS_R_07"> 
WITH T_RSVAMT AS (
SELECT T_DT.DT AS RSV_DT
     , NVL(A.SALE_AMT, 0) AS SALE_AMT
     , NVL(B.CANCEL_AMT, 0) AS CANCEL_AMT
     , NVL(A.SALE_AMT, 0) - NVL(B.CANCEL_AMT, 0) AS TOTAL_AMT
  FROM (
    (SELECT TO_CHAR(ADD_MONTHS(TO_DATE(#sFromYear#||'01', 'YYYYMM'), -1), 'YYYY-MM') AS DT FROM DUAL)
    UNION
    (SELECT #sFromYear#||'-'||LPAD(LEVEL, 2, '0') AS DT
        FROM DUAL
        <![CDATA[
      CONNECT BY LEVEL < 13)
      	]]>
    ) T_DT
  LEFT OUTER JOIN (SELECT RSV_DT
             , SUM(SALE_AMT) AS SALE_AMT
          FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'AD' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 AND T_RSV.REG_DTTM BETWEEN TO_DATE(#sFromYear#||'0101','YYYYMMDD') AND TO_DATE(#sFromYear#||'1231','YYYYMMDD')+1
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'RC' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                   AND T_RSV.REG_DTTM BETWEEN TO_DATE(#sFromYear#||'0101','YYYYMMDD') AND TO_DATE(#sFromYear#||'1231','YYYYMMDD')+1
                 UNION ALL
                SELECT TO_CHAR(T_RSV.RSV_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'AV' AS CTGR
                     , SALE_AMT
                  FROM TB_AV_RSV T_RSV
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'SV' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                   AND T_RSV.REG_DTTM BETWEEN TO_DATE(#sFromYear#||'0101','YYYYMMDD') AND TO_DATE(#sFromYear#||'1231','YYYYMMDD')+1
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , CASE SUBSTR(T_SPPRDT.CTGR,0,2) WHEN 'C1' THEN T_SPPRDT.CTGR
                     								  WHEN 'C4' THEN T_SPPRDT.CTGR
                                                      ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                        END AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                AND T_RSV.REG_DTTM BETWEEN TO_DATE(#sFromYear#||'0101','YYYYMMDD') AND TO_DATE(#sFromYear#||'1231','YYYYMMDD')+1
                )
           GROUP BY RSV_DT
       ) A
    ON A.RSV_DT=T_DT.DT
  LEFT OUTER JOIN (SELECT RSV_CANCEL_DT
                        , SUM(CANCEL_AMT) AS CANCEL_AMT
                     FROM (SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , 'AD' AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_AD_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , 'RC' AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_RC_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_RSV.RSV_DTTM, 'YYYY-MM') AS RSV_CANCEL_DT
                                , 'AV' AS CTGR
                                , SALE_AMT
                             FROM TB_AV_RSV T_RSV
                              WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , 'SV' AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SV_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , CASE SUBSTR(T_SPPRDT.CTGR,0,2) WHEN 'C1' THEN T_SPPRDT.CTGR
                                								 WHEN 'C4' THEN T_SPPRDT.CTGR
                                                                 ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                                   END AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SP_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                            INNER JOIN TB_SP_PRDTINF T_SPPRDT
                               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                          )
                    GROUP BY RSV_CANCEL_DT
                  ) B
    ON B.RSV_CANCEL_DT = T_DT.DT
)
SELECT RSV_DT AS DT
     , NVL(SALE_AMT, 0) AS SALE_AMT
     , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
     , NVL(TOTAL_AMT, 0) AS TOTAL_AMT
     , DECODE(MAX_AMT, NULL, 0, CEIL(TOTAL_AMT / MAX_AMT * 100)) AS TOTAL_AMT_PER
  FROM (
    SELECT RSV_DT
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
         , NVL(TOTAL_AMT, 0) AS TOTAL_AMT
         , (SELECT MAX(TOTAL_AMT) FROM T_RSVAMT WHERE SUBSTR(RSV_DT, 0, 4) = #sFromYear#) AS MAX_AMT
      FROM T_RSVAMT
    )
ORDER BY RSV_DT
</select>

<!-- 전체 연간 매출 통계 -->
<select id="BIS_S_08" resultMap="BIS_R_08"> 
WITH T_RSVAMT AS (
SELECT T_DT.DT AS RSV_DT
     , A.SALE_AMT - B.CANCEL_AMT AS TOTAL_AMT
     , A.SALE_CNT - B.CANCEL_CNT AS TOTAL_CNT
  FROM (
        SELECT #sFromYear#||'-'||LPAD(LEVEL, 2, '0') AS DT
        FROM DUAL
        <![CDATA[
      CONNECT BY LEVEL < 13
      	]]>
    ) T_DT
  LEFT OUTER JOIN (
    SELECT RSV_DT
             , SUM(SALE_AMT) AS SALE_AMT
             , COUNT(SALE_AMT) AS SALE_CNT
          FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
          			 , 'AD' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                	 , 'RC' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM') AS RSV_DT
                	 , 'AV' AS CTGR
                     , SALE_AMT
                  FROM TB_AV_RSV
                 WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                	 , 'SV' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                	 , CASE SUBSTR(T_SPPRDT.CTGR, 0, 2)
	                     WHEN 'C1' THEN T_SPPRDT.CTGR
	                     WHEN 'C4' THEN T_SPPRDT.CTGR
	                     ELSE SUBSTR(T_SPPRDT.CTGR, 0, 2)||'00'
	                   END AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01'))
           GROUP BY RSV_DT
       ) A
    ON A.RSV_DT=T_DT.DT
  LEFT OUTER JOIN (SELECT RSV_CANCEL_DT
                        , SUM(CANCEL_AMT) AS CANCEL_AMT
                        , COUNT(CANCEL_AMT) AS CANCEL_CNT
                     FROM (SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                     			, 'AD' AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_AD_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                           		, 'RC' AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_RC_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM') AS RSV_DT
                           		, 'AV' AS CTGR
                                , SALE_AMT
                             FROM TB_AV_RSV
                             WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                           		, 'SV' AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SV_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL                            
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                           		, CASE SUBSTR(T_SPPRDT.CTGR, 0, 2)
				                     WHEN 'C1' THEN T_SPPRDT.CTGR
				                     WHEN 'C4' THEN T_SPPRDT.CTGR
				                     ELSE SUBSTR(T_SPPRDT.CTGR, 0, 2)||'00'
				                   END AS CTGR
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SP_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                            INNER JOIN TB_SP_PRDTINF T_SPPRDT
                               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                          )
                    GROUP BY RSV_CANCEL_DT
                  ) B
    ON B.RSV_CANCEL_DT = T_DT.DT
)
SELECT RSV_DT
        , NVL(TOTAL_AMT, 0) AS TOTAL_RSV_AMT
        , NVL(TOTAL_CNT, 0) AS TOTAL_RSV_CNT
         FROM T_RSVAMT
           ORDER BY RSV_DT
</select>

<!-- 항목별 연간 매출 통계 -->
<select id="BIS_S_09" resultMap="BIS_R_09">
WITH T_RSVAMT AS (
SELECT RSV_DT
     , CTGR
     , PRDT_CATE_NM
     , SALE_AMT
  FROM (SELECT RSV_DT
             , CTGR
             , (SELECT CD_NM FROM TB_CD WHERE CD_NUM=CTGR) AS PRDT_CATE_NM
             , SUM(SALE_AMT) AS SALE_AMT
          FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'AD' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01', 'RS20', 'RS32')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'RC' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01', 'RS20', 'RS32')
                 UNION ALL
                SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'AV' AS CTGR
                     , SALE_AMT
                  FROM TB_AV_RSV
                 WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01', 'RS20', 'RS32')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , 'SV' AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01', 'RS20', 'RS32')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                	 , CASE SUBSTR(T_SPPRDT.CTGR,0,2) WHEN 'C4' THEN T_SPPRDT.CTGR
                                      ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00'
                       END AS CTGR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01', 'RS20', 'RS32'))
           GROUP BY RSV_DT, CTGR
       )
)
SELECT T_DT.DT AS RSV_DT
     , CTGR AS PRDT_GUBUN
     , PRDT_CATE_NM
     , NVL(SALE_AMT, 0) AS TOTAL_RSV_AMT
  FROM (
    SELECT #sFromYear#||'-'||LPAD(LEVEL, 2, '0') AS DT
        FROM DUAL
        <![CDATA[
      CONNECT BY LEVEL < 13
      	]]>
    ) T_DT
   LEFT OUTER JOIN (SELECT RSV_DT
                         , CTGR
                         , PRDT_CATE_NM
                         , NVL(SALE_AMT, 0) AS SALE_AMT
                      FROM T_RSVAMT
                   ) T_R
     ON T_R.RSV_DT = T_DT.DT 
</select>

<!-- 당월 취소 통계 상세 -->
<select id="BIS_S_10" resultMap="BIS_R_10">
  <isEqual property="sCtgr" compareValue="ALL">
SELECT '숙박' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, AD_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF, CANCEL_RSN FROM TB_AD_RSV T_RSV 
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
  UNION ALL
SELECT '렌트카' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, RC_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF, CANCEL_RSN FROM TB_RC_RSV T_RSV 
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_RC_DFTINF T_RC ON T_RC.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#          
  UNION ALL
SELECT '항공' AS PRDT_CATE_NM, RSV_NUM, TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, SALE_AMT AS CANCEL_AMT, 0 AS CMSS_AMT, DECODE(SALE_CORP_DIV, 'JL', '제이엘항공', '제주닷컴') AS CORP_NM, '항공' AS PRDT_NM, (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RSV.AV_CORP_DIV) || ' ' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RSV.START_COURSE_DIV) || '↔' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RSV.END_COURSE_DIV) AS PRDT_INF, '' AS CANCEL_RSN
  FROM TB_AV_RSV T_RSV
 WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(RSV_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#   
  UNION ALL
SELECT '제주특산/기념품' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_PRDT.PRDT_NM, T_PRDT.PRDT_INF, CANCEL_RSN FROM TB_SV_RSV T_RSV
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#          
  UNION ALL
SELECT CD_NM AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_SPPRDT.PRDT_NM, T_SPPRDT.PRDT_INF, CANCEL_RSN FROM TB_SP_RSV T_RSV 
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_SPPRDT.CORP_ID
    LEFT OUTER JOIN TB_CD T_CD ON T_CD.CD_NUM=CTGR
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="AD">
SELECT '숙박' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, AD_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF, CANCEL_RSN FROM TB_AD_RSV T_RSV 
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="RC">
SELECT '렌트카' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, RC_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF, CANCEL_RSN FROM TB_RC_RSV T_RSV 
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_RC_DFTINF T_RC ON T_RC.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth# 
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="AV">
SELECT '항공' AS PRDT_CATE_NM, RSV_NUM, TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, SALE_AMT AS CANCEL_AMT, 0 AS CMSS_AMT, DECODE(SALE_CORP_DIV, 'JL', '제이엘항공', '제주닷컴') AS CORP_NM, '항공' AS PRDT_NM, (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RSV.AV_CORP_DIV) || ' ' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RSV.START_COURSE_DIV) || '↔' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RSV.END_COURSE_DIV) AS PRDT_INF, '' AS CANCEL_RSN
  FROM TB_AV_RSV T_RSV
 WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(RSV_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#   
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="SV">
SELECT '제주특산/기념품' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_PRDT.PRDT_NM, T_PRDT.PRDT_INF, CANCEL_RSN FROM TB_SV_RSV T_RSV
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth# 
  </isEqual>
  
  <isNotEqual property="sCtgr" compareValue="ALL">
    <isNotEqual property="sCtgr" compareValue="AD">
      <isNotEqual property="sCtgr" compareValue="RC">
        <isNotEqual property="sCtgr" compareValue="AV">
          <isNotEqual property="sCtgr" compareValue="SV">
SELECT CD_NM AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(REG_DTTM, 'YYYY-MM-DD') AS RSV_DT, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_SPPRDT.PRDT_NM, T_SPPRDT.PRDT_INF, CANCEL_RSN FROM TB_SP_RSV T_RSV 
	INNER JOIN TB_RSV T_RS ON T_RS.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_SPPRDT.CORP_ID
    LEFT OUTER JOIN TB_CD T_CD ON T_CD.CD_NUM=CTGR
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND CTGR NOT IN ('C410', 'C420')
          	<!-- <isEqual property="sCtgr" compareValue="C200"> -->
        AND SUBSTR(CTGR, 0, 2) || '00'=#sCtgr#
          	<!-- </isEqual> -->
          	<!-- <isEqual property="sCtgr" compareValue="C300">
        AND SUBSTR(CTGR, 0, 2) || '00'=#sCtgr#
          	</isEqual> -->
          	<!-- <isNotEqual property="sCtgr" compareValue="C200">
          	  <isNotEqual property="sCtgr" compareValue="C300">
        AND CTGR=#sCtgr#
          	  </isNotEqual>
          	</isNotEqual> -->
          </isNotEqual>
        </isNotEqual>
      </isNotEqual>
	</isNotEqual>
  </isNotEqual>
</select>

<!-- 당월 이전 취소 통계 상세 -->
<select id="BIS_S_11" resultMap="BIS_R_11">
  <isEqual property="sCtgr" compareValue="ALL">
SELECT '숙박' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, AD_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF FROM TB_AD_RSV T_RSV 
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
  UNION ALL
SELECT '렌트카' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, RC_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF FROM TB_RC_RSV T_RSV 
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_RC_DFTINF T_RC ON T_RC.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
  UNION ALL
SELECT '제주특산/기념품' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_PRDT.PRDT_NM, T_PRDT.PRDT_INF FROM TB_SV_RSV T_RSV
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
  UNION ALL
SELECT CD_NM AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_SPPRDT.PRDT_NM, T_SPPRDT.PRDT_INF FROM TB_SP_RSV T_RSV 
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_SPPRDT.CORP_ID
    LEFT OUTER JOIN TB_CD T_CD ON T_CD.CD_NUM=CTGR
    WHERE <!-- SUBSTR(T_SPPRDT.CTGR,0,2) = 'C2' -->
        T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')  
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="AD">
SELECT '숙박' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, AD_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF FROM TB_AD_RSV T_RSV 
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="RC">
SELECT '렌트카' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, RC_NM AS CORP_NM, T_PRDT.PRDT_NM, PRDT_INF FROM TB_RC_RSV T_RSV 
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOIN TB_RC_DFTINF T_RC ON T_RC.CORP_ID=T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
  </isEqual>
  
  <isEqual property="sCtgr" compareValue="SV">
SELECT '제주특산/기념품' AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_PRDT.PRDT_NM, T_PRDT.PRDT_INF FROM TB_SV_RSV T_RSV
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_PRDT.CORP_ID
    WHERE T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
  </isEqual>
  
  <isNotEqual property="sCtgr" compareValue="ALL">
    <isNotEqual property="sCtgr" compareValue="AD">
      <isNotEqual property="sCtgr" compareValue="RC">
        <isNotEqual property="sCtgr" compareValue="SV">
SELECT CD_NM AS PRDT_CATE_NM, T_RSV.RSV_NUM, TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD') AS CANCEL_REQUEST_DTTM, CANCEL_AMT, CMSS_AMT, CORP_NM, T_SPPRDT.PRDT_NM, T_SPPRDT.PRDT_INF FROM TB_SP_RSV T_RSV 
    INNER JOIN TB_RSV ON TB_RSV.RSV_NUM=T_RSV.RSV_NUM
    INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM
    INNER JOiN TB_CORP T_CORP ON T_CORP.CORP_ID = T_SPPRDT.CORP_ID
    LEFT OUTER JOIN TB_CD T_CD ON T_CD.CD_NUM=CTGR
    WHERE <!-- SUBSTR(T_SPPRDT.CTGR,0,2) = 'C2' -->
        T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        AND TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM') = #sFromYear#||#sFromMonth#
        AND TO_CHAR(REG_DTTM, 'YYYYMM') != TO_CHAR(CANCEL_CMPL_DTTM , 'YYYYMM')
        AND CTGR NOT IN ('C410', 'C420')
          <!-- <isEqual property="sCtgr" compareValue="C200"> -->
        AND SUBSTR(CTGR, 0, 2) || '00'=#sCtgr#
          <!-- </isEqual>
          <isEqual property="sCtgr" compareValue="C300">
        AND SUBSTR(CTGR, 0, 2) || '00'=#sCtgr#
          </isEqual>
          <isNotEqual property="sCtgr" compareValue="C200">
          	<isNotEqual property="sCtgr" compareValue="C300">
        AND CTGR=#sCtgr#
          	</isNotEqual>
          </isNotEqual> -->
        </isNotEqual>
      </isNotEqual>
	</isNotEqual>
  </isNotEqual>
</select>

<!-- 상품의 매출금액 & 취소금액 -->
<select id="BIS_S_12" resultMap="BIS_R_12">
WITH T_RSV_AMT AS (
    SELECT NVL(SUM(SALE_AMT), 0) AS SALE_AMT FROM
        (
        <isEqual property="sCategory" compareValue="ALL">
        SELECT
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(TO_DATE(USE_DT, 'YYYYMMDD'), 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT                     
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
         UNION
        SELECT 
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(TO_DATE(RENT_START_DT, 'YYYYMMDD'), 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
         UNION
        SELECT
        	<isEqual property="sGubun" compareValue="RSV">  
        	TO_CHAR(RSV_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(USE_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT         
             , SALE_AMT
          FROM TB_AV_RSV
         WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
         UNION
        SELECT
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(USE_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
         UNION
         SELECT
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(DLV_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SV_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
        </isEqual>
        <isEqual property="sCategory" compareValue="AD">
        SELECT
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(TO_DATE(USE_DT, 'YYYYMMDD'), 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT                     
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
         	</isNotNull>
         </isNotEmpty>
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">
           AND AD_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>          
        UNION ALL          
          SELECT 
				  <isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        		  </isEqual>
        		  <isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(USE_DTTM, 'YYYY-MM-DD')
        		  </isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')         	 	  
           AND T_SPPRDT.PRDT_DIV='TOUR'
           AND CTGR='C410'
          		  <isNotEmpty property="sType">
		    	  	<isNotNull property="sType">
           AND AD_DIV=#sType#
            	  	</isNotNull>
          		  </isNotEmpty>
          		  <isNotEmpty property="sCorpNm">
		    	  	<isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	  	</isNotNull>
            	  </isNotEmpty>
        </isEqual>
        <isEqual property="sCategory" compareValue="RC">
        SELECT 
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(TO_DATE(RENT_START_DT, 'YYYYMMDD'), 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
         	</isNotNull>
         </isNotEmpty>
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND CAR_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL          
          SELECT 
				  <isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        		  </isEqual>
        		  <isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(USE_DTTM, 'YYYY-MM-DD')
        		  </isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')         	 	  
           AND T_SPPRDT.PRDT_DIV='TOUR'
           AND CTGR='C420'          		  
          		  <isNotEmpty property="sCorpNm">
		    	  	<isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	  	</isNotNull>
            	  </isNotEmpty>
        </isEqual>
        <isEqual property="sCategory" compareValue="AV">
        SELECT 
        	<isEqual property="sGubun" compareValue="RSV">  
        	TO_CHAR(RSV_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(USE_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT         
             , SALE_AMT
          FROM TB_AV_RSV
         WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
        </isEqual>
        <isEqual property="sCategory" compareValue="SV">
        SELECT
        	<isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	<isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(DLV_DTTM, 'YYYY-MM-DD')
        	</isEqual>
        	 AS RSV_DT                     
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SV_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='SV'
         	</isNotNull>
         </isNotEmpty>
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">
           AND CTGR=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        </isEqual>
        <isNotEqual property="sCategory" compareValue="ALL">
		  <isNotEqual property="sCategory" compareValue="AD">
		    <isNotEqual property="sCategory" compareValue="RC">
		      <isNotEqual property="sCategory" compareValue="AV">
		      	<isNotEqual property="sCategory" compareValue="SV">
		SELECT 
				  <isEqual property="sGubun" compareValue="RSV"> 
        	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD')
        		  </isEqual>
        		  <isEqual property="sGubun" compareValue="USE">
        	TO_CHAR(USE_DTTM, 'YYYY-MM-DD')
        		  </isEqual>
        	 AS RSV_DT
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
         	 	  <isEqual property="sCategory" compareValue="SPC">
           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2' -->
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
             	  </isEqual>
             	  <isEqual property="sCategory" compareValue="SPF">
           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3' -->
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
             	  </isEqual>
             	  <isEqual property="sCategory" compareValue="SPT">
           <!-- AND T_SPPRDT.PRDT_DIV='TOUR'
           AND CTGR NOT IN ('C410', 'C420') -->
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C100'
             	  </isEqual>
             	  <isEqual property="sCategory" compareValue="SPB">
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
             	  </isEqual>
          		  <isNotEmpty property="sType">
		    	  	<isNotNull property="sType">
           AND CTGR=#sType#
            	  	</isNotNull>
          		  </isNotEmpty>
          		  <isNotEmpty property="sCorpNm">
		    	  	<isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	  	</isNotNull>
          		  </isNotEmpty>
          		</isNotEqual>
		      </isNotEqual>
		    </isNotEqual>
		  </isNotEqual>
		</isNotEqual>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL_AMT AS (
    SELECT NVL(SUM(CANCEL_AMT), 0) AS CANCEL_AMT FROM
        (
        <isEqual property="sCategory" compareValue="ALL">
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT                                
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         UNION
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT    
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         UNION
        SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT         
             , SALE_AMT
          FROM TB_AV_RSV
         WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
         UNION
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
           ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         UNION
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT    
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_SV_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
        </isEqual>
        <isEqual property="sCategory" compareValue="AD">
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT                                
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
           AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
         	</isNotNull>
         </isNotEmpty>
         WHERE 1=1
          <isNotEmpty property="sType">
		    <isNotNull property="sType">
           AND AD_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
           ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         WHERE T_SPPRDT.PRDT_DIV='TOUR'
           AND CTGR='C410'
         		  <isNotEmpty property="sType">
		    	  	<isNotNull property="sType">
           AND AD_DIV=#sType#
            	  	</isNotNull>
          		  </isNotEmpty>
          		  <isNotEmpty property="sCorpNm">
		    	  	<isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	    </isNotNull>
            	  </isNotEmpty>
        </isEqual>
        <isEqual property="sCategory" compareValue="RC">
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT    
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
         	</isNotNull>
         </isNotEmpty>
         WHERE 1=1
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND CAR_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
           ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         WHERE T_SPPRDT.PRDT_DIV='TOUR'
           AND CTGR='C420'         		  
          		  <isNotEmpty property="sCorpNm">
		    	  	<isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	    </isNotNull>
            	  </isNotEmpty>
        </isEqual>
        <isEqual property="sCategory" compareValue="AV">
        SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_CANCEL_DT         
             , SALE_AMT AS CANCEL_AMT
          FROM TB_AV_RSV
         WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
        </isEqual>
        <isEqual property="sCategory" compareValue="SV">
        SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT                                
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_SV_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
           AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         WHERE 1=1
          <isNotEmpty property="sType">
		    <isNotNull property="sType">
           AND CTGR=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND SV_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        </isEqual>
        <isNotEqual property="sCategory" compareValue="ALL">
		  <isNotEqual property="sCategory" compareValue="AD">
		    <isNotEqual property="sCategory" compareValue="RC">
		      <isNotEqual property="sCategory" compareValue="AV">
		      	<isNotEqual property="sCategory" compareValue="SV">
		SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
            , T_DTLRSV.CANCEL_AMT
         FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
           ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
           ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
         WHERE 1=1
             	  <isEqual property="sCategory" compareValue="SPC">
           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2' -->
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
             	  </isEqual>
             	  <isEqual property="sCategory" compareValue="SPF">
           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3' -->
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
             	  </isEqual>
             	  <isEqual property="sCategory" compareValue="SPT">
           <!-- AND T_SPPRDT.PRDT_DIV='TOUR'
           AND CTGR NOT IN ('C410', 'C420') -->
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C100'
             	  </isEqual>
             	  <isEqual property="sCategory" compareValue="SPB">
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
             	  </isEqual>
         		  <isNotEmpty property="sType">
		    	  	<isNotNull property="sType">
           AND CTGR=#sType#
            	  	</isNotNull>
          		  </isNotEmpty>
          		  <isNotEmpty property="sCorpNm">
		    	  	<isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	    </isNotNull>
            	  </isNotEmpty>
          		</isNotEqual>
		      </isNotEqual>
		    </isNotEqual>
		  </isNotEqual>
		</isNotEqual>
        )
        WHERE RSV_CANCEL_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT (SELECT SALE_AMT FROM T_RSV_AMT) AS TOTAL_RSV_AMT, (SELECT CANCEL_AMT FROM T_CANCEL_AMT) AS TOTAL_CANCEL_AMT FROM DUAL
</select>

<!-- 예약 시간 건수 통계 (요일 & 시간별) -->
<select id="BIS_S_13" resultMap="BIS_R_13">
WITH T_RSV_TIME AS (
    SELECT BASE.RSV_WEEK_GUBUN, BASE.RSV_HOUR, NVL(RSV_CNT, 0) AS RSV_CNT FROM (
        SELECT RSV_WEEK_GUBUN, RSV_HOUR FROM 
            (SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS RSV_WEEK_GUBUN
                FROM DUAL
                  <![CDATA[
                CONNECT BY LEVEL < 8),
                  ]]>
            (SELECT LPAD(LEVEL-1, 2, '0') AS RSV_HOUR
                FROM DUAL
                  <![CDATA[
                CONNECT BY LEVEL < 25)
                  ]]>
        ) BASE
        LEFT OUTER JOIN (
            SELECT RSV_WEEK_GUBUN, RSV_HOUR, COUNT(SALE_AMT) AS RSV_CNT FROM
            (
            	<isEqual property="sCategory" compareValue="ALL">
            	  <isEqual property="sGubun" compareValue="RSV"> 
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT    
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION
                  </isEqual>
                SELECT 
                	<isEqual property="sGubun" compareValue="RSV">
                	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(TO_DATE(RENT_START_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(TO_DATE(RENT_START_DT, 'YYYYMMDD'), 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(TO_DATE(RENT_START_TM, 'HHMI'), 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION
                SELECT
                	<isEqual property="sGubun" compareValue="RSV"> 
                	TO_CHAR(T_RSV.RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.RSV_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.RSV_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(USE_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(USE_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_RSV.SALE_AMT
                  FROM TB_AV_RSV T_RSV
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')                 
                 UNION
                SELECT
                	<isEqual property="sGubun" compareValue="RSV">  
                	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(USE_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(USE_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION
                SELECT
                	<isEqual property="sGubun" compareValue="RSV">  
                	TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(DLV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(DLV_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(DLV_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SV_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')                 
              </isEqual>
              <isEqual property="sCategory" compareValue="AD">
              SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT    
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM                 
		         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
		         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
		         <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
		         	</isNotNull>
		         </isNotEmpty>
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                  <isNotEmpty property="sType">
				    <isNotNull property="sType">
		           AND AD_DIV=#sType#
		            </isNotNull>
		          </isNotEmpty>
		          <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		            </isNotNull>
		          </isNotEmpty>
		      UNION ALL
		        SELECT
			  			<isEqual property="sGubun" compareValue="RSV">  
			  		TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    	</isEqual>
                    	<isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(USE_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(USE_DTTM, 'HH24') AS RSV_HOUR
                    	</isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 INNER JOIN TB_CORP T_CORP
            		ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')                     	
		           AND T_SPPRDT.PRDT_DIV='TOUR'
		           AND CTGR='C410'
                      	<isNotEmpty property="sType">
			    	      <isNotNull property="sType">
	           	   AND AD_DIV=#sType#
	            	      </isNotNull>
	          		  	</isNotEmpty>
	          		  	<isNotEmpty property="sCorpNm">
			    	      <isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	      </isNotNull>
	            	    </isNotEmpty>
              </isEqual>
              <isEqual property="sCategory" compareValue="RC">
              SELECT
              		<isEqual property="sGubun" compareValue="RSV"> 
              		TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(TO_DATE(RENT_START_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(TO_DATE(RENT_START_DT, 'YYYYMMDD'), 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(TO_DATE(RENT_START_TM, 'HHMI'), 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         		 INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         		 <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
		         	</isNotNull>
		         </isNotEmpty>
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')   
                  <isNotEmpty property="sType">
				    <isNotNull property="sType">	         
		           AND CAR_DIV=#sType#
		            </isNotNull>
		          </isNotEmpty>
		          <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		            </isNotNull>
		          </isNotEmpty>  
		      UNION ALL
		        SELECT
			  			<isEqual property="sGubun" compareValue="RSV">  
			  		TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    	</isEqual>
                    	<isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(USE_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(USE_DTTM, 'HH24') AS RSV_HOUR
                    	</isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 INNER JOIN TB_CORP T_CORP
            		ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')                     	
		           AND T_SPPRDT.PRDT_DIV='TOUR'
		           AND CTGR='C420'                      	
	          		  	<isNotEmpty property="sCorpNm">
			    	      <isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	      </isNotNull>
	            	    </isNotEmpty>
              </isEqual>
              <isEqual property="sCategory" compareValue="AV">
              SELECT
              		<isEqual property="sGubun" compareValue="RSV">  
              		TO_CHAR(T_RSV.RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.RSV_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.RSV_DTTM , 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(USE_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(USE_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_RSV.SALE_AMT
                  FROM TB_AV_RSV T_RSV
              </isEqual>
              <isEqual property="sCategory" compareValue="SV">
              SELECT
              		<isEqual property="sGubun" compareValue="RSV"> 
              		TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    </isEqual>
                    <isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(DLV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(DLV_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(DLV_DTTM, 'HH24') AS RSV_HOUR
                    </isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM         		 
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')   
                  <isNotEmpty property="sType">
				    <isNotNull property="sType">	         
		           AND CTGR=#sType#
		            </isNotNull>
		          </isNotEmpty>
		          <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		           AND SV_NM LIKE '%' || #sCorpNm# || '%'
		            </isNotNull>
		          </isNotEmpty>  
              </isEqual>
              <isNotEqual property="sCategory" compareValue="ALL">
			    <isNotEqual property="sCategory" compareValue="AD">
			      <isNotEqual property="sCategory" compareValue="RC">
			        <isNotEqual property="sCategory" compareValue="AV">
			          <isNotEqual property="sCategory" compareValue="SV">
			  SELECT
			  			<isEqual property="sGubun" compareValue="RSV">  
			  		TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(T_RSV.REG_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.REG_DTTM , 'HH24') AS RSV_HOUR
                    	</isEqual>
                    	<isEqual property="sGubun" compareValue="USE">
                    TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , TO_CHAR(USE_DTTM, 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(USE_DTTM, 'HH24') AS RSV_HOUR
                    	</isEqual>
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 INNER JOIN TB_CORP T_CORP
            		ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                     	<isEqual property="sCategory" compareValue="SPC">
		           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2' -->
		           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
		             	</isEqual>
		             	<isEqual property="sCategory" compareValue="SPF">
		           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3' -->
		           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'		           
		             	</isEqual>
		             	<isEqual property="sCategory" compareValue="SPT">
		           <!-- AND T_SPPRDT.PRDT_DIV='TOUR'
		           AND CTGR NOT IN ('C410', 'C420') -->
		           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C100'
		             	</isEqual>
		             	<isEqual property="sCategory" compareValue="SPB">
		           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
		             	</isEqual>
                      	<isNotEmpty property="sType">
			    	      <isNotNull property="sType">
	           	   AND CTGR=#sType#
	            	      </isNotNull>
	          		  	</isNotEmpty>
	          		  	<isNotEmpty property="sCorpNm">
			    	      <isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	      </isNotNull>
	          		  	</isNotEmpty>
	          		  </isNotEqual>
                    </isNotEqual>
			      </isNotEqual>
			    </isNotEqual>
			  </isNotEqual>
            )
            WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
            GROUP BY RSV_WEEK_GUBUN, RSV_HOUR
        ) RSV ON RSV.RSV_WEEK_GUBUN=BASE.RSV_WEEK_GUBUN AND RSV.RSV_HOUR=BASE.RSV_HOUR
        ORDER BY RSV_WEEK_GUBUN, RSV_HOUR
)
  <![CDATA[
SELECT '00:00~02:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '00' AND RSV_HOUR < '02' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '02:00~04:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '02' AND RSV_HOUR < '04' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '04:00~06:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '04' AND RSV_HOUR < '06' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '06:00~08:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '06' AND RSV_HOUR < '08' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '08:00~10:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '08' AND RSV_HOUR < '10' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '10:00~12:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '10' AND RSV_HOUR < '12' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '12:00~14:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '12' AND RSV_HOUR < '14' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '14:00~16:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '14' AND RSV_HOUR < '16' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '16:00~18:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '16' AND RSV_HOUR < '18' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '18:00~20:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '18' AND RSV_HOUR < '20' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '20:00~22:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '20' AND RSV_HOUR < '22' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '22:00~00:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '22' GROUP BY RSV_WEEK_GUBUN
  ]]>
</select>

<!-- 예약 취소 건수 (요일별) -->
<select id="BIS_S_14" resultMap="BIS_R_14">
SELECT CANCEL_WEEK_GUBUN, NVL(CANCEL_CNT, 0) AS CANCEL_CNT FROM (
    SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS CANCEL_WEEK_GUBUN
        FROM DUAL
        <![CDATA[
      CONNECT BY LEVEL < 8) BASE
        ]]>
    LEFT OUTER JOIN (
        SELECT RSV_CANCEL_DAY, COUNT(CANCEL_AMT) AS CANCEL_CNT FROM
        (
        	<isEqual property="sCategory" compareValue="ALL">
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             UNION
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             UNION
            SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                 , TO_CHAR(RSV_DTTM, 'D') AS RSV_CANCEL_DAY
                 , SALE_AMT AS CANCEL_AMT
              FROM TB_AV_RSV
             WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
             UNION
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             UNION
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_SV_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SV_PRDTINF T_SPPRDT
               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            </isEqual>
            <isEqual property="sCategory" compareValue="AD">
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
               AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
	         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
	         <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>
	         WHERE 1=1
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
	          SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             INNER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_SPPRDT.PRDT_DIV='TOUR'
	           AND CTGR='C410'
             		  <isNotEmpty property="sType">
			    	  	<isNotNull property="sType">
	           	   AND AD_DIV=#sType#
	            	  	</isNotNull>
	          		  </isNotEmpty>
	          		  <isNotEmpty property="sCorpNm">
			    	  	<isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	    </isNotNull>
	          		  </isNotEmpty>
            </isEqual>
            <isEqual property="sCategory" compareValue="RC">
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         	 INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         	 <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
	         	</isNotNull>
	         </isNotEmpty>
         	 WHERE 1=1
         	  <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CAR_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
	          SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             INNER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_SPPRDT.PRDT_DIV='TOUR'
	           AND CTGR='C420'
	          		  <isNotEmpty property="sCorpNm">
			    	  	<isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	    </isNotNull>
	          		  </isNotEmpty>
            </isEqual>
            <isEqual property="sCategory" compareValue="AV">
            SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                 , TO_CHAR(RSV_DTTM, 'D') AS RSV_CANCEL_DAY
                 , SALE_AMT AS CANCEL_AMT
              FROM TB_AV_RSV
             WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
            </isEqual>
            <isEqual property="sCategory" compareValue="SV">
            SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_SV_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             INNER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM         	 
         	 WHERE 1=1
         	  <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CTGR=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND SV_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
            </isEqual>
            <isNotEqual property="sCategory" compareValue="ALL">
		  	  <isNotEqual property="sCategory" compareValue="AD">
		    	<isNotEqual property="sCategory" compareValue="RC">
		      	  <isNotEqual property="sCategory" compareValue="AV">
		      	  	<isNotEqual property="sCategory" compareValue="SV">
		    SELECT TO_CHAR(REG_DTTM , 'YYYY-MM-DD') AS RSV_DT
                , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'D') AS RSV_CANCEL_DAY
                , T_DTLRSV.CANCEL_AMT
             FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
             INNER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE 1=1
             	 	  <isEqual property="sCategory" compareValue="SPC">
	           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2' -->
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	             	  </isEqual>
	             	  <isEqual property="sCategory" compareValue="SPF">
	           <!-- AND T_SPPRDT.PRDT_DIV!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3' -->
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	             	  </isEqual>
	             	  <isEqual property="sCategory" compareValue="SPT">
	           <!-- AND T_SPPRDT.PRDT_DIV='TOUR'
	           AND CTGR NOT IN ('C410', 'C420') -->
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C100'
	             	  </isEqual>  
	             	  <isEqual property="sCategory" compareValue="SPB">
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	             	  </isEqual>             	
             		  <isNotEmpty property="sType">
			    	  	<isNotNull property="sType">
	           	   AND CTGR=#sType#
	            	  	</isNotNull>
	          		  </isNotEmpty>
	          		  <isNotEmpty property="sCorpNm">
			    	  	<isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	    </isNotNull>
	          		  </isNotEmpty>
	          		</isNotEqual>
		      	  </isNotEqual>
		      	</isNotEqual>
		     </isNotEqual>
		   </isNotEqual>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
        GROUP BY RSV_CANCEL_DAY
    ) CANCEL ON CANCEL.RSV_CANCEL_DAY=BASE.CANCEL_WEEK_GUBUN
    ORDER BY CANCEL_WEEK_GUBUN
</select>

<!-- 숙박 입실 통계 -->
<select id="BIS_S_15" resultMap="BIS_R_13">
SELECT 'checkIn' AS PRDT_GUBUN, BASE.RSV_WEEK_GUBUN, NVL(RSV_CNT, 0) AS RSV_CNT FROM (
    SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS RSV_WEEK_GUBUN
            FROM DUAL
              <![CDATA[
            CONNECT BY LEVEL < 8
              ]]>
    ) BASE
    LEFT OUTER JOIN (
        SELECT RSV_WEEK_GUBUN, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(TO_DATE(T_RSV.USE_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS USE_DT    
                 , TO_CHAR(TO_DATE(T_RSV.USE_DT, 'YYYYMMDD'), 'D') AS RSV_WEEK_GUBUN                 
                 , T_RSV.SALE_AMT
              FROM TB_AD_RSV T_RSV
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>             
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
               SELECT TO_CHAR(T_RSV.USE_DTTM, 'YYYY-MM-DD') AS USE_DT ,
                     TO_CHAR(T_RSV.USE_DTTM, 'D') AS RSV_WEEK_GUBUN ,
                     T_RSV.SALE_AMT
               FROM TB_SP_RSV T_RSV
               INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM AND T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
               INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
               WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
               <isNotEmpty property="sType">
				 <isNotNull property="sType">	         
		           AND AD_DIV=#sType#
		         </isNotNull>
		       </isNotEmpty>
		       <isNotEmpty property="sCorpNm">
				 <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		         </isNotNull>
		       </isNotEmpty>
        )
        WHERE USE_DT BETWEEN #sStartDt# AND #sEndDt#
        GROUP BY RSV_WEEK_GUBUN
    ) RSV ON RSV.RSV_WEEK_GUBUN=BASE.RSV_WEEK_GUBUN
    ORDER BY RSV_WEEK_GUBUN
</select>

<!-- 숙박 퇴실 통계 -->
<select id="BIS_S_16" resultMap="BIS_R_13">
SELECT 'checkOut' AS PRDT_GUBUN, BASE.RSV_WEEK_GUBUN, NVL(RSV_CNT, 0) AS RSV_CNT FROM (
    SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS RSV_WEEK_GUBUN
            FROM DUAL
              <![CDATA[
            CONNECT BY LEVEL < 8
              ]]>
    ) BASE
    LEFT OUTER JOIN (
        SELECT RSV_WEEK_GUBUN, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(TO_DATE(T_RSV.USE_DT, 'YYYYMMDD') + T_RSV.USE_NIGHT, 'YYYY-MM-DD') AS OUT_DT    
                 , TO_CHAR(TO_DATE(T_RSV.USE_DT, 'YYYYMMDD') + T_RSV.USE_NIGHT, 'D') AS RSV_WEEK_GUBUN                 
                 , T_RSV.SALE_AMT
              FROM TB_AD_RSV T_RSV
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID   
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
               SELECT TO_CHAR(T_RSV.USE_DTTM + 1, 'YYYY-MM-DD') AS OUT_DT ,
                     TO_CHAR(T_RSV.USE_DTTM + 1, 'D') AS RSV_WEEK_GUBUN ,
                     T_RSV.SALE_AMT
               FROM TB_SP_RSV T_RSV
               INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM AND T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
               INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
               WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
               <isNotEmpty property="sType">
				 <isNotNull property="sType">	         
		           AND AD_DIV=#sType#
		         </isNotNull>
		       </isNotEmpty>
		       <isNotEmpty property="sCorpNm">
				 <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		         </isNotNull>
		       </isNotEmpty>
        )
        WHERE OUT_DT BETWEEN #sStartDt# AND #sEndDt# 
        GROUP BY RSV_WEEK_GUBUN
    ) RSV ON RSV.RSV_WEEK_GUBUN=BASE.RSV_WEEK_GUBUN
    ORDER BY RSV_WEEK_GUBUN
</select>

<!-- 숙박 유형 통계(그래프) -->
<select id="BIS_S_17" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
               <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	           </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                <isNotEmpty property="sType">
				  <isNotNull property="sType">	         
		     	AND AD_DIV=#sType#
		          </isNotNull>
		        </isNotEmpty>
		        <isNotEmpty property="sCorpNm">
				  <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		          </isNotNull>
		         </isNotEmpty>
		     UNION ALL
               SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 	, T_DTLRSV.SALE_AMT
               FROM TB_RSV T_RSV
               INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
               INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
               INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
               WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
               <isNotEmpty property="sType">
				 <isNotNull property="sType">	         
		           AND AD_DIV=#sType#
		         </isNotNull>
		       </isNotEmpty>
		       <isNotEmpty property="sCorpNm">
				 <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		         </isNotNull>
		       </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
)
SELECT VIEW_SN AS PRDT_GUBUN
		, CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
    FROM T_TOTAL_CNT,
        (SELECT BASE.CD_NUM
        		, CD_NM
        		, VIEW_SN
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='ADDV' AND USE_YN='Y'
            ) BASE
            LEFT OUTER JOIN (
                SELECT AD_DIV, COUNT(SALE_AMT) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                         , T_DTLRSV.SALE_AMT
                         , AD_DIV
                      FROM TB_RSV T_RSV
                     INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                     LEFT OUTER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                     LEFT OUTER JOIN TB_AD_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
                     <isNotEmpty property="sCorpNm">
					    <isNotNull property="sCorpNm">
			         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
			         	</isNotNull>
			         </isNotEmpty>   
                     WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                      <isNotEmpty property="sType">
					    <isNotNull property="sType">	         
			           AND AD_DIV=#sType#
			            </isNotNull>
			          </isNotEmpty>
			          <isNotEmpty property="sCorpNm">
					    <isNotNull property="sCorpNm">
			           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
			            </isNotNull>
			          </isNotEmpty>
			         UNION ALL
		               SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
	                         , T_DTLRSV.SALE_AMT
	                         , AD_DIV
		               FROM TB_RSV T_RSV
		               INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
		               INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
		               INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
		               WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
		               <isNotEmpty property="sType">
						 <isNotNull property="sType">	         
				           AND AD_DIV=#sType#
				         </isNotNull>
				       </isNotEmpty>
				       <isNotEmpty property="sCorpNm">
						 <isNotNull property="sCorpNm">
				           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
				         </isNotNull>
				       </isNotEmpty>
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
                GROUP BY AD_DIV
            ) RSV ON RSV.AD_DIV=BASE.CD_NUM   
        )   
        ORDER BY VIEW_SN
</select>

<!-- 숙박 기간 통계(그래프) -->
<select id="BIS_S_18" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	         UNION ALL
               SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 	, T_DTLRSV.SALE_AMT
               FROM TB_RSV T_RSV
               INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
               INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
               INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
               WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
               <isNotEmpty property="sType">
				 <isNotNull property="sType">	         
		           AND AD_DIV=#sType#
		         </isNotNull>
		       </isNotEmpty>
		       <isNotEmpty property="sCorpNm">
				 <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		         </isNotNull>
		       </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
)
SELECT USE_NIGHT AS PRDT_GUBUN
		, USE_NIGHT AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
      FROM T_TOTAL_CNT,
      (
          SELECT T_BASE.USE_NIGHT AS USE_NIGHT
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT LEVEL-1 AS USE_NIGHT
                    FROM DUAL
                      <![CDATA[ 
                    CONNECT BY LEVEL < 7
                      ]]>
                ) T_BASE
                LEFT OUTER JOIN (                
                    SELECT USE_NIGHT
                          , COUNT(SALE_AMT) AS RSV_CNT FROM
                    (
                        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                             , T_DTLRSV.SALE_AMT
                               <![CDATA[ 
                             , (CASE WHEN USE_NIGHT > 5 THEN 5
                               ]]>
                                 ELSE USE_NIGHT
                               END) AS USE_NIGHT
                          FROM TB_RSV T_RSV
                         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             			 INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             			 <isNotEmpty property="sCorpNm">
						    <isNotNull property="sCorpNm">
				         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
				         	</isNotNull>
				         </isNotEmpty>   
                         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                          <isNotEmpty property="sType">
						    <isNotNull property="sType">	         
				           AND AD_DIV=#sType#
				            </isNotNull>
				          </isNotEmpty>
				          <isNotEmpty property="sCorpNm">
						    <isNotNull property="sCorpNm">
				           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
				            </isNotNull>
				          </isNotEmpty>
				        UNION ALL
			               SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
	                             , T_DTLRSV.SALE_AMT
	                             , 1 AS USE_NIGHT
			               FROM TB_RSV T_RSV
			               INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
			               INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
			               INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
			               WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
			               <isNotEmpty property="sType">
							 <isNotNull property="sType">	         
					           AND AD_DIV=#sType#
					         </isNotNull>
					       </isNotEmpty>
					       <isNotEmpty property="sCorpNm">
							 <isNotNull property="sCorpNm">
					           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
					         </isNotNull>
					       </isNotEmpty>
                    )
                    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#                 
                    GROUP BY USE_NIGHT 
               ) T_CNT ON T_CNT.USE_NIGHT=T_BASE.USE_NIGHT
                          
      )
    ORDER BY USE_NIGHT
</select>

<!-- 숙박 가격 통계(그래프) -->
<select id="BIS_S_19" resultMap="BIS_R_17">
WITH T_RSV_PRICE AS (
    SELECT SALE_AMT, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , TRUNC(T_DTLRSV.SALE_AMT/10000)*10000 AS SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
              SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , TRUNC(T_DTLRSV.SALE_AMT/10000)*10000 AS SALE_AMT
              FROM TB_RSV T_RSV
              INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
              INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
              WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
              <isNotEmpty property="sType">
			 	<isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	         	</isNotNull>
	       	  </isNotEmpty>
	       	  <isNotEmpty property="sCorpNm">
			 	<isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	          	</isNotNull>
	       	  </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
        GROUP BY SALE_AMT
),
T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT                 
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
              SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT 
              FROM TB_RSV T_RSV
              INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
              INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
              WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
              <isNotEmpty property="sType">
			 	<isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	         	</isNotNull>
	       	  </isNotEmpty>
	       	  <isNotEmpty property="sCorpNm">
			 	<isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	          	</isNotNull>
	       	  </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT PRICE_TITLE AS PRDT_GUBUN
		, '5만원 미만' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '05UNDER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT
          <![CDATA[         
        FROM T_RSV_PRICE WHERE SALE_AMT < 50000
          ]]>
     )
 UNION
SELECT PRICE_TITLE AS PRDT_GUBUN
		, '5~10만원' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '10UNDER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
          <![CDATA[      
        FROM T_RSV_PRICE WHERE SALE_AMT >= 50000 AND SALE_AMT < 100000
          ]]>
     )
 UNION
SELECT PRICE_TITLE AS PRDT_GUBUN
		, '10~20만원' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '20UNDER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT 
          <![CDATA[
        FROM T_RSV_PRICE WHERE SALE_AMT >= 100000 AND SALE_AMT < 200000
          ]]>
     )
 UNION
SELECT PRICE_TITLE AS PRDT_GUBUN
		, '20만원 이상' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '21OVER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
          <![CDATA[   
        FROM T_RSV_PRICE WHERE SALE_AMT >= 200000
          ]]>
     )
</select>

<!-- 숙박 지역 통계(그래프) -->
<select id="BIS_S_20" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT                 
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
		, CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
      FROM T_TOTAL_CNT,
      (
        SELECT BASE.CD_NUM
        		, CD_NM
        		, VIEW_SN
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='ADAR' AND USE_YN='Y'
            ) BASE
            LEFT OUTER JOIN (
                SELECT AD_AREA, COUNT(SALE_AMT) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                         , T_DTLRSV.SALE_AMT
                         , AD_AREA
                      FROM TB_RSV T_RSV
                     INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                     LEFT OUTER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                     LEFT OUTER JOIN TB_AD_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
                     WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                      <isNotEmpty property="sType">
					    <isNotNull property="sType">	         
			           AND AD_DIV=#sType#
			            </isNotNull>
			          </isNotEmpty>
			          <isNotEmpty property="sCorpNm">
					    <isNotNull property="sCorpNm">
			           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
			            </isNotNull>
			          </isNotEmpty>
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
                GROUP BY AD_AREA
            ) RSV ON RSV.AD_AREA=BASE.CD_NUM
        )
        ORDER BY VIEW_SN
</select>

<!-- 숙박 당일 예약 통계(그래프) -->
<select id="BIS_S_21" resultMap="BIS_R_21">
SELECT TODAY_RSV AS RSV_CNT
        , DECODE(TOTAL_CNT, 0, 0, ROUND(NVL(TODAY_RSV, 0)/TOTAL_CNT * 100, 1)) AS RSV_CNT_PER
        , (TOTAL_CNT - TODAY_RSV) AS OTHER_RSV_CNT
        , DECODE(TOTAL_CNT, 0, 0, ROUND((TOTAL_CNT - TODAY_RSV)/TOTAL_CNT * 100, 1)) AS OTHER_RSV_PER
        FROM
    (SELECT SUM(DECODE(REPLACE(RSV_DT, '-', ''), USE_DT, 1, 0)) AS TODAY_RSV        
        FROM (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
                 , USE_DT
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
              SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
                 , TO_CHAR(USE_DTTM, 'YYYY-MM-DD') AS USE_DT
              FROM TB_RSV T_RSV
              INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
              INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
              WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
              <isNotEmpty property="sType">
			 	<isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	         	</isNotNull>
	       	  </isNotEmpty>
	       	  <isNotEmpty property="sCorpNm">
			 	<isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	          	</isNotNull>
	       	  </isNotEmpty>
        ) 
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#),
    (SELECT COUNT(SALE_AMT) AS TOTAL_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
              SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
              INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
              INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
              INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
              WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
              <isNotEmpty property="sType">
			 	<isNotNull property="sType">	         
	           AND AD_DIV=#sType#
	         	</isNotNull>
	       	  </isNotEmpty>
	       	  <isNotEmpty property="sCorpNm">
			 	<isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	          	</isNotNull>
	       	  </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    )
</select>

<!-- 숙박 예약 취소 주기 통계(예약일 기준 - 그래프) -->
<select id="BIS_S_22" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND AD_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND AD_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
		, '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '1일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[
            FROM T_CANCEL WHERE DIFF_DAY>='1' AND DIFF_DAY<'3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '3일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT
        	  <![CDATA[
            FROM T_CANCEL WHERE DIFF_DAY>='3' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '일주일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[     
            FROM T_CANCEL WHERE DIFF_DAY>='7' AND DIFF_DAY<'15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '15일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[    
            FROM T_CANCEL WHERE DIFF_DAY>='15' AND DIFF_DAY<'30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '한달후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[     
            FROM T_CANCEL WHERE DIFF_DAY>='30'
              ]]>
    )
</select>

<!-- 숙박 예약 취소 주기 통계(사용일 기준 - 그래프) -->
<select id="BIS_S_23" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND AD_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(USE_DT, 'YYYY-MM-DD') - TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_AD_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_AD_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_AD_DFTINF T_AD ON T_AD.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='AD'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND AD_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(USE_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C410'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT
            FROM T_CANCEL 
              WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT
            FROM T_CANCEL 
              WHERE DIFF_DAY='1'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL 
            	<![CDATA[
              WHERE DIFF_DAY>'1' AND DIFF_DAY<='3'
                ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '7일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL 
            	<![CDATA[
              WHERE DIFF_DAY>'3' AND DIFF_DAY<='7'
              	]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL 
            	<![CDATA[
              WHERE DIFF_DAY>'7' AND DIFF_DAY<='15'
                ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '한달전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL 
            	<![CDATA[
              WHERE DIFF_DAY>'15'
                ]]>
    )
</select>


<!-- 렌터카 인수 통계 -->
<select id="BIS_S_24" resultMap="BIS_R_13">
SELECT 'RENTCAR' AS PRDT_GUBUN, BASE.RSV_WEEK_GUBUN, NVL(RSV_CNT, 0) AS RSV_CNT FROM (
    SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS RSV_WEEK_GUBUN
            FROM DUAL
              <![CDATA[
            CONNECT BY LEVEL < 8
              ]]>
    ) BASE
    LEFT OUTER JOIN (
        SELECT RSV_WEEK_GUBUN, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(TO_DATE(T_RSV.RENT_START_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS START_DT    
                 , TO_CHAR(TO_DATE(T_RSV.RENT_START_DT, 'YYYYMMDD'), 'D') AS RSV_WEEK_GUBUN                 
                 , T_RSV.SALE_AMT
              FROM TB_RC_RSV T_RSV
              LEFT OUTER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_RSV.PRDT_NUM
              LEFT OUTER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
                <isNotEmpty property="sCorpNm">
			      <isNotNull property="sCorpNm">
	          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
	         	  </isNotNull>
	           </isNotEmpty>              
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01') 
           	  <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CAR_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
	          SELECT TO_CHAR(T_RSV.USE_DTTM, 'YYYY-MM-DD') AS START_DT    
                 , TO_CHAR(T_RSV.USE_DTTM, 'D') AS RSV_WEEK_GUBUN                 
                 , T_RSV.SALE_AMT
	          FROM TB_SP_RSV T_RSV
	          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM AND T_RSV.RSV_STATUS_CD IN ('RS20', 'RS32')
	          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
	          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
	          <isNotEmpty property="sType">
				<isNotNull property="sType">	         
	          AND AD_DIV=#sType#
	      		</isNotNull>
	    	  </isNotEmpty>
	    	  <isNotEmpty property="sCorpNm">
				<isNotNull property="sCorpNm">
	          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	       		</isNotNull>
	    	  </isNotEmpty>
        )
        WHERE START_DT BETWEEN #sStartDt# AND #sEndDt#  
        GROUP BY RSV_WEEK_GUBUN
    ) RSV ON RSV.RSV_WEEK_GUBUN=BASE.RSV_WEEK_GUBUN
    ORDER BY RSV_WEEK_GUBUN
</select>

<!-- 렌터카 유형 통계(그래프) -->
<select id="BIS_S_25" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CAR_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
      FROM T_TOTAL_CNT,
        (SELECT BASE.CD_NUM
                , CD_NM
                , VIEW_SN
                , NVL(RSV_CNT, 0) AS RSV_CNT                
              FROM (
                SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='CDIV' AND USE_YN='Y'
            ) BASE
            LEFT OUTER JOIN (
                SELECT CAR_DIV, COUNT(SALE_AMT) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                         , T_DTLRSV.SALE_AMT
                         , CAR_DIV
                      FROM TB_RSV T_RSV
                     INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM                      
                     LEFT OUTER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                     LEFT OUTER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
                     <isNotEmpty property="sCorpNm">
					    <isNotNull property="sCorpNm">
			         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
			         	</isNotNull>
			         </isNotEmpty>                       
                     WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                      <isNotEmpty property="sType">
					    <isNotNull property="sType">	         
			           AND CAR_DIV=#sType#
			            </isNotNull>
			          </isNotEmpty>
			          <isNotEmpty property="sCorpNm">
					    <isNotNull property="sCorpNm">
			           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
			            </isNotNull>
			          </isNotEmpty>
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
                GROUP BY CAR_DIV
            ) RSV ON RSV.CAR_DIV=BASE.CD_NUM    
      )
      ORDER BY VIEW_SN
</select>

<!-- 렌터카 렌트 기간 통계(그래프) -->
<select id="BIS_S_26" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CAR_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
	          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
	          FROM TB_RSV T_RSV
	          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
	          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
	          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
	          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
	          <isNotEmpty property="sType">
				<isNotNull property="sType">	         
	          AND AD_DIV=#sType#
	      		</isNotNull>
	    	  </isNotEmpty>
	    	  <isNotEmpty property="sCorpNm">
				<isNotNull property="sCorpNm">
	          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	       		</isNotNull>
	    	  </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_USE_RSV AS (
    SELECT USE_DAY, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
                 , TO_DATE(RENT_END_DT, 'YYYY-MM-DD') - TO_DATE(RENT_START_DT, 'YYYY-MM-DD') + 1 AS USE_DAY
              FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CAR_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
	        UNION ALL
	          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
                 , 1 AS USE_DAY
	          FROM TB_RSV T_RSV
	          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
	          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
	          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
	          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
	          <isNotEmpty property="sType">
				<isNotNull property="sType">	         
	          AND AD_DIV=#sType#
	      		</isNotNull>
	    	  </isNotEmpty>
	    	  <isNotEmpty property="sCorpNm">
				<isNotNull property="sCorpNm">
	          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	       		</isNotNull>
	    	  </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
        GROUP BY USE_DAY 
)
SELECT USE_DAY AS PRDT_GUBUN
        , PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT '' || BASE.USE_DAY AS USE_DAY
        , BASE.USE_DAY || '일' AS PRDT_NM
        , NVL(RSV_CNT, 0) AS RSV_CNT        
      FROM (
        SELECT LEVEL AS USE_DAY FROM DUAL
        	  <![CDATA[
            CONNECT BY LEVEL < 6
              ]]>
      ) BASE
      LEFT OUTER JOIN (
        SELECT USE_DAY
            , RSV_CNT
          FROM T_USE_RSV
            <![CDATA[
          WHERE USE_DAY < 6
            ]]>
      ) RSV ON RSV.USE_DAY=BASE.USE_DAY
    )
 UNION
SELECT USE_DAY AS PRDT_GUBUN
        , PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT '6' AS USE_DAY
        , '6일 이상' AS PRDT_NM
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
      FROM T_USE_RSV
      WHERE USE_DAY >= 6
    )
</select>

<!-- 렌터카 연료 유형 통계(그래프) -->
<select id="BIS_S_27" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
             <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
	         	</isNotNull>
	         </isNotEmpty>   
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
              <isNotEmpty property="sType">
			    <isNotNull property="sType">	         
	           AND CAR_DIV=#sType#
	            </isNotNull>
	          </isNotEmpty>
	          <isNotEmpty property="sCorpNm">
			    <isNotNull property="sCorpNm">
	           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            </isNotNull>
	          </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT BASE.CD_NUM
            , CD_NM
            , VIEW_SN
            , NVL(RSV_CNT, 0) AS RSV_CNT            
          FROM (
            SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='CFCD' AND USE_YN='Y'
        ) BASE
        LEFT OUTER JOIN (
            SELECT USE_FUEL_DIV, COUNT(SALE_AMT) AS RSV_CNT FROM
            (
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                     , T_DTLRSV.SALE_AMT
                     , USE_FUEL_DIV
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 LEFT OUTER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                 LEFT OUTER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
                 <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
		         	</isNotNull>
		         </isNotEmpty>   
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                  <isNotEmpty property="sType">
				    <isNotNull property="sType">	         
		           AND CAR_DIV=#sType#
		            </isNotNull>
		          </isNotEmpty>
		          <isNotEmpty property="sCorpNm">
				    <isNotNull property="sCorpNm">
		           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		            </isNotNull>
		          </isNotEmpty>
            )
            WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
            GROUP BY USE_FUEL_DIV
        ) RSV ON RSV.USE_FUEL_DIV=BASE.CD_NUM 
    )
</select>

<!-- 렌터카 예약 취소 주기 통계(예약일 기준 - 그래프) -->
<select id="BIS_S_28" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND CAR_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT 
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND CAR_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY    
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
        	  <![CDATA[   
            FROM T_CANCEL WHERE DIFF_DAY>='1' AND DIFF_DAY<'3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일후' AS PRDT_NM
        , RSV_CNT     
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[     
            FROM T_CANCEL WHERE DIFF_DAY>='3' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '7일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[      
            FROM T_CANCEL WHERE DIFF_DAY>='7' AND DIFF_DAY<'15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[      
            FROM T_CANCEL WHERE DIFF_DAY>='15' AND DIFF_DAY<'30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '한달후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[     
            FROM T_CANCEL WHERE DIFF_DAY>='30'
              ]]>
    )
</select>

<!-- 렌터카 예약 취소 주기 통계(사용일 기준 - 그래프) -->
<select id="BIS_S_29" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND CAR_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT 
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(RENT_START_DT, 'YYYY-MM-DD') - TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
         INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
         <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
         INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='RC'
         	</isNotNull>
         </isNotEmpty>   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          <isNotEmpty property="sType">
		    <isNotNull property="sType">	         
           AND CAR_DIV=#sType#
            </isNotNull>
          </isNotEmpty>
          <isNotEmpty property="sCorpNm">
		    <isNotNull property="sCorpNm">
           AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotNull>
          </isNotEmpty>
        UNION ALL
          SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(USE_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY  
          FROM TB_RSV T_RSV
          INNER JOIN TB_SP_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
          INNER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
          WHERE T_SPPRDT.PRDT_DIV='TOUR' AND CTGR='C420'
          <isNotEmpty property="sType">
			<isNotNull property="sType">	         
          AND AD_DIV=#sType#
      		</isNotNull>
    	  </isNotEmpty>
    	  <isNotEmpty property="sCorpNm">
			<isNotNull property="sCorpNm">
          AND CORP_NM LIKE '%' || #sCorpNm# || '%'
       		</isNotNull>
    	  </isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL WHERE DIFF_DAY='1'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[ 
            FROM T_CANCEL WHERE DIFF_DAY>'1' AND DIFF_DAY<='3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '7일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
        	  <![CDATA[    
            FROM T_CANCEL WHERE DIFF_DAY>'3' AND DIFF_DAY<='7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT      
        	  <![CDATA[   
            FROM T_CANCEL WHERE DIFF_DAY>'7' AND DIFF_DAY<='15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '30일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[    
            FROM T_CANCEL WHERE DIFF_DAY>'15'
              ]]>
    )
</select>


<!-- 관광지 사용 통계 -->
<select id="BIS_S_30" resultMap="BIS_R_13">
SELECT 'coupon' AS PRDT_GUBUN, BASE.RSV_WEEK_GUBUN, NVL(RSV_CNT, 0) AS RSV_CNT FROM (
    SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS RSV_WEEK_GUBUN
            FROM DUAL
              <![CDATA[ 
            CONNECT BY LEVEL < 8
              ]]>
    ) BASE
    LEFT OUTER JOIN (
        SELECT RSV_WEEK_GUBUN, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.USE_DTTM, 'YYYY-MM-DD') AS START_DT    
                 , TO_CHAR(T_RSV.USE_DTTM, 'D') AS RSV_WEEK_GUBUN                 
                 , T_RSV.SALE_AMT
              FROM TB_SP_RSV T_RSV             
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
               ON T_SPPRDT.PRDT_NUM = T_RSV.PRDT_NUM
             INNER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
               <!-- AND T_RSV.PRDT_DIV!='TOUR'
               <isEqual property="sCategory" compareValue="SPC">
	           AND SUBSTR(CTGR, 0, 2)='C2'
	           </isEqual>
	           <isEqual property="sCategory" compareValue="SPF">
	           AND SUBSTR(CTGR, 0, 2)='C3'
	           </isEqual> -->
	           
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                         
               <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE START_DT BETWEEN #sStartDt# AND #sEndDt#  
        GROUP BY RSV_WEEK_GUBUN
    ) RSV ON RSV.RSV_WEEK_GUBUN=BASE.RSV_WEEK_GUBUN
    ORDER BY RSV_WEEK_GUBUN
</select>

<!-- 관광지 유형 통계(그래프) -->
<select id="BIS_S_31" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
	         INNER JOIN TB_SP_PRDTINF T_SPPRDT
	            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
	         INNER JOIN TB_CORP T_CORP
	            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                <!-- AND T_DTLRSV.PRDT_DIV!='TOUR'
                <isEqual property="sCategory" compareValue="SPC">
	           AND SUBSTR(CTGR, 0, 2)='C2'
	           </isEqual>
	           <isEqual property="sCategory" compareValue="SPF">
	           AND SUBSTR(CTGR, 0, 2)='C3'
	           </isEqual> -->
	           
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     
               <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT BASE.CD_NUM
            , CD_NM
            , VIEW_SN
            , NVL(RSV_CNT, 0) AS RSV_CNT            
          FROM (
            SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM IN (
           <isEqual property="sCategory" compareValue="SPC">
           'C200'
           </isEqual>
           <isEqual property="sCategory" compareValue="SPF">
           'C300'
           </isEqual>
            ) AND USE_YN='Y'
        ) BASE
        LEFT OUTER JOIN (
            SELECT CTGR, COUNT(SALE_AMT) AS RSV_CNT FROM
            (
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                     , T_DTLRSV.SALE_AMT
                     , CTGR
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 LEFT OUTER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                 INNER JOIN TB_CORP T_CORP
               		ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                   <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'
                   <isEqual property="sCategory" compareValue="SPC">
		           AND SUBSTR(CTGR, 0, 2)='C2'
		           </isEqual>
		           <isEqual property="sCategory" compareValue="SPF">
		           AND SUBSTR(CTGR, 0, 2)='C3'
		           </isEqual> -->
		           
		           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     
                   <isNotEmpty property="sType">
			    	 <isNotNull property="sType">
	           	   AND CTGR=#sType#
	            	 </isNotNull>
	          	   </isNotEmpty>
	          	   <isNotEmpty property="sCorpNm">
			    	 <isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	 </isNotNull>
	          	   </isNotEmpty>
            )
            WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
            GROUP BY CTGR
        ) RSV ON RSV.CTGR=BASE.CD_NUM    
    )  
    ORDER BY CD_NUM, VIEW_SN
</select>

<!-- 관광지 구매 개수(그래프) -->
<select id="BIS_S_32" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
	            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
	         INNER JOIN TB_CORP T_CORP
	            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
               <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'
               <isEqual property="sCategory" compareValue="SPC">
	           AND SUBSTR(CTGR, 0, 2)='C2'
	           </isEqual>
	           <isEqual property="sCategory" compareValue="SPF">
	           AND SUBSTR(CTGR, 0, 2)='C3'
	           </isEqual> -->
	           
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPB">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	                     </isEqual>
	                     
               <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
),
T_BUY_NUM AS (
    SELECT BUY_NUM, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
                 , BUY_NUM
              FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             LEFT OUTER JOIN TB_SP_PRDTINF T_SPPRDT ON T_SPPRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_CORP T_CORP
               		ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
               <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'
               <isEqual property="sCategory" compareValue="SPC">
	           AND SUBSTR(CTGR, 0, 2)='C2'
	           </isEqual>
	           <isEqual property="sCategory" compareValue="SPF">
	           AND SUBSTR(CTGR, 0, 2)='C3'
	           </isEqual> -->
	           
	           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPB">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	                     </isEqual>
               <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#   
        GROUP BY BUY_NUM
)
SELECT BUY_NUM AS PRDT_GUBUN
        , BUY_NUM || '개' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT '' || BASE.BUY_NUM AS BUY_NUM
            , NVL(RSV_CNT, 0) AS RSV_CNT            
          FROM (
            SELECT LEVEL AS BUY_NUM FROM DUAL
            	  <![CDATA[ 
                CONNECT BY LEVEL < 6
                  ]]>
          ) BASE
          LEFT OUTER JOIN (
            SELECT BUY_NUM
                , RSV_CNT
              FROM T_BUY_NUM
                <![CDATA[ 
              WHERE BUY_NUM < 6
                ]]>
          ) RSV ON RSV.BUY_NUM=BASE.BUY_NUM
     )
 UNION
SELECT BUY_NUM AS PRDT_GUBUN
        , '6개 이상' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT '6OVER' AS BUY_NUM
            , NVL(SUM(RSV_CNT), 0) AS RSV_CNT            
          FROM T_BUY_NUM
            <![CDATA[ 
          WHERE BUY_NUM >=6
            ]]>
    )
</select>

<!-- 관광지 구매 시기(그래프) -->
<select id="BIS_S_33" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
	        ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_DTLRSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
           AND TRIM(USE_DTTM)!=' ' 
           <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'            
           <isEqual property="sCategory" compareValue="SPC">
           AND SUBSTR(CTGR, 0, 2)='C2'
           </isEqual>
           <isEqual property="sCategory" compareValue="SPF">
           AND SUBSTR(CTGR, 0, 2)='C3'
           </isEqual> -->
           
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPB">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	                     </isEqual>
	                     
           <isNotEmpty property="sType">
    	 	  <isNotNull property="sType">
         	AND CTGR=#sType#
          	   </isNotNull>
        	</isNotEmpty>
        	<isNotEmpty property="sCorpNm">
    	 	  <isNotNull property="sCorpNm">
         	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
          	  </isNotNull>
        	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_RSV AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(USE_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
	        ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_DTLRSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
            AND TRIM(USE_DTTM)!=' '
           <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'
           
            <isEqual property="sCategory" compareValue="SPC">
           AND SUBSTR(CTGR, 0, 2)='C2'
           </isEqual>
           <isEqual property="sCategory" compareValue="SPF">
           AND SUBSTR(CTGR, 0, 2)='C3'
           </isEqual> -->
           
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPB">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	                     </isEqual>
	                     
            <isNotEmpty property="sType">
    	 	  <isNotNull property="sType">
         	AND CTGR=#sType#
          	   </isNotNull>
        	</isNotEmpty>
        	<isNotEmpty property="sCorpNm">
    	 	  <isNotNull property="sCorpNm">
         	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
          	  </isNotNull>
        	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '0PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT
            FROM T_RSV WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '1PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_RSV WHERE DIFF_DAY='1'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '2일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '2PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_RSV WHERE DIFF_DAY='2'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '3PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[       
            FROM T_RSV WHERE DIFF_DAY>='3' AND DIFF_DAY<'5'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '5일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '5PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
        	  <![CDATA[    
            FROM T_RSV WHERE DIFF_DAY>='5' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '일주일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '7PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[      
            FROM T_RSV WHERE DIFF_DAY>='7'
              ]]>
    )
</select>

<!-- 관광지 예약 취소 주기 통계(예약일 기준 - 그래프) -->
<select id="BIS_S_34" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
	        ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
           <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'
           <isEqual property="sCategory" compareValue="SPC">
           AND SUBSTR(CTGR, 0, 2)='C2'
           </isEqual>
           <isEqual property="sCategory" compareValue="SPF">
           AND SUBSTR(CTGR, 0, 2)='C3'
           </isEqual> -->
           
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPB">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	                     </isEqual>
	                     
           <isNotEmpty property="sType">
    	 	  <isNotNull property="sType">
         	AND CTGR=#sType#
          	   </isNotNull>
        	</isNotEmpty>
        	<isNotEmpty property="sCorpNm">
    	 	  <isNotNull property="sCorpNm">
         	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
          	  </isNotNull>
        	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
	        ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
           <!--  AND T_DTLRSV.PRDT_DIV!='TOUR'
            <isEqual property="sCategory" compareValue="SPC">
           AND SUBSTR(CTGR, 0, 2)='C2'
           </isEqual>
           <isEqual property="sCategory" compareValue="SPF">
           AND SUBSTR(CTGR, 0, 2)='C3'
           </isEqual> -->
           
           AND (SELECT HRK_CD_NUM
	                  FROM TB_CD
	                 WHERE CD_NUM = (SELECT CTGR
	                          FROM TB_SP_PRDTINF
	                     <isEqual property="sCategory" compareValue="SPC">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C200'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPF">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C300'
	                     </isEqual>
	                     <isEqual property="sCategory" compareValue="SPB">
	                         WHERE PRDT_NUM = T_SPPRDT.PRDT_NUM)) = 'C500'
	                     </isEqual>
	                     
           <isNotEmpty property="sType">
    	 	  <isNotNull property="sType">
         	AND CTGR=#sType#
          	   </isNotNull>
        	</isNotEmpty>
        	<isNotEmpty property="sCorpNm">
    	 	  <isNotNull property="sCorpNm">
         	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
          	  </isNotNull>
        	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[       
            FROM T_CANCEL WHERE DIFF_DAY>='1' AND DIFF_DAY<'3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[ 
            FROM T_CANCEL WHERE DIFF_DAY>='3' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '일주일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[     
            FROM T_CANCEL WHERE DIFF_DAY>='7' AND DIFF_DAY<'15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[       
            FROM T_CANCEL WHERE DIFF_DAY>='15' AND DIFF_DAY<'30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '한달 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[      
            FROM T_CANCEL WHERE DIFF_DAY>='30'
              ]]>
    )
</select>

<!-- 패키지 유형 통계(그래프) -->
<select id="BIS_S_35" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SP_PRDTINF T_SPPRDT
                ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
             INNER JOIN TB_CORP T_CORP
          		ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'         
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                AND T_DTLRSV.PRDT_DIV='TOUR'
                <isNotEmpty property="sType">
		    	  <isNotNull property="sType">
           	   AND CTGR=#sType#
            	  </isNotNull>
          		</isNotEmpty>
          		<isNotEmpty property="sCorpNm">
		    	  <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	  </isNotNull>
          		</isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
    FROM T_TOTAL_CNT,
        (SELECT BASE.CD_NUM
                , CD_NM
                , VIEW_SN
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='C100' AND USE_YN='Y'
            ) BASE
            LEFT OUTER JOIN (
                SELECT CTGR, COUNT(SALE_AMT) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                         , T_DTLRSV.SALE_AMT
                         , CTGR
                      FROM TB_RSV T_RSV
                     INNER JOIN TB_SP_RSV T_DTLRSV
                        ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                     LEFT OUTER JOIN TB_SP_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                     INNER JOIN TB_CORP T_CORP
          				ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='SP' 
                     WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                        AND T_DTLRSV.PRDT_DIV='TOUR'
                        <isNotEmpty property="sType">
				    	  <isNotNull property="sType">
		           	   AND CTGR=#sType#
		            	  </isNotNull>
		          		</isNotEmpty>
		          		<isNotEmpty property="sCorpNm">
				    	  <isNotNull property="sCorpNm">
		           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
		            	  </isNotNull>
		          		</isNotEmpty>
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
                GROUP BY CTGR
            ) RSV ON RSV.CTGR=BASE.CD_NUM    
    )
    ORDER BY VIEW_SN
</select>

<!-- 패키지 가격 통계(그래프) -->
<select id="BIS_S_36" resultMap="BIS_R_17">
WITH T_RSV_PRICE AS (
    SELECT SALE_AMT, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , TRUNC(T_DTLRSV.SALE_AMT/10000)*10000 AS SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             LEFT OUTER JOIN TB_SP_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_CORP T_CORP
          		ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                AND T_DTLRSV.PRDT_DIV='TOUR'
                <isNotEmpty property="sType">
		    	  <isNotNull property="sType">
           	   AND CTGR=#sType#
            	  </isNotNull>
          		</isNotEmpty>
          		<isNotEmpty property="sCorpNm">
		    	  <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	  </isNotNull>
          		</isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
        GROUP BY SALE_AMT
),
T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SP_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             LEFT OUTER JOIN TB_SP_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_CORP T_CORP
          		ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='SP'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                AND T_DTLRSV.PRDT_DIV='TOUR'
                <isNotEmpty property="sType">
		    	  <isNotNull property="sType">
           	   AND CTGR=#sType#
            	  </isNotNull>
          		</isNotEmpty>
          		<isNotEmpty property="sCorpNm">
		    	  <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	  </isNotNull>
          		</isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT PRICE_TITLE AS PRDT_GUBUN
        , '5만원 미만' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '05UNDER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
          <![CDATA[       
        FROM T_RSV_PRICE WHERE SALE_AMT < 50000
          ]]>
     )
 UNION
SELECT PRICE_TITLE AS PRDT_GUBUN
        , '5~10만원' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '10UNDER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
          <![CDATA[ 
        FROM T_RSV_PRICE WHERE SALE_AMT >= 50000 AND SALE_AMT < 100000
          ]]>
     )
 UNION
SELECT PRICE_TITLE AS PRDT_GUBUN
        , '10~20만원' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '20UNDER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT 
          <![CDATA[
        FROM T_RSV_PRICE WHERE SALE_AMT >= 100000 AND SALE_AMT < 200000
          ]]>
     )
 UNION
SELECT PRICE_TITLE AS PRDT_GUBUN
        , '20만원 이상' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
       FROM T_TOTAL_CNT,
     (SELECT '21OVER' AS PRICE_TITLE
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
          <![CDATA[
        FROM T_RSV_PRICE WHERE SALE_AMT >= 200000
          ]]>
     )
</select>

<!-- 패키지 예약 취소 주기 통계(예약일 기준 - 그래프) -->
<select id="BIS_S_37" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
         	ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'   
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            AND T_DTLRSV.PRDT_DIV='TOUR'
            <isNotEmpty property="sType">
	    	  <isNotNull property="sType">
          	AND CTGR=#sType#
           	  </isNotNull>
         	</isNotEmpty>
         	<isNotEmpty property="sCorpNm">
	    	  <isNotNull property="sCorpNm">
          	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
           	  </isNotNull>
         	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
         	ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP' 
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            AND T_DTLRSV.PRDT_DIV='TOUR'
            <isNotEmpty property="sType">
	    	  <isNotNull property="sType">
          	AND CTGR=#sType#
           	  </isNotNull>
         	</isNotEmpty>
         	<isNotEmpty property="sCorpNm">
	    	  <isNotNull property="sCorpNm">
          	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
           	  </isNotNull>
         	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[      
            FROM T_CANCEL WHERE DIFF_DAY>='1' AND DIFF_DAY<'3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[
            FROM T_CANCEL WHERE DIFF_DAY>='3' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '일주일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[    
            FROM T_CANCEL WHERE DIFF_DAY>='7' AND DIFF_DAY<'15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[
            FROM T_CANCEL WHERE DIFF_DAY>='15' AND DIFF_DAY<'30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '한달후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[    
            FROM T_CANCEL WHERE DIFF_DAY>='30'
              ]]>
    )
</select>

<!-- 패키지 예약 취소 주기 통계(사용일 기준 - 그래프) -->
<select id="BIS_S_38" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
         	ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            AND T_DTLRSV.PRDT_DIV='TOUR'
            <isNotEmpty property="sType">
	    	  <isNotNull property="sType">
          	AND CTGR=#sType#
           	  </isNotNull>
         	</isNotEmpty>
         	<isNotEmpty property="sCorpNm">
	    	  <isNotNull property="sCorpNm">
          	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
           	  </isNotNull>
         	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(USE_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
         	ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SP'
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            AND T_DTLRSV.PRDT_DIV='TOUR'
            <isNotEmpty property="sType">
	    	  <isNotNull property="sType">
          	AND CTGR=#sType#
           	  </isNotNull>
         	</isNotEmpty>
         	<isNotEmpty property="sCorpNm">
	    	  <isNotNull property="sCorpNm">
          	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
           	  </isNotNull>
         	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT       
        	  <![CDATA[ 
            FROM T_CANCEL WHERE DIFF_DAY>='1' AND DIFF_DAY<'3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[    
            FROM T_CANCEL WHERE DIFF_DAY>='3' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '일주일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT 
        	  <![CDATA[       
            FROM T_CANCEL WHERE DIFF_DAY>='7' AND DIFF_DAY<'15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[
            FROM T_CANCEL WHERE DIFF_DAY>='15' AND DIFF_DAY<'30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '한달전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT       
        	  <![CDATA[ 
            FROM T_CANCEL WHERE DIFF_DAY>='30'
              ]]>
    )
</select>



<!-- 항공 출발시간 통계 -->
<select id="BIS_S_39" resultMap="BIS_R_13">
WITH T_RSV_TIME AS (
    SELECT BASE.RSV_WEEK_GUBUN, BASE.RSV_HOUR, NVL(RSV_CNT, 0) AS RSV_CNT FROM (
        SELECT RSV_WEEK_GUBUN, RSV_HOUR FROM 
            (SELECT TO_CHAR(TO_DATE('2016-05-'||LPAD(LEVEL, 2, '0'), 'YYYY-MM-DD'), 'D') AS RSV_WEEK_GUBUN
                FROM DUAL
                  <![CDATA[ 
                CONNECT BY LEVEL < 8),
                  ]]>
            (SELECT LPAD(LEVEL-1, 2, '0') AS RSV_HOUR
                FROM DUAL
                  <![CDATA[ 
                CONNECT BY LEVEL < 25)
                  ]]>
        ) BASE
        LEFT OUTER JOIN (
            SELECT RSV_WEEK_GUBUN, RSV_HOUR, COUNT(SALE_AMT) AS RSV_CNT FROM
            (
                SELECT TO_CHAR(T_RSV.USE_DTTM, 'YYYY-MM-DD') AS RSV_DT    
                     , TO_CHAR(T_RSV.USE_DTTM , 'D') AS RSV_WEEK_GUBUN
                     , TO_CHAR(T_RSV.USE_DTTM , 'HH24') AS RSV_HOUR
                     , T_RSV.SALE_AMT
                  FROM TB_AV_RSV T_RSV
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 
            )
            WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
            GROUP BY RSV_WEEK_GUBUN, RSV_HOUR
        ) RSV ON RSV.RSV_WEEK_GUBUN=BASE.RSV_WEEK_GUBUN AND RSV.RSV_HOUR=BASE.RSV_HOUR
        ORDER BY RSV_WEEK_GUBUN, RSV_HOUR
)
  <![CDATA[ 
SELECT '07PREV' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR < '08' OR RSV_HOUR >= '20' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '08:00~10:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '08' AND RSV_HOUR < '10' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '10:00~12:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '10' AND RSV_HOUR < '12' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '12:00~14:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '12' AND RSV_HOUR < '14' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '14:00~16:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '14' AND RSV_HOUR < '16' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '16:00~18:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '16' AND RSV_HOUR < '18' GROUP BY RSV_WEEK_GUBUN
 UNION
SELECT '18:00~20:00' AS PRDT_GUBUN, RSV_WEEK_GUBUN, SUM(RSV_CNT) AS RSV_CNT FROM T_RSV_TIME WHERE RSV_HOUR >= '18' AND RSV_HOUR < '20' GROUP BY RSV_WEEK_GUBUN
  ]]>
</select>

<!-- 항공 예약 시기 통계(그래프) -->
<select id="BIS_S_40" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , SALE_AMT        
          FROM TB_AV_RSV T_RSV
         WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_RSV AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(USE_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(RSV_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_AV_RSV T_RSV
         WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
		, '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT
            FROM T_RSV WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '3일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
              <![CDATA[    
            FROM T_RSV WHERE DIFF_DAY>='1' AND DIFF_DAY<='3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '7일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
              <![CDATA[       
            FROM T_RSV WHERE DIFF_DAY>'3' AND DIFF_DAY<='7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '15일전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT     
        	  <![CDATA[    
            FROM T_RSV WHERE DIFF_DAY>'7' AND DIFF_DAY<='15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '한달전' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30PREV' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[ 
            FROM T_RSV WHERE DIFF_DAY>'15' AND DIFF_DAY<='30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
		, '그외' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '31OVER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[     
            FROM T_RSV WHERE DIFF_DAY>'30'
              ]]>
    )
</select>

<!-- 항공 항공권 유형 통계(그래프) -->
<select id="BIS_S_41" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(RSV_CNT) AS CNT FROM
        (
            SELECT RSV_NUM
                 , COUNT(RSV_NUM) AS RSV_CNT
              FROM TB_AV_RSV
             WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
             GROUP BY RSV_NUM
        )
    )
SELECT AIR_GUBUN AS PRDT_GUBUN
        , DECODE(AIR_GUBUN, '1', '편도', '왕복') AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
      FROM T_TOTAL_CNT,
      (
        SELECT T_BASE.AIR_GUBUN AS AIR_GUBUN
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT LEVEL AS AIR_GUBUN
                    FROM DUAL
                      <![CDATA[  
                    CONNECT BY LEVEL < 3
                      ]]>
                ) T_BASE
                LEFT OUTER JOIN (
                    SELECT RSV_CNT AS AIR_GUBUN, COUNT(RSV_CNT) AS RSV_CNT FROM (
                        SELECT RSV_NUM, COUNT(RSV_NUM) AS RSV_CNT FROM TB_AV_RSV 
                          WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                            AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
                          GROUP BY RSV_NUM
                    )
                    GROUP BY RSV_CNT
                ) T_CNT ON T_CNT.AIR_GUBUN=T_BASE.AIR_GUBUN             
       )
       ORDER BY AIR_GUBUN DESC
          
</select>

<!-- 항공 항공사 통계(그래프) -->
<select id="BIS_S_42" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(AV_CORP_DIV) AS CNT FROM
        (
            SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT                   
                 , AV_CORP_DIV
              FROM TB_AV_RSV
             WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
    FROM T_TOTAL_CNT,
        (SELECT BASE.CD_NUM
                , CD_NM
                , VIEW_SN
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='AVCP' AND USE_YN='Y'
            ) BASE
            LEFT OUTER JOIN (
                SELECT AV_CORP_DIV, COUNT(AV_CORP_DIV) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT                      
                         , AV_CORP_DIV
                      FROM TB_AV_RSV
                     WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
                GROUP BY AV_CORP_DIV
            ) RSV ON RSV.AV_CORP_DIV=BASE.CD_NUM   
        )   
</select>

<!-- 항공 출발 도시 통계(그래프) -->
<select id="BIS_S_43" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(START_COURSE_DIV) AS CNT FROM
        (
            SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT                   
                 , START_COURSE_DIV
              FROM TB_AV_RSV
             WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
    FROM T_TOTAL_CNT,
        (SELECT BASE.CD_NUM
                , CD_NM
                , VIEW_SN
                , NVL(RSV_CNT, 0) AS RSV_CNT
              FROM (
                SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='AVLN' AND USE_YN='Y'
            ) BASE
            LEFT OUTER JOIN (
                SELECT START_COURSE_DIV, COUNT(START_COURSE_DIV) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT                      
                         , START_COURSE_DIV
                      FROM TB_AV_RSV
                     WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
                GROUP BY START_COURSE_DIV
            ) RSV ON RSV.START_COURSE_DIV=BASE.CD_NUM   
        )   
</select>

<!-- 항공 여행기간 통계(그래프) -->
<select id="BIS_S_44" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(RSV_CNT) AS CNT FROM
    (
        SELECT RSV_NUM
             , COUNT(RSV_NUM) AS RSV_CNT
          FROM TB_AV_RSV
         WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
            AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
         GROUP BY RSV_NUM
    )
    WHERE RSV_CNT='2'
),
T_FROM AS (
  SELECT RSV_NUM
    , START_COURSE_DIV AS COURSE 
    , USE_DTTM AS FROM_DTTM
    FROM (
      SELECT RSV_NUM
        , START_COURSE_DIV
        , USE_DTTM
        , RANK() OVER (PARTITION BY RSV_NUM ORDER BY USE_DTTM ASC) AS RK
      FROM TB_AV_RSV
        WHERE RSV_NUM IN (
            SELECT RSV_NUM FROM (
                SELECT RSV_NUM, COUNT(RSV_NUM) AS RSV_CNT FROM TB_AV_RSV 
                  WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                     AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
                  GROUP BY RSV_NUM
            )
            WHERE RSV_CNT = '2'
        )                
    )
    WHERE RK='1'
),
T_RETURN AS (
  SELECT RSV_NUM
    , END_COURSE_DIV AS COURSE
    , USE_DTTM AS RETURN_DTTM
    FROM (
     SELECT RSV_NUM
        , END_COURSE_DIV
        , USE_DTTM
        , RANK() OVER (PARTITION BY RSV_NUM ORDER BY USE_DTTM ASC) AS RK
      FROM TB_AV_RSV
        WHERE RSV_NUM IN (
            SELECT RSV_NUM FROM (
                SELECT RSV_NUM, COUNT(RSV_NUM) AS RSV_CNT FROM TB_AV_RSV 
                  WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                     AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
                  GROUP BY RSV_NUM
            )
            WHERE RSV_CNT = '2'
        )                
    )
    WHERE RK='2'
)
SELECT TERM AS PRDT_GUBUN
        , TERM AS PRDT_NM
        , NVL(RSV_CNT, 0) AS RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(NVL(RSV_CNT, 0)/CNT * 100, 1)) AS RSV_CNT_PER
      FROM T_TOTAL_CNT, (
        SELECT T_BASE.TERM
                , NVL(RSV_CNT, 0) AS RSV_CNT
            FROM (
              SELECT LEVEL-1 AS TERM
                FROM DUAL
                  <![CDATA[  
                CONNECT BY LEVEL < 7
                  ]]>
              ) T_BASE
              LEFT OUTER JOIN (
                SELECT TERM
                        , SUM(RSV_CNT) AS RSV_CNT
                    FROM (
                    	  <![CDATA[  
                        SELECT (CASE WHEN TERM > 5 THEN 5
                          ]]>
                                 ELSE TERM
                                 END) AS TERM
                            , COUNT(TERM) AS RSV_CNT
                          FROM (
                            SELECT TO_DATE(TO_CHAR(T_RETURN.RETURN_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_FROM.FROM_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS TERM
                                  FROM T_FROM, T_RETURN
                                WHERE T_FROM.RSV_NUM=T_RETURN.RSV_NUM
                          )
                          GROUP BY TERM
                     )
                     GROUP BY TERM
               ) T_CNT ON T_CNT.TERM=T_BASE.TERM
            ORDER BY TERM
       )
</select>

<!-- 월별 광고 수익율 통계 -->
<select id="BIS_S_45" resultMap="BIS_R_45">
WITH T_RSVAMT AS (
SELECT T_BASE.DT
     , NVL(A.SALE_AMT, 0) - NVL(B.CANCEL_AMT, 0) AS TOTAL_AMT
     , NVL(A.SALE_CNT, 0) - NVL(B.CANCEL_CNT, 0) AS TOTAL_CNT
     , NVL(ADTM_AMT, 0) AS ADTM_AMT
  FROM (
    SELECT #sYear#||'-'||LPAD(LEVEL, 2, '0') AS DT
        FROM DUAL
        <![CDATA[
      CONNECT BY LEVEL < 13
        ]]>
    ) T_BASE
  LEFT OUTER JOIN (SELECT RSV_DT
             , SUM(SALE_AMT) AS SALE_AMT
             , COUNT(SALE_AMT) AS SALE_CNT
          FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM') AS RSV_DT
                     , SALE_AMT
                  FROM TB_AV_RSV
                 WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01'))
           GROUP BY RSV_DT
       ) A
    ON A.RSV_DT=T_BASE.DT
  LEFT OUTER JOIN (SELECT RSV_CANCEL_DT
                        , SUM(CANCEL_AMT) AS CANCEL_AMT
                        , COUNT(CANCEL_AMT) AS CANCEL_CNT
                     FROM (SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_AD_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_RC_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM') AS RSV_DT
                                , SALE_AMT
                             FROM TB_AV_RSV
                             WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SV_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL                         
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SP_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                            INNER JOIN TB_SP_PRDTINF T_SPPRDT
                               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                          )
                    GROUP BY RSV_CANCEL_DT
                  ) B
    ON B.RSV_CANCEL_DT = T_BASE.DT
  LEFT OUTER JOIN (
        SELECT TO_CHAR(TO_DATE(APL_DT, 'YYYYMMDD')
            , 'YYYY-MM') AS RSV_DT
            , SUM(ADTM_AMT) AS ADTM_AMT 
          FROM TB_ADTM_AMT 
            WHERE APL_DT LIKE #sYear#||'%'
            GROUP BY TO_CHAR(TO_DATE(APL_DT, 'YYYYMMDD'), 'YYYY-MM')
   ) T_ADTM
     ON T_ADTM.RSV_DT=T_BASE.DT
)
SELECT DT AS RSV_DT
     , TOTAL_AMT AS TOTAL_RSV_AMT
     , TOTAL_CNT AS TOTAL_RSV_CNT
     , ADTM_AMT
     , DECODE(ADTM_AMT, 0, 0, ROUND(TOTAL_AMT / ADTM_AMT * 100, 1)) AS ROAS_PER
     , DECODE(ADTM_AMT, 0, 0, ROUND(ADTM_AMT / TOTAL_CNT)) AS CPA_AMT
  FROM T_RSVAMT
  ORDER BY RSV_DT
</select>

<!-- 일별 광고 수익율 통계 -->
<select id="BIS_S_46" resultMap="BIS_R_45">
  WITH T_RSVAMT AS (
SELECT T_BASE.DT
     , NVL(A.SALE_AMT, 0) - NVL(B.CANCEL_AMT, 0) AS TOTAL_AMT
     , NVL(A.SALE_CNT, 0) - NVL(B.CANCEL_CNT, 0) AS TOTAL_CNT
     , NVL(ADTM_AMT, 0) AS ADTM_AMT
  FROM (
    SELECT #sYear#||'-'||#sMonth#||'-'||LPAD(LEVEL, 2, '0') AS DT
        FROM DUAL
        <![CDATA[
      CONNECT BY LEVEL <= TO_CHAR(LAST_DAY(TO_DATE(#sYear#||'-'||#sMonth#, 'YYYY-MM')), 'DD')
        ]]>
    ) T_BASE
  LEFT OUTER JOIN (SELECT RSV_DT
             , SUM(SALE_AMT) AS SALE_AMT
             , COUNT(SALE_AMT) AS SALE_CNT
          FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_AD_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_RC_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , SALE_AMT
                  FROM TB_AV_RSV
                 WHERE RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                 UNION ALL
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT
                     , T_DTLRSV.SALE_AMT
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SP_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 INNER JOIN TB_SP_PRDTINF T_SPPRDT
                    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01'))
           GROUP BY RSV_DT
       ) A
    ON A.RSV_DT=T_BASE.DT
  LEFT OUTER JOIN (SELECT RSV_CANCEL_DT
                        , SUM(CANCEL_AMT) AS CANCEL_AMT
                        , COUNT(CANCEL_AMT) AS CANCEL_CNT
                     FROM (SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_AD_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_RC_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') AS RSV_DT
                                , SALE_AMT
                             FROM TB_AV_RSV
                             WHERE RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SV_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                            UNION ALL                            
                           SELECT TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM , 'YYYY-MM-DD') AS RSV_CANCEL_DT
                                , T_DTLRSV.CANCEL_AMT
                             FROM TB_RSV T_RSV
                            INNER JOIN TB_SP_RSV T_DTLRSV
                               ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                            INNER JOIN TB_SP_PRDTINF T_SPPRDT
                               ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
                              AND T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
                          )
                    GROUP BY RSV_CANCEL_DT
                  ) B
    ON B.RSV_CANCEL_DT = T_BASE.DT
  LEFT OUTER JOIN (
        SELECT TO_CHAR(TO_DATE(APL_DT, 'YYYYMMDD')
            , 'YYYY-MM-DD') AS RSV_DT
            , SUM(ADTM_AMT) AS ADTM_AMT 
          FROM TB_ADTM_AMT 
            WHERE APL_DT LIKE #sYear#||#sMonth#||'%'
            GROUP BY TO_CHAR(TO_DATE(APL_DT, 'YYYYMMDD'), 'YYYY-MM-DD')
   ) T_ADTM
     ON T_ADTM.RSV_DT=T_BASE.DT
)
SELECT TO_CHAR(TO_DATE(DT, 'YYYY-MM-DD'), 'MM')||'월 '||TO_CHAR(TO_DATE(DT, 'YYYY-MM-DD'), 'DD')||'일' AS RSV_DT
     , TOTAL_AMT AS TOTAL_RSV_AMT
     , TOTAL_CNT AS TOTAL_RSV_CNT
     , ADTM_AMT
     , DECODE(ADTM_AMT, 0, 0, ROUND(TOTAL_AMT / ADTM_AMT * 100, 1)) AS ROAS_PER
     , DECODE(TOTAL_CNT, 0, 0, ROUND(ADTM_AMT / TOTAL_CNT)) AS CPA_AMT
  FROM T_RSVAMT
  ORDER BY RSV_DT
</select>

<!-- 일별 현황 통계 -->
<select id="BIS_S_47" resultMap="BIS_R_47">
WITH T_RSV AS (
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'AD' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.AD_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30', 'RS33') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS10') THEN T_DTLRSV.NML_AMT
             ELSE 0
         END
       ) AS CANCEL_REQ_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS11', 'RS12') THEN T_DTLRSV.NML_AMT
             ELSE 0
         END
       ) AS REFUND_REQ_AMT
     , (CASE
                       WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02',
                                                       'RS03',
                                                       'RS30',
                                                       'RS33')
                       THEN DECODE(TYPES,'USE',T_PT.POINT,0) - DECODE(TYPES,'CANCEL',T_PT.POINT,0)
                       ELSE 0
               END ) AS POINT_AMT
  FROM TB_RSV T_RSV
 INNER JOIN TB_AD_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
    LEFT JOIN TB_POINT T_PT
               ON		   T_DTLRSV.AD_RSV_NUM = T_PT.DTL_RSV_NUM
    WHERE T_RSV.REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sStartDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
 UNION
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'RC' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.RC_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30', 'RS33') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS10') THEN T_DTLRSV.NML_AMT
             ELSE 0
         END
       ) AS CANCEL_REQ_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS11', 'RS12') THEN T_DTLRSV.NML_AMT
             ELSE 0
         END
       ) AS REFUND_REQ_AMT
    , (CASE
                       WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02',
                                                       'RS03',
                                                       'RS30',
                                                       'RS33')
                       THEN DECODE(TYPES,'USE',T_PT.POINT,0) - DECODE(TYPES,'CANCEL',T_PT.POINT,0)
                       ELSE 0
               END ) AS POINT_AMT
  FROM TB_RSV T_RSV
 INNER JOIN TB_RC_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
    LEFT JOIN TB_POINT T_PT
               ON		   T_DTLRSV.RC_RSV_NUM = T_PT.DTL_RSV_NUM
    WHERE T_RSV.REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sStartDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
  UNION
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'SV' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.SV_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30', 'RS33') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS10') THEN T_DTLRSV.NML_AMT
             ELSE 0
         END
       ) AS CANCEL_REQ_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS11', 'RS12') THEN T_DTLRSV.NML_AMT
             ELSE 0
         END
       ) AS REFUND_REQ_AMT
     , (CASE
                       WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02',
                                                       'RS03',
                                                       'RS30',
                                                       'RS33')
                       THEN DECODE(TYPES,'USE',T_PT.POINT,0) - DECODE(TYPES,'CANCEL',T_PT.POINT,0)
                       ELSE 0
               END ) AS POINT_AMT
  FROM TB_RSV T_RSV
 INNER JOIN TB_SV_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
 INNER JOIN TB_SV_PRDTINF T_SPPRDT
    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
    LEFT JOIN TB_POINT T_PT
               ON		   T_DTLRSV.SV_RSV_NUM = T_PT.DTL_RSV_NUM
    WHERE T_RSV.REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sStartDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
 UNION
SELECT RSV_DT
     , CASE CTGR WHEN 'C410' THEN 'AD'
                 WHEN 'C420' THEN 'RC'
                 <!-- WHEN 'C120' THEN 'C130'
                 WHEN 'C180' THEN 'C160' -->
                 ELSE CTGR
        END AS CTGR
     , CORP_ID
     , RSV_NUM
     , RSV_STATUS_CD
     , NML_AMT
     , DIS_AMT
     , CANCEL_REQ_AMT
     , REFUND_REQ_AMT
     , POINT_AMT
  FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
             , CASE SUBSTR(T_SPPRDT.CTGR,0,2) <!-- WHEN 'C1' THEN T_SPPRDT.CTGR -->
                                              WHEN 'C4' THEN T_SPPRDT.CTGR
                                              ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                END AS CTGR
             , T_DTLRSV.CORP_ID
             , T_DTLRSV.SP_RSV_NUM AS RSV_NUM
             , T_DTLRSV.RSV_STATUS_CD
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
                     ELSE T_DTLRSV.NML_AMT
                 END
               ) AS NML_AMT
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30', 'RS33') THEN T_DTLRSV.DIS_AMT
                     ELSE 0
                 END
               ) AS DIS_AMT
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS10') THEN T_DTLRSV.NML_AMT
                     ELSE 0
                 END
               ) AS CANCEL_REQ_AMT
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS11', 'RS12') THEN T_DTLRSV.NML_AMT
                     ELSE 0
                 END
               ) AS REFUND_REQ_AMT
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02',
                                               'RS03',
                                               'RS30',
                                               'RS33')
               THEN DECODE(TYPES,'USE',T_PT.POINT,0) - DECODE(TYPES,'CANCEL',T_PT.POINT,0)
               ELSE 0
             END ) AS POINT_AMT
          FROM TB_RSV T_RSV
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         LEFT JOIN TB_POINT T_PT
               ON		   T_DTLRSV.SP_RSV_NUM = T_PT.DTL_RSV_NUM
           AND CTGR NOT IN ('C110', 'C140', 'C150')
        WHERE T_RSV.REG_DTTM BETWEEN TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sStartDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
       )
)

SELECT CTGR AS PRDT_GUBUN
     , COUNT(RSV_NUM) AS RSV_CNT
     , SUM(CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30', 'RS33') THEN 1
                ELSE 0
            END
          ) AS ACCOUNT_CNT
     , SUM(CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30', 'RS33') AND DIS_AMT > 0 THEN 1
     ELSE 0
     END
     ) AS DIS_ACCOUNT_CNT
     , SUM(NML_AMT) - SUM(DIS_AMT) AS SALE_AMT
     , SUM(POINT_AMT) AS POINT_AMT
     , SUM(DIS_AMT) AS DIS_AMT
     , SUM(CANCEL_REQ_AMT) AS CANCEL_REQ_AMT
     , SUM(REFUND_REQ_AMT) AS REFUND_REQ_AMT
  FROM T_RSV    
 GROUP BY CTGR
</select>

<!-- 일별 현황 통계 (회원 현황) -->
<select id="BIS_S_48" resultMap="BIS_R_48">
    SELECT COUNT(*) AS USER_JOIN_CNT
	 , SUM(CASE WHEN QUT_YN = 'Y'
                THEN 1
                ELSE 0
            END
          ) AS ALL_QUT_CNT
     , SUM(CASE WHEN FRST_REG_DTTM BETWEEN TO_DATE(#sStartDt#,'YYYY-MM-DD') AND TO_DATE(#sStartDt#,'YYYY-MM-DD') +1
                THEN 1
                ELSE 0
            END
          ) AS NOW_JOIN_CNT
     , SUM(CASE WHEN QUT_YN = 'Y' AND LAST_MOD_DTTM BETWEEN TO_DATE(#sStartDt#,'YYYY-MM-DD') AND TO_DATE(#sStartDt#,'YYYY-MM-DD') +1
                THEN 1
                ELSE 0
            END
          ) AS NOW_QUT_CNT
     , 0 AS MONTH1_JOIN_CNT
     , 0 AS MONTH2_JOIN_CNT
     , 0 AS MONTH3_JOIN_CNT
  FROM TB_USER
  <![CDATA[
 WHERE FRST_REG_DTTM <= TO_DATE(#sStartDt#,'YYYY-MM-DD') + 1
  ]]>
</select>

<!-- 정산 통계 (총 판매액 & 총 판매수수료액 & 총 정산대상금액) -->
<select id="BIS_S_49" resultMap="BIS_R_49">
SELECT NVL(SUM(SALE_AMT), 0) AS TOTAL_RSV_AMT
		, NVL(SUM(DIS_AMT), 0) AS TOTAL_DIS_AMT
		, NVL(SUM(CMSS_AMT), 0) AS TOTAL_CMSS_AMT
        , NVL(SUM(SALE_CMSS), 0) AS TOTAL_SALE_CMSS
        , NVL(SUM(ADJ_AMT), 0) AS TOTAL_ADJ_AMT
    FROM (
        SELECT T_CORP.CORP_NM                       /*업체명*/     
             , SUM(T_ADJ.SALE_AMT) AS SALE_AMT      /*판매 금액*/
             , SUM(T_ADJ.DIS_AMT) AS DIS_AMT        /*할인 금액*/
             , SUM(T_ADJ.CMSS_AMT) AS CMSS_AMT      /*취소 수수료*/
             , SUM(T_ADJ.SALE_CMSS) AS SALE_CMSS    /*판매 수수료*/
             , SUM(T_ADJ.ADJ_AMT) AS ADJ_AMT        /*정산 금액*/     
          FROM TB_ADJ T_ADJ
          LEFT OUTER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID = T_ADJ.CORP_ID
            <isNotEqual property="sCategory" compareValue="ALL">
              <isNotEqual property="sCategory" compareValue="CADO">
                <isNotEqual property="sCategory" compareValue="CRCO">
                  <isNotEqual property="sCategory" compareValue="CSVS">
                    <isNotEqual property="sCategory" compareValue="CSVM">
          INNER JOIN TB_SP_PRDTINF T_SPPRDT 
            ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
             		</isNotEqual>
            	  </isNotEqual>
            	</isNotEqual>
           	  </isNotEqual>
            </isNotEqual>
         WHERE T_ADJ.ADJ_ITD_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
            AND ADJ_STATUS_CD='AJ80'
            AND ADJ_AMT!='0'
            <isNotEqual property="sCategory" compareValue="ALL">
            AND CORP_MOD_CD=#sCategory#
            <!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2)              
              <isEqual property="sCategory" compareValue="SPC">
            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
              </isEqual>
              <isEqual property="sCategory" compareValue="SPF">
            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
              </isEqual>
              <isEqual property="sCategory" compareValue="SPT">
            AND CORP_SUB_CD='TOUR'
              </isEqual> -->
            </isNotEqual>
                        
            <isNotEmpty property="sCorpNm">
		      <isNotNull property="sCorpNm">
            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
              </isNotNull>
            </isNotEmpty>
         GROUP BY CORP_NM
     )
</select>

<!-- 정산 통계 리스트 -->
<select id="BIS_S_50" resultMap="BIS_R_50">
SELECT CORP_ID
		, CORP_NM
        , SALE_AMT
        , CMSS_AMT
        , DIS_AMT
        , SALE_CMSS_AMT
        , ADJ_AMT
    FROM (
        SELECT ROWNUM AS RN
        		, CORP_ID
                , CORP_NM
                , SALE_AMT
                , CMSS_AMT
                , DIS_AMT
                , SALE_CMSS_AMT
                , ADJ_AMT
            FROM (
                SELECT T_CORP.CORP_ID						/*업체 ID*/
                	 , T_CORP.CORP_NM                       /*업체명*/     
                     , SUM(T_ADJ.SALE_AMT) AS SALE_AMT      /*판매 금액*/
                     , SUM(T_ADJ.CMSS_AMT) AS CMSS_AMT      /*취소 수수료 금액*/
                     , SUM(T_ADJ.DIS_AMT) AS DIS_AMT        /*할인 금액*/
                     , SUM(T_ADJ.SALE_CMSS) AS SALE_CMSS_AMT/*판매 수수료*/
                     , SUM(T_ADJ.ADJ_AMT) AS ADJ_AMT        /*정산 금액*/     
                  FROM TB_ADJ T_ADJ
                  LEFT OUTER JOIN TB_CORP T_CORP
                    ON T_CORP.CORP_ID = T_ADJ.CORP_ID
                    <isNotEqual property="sCategory" compareValue="ALL">
		              <isNotEqual property="sCategory" compareValue="CADO">
		                <isNotEqual property="sCategory" compareValue="CRCO">
		                  <isNotEqual property="sCategory" compareValue="CSVS">
		                    <isNotEqual property="sCategory" compareValue="CSVM">
                  INNER JOIN TB_SP_PRDTINF T_SPPRDT 
                    ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
                    		</isNotEqual>
                    	  </isNotEqual>
                    	</isNotEqual>
                   	  </isNotEqual>
                   	</isNotEqual>
                 WHERE T_ADJ.ADJ_ITD_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
                    AND ADJ_STATUS_CD='AJ80'
                    AND ADJ_AMT!='0'
                    <isNotEqual property="sCategory" compareValue="ALL">
                    AND CORP_MOD_CD=#sCategory#
		            <!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2)
                      <isEqual property="sCategory" compareValue="SPC">
		            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
		              </isEqual>
		              <isEqual property="sCategory" compareValue="SPF">
		            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
		              </isEqual>
		              <isEqual property="sCategory" compareValue="SPT">
		            AND CORP_SUB_CD='TOUR'
		              </isEqual> -->
		            </isNotEqual>
		            
		    		<isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
                 GROUP BY T_CORP.CORP_ID, CORP_NM
             )
     )
     WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
     ORDER BY SALE_AMT DESC
</select>

<!-- 정산 통계 총 건수 -->
<select id="BIS_S_51" resultClass="int">
SELECT COUNT(CORP_NM) AS TOTAL_CNT
    FROM (
        SELECT T_CORP.CORP_NM                       /*업체명*/
          FROM TB_ADJ T_ADJ
          LEFT OUTER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID = T_ADJ.CORP_ID
            <isNotEqual property="sCategory" compareValue="ALL">
              <isNotEqual property="sCategory" compareValue="CADO">
                <isNotEqual property="sCategory" compareValue="CRCO">
                  <isNotEqual property="sCategory" compareValue="CSVS">
                    <isNotEqual property="sCategory" compareValue="CSVM">
          INNER JOIN TB_SP_PRDTINF T_SPPRDT 
            ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
            		</isNotEqual>
            	  </isNotEqual>
            	</isNotEqual>
           	  </isNotEqual>
           	</isNotEqual>
         WHERE T_ADJ.ADJ_ITD_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
            AND ADJ_STATUS_CD='AJ80'
            AND ADJ_AMT!='0'
            <isNotEqual property="sCategory" compareValue="ALL">
            AND CORP_MOD_CD=#sCategory#
      		<!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2)
      		  <isEqual property="sCategory" compareValue="SPC">
            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
              </isEqual>
              <isEqual property="sCategory" compareValue="SPF">
            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
              </isEqual>
      		  <isEqual property="sCategory" compareValue="SPT">
      		AND CORP_SUB_CD='TOUR'
      		  </isEqual> -->
      		</isNotEqual>
      
			<isNotEmpty property="sCorpNm">
  			  <isNotNull property="sCorpNm">
      		AND CORP_NM LIKE '%'||#sCorpNm#||'%'
        	  </isNotNull>
      		</isNotEmpty>
         GROUP BY CORP_NM
     )
</select>

<!-- 결제방법 통계 - 정산일 기준 (그래프) -->
<select id="BIS_S_52" resultMap="BIS_R_17">
WITH T_TOTAL AS (
SELECT SUM(CNT) AS TOTAL_CNT
  FROM (
    <isEqual property="sCategory" compareValue="ALL">
    SELECT COUNT(PAY_DIV) AS CNT
        FROM TB_RSV T_RSV 
            LEFT OUTER JOIN TB_AD_RSV T_DTRSV 
                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
            LEFT OUTER JOIN TB_CORP T_CORP
                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
        	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
            <isNotEmpty property="sCorpNm">
			  <isNotNull property="sCorpNm">
		    AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		      </isNotNull>
		    </isNotEmpty>
    UNION
    SELECT COUNT(PAY_DIV) AS CNT
        FROM TB_RSV T_RSV 
            LEFT OUTER JOIN TB_RC_RSV T_DTRSV 
                 ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
            LEFT OUTER JOIN TB_CORP T_CORP
                 ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
           AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
           <isNotEmpty property="sCorpNm">
		     <isNotNull property="sCorpNm">
		   AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		     </isNotNull>
		   </isNotEmpty>
    UNION
    SELECT COUNT(PAY_DIV) AS CNT
        FROM TB_RSV T_RSV 
            LEFT OUTER JOIN TB_SP_RSV T_DTRSV 
               ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM     
            LEFT OUTER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')           
           AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')     
           <isNotEmpty property="sCorpNm">
		     <isNotNull property="sCorpNm">
		   AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		     </isNotNull>
		   </isNotEmpty>       
    </isEqual>
    <isEqual property="sCategory" compareValue="CADO">
    SELECT COUNT(PAY_DIV) AS CNT
        FROM TB_RSV T_RSV 
            LEFT OUTER JOIN TB_AD_RSV T_DTRSV 
               ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
            LEFT OUTER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
           AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
           <isNotEmpty property="sCorpNm">
		     <isNotNull property="sCorpNm">
		   AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		     </isNotNull>
		   </isNotEmpty>
    </isEqual>
    <isEqual property="sCategory" compareValue="CRCO">
    SELECT COUNT(PAY_DIV) AS CNT
        FROM TB_RSV T_RSV 
           LEFT OUTER JOIN TB_RC_RSV T_DTRSV 
               ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
           LEFT OUTER JOIN TB_CORP T_CORP
               ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
            AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
        	<isNotEmpty property="sCorpNm">
		      <isNotNull property="sCorpNm">
		    AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		      </isNotNull>
		    </isNotEmpty>
    </isEqual>
    <isNotEqual property="sCategory" compareValue="ALL">
      <isNotEqual property="sCategory" compareValue="CADO">
        <isNotEqual property="sCategory" compareValue="CRCO">
    SELECT COUNT(PAY_DIV) AS CNT
        FROM TB_RSV T_RSV 
           LEFT OUTER JOIN TB_SP_RSV T_DTRSV 
              ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM     
           LEFT OUTER JOIN TB_CORP T_CORP
              ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
           INNER JOIN TB_SP_PRDTINF T_SPPRDT 
              ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
            AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')     
            AND CORP_MOD_CD=#sCategory#   	
            <!-- <isEqual property="sCategory" compareValue="SPC">
            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
            </isEqual>
            <isEqual property="sCategory" compareValue="SPF">
            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
            </isEqual>
            <isEqual property="sCategory" compareValue="SPT">
            AND CORP_SUB_CD='TOUR'
            </isEqual> -->
        	<isNotEmpty property="sCorpNm">
		      <isNotNull property="sCorpNm">
		    AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		      </isNotNull>
		    </isNotEmpty>
        </isNotEqual>
      </isNotEqual>
    </isNotEqual>
    )
)
SELECT T_BASE.PAY_DIV AS PRDT_GUBUN
    , T_BASE.PAY_DIV AS PRDT_NM
    , NVL(RSV_CNT, 0) AS RSV_CNT
    , DECODE(TOTAL_CNT, 0, 0, ROUND(NVL(RSV_CNT, 0) / TOTAL_CNT * 100, 1)) AS RSV_CNT_PER
        FROM T_TOTAL, (
            (SELECT 'L'||LEVEL||'00' AS PAY_DIV
                FROM DUAL
                  <![CDATA[
                CONNECT BY LEVEL < 5
                  ]]>
            ) T_BASE
            LEFT OUTER JOIN (
            	SELECT PAY_DIV, SUM(CNT) AS RSV_CNT
				    FROM (    
				    	<isEqual property="sCategory" compareValue="ALL">
				        SELECT PAY_DIV
				            , COUNT(PAY_DIV) AS CNT
				                FROM TB_RSV T_RSV                    
				            LEFT OUTER JOIN TB_AD_RSV T_DTRSV
				                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
				            LEFT OUTER JOIN TB_CORP T_CORP
				                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
				            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
				            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
				                <isNotEmpty property="sCorpNm">
							      <isNotNull property="sCorpNm">
					            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
					              </isNotNull>
					            </isNotEmpty>
				            GROUP BY PAY_DIV
				        UNION
				        SELECT PAY_DIV
				            , COUNT(PAY_DIV) AS CNT
				                FROM TB_RSV T_RSV                    
				            LEFT OUTER JOIN TB_RC_RSV T_DTRSV
				                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
				            LEFT OUTER JOIN TB_CORP T_CORP
				                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
				            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
				            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
				                <isNotEmpty property="sCorpNm">
							      <isNotNull property="sCorpNm">
					            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
					              </isNotNull>
					            </isNotEmpty>
				            GROUP BY PAY_DIV
				        UNION
				        SELECT PAY_DIV
				            , COUNT(PAY_DIV) AS CNT
				                FROM TB_RSV T_RSV                    
				            LEFT OUTER JOIN TB_SP_RSV T_DTRSV
				                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
				            LEFT OUTER JOIN TB_CORP T_CORP
				                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
				            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
				            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')				                
				                <isNotEmpty property="sCorpNm">
							      <isNotNull property="sCorpNm">
					            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
					              </isNotNull>
					            </isNotEmpty>
				            GROUP BY PAY_DIV
				         </isEqual>
				         <isEqual property="sCategory" compareValue="CADO">
				         SELECT PAY_DIV
				            , COUNT(PAY_DIV) AS CNT
				                FROM TB_RSV T_RSV                    
				            LEFT OUTER JOIN TB_AD_RSV T_DTRSV
				                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
				            LEFT OUTER JOIN TB_CORP T_CORP
				                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
				            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
				            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
				                <isNotEmpty property="sCorpNm">
							      <isNotNull property="sCorpNm">
					            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
					              </isNotNull>
					            </isNotEmpty>
				            GROUP BY PAY_DIV
				         </isEqual>
				         <isEqual property="sCategory" compareValue="CRCO">
				         SELECT PAY_DIV
				            , COUNT(PAY_DIV) AS CNT
				                FROM TB_RSV T_RSV                    
				            LEFT OUTER JOIN TB_RC_RSV T_DTRSV
				                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
				            LEFT OUTER JOIN TB_CORP T_CORP
				                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
				            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
				            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
				                <isNotEmpty property="sCorpNm">
							      <isNotNull property="sCorpNm">
					            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
					              </isNotNull>
					            </isNotEmpty>
				            GROUP BY PAY_DIV
				         </isEqual>
				         <isNotEqual property="sCategory" compareValue="ALL">
				           <isNotEqual property="sCategory" compareValue="CADO">
			                 <isNotEqual property="sCategory" compareValue="CRCO">
				         SELECT PAY_DIV
				            , COUNT(PAY_DIV) AS CNT
				                FROM TB_RSV T_RSV                    
				            LEFT OUTER JOIN TB_SP_RSV T_DTRSV
				                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
				            LEFT OUTER JOIN TB_CORP T_CORP
				                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
				            INNER JOIN TB_SP_PRDTINF T_SPPRDT 
				            	ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
				            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
				            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
				            	AND CORP_MOD_CD=#sCategory#
				                <!-- <isEqual property="sCategory" compareValue="SPC">
					            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
					            </isEqual>
					            <isEqual property="sCategory" compareValue="SPF">
					            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
					            </isEqual>
				                <isEqual property="sCategory" compareValue="SPT">
				                AND CORP_SUB_CD='TOUR'
				                </isEqual> -->
				                <isNotEmpty property="sCorpNm">
							      <isNotNull property="sCorpNm">
					            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
					              </isNotNull>
					            </isNotEmpty>
				            GROUP BY PAY_DIV
				             </isNotEqual>
				           </isNotEqual>
				         </isNotEqual>
				       )
				       GROUP BY PAY_DIV				       
            ) T_CNT ON T_CNT.PAY_DIV=T_BASE.PAY_DIV
       )
</select>

<!-- 회원/비회원 결제비율 통계 - 정산일 기준 (그래프) -->
<select id="BIS_S_53" resultMap="BIS_R_21">
SELECT MEM_CNT AS RSV_CNT
        , DECODE(TOTAL_CNT, 0, 0, ROUND(NVL(MEM_CNT, 0)/TOTAL_CNT * 100, 1)) AS RSV_CNT_PER
        , (TOTAL_CNT - MEM_CNT) AS OTHER_RSV_CNT
        , DECODE(TOTAL_CNT, 0, 0, ROUND((TOTAL_CNT - MEM_CNT)/TOTAL_CNT * 100, 1)) AS OTHER_RSV_PER
        FROM
    (SELECT SUM(CNT) AS MEM_CNT
	    FROM (    
	    	<isEqual property="sCategory" compareValue="ALL">
	        SELECT USER_ID
	            , SUM(DECODE(USER_ID, 'GUEST', 0, 1)) AS CNT
	                FROM TB_RSV T_RSV                    
	            LEFT OUTER JOIN TB_AD_RSV T_DTRSV
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	                <isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
	            GROUP BY USER_ID
	        UNION
	        SELECT USER_ID
	            , SUM(DECODE(USER_ID, 'GUEST', 0, 1)) AS CNT
	                FROM TB_RSV T_RSV                    
	            LEFT OUTER JOIN TB_RC_RSV T_DTRSV
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	                <isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
	            GROUP BY USER_ID
	        UNION
	        SELECT USER_ID
	            , SUM(DECODE(USER_ID, 'GUEST', 0, 1)) AS CNT
	                FROM TB_RSV T_RSV                    
	            LEFT OUTER JOIN TB_SP_RSV T_DTRSV
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')				                
	                <isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
	            GROUP BY USER_ID
	         </isEqual>
	         <isEqual property="sCategory" compareValue="CADO">
	         SELECT USER_ID
	            , SUM(DECODE(USER_ID, 'GUEST', 0, 1)) AS CNT
	                FROM TB_RSV T_RSV                    
	            LEFT OUTER JOIN TB_AD_RSV T_DTRSV
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	                <isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
	            GROUP BY USER_ID
	         </isEqual>
	         <isEqual property="sCategory" compareValue="CRCO">
	         SELECT USER_ID
	            , SUM(DECODE(USER_ID, 'GUEST', 0, 1)) AS CNT
	                FROM TB_RSV T_RSV                    
	            LEFT OUTER JOIN TB_RC_RSV T_DTRSV
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	                <isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
	            GROUP BY USER_ID
	         </isEqual>
	         <isNotEqual property="sCategory" compareValue="ALL">
	           <isNotEqual property="sCategory" compareValue="CADO">
                <isNotEqual property="sCategory" compareValue="CRCO">
	         SELECT USER_ID
	            , SUM(DECODE(USER_ID, 'GUEST', 0, 1)) AS CNT
	                FROM TB_RSV T_RSV                    
	            LEFT OUTER JOIN TB_SP_RSV T_DTRSV
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	            INNER JOIN TB_SP_PRDTINF T_SPPRDT 
	            	ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
	            WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	            	AND CORP_MOD_CD=#sCategory#
	                <!-- <isEqual property="sCategory" compareValue="SPC">
		            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
		            </isEqual>
		            <isEqual property="sCategory" compareValue="SPF">
		            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
		            </isEqual>
	                <isEqual property="sCategory" compareValue="SPT">
	                AND CORP_SUB_CD='TOUR'
	                </isEqual> -->
	                <isNotEmpty property="sCorpNm">
				      <isNotNull property="sCorpNm">
		            AND CORP_NM LIKE '%'||#sCorpNm#||'%'
		              </isNotNull>
		            </isNotEmpty>
	            GROUP BY USER_ID
	             </isNotEqual>
	           </isNotEqual>
	         </isNotEqual>
	       )	       
    ),
    (SELECT SUM(CNT) AS TOTAL_CNT
	  FROM (
	    <isEqual property="sCategory" compareValue="ALL">
	    SELECT COUNT(USER_ID) AS CNT
	        FROM TB_RSV T_RSV 
	            LEFT OUTER JOIN TB_AD_RSV T_DTRSV 
	                ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	        	AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	            <isNotEmpty property="sCorpNm">
				  <isNotNull property="sCorpNm">
			    AND CORP_NM LIKE '%'||#sCorpNm#||'%'
			      </isNotNull>
			    </isNotEmpty>
	    UNION
	    SELECT COUNT(USER_ID) AS CNT
	        FROM TB_RSV T_RSV 
	            LEFT OUTER JOIN TB_RC_RSV T_DTRSV 
	                 ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	                 ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	           AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	           <isNotEmpty property="sCorpNm">
			     <isNotNull property="sCorpNm">
			   AND CORP_NM LIKE '%'||#sCorpNm#||'%'
			     </isNotNull>
			   </isNotEmpty>
	    UNION
	    SELECT COUNT(USER_ID) AS CNT
	        FROM TB_RSV T_RSV 
	            LEFT OUTER JOIN TB_SP_RSV T_DTRSV 
	               ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM     
	            LEFT OUTER JOIN TB_CORP T_CORP
	               ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')           
	           AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')     
	           <isNotEmpty property="sCorpNm">
			     <isNotNull property="sCorpNm">
			   AND CORP_NM LIKE '%'||#sCorpNm#||'%'
			     </isNotNull>
			   </isNotEmpty>       
	    </isEqual>
	    <isEqual property="sCategory" compareValue="CADO">
	    SELECT COUNT(USER_ID) AS CNT
	        FROM TB_RSV T_RSV 
	            LEFT OUTER JOIN TB_AD_RSV T_DTRSV 
	               ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	            LEFT OUTER JOIN TB_CORP T_CORP
	               ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	           AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	           <isNotEmpty property="sCorpNm">
			     <isNotNull property="sCorpNm">
			   AND CORP_NM LIKE '%'||#sCorpNm#||'%'
			     </isNotNull>
			   </isNotEmpty>
	    </isEqual>
	    <isEqual property="sCategory" compareValue="CRCO">
	    SELECT COUNT(USER_ID) AS CNT
	        FROM TB_RSV T_RSV 
	           LEFT OUTER JOIN TB_RC_RSV T_DTRSV 
	               ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM
	           LEFT OUTER JOIN TB_CORP T_CORP
	               ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	        	<isNotEmpty property="sCorpNm">
			      <isNotNull property="sCorpNm">
			    AND CORP_NM LIKE '%'||#sCorpNm#||'%'
			      </isNotNull>
			    </isNotEmpty>
	    </isEqual>
	    <isNotEqual property="sCategory" compareValue="ALL">
	      <isNotEqual property="sCategory" compareValue="CADO">
	        <isNotEqual property="sCategory" compareValue="CRCO">
	    SELECT COUNT(USER_ID) AS CNT
	        FROM TB_RSV T_RSV 
	           LEFT OUTER JOIN TB_SP_RSV T_DTRSV 
	              ON T_DTRSV.RSV_NUM=T_RSV.RSV_NUM     
	           LEFT OUTER JOIN TB_CORP T_CORP
	              ON T_CORP.CORP_ID=T_DTRSV.CORP_ID
	           INNER JOIN TB_SP_PRDTINF T_SPPRDT 
	           	  ON T_SPPRDT.CORP_ID = T_CORP.CORP_ID
	        WHERE ADJ_DT BETWEEN REPLACE(#sStartDt#, '-') AND REPLACE(#sEndDt#, '-')
	            AND T_DTRSV.RSV_STATUS_CD NOT IN ('RS20', 'RS32')
	            AND CORP_MOD_CD=#sCategory#
	            <!-- <isEqual property="sCategory" compareValue="SPC">
	            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
	            </isEqual>
	            <isEqual property="sCategory" compareValue="SPF">
	            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
	            </isEqual>
	            <isEqual property="sCategory" compareValue="SPT">
	            AND CORP_SUB_CD='TOUR'
	            </isEqual> -->
	        	<isNotEmpty property="sCorpNm">
			      <isNotNull property="sCorpNm">
			    AND CORP_NM LIKE '%'||#sCorpNm#||'%'
			      </isNotNull>
			    </isNotEmpty>
	        </isNotEqual>
	      </isNotEqual>
	    </isNotEqual>
	    )
	)
</select>

<!-- 입점업체 검색 -->
<select id="BIS_S_54" resultMap="BIS_R_54">
SELECT CORP_NM
	FROM (
		SELECT ROWNUM AS RN
				, CORP_NM 
			FROM TB_CORP
		    WHERE CORP_NM LIKE '%'||#sCorpNm#||'%'
		        AND CORP_CD=SUBSTR(#sCategory#, 0, 2)		        
		        <isEqual property="sCategory" compareValue="SPC">
	            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
	            </isEqual>
	            <isEqual property="sCategory" compareValue="SPF">
	            AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
	            </isEqual>
		        <isEqual property="sCategory" compareValue="SPT">
		        AND CORP_SUB_CD='TOUR'
		        </isEqual>
	)
	WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
</select>

<!-- 입점업체 검색 총 건수 -->
<select id="BIS_S_55" resultClass="int">
SELECT COUNT(CORP_NM) AS TOTAL_CNT 
	FROM TB_CORP
    WHERE CORP_NM LIKE '%'||#sCorpNm#||'%'
        AND CORP_CD=SUBSTR(#sCategory#, 0, 2)        
        <isEqual property="sCategory" compareValue="SPC">
        AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
        </isEqual>
        <isEqual property="sCategory" compareValue="SPF">
        AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
        </isEqual>
        <isEqual property="sCategory" compareValue="SPT">
        AND CORP_SUB_CD='TOUR'
        </isEqual>
</select>

<!-- 렌터카 유형에 따른 예약 차량 건수 통계 (그래프) -->
<select id="BIS_S_56" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
	           AND CAR_DIV=#sType#
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT CAR_CD AS PRDT_GUBUN
        , (SELECT CD_NM FROM TB_CD WHERE CD_NUM=CAR_CD) AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER
      FROM T_TOTAL_CNT,
        (SELECT CAR_CD
                , NVL(RSV_CNT, 0) AS RSV_CNT                
              FROM (
                SELECT CAR_CD, COUNT(SALE_AMT) AS RSV_CNT FROM
                (
                    SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                         , T_DTLRSV.SALE_AMT
                         , CAR_CD
                      FROM TB_RSV T_RSV
                     INNER JOIN TB_RC_RSV T_DTLRSV ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                     LEFT OUTER JOIN TB_RC_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                     LEFT OUTER JOIN TB_RC_DFTINF T_DFT ON T_DFT.CORP_ID=T_PRDT.CORP_ID                     
                     WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')                      
			           AND CAR_DIV=#sType#
                )
                WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
                GROUP BY CAR_CD
            )    
      ) T_CNT          
</select>

<!-- 업체별 정산 리스트 -->
<select id="BIS_S_57" resultMap="BIS_R_57">
SELECT TO_CHAR(TO_DATE(ADJ_ITD_DT, 'YYYYMMDD'), 'YYYY-MM-DD') AS ADJ_ITD_DT
        , SALE_AMT
        , CMSS_AMT
        , SALE_CMSS
        , ADJ_AMT
        , DIS_AMT
        , LAST_ADJ_AMT
        FROM TB_ADJ
        WHERE CORP_ID=#sCorpId#
          AND ADJ_ITD_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
          AND ADJ_STATUS_CD='AJ80'
        ORDER BY ADJ_ITD_DT
</select>

<!-- 기념품 유형 통계(그래프) -->
<select id="BIS_S_58" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SV_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
	         INNER JOIN TB_SV_PRDTINF T_SPPRDT
	            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
	         INNER JOIN TB_CORP T_CORP
	            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SV'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
)
SELECT VIEW_SN AS PRDT_GUBUN
        , CD_NM AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT BASE.CD_NUM
            , CD_NM
            , VIEW_SN
            , NVL(RSV_CNT, 0) AS RSV_CNT            
          FROM (
            SELECT CD_NUM, CD_NM, VIEW_SN FROM TB_CD WHERE HRK_CD_NUM='SVDV' AND USE_YN='Y'
        ) BASE
        LEFT OUTER JOIN (
            SELECT CTGR, COUNT(SALE_AMT) AS RSV_CNT FROM
            (
                SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                     , T_DTLRSV.SALE_AMT
                     , CTGR
                  FROM TB_RSV T_RSV
                 INNER JOIN TB_SV_RSV T_DTLRSV
                    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
                 LEFT OUTER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
                 INNER JOIN TB_CORP T_CORP
               		ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='SV'
                 WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                    <isNotEmpty property="sType">
			    	 <isNotNull property="sType">
	           	   AND CTGR=#sType#
	            	 </isNotNull>
	          	   </isNotEmpty>
	          	   <isNotEmpty property="sCorpNm">
			    	 <isNotNull property="sCorpNm">
	           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
	            	 </isNotNull>
	          	   </isNotEmpty>
            )
            WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#  
            GROUP BY CTGR
        ) RSV ON RSV.CTGR=BASE.CD_NUM    
    )  
    ORDER BY CD_NUM, VIEW_SN
</select>

<!-- 기념품 구매 개수(그래프) -->
<select id="BIS_S_59" resultMap="BIS_R_17">
WITH T_TOTAL_CNT AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
              FROM TB_RSV T_RSV
             INNER JOIN TB_SV_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             INNER JOIN TB_SV_PRDTINF T_SPPRDT
	            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
	         INNER JOIN TB_CORP T_CORP
	            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SV'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt# 
),
T_BUY_NUM AS (
    SELECT BUY_NUM, COUNT(SALE_AMT) AS RSV_CNT FROM
        (
            SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
                 , T_DTLRSV.SALE_AMT
                 , BUY_NUM
              FROM TB_RSV T_RSV
             INNER JOIN TB_SV_RSV T_DTLRSV
                ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
             LEFT OUTER JOIN TB_SV_PRDTINF T_PRDT ON T_PRDT.PRDT_NUM=T_DTLRSV.PRDT_NUM
             INNER JOIN TB_CORP T_CORP
               		ON T_CORP.CORP_ID=T_PRDT.CORP_ID AND CORP_CD='SV'
             WHERE T_RSV.RSV_STATUS_CD NOT IN ('RS99', 'RS00', 'RS01')
                <isNotEmpty property="sType">
		    	 <isNotNull property="sType">
           	   AND CTGR=#sType#
            	 </isNotNull>
          	   </isNotEmpty>
          	   <isNotEmpty property="sCorpNm">
		    	 <isNotNull property="sCorpNm">
           	   AND CORP_NM LIKE '%' || #sCorpNm# || '%'
            	 </isNotNull>
          	   </isNotEmpty>
        )
        WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#   
        GROUP BY BUY_NUM
)
SELECT BUY_NUM AS PRDT_GUBUN
        , BUY_NUM || '개' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT '' || BASE.BUY_NUM AS BUY_NUM
            , NVL(RSV_CNT, 0) AS RSV_CNT            
          FROM (
            SELECT LEVEL AS BUY_NUM FROM DUAL
            	  <![CDATA[ 
                CONNECT BY LEVEL < 6
                  ]]>
          ) BASE
          LEFT OUTER JOIN (
            SELECT BUY_NUM
                , RSV_CNT
              FROM T_BUY_NUM
                <![CDATA[ 
              WHERE BUY_NUM < 6
                ]]>
          ) RSV ON RSV.BUY_NUM=BASE.BUY_NUM
     )
 UNION
SELECT BUY_NUM AS PRDT_GUBUN
        , '6개 이상' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL_CNT,
    (SELECT '6OVER' AS BUY_NUM
            , NVL(SUM(RSV_CNT), 0) AS RSV_CNT            
          FROM T_BUY_NUM
            <![CDATA[ 
          WHERE BUY_NUM >=6
            ]]>
    )
</select>

<!-- 기념품 예약 취소 주기 통계(예약일 기준 - 그래프) -->
<select id="BIS_S_60" resultMap="BIS_R_17">
WITH T_TOTAL AS (
    SELECT COUNT(SALE_AMT) AS CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , T_DTLRSV.SALE_AMT        
          FROM TB_RSV T_RSV
         INNER JOIN TB_SV_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SV_PRDTINF T_SPPRDT
	        ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SV'
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            <isNotEmpty property="sType">
    	 	  <isNotNull property="sType">
         	AND CTGR=#sType#
          	   </isNotNull>
        	</isNotEmpty>
        	<isNotEmpty property="sCorpNm">
    	 	  <isNotNull property="sCorpNm">
         	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
          	  </isNotNull>
        	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
),
T_CANCEL AS (
    SELECT DIFF_DAY, COUNT(DIFF_DAY) AS RSV_CNT FROM
    (
        SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD') AS RSV_DT                     
             , TO_DATE(TO_CHAR(CANCEL_CMPL_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') - TO_DATE(TO_CHAR(T_RSV.REG_DTTM, 'YYYY-MM-DD'), 'YYYY-MM-DD') AS DIFF_DAY                
          FROM TB_RSV T_RSV
         INNER JOIN TB_SV_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SV_PRDTINF T_SPPRDT
	        ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID=T_SPPRDT.CORP_ID AND CORP_CD='SV'
         WHERE T_DTLRSV.RSV_STATUS_CD IN ('RS20', 'RS32')
            <isNotEmpty property="sType">
    	 	  <isNotNull property="sType">
         	AND CTGR=#sType#
          	   </isNotNull>
        	</isNotEmpty>
        	<isNotEmpty property="sCorpNm">
    	 	  <isNotNull property="sCorpNm">
         	AND CORP_NM LIKE '%' || #sCorpNm# || '%'
          	  </isNotNull>
        	</isNotEmpty>
    )
    WHERE RSV_DT BETWEEN #sStartDt# AND #sEndDt#
    GROUP BY DIFF_DAY
)
SELECT STD AS PRDT_GUBUN
        , '당일' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '00AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
            FROM T_CANCEL WHERE DIFF_DAY='0'
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '1일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '01AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[       
            FROM T_CANCEL WHERE DIFF_DAY>='1' AND DIFF_DAY<'3'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '3일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '03AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT        
        	  <![CDATA[ 
            FROM T_CANCEL WHERE DIFF_DAY>='3' AND DIFF_DAY<'7'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '일주일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '07AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT    
        	  <![CDATA[     
            FROM T_CANCEL WHERE DIFF_DAY>='7' AND DIFF_DAY<'15'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '15일 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '15AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT  
        	  <![CDATA[       
            FROM T_CANCEL WHERE DIFF_DAY>='15' AND DIFF_DAY<'30'
              ]]>
    )
 UNION
SELECT STD AS PRDT_GUBUN
        , '한달 후' AS PRDT_NM
        , RSV_CNT
        , DECODE(CNT, 0, 0, ROUND(RSV_CNT/CNT * 100, 1)) AS RSV_CNT_PER 
      FROM T_TOTAL,
    (SELECT '30AFTER' AS STD
        , NVL(SUM(RSV_CNT), 0) AS RSV_CNT   
        	  <![CDATA[      
            FROM T_CANCEL WHERE DIFF_DAY>='30'
              ]]>
    )
</select>

<!-- 정산 통계 Excel 리스트 -->
<select id="BIS_S_61" resultMap="BIS_R_50">
SELECT CORP_ID
        , CORP_NM
        , SALE_AMT
        , CMSS_AMT
        , DIS_AMT
        , SALE_CMSS_AMT
        , ADJ_AMT
    FROM (
        SELECT T_CORP.CORP_ID						/*업체 ID*/
        	 , T_CORP.CORP_NM                       /*업체명*/     
             , SUM(T_ADJ.SALE_AMT) AS SALE_AMT      /*판매 금액*/
             , SUM(T_ADJ.CMSS_AMT) AS CMSS_AMT      /*취소 수수료 금액*/
             , SUM(T_ADJ.DIS_AMT) AS DIS_AMT        /*할인 금액*/
             , SUM(T_ADJ.SALE_CMSS) AS SALE_CMSS_AMT/*판매 수수료*/
             , SUM(T_ADJ.ADJ_AMT) AS ADJ_AMT        /*정산 금액*/     
          FROM TB_ADJ T_ADJ
          LEFT OUTER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID = T_ADJ.CORP_ID
         WHERE T_ADJ.ADJ_ITD_DT BETWEEN REPLACE(#sStartDt#, '-', '') AND REPLACE(#sEndDt#, '-', '')
            AND ADJ_STATUS_CD='AJ80'
            AND ADJ_AMT!='0'
      <isNotEqual property="sCategory" compareValue="ALL">
      AND CORP_MOD_CD=#sCategory#    
      <!-- AND CORP_CD=SUBSTR(#sCategory#, 0, 2)              
        <isEqual property="sCategory" compareValue="SPC">
      AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C2'
        </isEqual>
        <isEqual property="sCategory" compareValue="SPF">
      AND CORP_SUB_CD!='TOUR' AND SUBSTR(CTGR, 0, 2)='C3'
        </isEqual>
        <isEqual property="sCategory" compareValue="SPT">
      AND CORP_SUB_CD='TOUR'
        </isEqual> -->
      </isNotEqual>
      
	  <isNotEmpty property="sCorpNm">
  		<isNotNull property="sCorpNm">
      AND CORP_NM LIKE '%'||#sCorpNm#||'%'
        </isNotNull>
      </isNotEmpty>
         GROUP BY T_CORP.CORP_ID, CORP_NM
     )
     ORDER BY SALE_AMT DESC
</select>

<!-- 입점업체 현황 -->
<select id="BIS_S_62" resultMap="BIS_R_62">
SELECT '전체' AS CORP_DIV_NM
     , T_CORP.CORP_DIV
     , NVL(TOTAL_CORP_CNT, 0) AS TOTAL_CORP_CNT
     , NVL(CONF_CORP_CNT, 0)  AS CONF_CORP_CNT
     , NVL(MEM_CORP_CNT, 0)   AS MEM_CORP_CNT
     , NVL(TOTAL_PRDT_CNT, 0)   AS TOTAL_PRDT_CNT
     , NVL(PRDT_CNT01, 0)   AS PRDT_CNT01
     , NVL(PRDT_CNT02, 0)   AS PRDT_CNT02
     , NVL(PRDT_CNT03, 0)   AS PRDT_CNT03
     , NVL(PRDT_CNT04, 0)   AS PRDT_CNT04
     , NVL(PRDT_CNT05, 0)   AS PRDT_CNT05
     , NVL(PRDT_CNT06, 0)   AS PRDT_CNT06
     , NVL(PRDT_CNT07, 0)   AS PRDT_CNT07
  FROM (SELECT 'ALL'  AS CORP_DIV
             , NVL(SUM(TOTAL_CORP_CNT), 0) AS TOTAL_CORP_CNT
             , NVL(SUM(CONF_CORP_CNT), 0)  AS CONF_CORP_CNT
             , NVL(SUM(MEM_CORP_CNT), 0)   AS MEM_CORP_CNT
          FROM TB_CORP_ANLS
         WHERE APL_DT = REPLACE(#sStartDt#, '-', '')
       ) T_CORP
 INNER JOIN (SELECT 'ALL'  AS CORP_DIV
                  , SUM(TOTAL_PRDT_CNT) AS TOTAL_PRDT_CNT
                  , SUM(PRDT_CNT01) AS PRDT_CNT01
                  , SUM(PRDT_CNT02) AS PRDT_CNT02
                  , SUM(PRDT_CNT03) AS PRDT_CNT03
                  , SUM(PRDT_CNT04) AS PRDT_CNT04
                  , SUM(PRDT_CNT05) AS PRDT_CNT05
                  , SUM(PRDT_CNT06) AS PRDT_CNT06
                  , SUM(PRDT_CNT07) AS PRDT_CNT07
               FROM TB_PRDT_ANLS
              WHERE APL_DT = REPLACE(#sStartDt#, '-', '')
            ) T_PRDT
    ON T_PRDT.CORP_DIV = T_CORP.CORP_DIV
 UNION ALL
SELECT CASE T_CORP.CORP_DIV WHEN 'FOOD' THEN '맛집'
                            WHEN 'TICK' THEN '관광지/레저'
                            WHEN 'TOUR' THEN '여행사 상품'
                            ELSE (SELECT CD_NM FROM TB_CD
                                WHERE CD_NUM=T_CORP.CORP_DIV )
        END AS CORP_DIV_NM
     , T_CORP.CORP_DIV
     , T_CORP.TOTAL_CORP_CNT
     , T_CORP.CONF_CORP_CNT
     , T_CORP.MEM_CORP_CNT
     , T_PRDT.TOTAL_PRDT_CNT
     , T_PRDT.PRDT_CNT01
     , T_PRDT.PRDT_CNT02
     , T_PRDT.PRDT_CNT03
     , T_PRDT.PRDT_CNT04
     , T_PRDT.PRDT_CNT05
     , T_PRDT.PRDT_CNT06
     , T_PRDT.PRDT_CNT07
  FROM TB_CORP_ANLS T_CORP
 INNER JOIN (SELECT CORP_DIV
                  , SUM(TOTAL_PRDT_CNT) AS TOTAL_PRDT_CNT
                  , SUM(PRDT_CNT01) AS PRDT_CNT01
                  , SUM(PRDT_CNT02) AS PRDT_CNT02
                  , SUM(PRDT_CNT03) AS PRDT_CNT03
                  , SUM(PRDT_CNT04) AS PRDT_CNT04
                  , SUM(PRDT_CNT05) AS PRDT_CNT05
                  , SUM(PRDT_CNT06) AS PRDT_CNT06
                  , SUM(PRDT_CNT07) AS PRDT_CNT07
               FROM TB_PRDT_ANLS
              WHERE APL_DT = REPLACE(#sStartDt#, '-', '')
              GROUP BY CORP_DIV
            ) T_PRDT
    ON T_PRDT.CORP_DIV = T_CORP.CORP_DIV
 WHERE APL_DT = REPLACE(#sStartDt#, '-', '')
</select>

<select id="BIS_S_63" resultMap="BIS_R_63">
SELECT CORP_DIV
     , PRDT_DIV
     , TOTAL_PRDT_CNT
     , PRDT_DIV_NM
     , PRDT_CNT01
     , PRDT_CNT02
     , PRDT_CNT03
     , PRDT_CNT04
     , PRDT_CNT05
     , PRDT_CNT06
     , PRDT_CNT07 
  FROM TB_PRDT_ANLS
 WHERE APL_DT = REPLACE(#sStartDt#, '-', '')
   AND CORP_DIV = #sGubun#
</select>

<select id="BIS_S_64" resultMap="BIS_R_64">
SELECT SUM(CASE WHEN SUBSTR(ANLS_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')
                THEN VISITOR_NUM
                ELSE 0
            END
          ) AS YEAR_VISITOR_CNT     
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD')
                THEN VISITOR_NUM
                ELSE 0
            END
          ) AS MONTH1_VISITOR_CNT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD')
                THEN VISITOR_NUM
                ELSE 0
            END
          ) AS MONTH2_VISITOR_CNT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD')
                THEN VISITOR_NUM
                ELSE 0
            END
          ) AS MONTH3_VISITOR_CNT 
     
  FROM TB_DAYDAY_ANLS
  <![CDATA[
 WHERE ANLS_DT <= REPLACE(#sStartDt#, '-', '')
  ]]>
</select>

<select id="BIS_S_65" resultClass="int">
SELECT NVL(SUM(NVL(ADTM_AMT, 0) + NVL(ADTM_AMT_ADD1, 0)), 0) AS ADTM_AMT 
	FROM TB_ADTM_AMT 
	WHERE APL_DT = REPLACE(#sStartDt#, '-', '')
</select>

<select id="BIS_S_66" resultMap="BIS_R_66">
SELECT SUM(AV_JL_CNT) AS TOTAL_AV_JL_CNT
     , SUM(AV_JL_SALEAMT) AS TOTAL_AV_JL_SALEAMT
     , SUM(CASE WHEN SUBSTR(ANLS_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')
                THEN AV_JL_CNT
                ELSE 0
            END
          ) AS YEAR_AV_JL_CNT 
     , SUM(CASE WHEN SUBSTR(ANLS_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')
                THEN AV_JL_SALEAMT
                ELSE 0
            END
          ) AS YEAR_AV_JL_SALEAMT 
     , SUM(CASE WHEN ANLS_DT = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')-1 || TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'MMDD')
                THEN AV_JL_CNT
                ELSE 0
            END
          ) AS PREV_JL_CNT
     , SUM(CASE WHEN ANLS_DT = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')-1 || TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'MMDD')
                THEN AV_JL_SALEAMT
                ELSE 0
            END
          ) AS PREV_JL_SALEAMT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD')
                THEN AV_JL_CNT
                ELSE 0
            END
          ) AS MONTH1_AV_JL_CNT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD')
                THEN AV_JL_SALEAMT
                ELSE 0
            END
          ) AS MONTH1_AV_JL_SALEAMT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD')
                THEN AV_JL_CNT
                ELSE 0
            END
          ) AS MONTH2_AV_JL_CNT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD')
                THEN AV_JL_SALEAMT
                ELSE 0
            END
          ) AS MONTH2_AV_JL_SALEAMT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD')
                THEN AV_JL_CNT
                ELSE 0
            END
          ) AS MONTH3_AV_JL_CNT 
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD')
                THEN AV_JL_SALEAMT
                ELSE 0
            END
          ) AS MONTH3_AV_JL_SALEAMT
     , SUM(AV_JC_CNT) AS TOTAL_AV_JC_CNT
     , SUM(AV_JC_SALEAMT) AS TOTAL_AV_JC_SALEAMT
     , SUM(CASE WHEN SUBSTR(ANLS_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')
                THEN AV_JC_CNT
                ELSE 0
            END
          ) AS YEAR_AV_JC_CNT 
     , SUM(CASE WHEN SUBSTR(ANLS_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')
                THEN AV_JC_SALEAMT
                ELSE 0
            END
          ) AS YEAR_AV_JC_SALEAMT 
     , SUM(CASE WHEN ANLS_DT = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')-1 || TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'MMDD')
                THEN AV_JC_CNT
                ELSE 0
            END
          ) AS PREV_JC_CNT
     , SUM(CASE WHEN ANLS_DT = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')-1 || TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'MMDD')
                THEN AV_JC_SALEAMT
                ELSE 0
            END
          ) AS PREV_JC_SALEAMT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD')
                THEN AV_JC_CNT
                ELSE 0
            END
          ) AS MONTH1_AV_JC_CNT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD')
                THEN AV_JC_SALEAMT
                ELSE 0
            END
          ) AS MONTH1_AV_JC_SALEAMT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD')
                THEN AV_JC_CNT
                ELSE 0
            END
          ) AS MONTH2_AV_JC_CNT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD')
                THEN AV_JC_SALEAMT
                ELSE 0
            END
          ) AS MONTH2_AV_JC_SALEAMT
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD')
                THEN AV_JC_CNT
                ELSE 0
            END
          ) AS MONTH3_AV_JC_CNT 
     , SUM(CASE WHEN ANLS_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
        AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD')
                THEN AV_JC_SALEAMT
                ELSE 0
            END
          ) AS MONTH3_AV_JC_SALEAMT
     
  FROM TB_DAYDAY_ANLS
  <![CDATA[
 WHERE ANLS_DT <= REPLACE(#sStartDt#, '-', '')
  ]]>
</select>

<select id="BIS_S_67" resultMap="BIS_R_67">
WITH T_RSV AS (
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'AD' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.AD_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02', 'RS30') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT     
     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
  FROM TB_RSV T_RSV
 INNER JOIN TB_AD_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
 UNION
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'RC' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.RC_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02', 'RS30') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT     
     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
  FROM TB_RSV T_RSV
 INNER JOIN TB_RC_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
  UNION
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'SV' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.SV_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02', 'RS30') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT     
     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
  FROM TB_RSV T_RSV
 INNER JOIN TB_SV_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
 INNER JOIN TB_SV_PRDTINF T_SPPRDT
    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
 UNION
SELECT RSV_DT
     , CASE CTGR WHEN 'C410' THEN 'AD'
                 WHEN 'C420' THEN 'RC'
                 
                 ELSE CTGR
        END AS CTGR
     , CORP_ID
     , RSV_NUM
     , RSV_STATUS_CD
     , NML_AMT
     , DIS_AMT     
     , CANCEL_DT
  FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
             , CASE SUBSTR(T_SPPRDT.CTGR,0,2) 
             								  WHEN 'C1' THEN T_SPPRDT.CTGR
                                              WHEN 'C4' THEN T_SPPRDT.CTGR
                                              ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                END AS CTGR
             , T_DTLRSV.CORP_ID
             , T_DTLRSV.SP_RSV_NUM AS RSV_NUM
             , T_DTLRSV.RSV_STATUS_CD
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
                     ELSE T_DTLRSV.NML_AMT
                 END
               ) AS NML_AMT
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02', 'RS30') THEN T_DTLRSV.DIS_AMT
                     ELSE 0
                 END
               ) AS DIS_AMT       
             , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
          FROM TB_RSV T_RSV    
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
           AND CTGR NOT IN ('C110', 'C140', 'C150')
       )
)

SELECT CTGR AS PRDT_GUBUN     
     , SUM(
        CASE RSV_DT WHEN REPLACE(#sStartDt#, '-', '') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
                ELSE 0
            END
          ELSE 0
        END
          ) AS RSV_CNT
     , SUM(
        CASE RSV_DT WHEN REPLACE(#sStartDt#, '-', '') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS SALE_AMT
     , SUM(
        CASE RSV_DT WHEN TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')-1 || TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'MMDD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
                WHEN RSV_STATUS_CD='RS20' THEN 
                    CASE WHEN RSV_DT!=CANCEL_DT THEN 1                        
                        ELSE 0
                    END
                ELSE 0
            END
          ELSE 0
        END
          ) AS PREV_RSV_CNT
     , SUM(
        CASE RSV_DT WHEN TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY')-1 || TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'MMDD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                WHEN RSV_STATUS_CD='RS20' THEN 
                    CASE WHEN RSV_DT!=CANCEL_DT THEN NML_AMT - DIS_AMT
                        ELSE 0
                    END
                ELSE 0
            END
          ELSE 0
        END
          ) AS PREV_SALE_AMT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
                ELSE 0
            END
          ELSE 0
        END
          ) AS MONTH3_RSV_CNT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -3)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS MONTH3_SALE_AMT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
                ELSE 0
            END
          ELSE 0
        END
          ) AS MONTH2_RSV_CNT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -2)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS MONTH2_SALE_AMT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
                ELSE 0
            END
          ELSE 0
        END
          ) AS MONTH1_RSV_CNT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -1)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS MONTH1_SALE_AMT
     , SUM(
        CASE WHEN SUBSTR(RSV_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
                ELSE 0
            END
          ELSE 0
        END
          ) AS YEAR_RSV_CNT
     , SUM(
        CASE WHEN SUBSTR(RSV_DT, 0, 4) = TO_CHAR(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), 'YYYY') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS YEAR_SALE_AMT
     , SUM(        
        CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN 1
            ELSE 0
        END
          ) AS TOTAL_RSV_CNT
     , SUM(        
        CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
            ELSE 0
        END
          ) AS TOTAL_SALE_AMT
  FROM T_RSV    
 GROUP BY CTGR
</select>

<select id="BIS_S_68" resultMap="BIS_R_68">
WITH T_RSV AS (
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'AD' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.AD_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT     
     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
  FROM TB_RSV T_RSV
 INNER JOIN TB_AD_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
 UNION
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'RC' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.RC_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT     
     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
  FROM TB_RSV T_RSV
 INNER JOIN TB_RC_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
  UNION
SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
     , 'SV' AS CTGR
     , T_DTLRSV.CORP_ID
     , T_DTLRSV.SV_RSV_NUM AS RSV_NUM
     , T_DTLRSV.RSV_STATUS_CD
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
             ELSE T_DTLRSV.NML_AMT
         END
       ) AS NML_AMT
     , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30') THEN T_DTLRSV.DIS_AMT
             ELSE 0
         END
       ) AS DIS_AMT     
     , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
  FROM TB_RSV T_RSV
 INNER JOIN TB_SV_RSV T_DTLRSV
    ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
 INNER JOIN TB_SV_PRDTINF T_SPPRDT
    ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
 UNION
SELECT RSV_DT
     , CASE CTGR WHEN 'C410' THEN 'AD'
                 WHEN 'C420' THEN 'RC'
                 
                 ELSE CTGR
        END AS CTGR
     , CORP_ID
     , RSV_NUM
     , RSV_STATUS_CD
     , NML_AMT
     , DIS_AMT     
     , CANCEL_DT
  FROM (SELECT TO_CHAR(T_RSV.REG_DTTM, 'YYYYMMDD') AS RSV_DT
             , CASE SUBSTR(T_SPPRDT.CTGR,0,2) 
                                              WHEN 'C4' THEN T_SPPRDT.CTGR
                                              ELSE SUBSTR(T_SPPRDT.CTGR,0,2)||'00' 
                END AS CTGR
             , T_DTLRSV.CORP_ID
             , T_DTLRSV.SP_RSV_NUM AS RSV_NUM
             , T_DTLRSV.RSV_STATUS_CD
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS00', 'RS01', 'RS10', 'RS11', 'RS12', 'RS20', 'RS99') THEN 0
                     ELSE T_DTLRSV.NML_AMT
                 END
               ) AS NML_AMT
             , (CASE WHEN T_DTLRSV.RSV_STATUS_CD IN ('RS02','RS03', 'RS30') THEN T_DTLRSV.DIS_AMT
                     ELSE 0
                 END
               ) AS DIS_AMT       
             , TO_CHAR(T_DTLRSV.CANCEL_CMPL_DTTM, 'YYYYMMDD') AS CANCEL_DT
          FROM TB_RSV T_RSV    
         INNER JOIN TB_SP_RSV T_DTLRSV
            ON T_DTLRSV.RSV_NUM = T_RSV.RSV_NUM
         INNER JOIN TB_SP_PRDTINF T_SPPRDT
            ON T_SPPRDT.PRDT_NUM = T_DTLRSV.PRDT_NUM
           AND CTGR NOT IN ('C110', 'C140', 'C150')
       )
)

SELECT SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -15), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -15), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -15)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS PREV_MONTH3_SALE_AMT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -14), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -14), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -14)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS PREV_MONTH2_SALE_AMT
     , SUM(
        CASE WHEN RSV_DT BETWEEN TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -13), 'YYYYMM') || '01' 
          AND TO_CHAR(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -13), 'YYYYMM') || TO_CHAR(LAST_DAY(ADD_MONTHS(TO_DATE(#sStartDt#, 'YYYY-MM-DD'), -13)), 'DD') THEN
            CASE WHEN RSV_STATUS_CD IN ('RS02', 'RS03', 'RS30') THEN NML_AMT - DIS_AMT
                ELSE 0
            END
          ELSE 0
        END
          ) AS PREV_MONTH1_SALE_AMT     
  FROM T_RSV
</select>

<select id="DAY_S_00" resultMap="DAY_R_00">
SELECT NVL(AV_JL_CNT, 0) AS AV_JL_CNT
     , NVL(AV_JL_SALEAMT, 0) AS AV_JL_SALEAMT
     , NVL(AV_JC_CNT, 0) AS AV_JC_CNT
     , NVL(AV_JC_SALEAMT, 0) AS AV_JC_SALEAMT
     , NVL(VISITOR_NUM, 0) AS VISITOR_NUM
  FROM TB_DAYDAY_ANLS
 WHERE ANLS_DT = REPLACE(#sStartDt#, '-', '')
</select>

<update id="DAY_M_00">
 MERGE INTO TB_DAYDAY_ANLS T_DAY
 USING (SELECT REPLACE(#anlsDt#, '-', '') AS ANLS_DT FROM DUAL) DAY
    ON (DAY.ANLS_DT = T_DAY.ANLS_DT)
  WHEN MATCHED THEN
UPDATE SET
       AV_JL_CNT = #avJlCnt#,
       AV_JL_SALEAMT = #avJlSaleamt#,
       AV_JC_CNT = #avJcCnt#,
       AV_JC_SALEAMT = #avJcSaleamt#,
       VISITOR_NUM = #visitorNum#
  WHEN NOT MATCHED THEN
INSERT
     ( ANLS_DT
     , AV_JL_CNT
     , AV_JL_SALEAMT
     , AV_JC_CNT
     , AV_JC_SALEAMT
     , VISITOR_NUM
       )
VALUES
     ( REPLACE(#anlsDt#, '-', '')
     , #avJlCnt#
     , #avJlSaleamt#
     , #avJcCnt#
     , #avJcSaleamt#
     , #visitorNum#
     )
</update>


<select id="BIS_S_69" resultMap="BIS_R_69">

SELECT * FROM (
    SELECT ROWNUM AS RN, TB1.* FROM (
    SELECT
    T2.CD_NM,
    (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID =  T1.CORP_ID) AS CORP_NM,
    PRDT_NM,
    SALE_AMT,
    SALE_CNT,
    CANCEL_AMT,
    CANCEL_CNT,
    R_SALE_AMT,
    R_SALE_CNT
    FROM(
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_AD_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_RC_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_SP_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_SV_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    ORDER BY R_SALE_CNT DESC, R_SALE_AMT DESC, C.CORP_MOD_CD
    ) AS T1
    JOIN TB_CD AS T2
    ON T2.CD_NUM = T1.CORP_MOD_CD
    WHERE 1=1
    <isNotEmpty property="sCorpCd">
    AND CORP_MOD_CD = #sCorpCd#
    </isNotEmpty>
    ) TB1
    WHERE 1=1
    <isNotEmpty property="sCorpNm">
    AND CORP_NM LIKE '%' || #sCorpNm# || '%'
    </isNotEmpty>
    <isNotEmpty property="sPrdtNm">
    AND PRDT_NM LIKE '%' || #sPrdtNm# || '%'
    </isNotEmpty>
)
    WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)

</select>

<select id="BIS_S_70" resultClass="int">
SELECT COUNT(*) FROM (SELECT * FROM
    (
    SELECT
    ROWNUM AS RN,
    T2.CD_NM,
    (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID =  T1.CORP_ID) AS CORP_NM,
    PRDT_NM,
    SALE_AMT,
    SALE_CNT,
    CANCEL_AMT,
    CANCEL_CNT,
    R_SALE_AMT,
    R_SALE_CNT
    FROM(
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_AD_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_RC_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_SP_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM,
    (SUM(SALE_AMT) - SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT ELSE 0 END))  R_SALE_AMT,
    COUNT(SALE_AMT) - COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS R_SALE_CNT,
    SUM(SALE_AMT) AS SALE_AMT,
    SUM(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN A.CANCEL_AMT END) AS CANCEL_AMT,
    COUNT(SALE_AMT) AS SALE_CNT,
    COUNT(CASE WHEN A.RSV_STATUS_CD IN ('RS10','RS20') THEN 1 END) AS CANCEL_CNT
    FROM
    TB_SV_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-','')||'000000','YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-','')||'235959','YYYYMMDDHH24MISS')
    </isNotEmpty>
    GROUP BY A.CORP_ID,C.CORP_MOD_CD,PRDT_NUM, PRDT_NM
    ORDER BY C.CORP_MOD_CD,R_SALE_AMT DESC, R_SALE_CNT DESC
    ) AS T1
    JOIN TB_CD AS T2
    ON T2.CD_NUM = T1.CORP_MOD_CD
    WHERE 1=1
    <isNotEmpty property="sCorpCd">
    AND CORP_MOD_CD = #sCorpCd#
    </isNotEmpty>
    )
    WHERE 1=1
    <isNotEmpty property="sCorpNm">
        AND CORP_NM LIKE '%' || #sCorpNm# || '%'
    </isNotEmpty>
    <isNotEmpty property="sPrdtNm">
        AND PRDT_NM LIKE '%' || #sPrdtNm# || '%'
    </isNotEmpty>
)


</select>

<select id="BIS_S_71" resultMap="BIS_R_71">
SELECT * FROM (
    SELECT ROWNUM AS RN, TB1.* FROM (
SELECT
(SELECT CORP_NM FROM TB_CORP WHERE CORP_ID =  T1.CORP_ID) AS CORP_NM,
PRDT_NM
    FROM(
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM
    FROM
    TB_AD_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-',''),'YYYY-MM-DD')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-',''),'YYYY-MM-DD') + 1
    </isNotEmpty>
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM
    FROM
    TB_RC_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-',''),'YYYY-MM-DD')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-',''),'YYYY-MM-DD') + 1
    </isNotEmpty>
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM
    FROM
    TB_SP_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-',''),'YYYY-MM-DD')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-',''),'YYYY-MM-DD') + 1
    </isNotEmpty>
    UNION ALL
    SELECT
    A.CORP_ID,
    C.CORP_MOD_CD,
    PRDT_NUM,
    PRDT_NM
    FROM
    TB_SV_RSV AS A
    JOIN
    TB_RSV AS B
    ON A.RSV_NUM = B.RSV_NUM
    JOIN
    TB_CORP AS C
    ON A.CORP_ID = C.CORP_ID
    WHERE 1=1
    AND A.RSV_STATUS_CD != 'RS99'
    <isNotEmpty property="sStartDt">
        AND B.REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sStartDt#,'-',''),'YYYY-MM-DD')
    </isNotEmpty>
    <isNotEmpty property="sEndDt">
        AND B.REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sEndDt#,'-',''),'YYYY-MM-DD') + 1
    </isNotEmpty>
    ) AS T1
    JOIN TB_CD AS T2
    ON T2.CD_NUM = T1.CORP_MOD_CD
    WHERE 1=1
    <isNotEmpty property="sCorpCd">
        AND CORP_MOD_CD = #sCorpCd#
    </isNotEmpty>
    ) TB1
    WHERE 1=1
    <isNotEmpty property="sCorpNm">
        AND CORP_NM LIKE '%' || #sCorpNm# || '%'
    </isNotEmpty>
    <isNotEmpty property="sPrdtNm">
        AND PRDT_NM LIKE '%' || #sPrdtNm# || '%'
    </isNotEmpty>
    )
</select>


</sqlMap>