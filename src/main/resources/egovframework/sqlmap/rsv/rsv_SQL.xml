<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >

<sqlMap namespace="rsv">

<resultMap id="RSV_R_00" class="web.order.vo.RSVVO">
    <result property="rsvNum" 			    column="RSV_NUM" />
    <result property="rsvStatusCd" 		    column="RSV_STATUS_CD" />
    <result property="userId" 			    column="USER_ID" />
    <result property="rsvNm" 			    column="RSV_NM" />
    <result property="rsvEmail" 		    column="RSV_EMAIL" />
    <result property="rsvTelnum" 		    column="RSV_TELNUM" />
    <result property="useNm" 			    column="USE_NM" />
    <result property="useEmail" 		    column="USE_EMAIL" />
    <result property="useTelnum" 		    column="USE_TELNUM" />
    <result property="payDiv" 			    column="PAY_DIV" />
    <result property="totalNmlAmt" 		    column="TOTAL_NML_AMT" />
    <result property="totalSaleAmt" 	    column="TOTAL_SALE_AMT" />
    <result property="totalPayAmt" 		    column="TOTAL_PAY_AMT" />
    <result property="totalDisAmt" 		    column="TOTAL_DIS_AMT" />
    <result property="totalCancelAmt" 	    column="TOTAL_CANCEL_AMT" />
    <result property="regDttm" 			    column="REG_DTTM" />
    <result property="regIp" 			    column="REG_IP" />
    <result property="modDttm" 			    column="MOD_DTTM" />
    <result property="modIp" 			    column="MOD_IP" />
    <result property="totalCmssAmt" 	    column="TOTAL_CMSS_AMT" />
    <result property="totalDisCancelAmt" 	column="TOTAL_DIS_CANCEL_AMT" />
    <result property="postNum" 			    column="POST_NUM" />
    <result property="roadNmAddr" 		    column="ROAD_NM_ADDR" />
    <result property="dtlAddr" 			    column="DTL_ADDR" />
    <result property="dlvRequestInf"	    column="DLV_REQUEST_INF" />
    <result property="lpointUsePoint"	    column="LPOINT_USE_POINT" />
    <result property="lpointSavePoint"	    column="LPOINT_SAVE_POINT" />
    <result property="userSmsYn"	        column="USER_SMS_YN" />
    <result property="LGD_ACCOUNTNUM"	    column="LGD_ACCOUNTNUM" />
    <result property="LGD_FINANCENAME"	    column="LGD_FINANCENAME" />
    <result property="LGD_CASFLAGY"	        column="LGD_CASFLAGY" />
    <result property="LGD_PAYER"	        column="LGD_PAYER" />
    <result property="tamnacardRefId"	    column="TAMNACARD_REF_ID" />
    <result property="tamnacardLinkUrl"	    column="TAMNACARD_LINK_URL" />
    <result property="partnerCode"	        column="PARTNER_CODE" />
    <result property="partnerNm"	        column="PARTNER_NM" />
    <result property="usePoint"	            column="USE_POINT" />
</resultMap>

<resultMap id="RSV_R_01" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 				column="PRDT_CD" />
    <result property="prdtCdNm" 			column="PRDT_CD_NM" />
    <result property="prdtRsvNum" 			column="PRDT_RSV_NUM" />
    <result property="rsvNum" 				column="RSV_NUM" />
    <result property="rsvStatusCd" 			column="RSV_STATUS_CD" />
    <result property="corpId" 				column="CORP_ID" />
    <result property="prdtNum" 				column="PRDT_NUM" />
    <result property="prdtNm" 				column="PRDT_NM" />
    <result property="prdtInf" 				column="PRDT_INF" />
    <result property="nmlAmt" 				column="NML_AMT" />
    <result property="saleAmt" 				column="SALE_AMT" />
    <result property="disAmt" 				column="DIS_AMT" />
    <result property="corpNm" 				column="CORP_NM" />
    <result property="cancelAmt" 			column="CANCEL_AMT" />
    <result property="cmssAmt" 				column="CMSS_AMT" />
    <result property="disCancelAmt"			column="DIS_CANCEL_AMT" />
    <result property="useDttm"				column="USE_DTTM" />
    <result property="prdtDiv"				column="PRDT_DIV" />
    <result property="useAbleDttm" 			column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 			column="EXPR_END_DT" />
    <result property="exprStartDt" 			column="EXPR_START_DT" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="dlvCorpNm" 			column="DLV_CORP_NM" />
    <result property="dlvNum" 				column="DLV_NUM" />
    <result property="buyFixDttm" 			column="BUY_FIX_DTTM" />
</resultMap>

<resultMap id="RSV_R_02" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 		column="PRDT_CD" />
    <result property="prdtCdNm" 	column="PRDT_CD_NM" />
    <result property="prdtCnt" 		column="PRDT_CNT" />
</resultMap>

<resultMap id="RSV_R_03" class="web.order.vo.RSVEPILVO">
    <result property="prdtCd"       column="PRDT_CD"/>
    <result property="userId"       column="USER_ID"/>
    <result property="corpId"       column="CORP_ID"/>
    <result property="prdtNum"      column="PRDT_NUM"/>
    <result property="rsvNum"       column="RSV_NUM"/>
    <result property="prdtRsvNum"   column="PRDT_RSV_NUM"/>
    <result property="endDt"        column="END_DT"/>
    <result property="corpNm"       column="CORP_NM"/>
    <result property="prdtNm"       column="PRDT_NM"/>
    <result property="prdtInf"      column="PRDT_INF"/>
    <result property="useepilRegYn" column="USEEPIL_REG_YN"/>
</resultMap>

<resultMap id="RSV_R_04" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 				column="PRDT_CD" />
    <result property="prdtCdNm" 			column="PRDT_CD_NM" />
    <result property="ctgrNm" 				column="CTGR_NM" />
    <result property="prdtRsvNum" 			column="PRDT_RSV_NUM" />
    <result property="rsvNum" 				column="RSV_NUM" />
    <result property="rsvStatusCd" 			column="RSV_STATUS_CD" />
    <result property="corpId" 				column="CORP_ID" />
    <result property="prdtNum" 				column="PRDT_NUM" />
    <result property="prdtNm" 				column="PRDT_NM" />
    <result property="prdtInf" 				column="PRDT_INF" />
    <result property="nmlAmt" 				column="NML_AMT" />
    <result property="saleAmt" 				column="SALE_AMT" />
    <result property="disAmt" 				column="DIS_AMT" />
    <result property="corpNm" 				column="CORP_NM" />
    <result property="roadNmAddr" 			column="ROAD_NM_ADDR" />
    <result property="cancelAmt" 			column="CANCEL_AMT" />
    <result property="cmssAmt" 				column="CMSS_AMT" />
    <result property="disCancelAmt"			column="DIS_CANCEL_AMT" />
    <result property="useDttm"				column="USE_DTTM" />
    <result property="prdtDiv"				column="PRDT_DIV" />
    <result property="useAbleDttm" 			column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 			column="EXPR_END_DT" />
    <result property="exprStartDt" 			column="EXPR_START_DT" />
    <result property="spDivSn" 				column="SP_DIV_SN" />
    <result property="spOptSn" 				column="SP_OPT_SN" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelGuide" 			column="CANCEL_GUIDE" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="dlvCorpNm" 			column="DLV_CORP_NM" />
    <result property="dlvNum" 				column="DLV_NUM" />
    <result property="dlvAmt" 				column="DLV_AMT" />
    <result property="dlvAmtDiv" 			column="DLV_AMT_DIV" />
    <result property="prdtCnt" 				column="PRDT_CNT" />
    <result property="lsLinkPrdtNum" 		column="LS_LINK_PRDT_NUM" />
    <result property="lsLinkOptNum" 		column="LS_LINK_OPT_NUM" />
    <result property="lsLinkYn"      		column="LS_LINK_YN" />
    <result property="adjYn" 				column="ADJ_YN" />
    <result property="useNm" 				column="USE_NM" />
    <result property="useTelnum" 			column="USE_TELNUM" />
    <result property="preAdjAmt" 			column="PRE_ADJ_AMT" />
    <result property="prdc" 			    column="PRDC" />
    <result property="rnCorp" 			    column="RN_CORP" />
    <result property="corpMaxCount"		    column="CORP_MAX_COUNT" />
    <result property="usePoint"		        column="USE_POINT" />
    <result property="payPoint"		        column="PAY_POINT" />
    <result property="cpNm"		            column="CP_NM" />
    <result property="cpId"		            column="CP_ID" />
</resultMap>

<resultMap id="RSV_R_05" class="web.order.vo.RSVVO">
    <result property="rsvNum" 			    column="RSV_NUM" />
    <result property="rsvStatusCd" 		    column="RSV_STATUS_CD" />
    <result property="userId" 			    column="USER_ID" />
    <result property="rsvNm" 			    column="RSV_NM" />
    <result property="rsvEmail" 		    column="RSV_EMAIL" />
    <result property="rsvTelnum" 		    column="RSV_TELNUM" />
    <result property="useNm" 			    column="USE_NM" />
    <result property="useEmail" 		    column="USE_EMAIL" />
    <result property="useTelnum" 		    column="USE_TELNUM" />
    <result property="payDiv" 			    column="PAY_DIV" />
    <result property="totalNmlAmt" 		    column="TOTAL_NML_AMT" />
    <result property="totalSaleAmt" 	    column="TOTAL_SALE_AMT" />
    <result property="totalPayAmt" 		    column="TOTAL_PAY_AMT" />
    <result property="totalDisAmt" 		    column="TOTAL_DIS_AMT" />
    <result property="totalCancelAmt" 	    column="TOTAL_CANCEL_AMT" />
    <result property="lpointUsePoint" 	    column="LPOINT_USE_POINT" />
    <result property="regDttm" 			    column="REG_DTTM" />
    <result property="regIp" 			    column="REG_IP" />
    <result property="modDttm" 			    column="MOD_DTTM" />
    <result property="modIp" 			    column="MOD_IP" />
    <result property="totalCmssAmt" 	    column="TOTAL_CMSS_AMT" />
    <result property="totalDisCancelAmt" 	column="TOTAL_DIS_CANCEL_AMT" />
    <result property="appDiv" 			    column="APP_DIV" />
    <result property="usePoint" 			column="USE_POINT" />
</resultMap>

<resultMap id="RSV_R_07" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 				column="PRDT_CD" />
    <result property="prdtCdNm" 			column="PRDT_CD_NM" />
    <result property="prdtRsvNum" 			column="PRDT_RSV_NUM" />
    <result property="rsvNum" 				column="RSV_NUM" />
    <result property="rsvStatusCd" 			column="RSV_STATUS_CD" />
    <result property="corpId" 				column="CORP_ID" />
    <result property="prdtNum" 				column="PRDT_NUM" />
    <result property="prdtNm" 				column="PRDT_NM" />
    <result property="prdtInf" 				column="PRDT_INF" />
    <result property="nmlAmt" 				column="NML_AMT" />
    <result property="saleAmt" 				column="SALE_AMT" />
    <result property="disAmt" 				column="DIS_AMT" />
    <result property="corpNm" 				column="CORP_NM" />
    <result property="cancelAmt" 			column="CANCEL_AMT" />
    <result property="cmssAmt" 				column="CMSS_AMT" />
    <result property="disCancelAmt"			column="DIS_CANCEL_AMT" />
    <result property="useDttm"				column="USE_DTTM" />
    <result property="prdtDiv"				column="PRDT_DIV" />
    <result property="useAbleDttm" 			column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 			column="EXPR_END_DT" />
    <result property="exprStartDt" 			column="EXPR_START_DT" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="dlvCorpNm" 			column="DLV_CORP_NM" />
    <result property="dlvNum" 				column="DLV_NUM" />
    <result property="buyFixDttm" 			column="BUY_FIX_DTTM" />
    <result property="directRecvYn" 		column="DIRECT_RECV_YN" />
    <result property="userId" 		        column="USER_ID" />
</resultMap>

<resultMap id="RSV_R_09" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 		column="PRDT_CD" />
    <result property="prdtCdNm" 	column="PRDT_CD_NM" />
    <result property="prdtRsvNum" 	column="PRDT_RSV_NUM" />
    <result property="rsvNum" 		column="RSV_NUM" />
    <result property="rsvStatusCd" 	column="RSV_STATUS_CD" />
    <result property="corpId" 		column="CORP_ID" />
    <result property="prdtNum" 		column="PRDT_NUM" />
    <result property="prdtNm" 		column="PRDT_NM" />
    <result property="prdtInf" 		column="PRDT_INF" />
    <result property="nmlAmt" 		column="NML_AMT" />
    <result property="saleAmt" 		column="SALE_AMT" />
    <result property="disAmt" 		column="DIS_AMT" />
    <result property="corpNm" 		column="CORP_NM" />
    <result property="cancelAmt" 	column="CANCEL_AMT" />
    <result property="cmssAmt" 		column="CMSS_AMT" />
    <result property="disCancelAmt"	column="DIS_CANCEL_AMT" />
    <result property="useDttm"		column="USE_DTTM" />
    <result property="prdtDiv"		column="PRDT_DIV" />
    <result property="useAbleDttm" 	column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 	column="EXPR_END_DT" />
    <result property="exprStartDt" 	column="EXPR_START_DT" />
    <result property="cancelGuide" 	column="CANCEL_GUIDE" />
</resultMap>

<resultMap id="RSV_R_15" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 		    column="PRDT_CD" />
    <result property="prdtCdNm" 	    column="PRDT_CD_NM" />
    <result property="prdtRsvNum" 	    column="PRDT_RSV_NUM" />
    <result property="rsvNum" 		    column="RSV_NUM" />
    <result property="rsvStatusCd" 	    column="RSV_STATUS_CD" />
    <result property="corpId" 		    column="CORP_ID" />
    <result property="prdtNum" 		    column="PRDT_NUM" />
    <result property="prdtNm" 		    column="PRDT_NM" />
    <result property="prdtInf" 		    column="PRDT_INF" />
    <result property="nmlAmt" 		    column="NML_AMT" />
    <result property="saleAmt" 		    column="SALE_AMT" />
    <result property="disAmt" 		    column="DIS_AMT" />
    <result property="corpNm" 		    column="CORP_NM" />
    <result property="cancelAmt" 	    column="CANCEL_AMT" />
    <result property="cmssAmt" 		    column="CMSS_AMT" />
    <result property="disCancelAmt"	    column="DIS_CANCEL_AMT" />
    <result property="useDttm"		    column="USE_DTTM" />
    <result property="prdtDiv"		    column="PRDT_DIV" />
    <result property="useAbleDttm" 	    column="USE_ABLE_DTTM" />
    <result property="rsvNm" 		    column="RSV_NM" />
    <result property="rsvTelnum" 	    column="RSV_TELNUM" />
    <result property="refundBankNm"     column="REFUND_BANK_NM" />
    <result property="refundAccNum"     column="REFUND_ACC_NUM" />
    <result property="refundDepositor" 	column="REFUND_DEPOSITOR" />
    <result property="refundBankCode" 	column="REFUND_BANK_CODE" />
    <result property="refundRsn" 	    column="REFUND_RSN" />
    <result property="userId" 	        column="USER_ID" />
    <result property="payDiv"	        column="PAY_DIV" />
    <result property="regDttm"	        column="REG_DTTM" />
    <result property="cancelRequestDttm"   column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm"   column="REFUND_REQUEST_DTTM" />
</resultMap>

<resultMap id="RSV_R_17" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 		        column="PRDT_CD" />
    <result property="prdtCdNm" 	        column="PRDT_CD_NM" />
    <result property="rsvNum" 		        column="RSV_NUM" />
    <result property="prdtRsvNum" 	        column="PRDT_RSV_NUM" />
    <result property="prdtNum" 		        column="PRDT_NUM" />
    <result property="prdtNm" 		        column="PRDT_NM" />
    <result property="rsvStatusCd" 	        column="RSV_STATUS_CD" />
    <result property="corpId" 		        column="CORP_ID" />
    <result property="corpNm" 		        column="CORP_NM" />
    <result property="prdtInf" 		        column="PRDT_INF" />
    <result property="nmlAmt" 		        column="NML_AMT" />
    <result property="saleAmt" 		        column="SALE_AMT" />
    <result property="disAmt" 		        column="DIS_AMT" />
    <result property="cancelAmt" 	        column="CANCEL_AMT" />
    <result property="cmssAmt" 		        column="CMSS_AMT" />
    <result property="disCancelAmt"	        column="DIS_CANCEL_AMT" />
    <result property="useDttm"		        column="USE_DTTM" />
    <result property="prdtDiv"		        column="PRDT_DIV" />
    <result property="useAbleDttm" 	        column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 	        column="EXPR_END_DT" />
    <result property="exprStartDt" 	        column="EXPR_START_DT" />
    <result property="adjDt" 		        column="ADJ_DT" />
    <result property="userId" 		        column="USER_ID" />
    <result property="rsvNm" 		        column="RSV_NM" />
    <result property="rsvEmail" 	        column="RSV_EMAIL" />
    <result property="rsvTelnum" 	        column="RSV_TELNUM" />
    <result property="useNm" 		        column="USE_NM" />
    <result property="useEmail" 	        column="USE_EMAIL" />
    <result property="useTelnum" 	        column="USE_TELNUM" />
    <result property="payDiv" 		        column="PAY_DIV" />
    <result property="regDttm" 		        column="REG_DTTM" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="evntCd" 		        column="EVNT_CD" />
</resultMap>

<resultMap id="RSV_R_18" class="web.order.vo.AV_RSVVO">
    <result property="saleCorpDiv"	    column="SALE_CORP_DIV" />
    <result property="avCorpDiv" 	    column="AV_CORP_DIV" />
    <result property="rsvNum"	 	    column="RSV_NUM" />
    <result property="rsvNm"	 	    column="RSV_NM" />
    <result property="rsvDttm"	 	    column="RSV_DTTM" />
    <result property="startCourseDiv"	column="START_COURSE_DIV" />
    <result property="endCourseDiv"	    column="END_COURSE_DIV" />
    <result property="useDttm" 		    column="USE_DTTM" />
    <result property="mem"		 	    column="MEM" />
    <result property="saleAmt"	 	    column="SALE_AMT" />
    <result property="rsvStatusCd" 	    column="RSV_STATUS_CD" />
</resultMap>

<resultMap id="RSV_R_19" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 		        column="PRDT_CD" />
    <result property="prdtCdNm" 	        column="PRDT_CD_NM" />
    <result property="rsvNum" 		        column="RSV_NUM" />
    <result property="prdtRsvNum" 	        column="PRDT_RSV_NUM" />
    <result property="prdtNum" 		        column="PRDT_NUM" />
    <result property="prdtNm" 		        column="PRDT_NM" />
    <result property="rsvStatusCd" 	        column="RSV_STATUS_CD" />
    <result property="corpId" 		        column="CORP_ID" />
    <result property="corpNm" 		        column="CORP_NM" />
    <result property="prdtInf" 		        column="PRDT_INF" />
    <result property="nmlAmt" 		        column="NML_AMT" />
    <result property="saleAmt" 		        column="SALE_AMT" />
    <result property="disAmt" 		        column="DIS_AMT" />
    <result property="cancelAmt" 	        column="CANCEL_AMT" />
    <result property="cmssAmt" 		        column="CMSS_AMT" />
    <result property="disCancelAmt"	        column="DIS_CANCEL_AMT" />
    <result property="useDttm"		        column="USE_DTTM" />
    <result property="prdtDiv"		        column="PRDT_DIV" />
    <result property="useAbleDttm" 	        column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 	        column="EXPR_END_DT" />
    <result property="exprStartDt" 	        column="EXPR_START_DT" />
    <result property="adjDt" 		        column="ADJ_DT" />
    <result property="userId" 		        column="USER_ID" />
    <result property="rsvNm" 		        column="RSV_NM" />
    <result property="rsvEmail" 	        column="RSV_EMAIL" />
    <result property="rsvTelnum" 	        column="RSV_TELNUM" />
    <result property="useNm" 		        column="USE_NM" />
    <result property="useEmail" 	        column="USE_EMAIL" />
    <result property="useTelnum" 	        column="USE_TELNUM" />
    <result property="payDiv" 		        column="PAY_DIV" />
    <result property="regDttm" 		        column="REG_DTTM" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="evntCd" 		        column="EVNT_CD" />
    <result property="lpointUsePoint" 		column="LPOINT_USE_POINT" />
    <result property="lpointSavePoint" 		column="LPOINT_SAVE_POINT" />
</resultMap>

<resultMap id="RSV_R_22" class="web.order.vo.RSVVO">
    <result property="postNum"		column="POST_NUM" />
    <result property="roadNmAddr" 	column="ROAD_NM_ADDR" />
    <result property="dtlAddr"	 	column="DTL_ADDR" />
    <result property="useNm"	 	column="USE_NM" />
    <result property="useTelnum"	column="USE_TELNUM" />
</resultMap>

<resultMap id="RSV_R_23" class="web.order.vo.ORDERVO">
    <result property="useNm" 		column="USE_NM" />
    <result property="useEmail" 	column="USE_EMAIL" />
    <result property="useTelnum" 	column="USE_TELNUM" />
</resultMap>

<resultMap id="RSV_R_24" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 			    column="PRDT_CD" />
    <result property="prdtCdNm" 			column="PRDT_CD_NM" />
    <result property="rsvNum" 			    column="RSV_NUM" />
    <result property="prdtRsvNum" 		    column="PRDT_RSV_NUM" />
    <result property="prdtNum" 			    column="PRDT_NUM" />
    <result property="prdtNm" 			    column="PRDT_NM" />
    <result property="rsvStatusCd" 		    column="RSV_STATUS_CD" />
    <result property="corpId" 			    column="CORP_ID" />
    <result property="prdtInf" 			    column="PRDT_INF" />
    <result property="nmlAmt" 			    column="NML_AMT" />
    <result property="saleAmt" 			    column="SALE_AMT" />
    <result property="disAmt" 			    column="DIS_AMT" />
    <result property="cancelAmt" 		    column="CANCEL_AMT" />
    <result property="cmssAmt" 			    column="CMSS_AMT" />
    <result property="disCancelAmt" 	    column="DIS_CANCEL_AMT" />
    <result property="prdtDiv" 			    column="PRDT_DIV" />
    <result property="exprEndDt" 		    column="EXPR_END_DT" />
    <result property="adjDt" 			    column="ADJ_DT" />
    <result property="corpNm" 			    column="CORP_NM" />
    <result property="userId" 			    column="USER_ID" />
    <result property="rsvNm" 			    column="RSV_NM" />
    <result property="rsvEmail" 		    column="RSV_EMAIL" />
    <result property="rsvTelnum" 		    column="RSV_TELNUM" />
    <result property="useNm" 			    column="USE_NM" />
    <result property="useEmail" 		    column="USE_EMAIL" />
    <result property="useTelnum" 		    column="USE_TELNUM" />
    <result property="payDiv" 			    column="PAY_DIV" />
    <result property="regDttm" 			    column="REG_DTTM" />
    <result property="cancelRequestDttm"    column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm"    column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 	    column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 		    column="CANCEL_RSN" />
    <result property="dlvCorpNm" 		    column="DLV_CORP_NM" />
    <result property="dlvNum" 			    column="DLV_NUM" />
    <result property="dlvDttm" 			    column="DLV_DTTM" />
    <result property="dlvAmt" 			    column="DLV_AMT" />
    <result property="buyFixYn" 		    column="BUY_FIX_YN" />
    <result property="buyFixDttm" 		    column="BUY_FIX_DTTM" />
    <result property="evntCd" 			    column="EVNT_CD" />
</resultMap>

<resultMap id="RSV_R_26" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 			    column="PRDT_CD" />
    <result property="prdtCdNm" 			column="PRDT_CD_NM" />
    <result property="rsvNum" 			    column="RSV_NUM" />
    <result property="prdtRsvNum" 		    column="PRDT_RSV_NUM" />
    <result property="prdtNum" 			    column="PRDT_NUM" />
    <result property="prdtNm" 			    column="PRDT_NM" />
    <result property="rsvStatusCd" 		    column="RSV_STATUS_CD" />
    <result property="corpId" 			    column="CORP_ID" />
    <result property="prdtInf" 			    column="PRDT_INF" />
    <result property="nmlAmt" 			    column="NML_AMT" />
    <result property="saleAmt" 			    column="SALE_AMT" />
    <result property="disAmt" 			    column="DIS_AMT" />
    <result property="cancelAmt" 		    column="CANCEL_AMT" />
    <result property="cmssAmt" 			    column="CMSS_AMT" />
    <result property="disCancelAmt" 	    column="DIS_CANCEL_AMT" />
    <result property="prdtDiv" 			    column="PRDT_DIV" />
    <result property="exprEndDt" 		    column="EXPR_END_DT" />
    <result property="adjDt" 			    column="ADJ_DT" />
    <result property="corpNm" 			    column="CORP_NM" />
    <result property="userId" 			    column="USER_ID" />
    <result property="rsvNm" 			    column="RSV_NM" />
    <result property="rsvEmail" 		    column="RSV_EMAIL" />
    <result property="rsvTelnum" 		    column="RSV_TELNUM" />
    <result property="useNm" 			    column="USE_NM" />
    <result property="useEmail" 		    column="USE_EMAIL" />
    <result property="useTelnum" 		    column="USE_TELNUM" />
    <result property="payDiv" 			    column="PAY_DIV" />
    <result property="regDttm" 			    column="REG_DTTM" />
    <result property="cancelRequestDttm"    column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm"    column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 	    column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 		    column="CANCEL_RSN" />
    <result property="dlvCorpNm" 		    column="DLV_CORP_NM" />
    <result property="dlvNum" 			    column="DLV_NUM" />
    <result property="dlvDttm" 			    column="DLV_DTTM" />
    <result property="dlvAmt" 			    column="DLV_AMT" />
    <result property="buyFixYn" 		    column="BUY_FIX_YN" />
    <result property="buyFixDttm" 		    column="BUY_FIX_DTTM" />
    <result property="evntCd" 			    column="EVNT_CD" />
    <result property="lpointUsePoint" 		column="LPOINT_USE_POINT" />
    <result property="lpointSavePoint" 		column="LPOINT_SAVE_POINT" />
    <result property="appDiv" 		        column="APP_DIV" />
    <result property="totalNmlAmt" 	        column="TOTAL_NML_AMT" />
    <result property="totalDisAmt" 	        column="TOTAL_DIS_AMT" />
    <result property="totalSaleAmt"         column="TOTAL_SALE_AMT" />
    <result property="roadNmAddr" 		    column="ROAD_NM_ADDR" />
    <result property="postNum" 		        column="POST_NUM" />
    <result property="partner" 		        column="PARTNER" />
    <result property="notice" 		        column="NOTICE" />
    <result property="usePoint"             column="USE_POINT" />
    <result property="partnerCode"          column="PARTNER_CODE" />
    <result property="cpNm"                 column="CP_NM" />
    <result property="email"                column="EMAIL" />
</resultMap>

<resultMap id="RSV_R_28" class="web.order.vo.ORDERVO">
    <result property="userId" 		column="USER_ID" />
    <result property="useNm" 		column="USE_NM" />
    <result property="useEmail" 	column="USE_EMAIL" />
    <result property="useTelnum" 	column="USE_TELNUM" />
</resultMap>

<resultMap id="RSV_R_29" class="web.order.vo.ORDERVO">
    <result property="userId" 		column="USER_ID" />
    <result property="corpNm"	 	column="CORP_NM" />
    <result property="prdtNm" 		column="PRDT_NM" />
    <result property="prdtInf" 		column="PRDT_INF" />
    <result property="imgPath"	 	column="IMG_PATH" />
    <result property="roadNmAddr" 	column="ROAD_NM_ADDR" />
    <result property="rsvTelnum"	column="RSV_TELNUM" />
</resultMap>

<resultMap id="RSV_R_30" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 				column="PRDT_CD" />
    <result property="prdtCdNm" 			column="PRDT_CD_NM" />
    <result property="prdtRsvNum" 			column="PRDT_RSV_NUM" />
    <result property="rsvNum" 				column="RSV_NUM" />
    <result property="rsvStatusCd" 			column="RSV_STATUS_CD" />
    <result property="corpId" 				column="CORP_ID" />
    <result property="prdtNum" 				column="PRDT_NUM" />
    <result property="prdtNm" 				column="PRDT_NM" />
    <result property="prdtInf" 				column="PRDT_INF" />
    <result property="nmlAmt" 				column="NML_AMT" />
    <result property="saleAmt" 				column="SALE_AMT" />
    <result property="disAmt" 				column="DIS_AMT" />
    <result property="corpNm" 				column="CORP_NM" />
    <result property="cancelAmt" 			column="CANCEL_AMT" />
    <result property="cmssAmt" 				column="CMSS_AMT" />
    <result property="disCancelAmt"			column="DIS_CANCEL_AMT" />
    <result property="useDttm"				column="USE_DTTM" />
    <result property="prdtDiv"				column="PRDT_DIV" />
    <result property="useAbleDttm" 			column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 			column="EXPR_END_DT" />
    <result property="exprStartDt" 			column="EXPR_START_DT" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="dlvCorpNm" 			column="DLV_CORP_NM" />
    <result property="goodsflowDlvCd" 	    column="GOODSFLOW_DLV_CD" />
    <result property="dlvNum" 				column="DLV_NUM" />
    <result property="buyFixDttm" 			column="BUY_FIX_DTTM" />
    <result property="regDttm" 			column="REG_DTTM" />
    <result property="useepilRegYn" 			column="USEEPIL_REG_YN" />
    <result property="savePath" 			column="SAVE_PATH" />
    <result property="saveFileNm" 			column="SAVE_FILE_NM" />
</resultMap>

<resultMap id="RSV_R_31" class="web.order.vo.ORDERVO">
    <result property="prdtCd" 		        column="PRDT_CD" />
    <result property="prdtCdNm" 	        column="PRDT_CD_NM" />
    <result property="rsvNum" 		        column="RSV_NUM" />
    <result property="prdtRsvNum" 	        column="PRDT_RSV_NUM" />
    <result property="prdtNum" 		        column="PRDT_NUM" />
    <result property="prdtNm" 		        column="PRDT_NM" />
    <result property="rsvStatusCd" 	        column="RSV_STATUS_CD" />
    <result property="corpId" 		        column="CORP_ID" />
    <result property="corpNm" 		        column="CORP_NM" />
    <result property="startDt" 		        column="START_DT" />
    <result property="prdtInf" 		        column="PRDT_INF" />
    <result property="nmlAmt" 		        column="NML_AMT" />
    <result property="saleAmt" 		        column="SALE_AMT" />
    <result property="disAmt" 		        column="DIS_AMT" />
    <result property="cancelAmt" 	        column="CANCEL_AMT" />
    <result property="cmssAmt" 		        column="CMSS_AMT" />
    <result property="disCancelAmt"	        column="DIS_CANCEL_AMT" />
    <result property="useDttm"		        column="USE_DTTM" />
    <result property="prdtDiv"		        column="PRDT_DIV" />
    <result property="useAbleDttm" 	        column="USE_ABLE_DTTM" />
    <result property="exprEndDt" 	        column="EXPR_END_DT" />
    <result property="exprStartDt" 	        column="EXPR_START_DT" />
    <result property="adjDt" 		        column="ADJ_DT" />
    <result property="userId" 		        column="USER_ID" />
    <result property="rsvNm" 		        column="RSV_NM" />
    <result property="rsvEmail" 	        column="RSV_EMAIL" />
    <result property="rsvTelnum" 	        column="RSV_TELNUM" />
    <result property="useNm" 		        column="USE_NM" />
    <result property="useEmail" 	        column="USE_EMAIL" />
    <result property="useTelnum" 	        column="USE_TELNUM" />
    <result property="payDiv" 		        column="PAY_DIV" />
    <result property="regDttm" 		        column="REG_DTTM" />
    <result property="cancelRequestDttm" 	column="CANCEL_REQUEST_DTTM" />
    <result property="refundRequestDttm" 	column="REFUND_REQUEST_DTTM" />
    <result property="cancelCmplDttm" 		column="CANCEL_CMPL_DTTM" />
    <result property="cancelRsn" 			column="CANCEL_RSN" />
    <result property="evntCd" 		        column="EVNT_CD" />
    <result property="lpointUsePoint" 		column="LPOINT_USE_POINT" />
    <result property="lpointSavePoint" 		column="LPOINT_SAVE_POINT" />
    <result property="appDiv" 		        column="APP_DIV" />
    <result property="totalNmlAmt" 	        column="TOTAL_NML_AMT" />
    <result property="totalDisAmt" 	        column="TOTAL_DIS_AMT" />
    <result property="totalSaleAmt"         column="TOTAL_SALE_AMT" />
    <result property="cpNm"			        column="CP_NM" />
    <result property="partner"              column="PARTNER" />
    <result property="notice"               column="NOTICE" />
    <result property="usePoint"             column="USE_POINT" />
    <result property="partnerCode"          column="PARTNER_CODE" />
    <result property="email"                column="EMAIL" />
</resultMap>

<resultMap id="MMS_BACKUP_MSG_R_00" class="egovframework.cmmn.vo.MMSVO">
    <result property="subject" 		        column="SUBJECT" />
    <result property="msg" 		            column="MSG" />
</resultMap>

<resultMap id="ESCROW_R_00" class="web.order.vo.ESCROWVO">
    <result property="corpCd"   		    column="CORP_CD" />
    <result property="payDiv" 		        column="PAY_DIV" />
    <result property="oid" 		            column="RSV_NUM" />
    <result property="svRsvNum"             column="SV_RSV_NUM" />
    <result property="dlvWorker" 		    column="RSV_NM" />
    <result property="dlvWorkertel" 	    column="RSV_TELNUM" />
    <result property="dlvCompCode" 		    column="ESCROW_DLV_CD" />
</resultMap>

<resultMap id="OSSRSV_R_00" class="oss.rsv.vo.OSS_RSVEXCELVO">
    <result property="seq"              column="SEQ"/>
    <result property="rsvNm"            column="RSV_NM"/>
    <result property="rsvTelnum"        column="RSV_TELNUM"/>
    <result property="useNm"            column="USE_NM"/>
    <result property="useTelnum"        column="USE_TELNUM"/>
    <result property="postNum"          column="POST_NUM"/>
    <result property="roadNmAddr"       column="ROAD_NM_ADDR"/>
    <result property="dtlAddr"          column="DTL_ADDR"/>
    <result property="dlvRequestInf"    column="DLV_REQUEST_INF"/>
    <result property="corpNm"           column="CORP_NM"/>
    <result property="prdtNm"           column="PRDT_NM"/>
    <result property="prdtDivNm"        column="PRDT_DIV_NM"/>
    <result property="optNm"            column="OPT_NM"/>
    <result property="saleAmt"          column="SALE_AMT"/>
    <result property="dlvAmtDiv"        column="DLV_AMT_DIV"/>
    <result property="addOptNm"         column="ADD_OPT_NM"/>
    <result property="addOptAmt"        column="ADD_OPT_AMT"/>
    <result property="buyNum"           column="BUY_NUM"/>
    <result property="dlvAmt"           column="DLV_AMT"/>
    <result property="payDiv"           column="PAY_DIV"/>
    <result property="prdtNum"          column="PRDT_NUM"/>
    <result property="divSn"            column="DIV_SN"/>
    <result property="optSn"            column="OPT_SN"/>
    <result property="addOptSn"         column="ADD_OPT_SN"/>
    <result property="directRecvYn"     column="DIRECT_RECV_YN"/>
    <result property="corpId"           column="CORP_ID"/>
    <result property="sPrdtOptNm"       column="S_PRDT_OPT_NM"/>
    <result property="rsvCompleteYn"    column="RSV_COMPLETE_YN"/>
    <result property="prdtDiv"          column="PRDT_DIV"/>
    <result property="exprDaynumYn"     column="EXPR_DAYNUM_YN"/>
    <result property="exprDaynum"       column="EXPR_DAYNUM"/>
    <result property="exprEndDt"        column="EXPR_END_DT"/>
    <result property="exprStartDt"      column="EXPR_START_DT"/>
    <result property="useAbleTm"        column="USE_ABLE_TM"/>
</resultMap>

<resultMap id="OSSRSV_R_01" class="oss.rsv.vo.OSS_RSVEXCELVO">
    <result property="sPrdtOptNm"            column="S_PRDT_OPT_NM"/>
</resultMap>

<select id="RSV_S_00" resultMap="RSV_R_00">
    SELECT * FROM(
        SELECT RSV_NUM /*예약 번호*/
        , RSV_STATUS_CD /*예약 상태 코드*/
        , USER_ID /*사용자 아이디*/
        , RSV_NM /*예약 명*/
        , RSV_EMAIL /*예약 이메일*/
        , RSV_TELNUM /*예약 전화번호*/
        , USE_NM /*사용 명*/
        , NVL(USE_EMAIL, RSV_EMAIL) AS USE_EMAIL /*사용 이메일*/
        , USE_TELNUM /*사용 전화번호*/
        , PAY_DIV /*결제 구분*/
        , TOTAL_NML_AMT /*총 정상 금액*/
        , TOTAL_SALE_AMT /*총 판매 금액*/
        , TOTAL_PAY_AMT /*총 결제 금액*/
        , TOTAL_DIS_AMT /*총 할인 금액*/
        , TOTAL_CANCEL_AMT /*총 취소 금액*/
        , A.REG_DTTM /*등록 일시*/
        , REG_IP /*등록 아이피*/
        , MOD_DTTM /*수정 일시*/
        , MOD_IP /*수정 아이피*/
        , TOTAL_CMSS_AMT /*총 수수료 금액*/
        , TOTAL_DIS_CANCEL_AMT /*총 할인 취소 금액*/
        , POST_NUM /* 우편번호 */
        , ROAD_NM_ADDR /*도로명주소 */
        , DTL_ADDR /* 상세 주소 */
        , NVL(DLV_REQUEST_INF, ' ') AS DLV_REQUEST_INF /* 배송요청정보 */
        , LPOINT_USE_POINT /* L.Point 사용 포인트 */
        , LPOINT_SAVE_POINT/* L.Point 적립 포인트 */
        , USER_SMS_YN
        , LGD_ACCOUNTNUM
        , LGD_FINANCENAME
        , LGD_CASFLAGY
        , LGD_PAYER
        , TAMNACARD_REF_ID
        , TAMNACARD_LINK_URL
        , A.PARTNER_CODE /* 파트너(협력사) 코드 */
        , C.PARTNER_NM
        , NVL(USE_POINT,0) AS USE_POINT /* 파트너(협력사) Point 사용 포인트 */
        FROM TB_RSV AS A
        LEFT JOIN TB_LGPAYINF AS B
        <isEqual property="LGD_RESPCODE" compareValue="8888">
            ON A.RSV_NUM = B.LGD_OID AND B.LGD_RESPCODE IN ('0000','8888')
        </isEqual>
        <isNotEqual property="LGD_RESPCODE" compareValue="8888">
            ON A.RSV_NUM = B.LGD_OID AND B.LGD_RESPCODE = '0000'
        </isNotEqual>
        LEFT JOIN TB_POINT_CP AS C
        ON A.PARTNER_CODE = C.PARTNER_CODE
        WHERE 1=1
        <isNotEmpty property="rsvNum">
            AND RSV_NUM = #rsvNum#
        </isNotEmpty>
        <isNotEmpty property="userId">
            AND USER_ID = #userId#
        </isNotEmpty>
        <isNotEmpty property="tamnacardRefId">
            AND TAMNACARD_REF_ID = #tamnacardRefId#
        </isNotEmpty>
        <isNotEmpty property="tamnacardRefHashid">
            AND TAMNACARD_REF_HASHID = #tamnacardRefHashid#
        </isNotEmpty>
        <isNotEmpty property="partnerCode">
            <isNotEqual property="partnerCode" compareValue="tamnao">
                AND A.PARTNER_CODE = #partnerCode#
            </isNotEqual>
        </isNotEmpty>
        ORDER BY A.REG_DTTM DESC
    ) WHERE 1=1
    <isNotEqual property="rn" compareValue="unlimit">
    AND ROWNUM = 1
    </isNotEqual>
</select>

<select id="RSV_S_01" resultMap="RSV_R_04">
SELECT
     '' AS RN_CORP
    ,'' AS CORP_MAX_COUNT
    , PRDT_CD
    , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = PRDT_CD) AS PRDT_CD_NM
    , CTGR_NM
    , T_RSV.RSV_NUM
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , TC.CORP_ID
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , CASE PRDT_CD
        WHEN 'AD' THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
        ELSE  TC.CORP_NM END ||
      CASE TC.AD_APILINK_NM WHEN 'TLL' THEN '(TL린칸)' END ||
      CASE TC.API_RENT_DIV WHEN 'R' THEN '(리본)' WHEN 'I' THEN '(인스)' WHEN 'G' THEN '(그림)' END
        AS CORP_NM
    , CASE PRDT_CD
        WHEN 'AD' THEN TC.ROAD_NM_ADDR || ' ' || TC.DTL_ADDR
        ELSE ''
    END AS ROAD_NM_ADDR
    , USE_DTTM
    , PRDT_DIV
    , USE_ABLE_DTTM
    , EXPR_END_DT
    , EXPR_START_DT
    , SP_DIV_SN
    , SP_OPT_SN
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
    , CANCEL_CMPL_DTTM
    , CANCEL_RSN
    , CANCEL_GUIDE
    , DLV_CORP_NM
    , DLV_NUM
    , NVL(DLV_AMT,0) AS DLV_AMT
    , DLV_AMT_DIV
    , PRDT_CNT
    , (SELECT LS_LINK_PRDT_NUM FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_RSV.PRDT_NUM) AS LS_LINK_PRDT_NUM
    , (SELECT LS_LINK_OPT_NUM FROM TB_SP_OPTINF WHERE PRDT_NUM = T_RSV.PRDT_NUM AND SP_DIV_SN = T_RSV.SP_DIV_SN AND SP_OPT_SN = T_RSV.SP_OPT_SN) AS LS_LINK_OPT_NUM
    , TC.LS_LINK_YN
    , ADJ_YN
    , '' AS USE_NM
    , '' AS USE_TELNUM
    , '' AS PRE_ADJ_AMT
    , PRDC
    , TC.AD_APILINK_NM
    , TC.API_RENT_DIV
    , NVL((SELECT TP.POINT FROM TB_POINT TP WHERE TP.DTL_RSV_NUM = T_RSV.PRDT_RSV_NUM AND TP.TYPES='USE' AND CONTENTS = 'CMSS_AMT'),0) AS USE_POINT /* 수수료 사용 포인트 */
    , NVL((SELECT TP.POINT FROM TB_POINT TP WHERE TP.DTL_RSV_NUM = T_RSV.PRDT_RSV_NUM AND TP.TYPES='USE' AND CONTENTS IS NULL),0) AS PAY_POINT /* 사용 포인트 */
    ,(SELECT CP_NM FROM TB_USER_CP WHERE USE_RSV_NUM = PRDT_RSV_NUM) AS CP_NM
    ,(SELECT CP_ID FROM TB_USER_CP WHERE USE_RSV_NUM = PRDT_RSV_NUM) AS CP_ID
FROM (SELECT 'AD' AS PRDT_CD
        , '숙박' AS CTGR_NM
        , RSV_NUM
        , AD_RSV_NUM AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , NULL AS SP_DIV_SN
        , NULL AS SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_AD_DFTINF WHERE CORP_ID = T_ADRSV.CORP_ID) AS CANCEL_GUIDE
        , NULL AS DLV_CORP_NM
        , NULL AS DLV_NUM
        , NULL AS DLV_AMT
        , NULL AS DLV_AMT_DIV
        , 1 AS PRDT_CNT
        , ADJ_YN
        , NULL AS PRDC
    FROM TB_AD_RSV T_ADRSV
    WHERE RSV_NUM = #rsvNum#

    UNION ALL

    SELECT (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS PRDT_CD
            , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS CTGR_NM
            , RSV_NUM
            , SP_RSV_NUM AS PRDT_RSV_NUM
            , PRDT_NUM
            , PRDT_NM
            , RSV_STATUS_CD
            , CORP_ID
            , PRDT_INF
            , NML_AMT
            , SALE_AMT
            , DIS_AMT
            , CANCEL_AMT
            , CMSS_AMT
            , DIS_CANCEL_AMT
            , USE_DTTM
            , PRDT_DIV
            , USE_ABLE_DTTM
            , EXPR_END_DT
            , EXPR_START_DT
            , SP_DIV_SN
            , SP_OPT_SN
            , CANCEL_REQUEST_DTTM
            , REFUND_REQUEST_DTTM
            , CANCEL_CMPL_DTTM
            , CANCEL_RSN
            , (SELECT CANCEL_GUIDE FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM) AS CANCEL_GUIDE
            , NULL AS DLV_CORP_NM
            , NULL AS DLV_NUM
            , NULL AS DLV_AMT
            , NULL AS DLV_AMT_DIV
            , BUY_NUM AS PRDT_CNT
            , ADJ_YN
            , NULL AS PRDC
        FROM TB_SP_RSV T_SPRSV
    WHERE RSV_NUM = #rsvNum#

    UNION ALL

    SELECT 'RC' AS PRDT_CD
        , '렌터카' AS CTGR_NM
        , RSV_NUM
        , RC_RSV_NUM AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , PRDT_INF || ' [' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM = T_RCRSV.ISR_DIV)
            || CASE
                WHEN T_RCRSV.ISR_DIV = 'ID10' THEN
                    CASE
                        WHEN T_RCRSV.ISR_TYPE_DIV = 'GENL' THEN '-일반자차'
                        WHEN T_RCRSV.ISR_TYPE_DIV = 'LUXY' THEN '-고급자차'
                    END
                ELSE ''
            END || ']' AS PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , NULL AS SP_DIV_SN
        , NULL AS SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_RC_DFTINF WHERE CORP_ID = T_RCRSV.CORP_ID) AS CANCEL_GUIDE
        , NULL AS DLV_CORP_NM
        , NULL AS DLV_NUM
        , NULL AS DLV_AMT
        , NULL AS DLV_AMT_DIV
        , 1 AS PRDT_CNT
        , ADJ_YN
        , NULL AS PRDC
    FROM TB_RC_RSV T_RCRSV
    WHERE RSV_NUM = #rsvNum#

    UNION ALL

    SELECT 'SV' AS PRDT_CD
        , (SELECT CD_NM  FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SV_PRDTINF WHERE PRDT_NUM = T_SVRSV.PRDT_NUM)) AS CTGR_NM
        , RSV_NUM
        , SV_RSV_NUM AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , NULL AS SP_DIV_SN
        , NULL AS SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_SV_PRDTINF WHERE PRDT_NUM = T_SVRSV.PRDT_NUM) AS CANCEL_GUIDE
        , DLV_CORP_NM
        , DLV_NUM
        , DLV_AMT
        , DLV_AMT_DIV
        , BUY_NUM AS PRDT_CNT
        , ADJ_YN
        , (SELECT PRDC FROM TB_SV_PRDTINF WHERE PRDT_NUM = T_SVRSV.PRDT_NUM) AS PRDC
    FROM TB_SV_RSV T_SVRSV
    WHERE RSV_NUM = #rsvNum#
) T_RSV
LEFT JOIN TB_CORP TC
ON T_RSV.CORP_ID = TC.CORP_ID
</select>

<select id="RSV_S_02" resultMap="RSV_R_02">
SELECT PRDT_CD
     , (SELECT CD_NM
          FROM TB_CD
         WHERE CD_NUM = PRDT_CD
       ) AS PRDT_CD_NM
     , COUNT(RSV_NUM) AS PRDT_CNT
  FROM (SELECT 'AD' AS PRDT_CD
             , RSV_NUM
             , AD_RSV_NUM AS PRDT_RSV_NUM
             , PRDT_NUM
             , PRDT_NM
             , RSV_STATUS_CD
             , CORP_ID
             , PRDT_INF
             , NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_AD_RSV
         WHERE RSV_NUM = #rsvNum#
         UNION ALL
        SELECT (SELECT HRK_CD_NUM
                  FROM TB_CD
                 WHERE CD_NUM = (SELECT CTGR
                                   FROM TB_SP_PRDTINF
                                  WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS PRDT_CD
             , RSV_NUM
             , SP_RSV_NUM AS PRDT_RSV_NUM
             , PRDT_NUM
             , PRDT_NM
             , RSV_STATUS_CD
             , CORP_ID
             , PRDT_INF
             , NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_SP_RSV T_SPRSV
         WHERE RSV_NUM = #rsvNum#
         UNION ALL
        SELECT 'RC' AS PRDT_CD
             , RSV_NUM
             , RC_RSV_NUM AS PRDT_RSV_NUM
             , PRDT_NUM
             , PRDT_NM
             , RSV_STATUS_CD
             , CORP_ID
             , PRDT_INF
             , NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_RC_RSV
         WHERE RSV_NUM = #rsvNum#
       )
 GROUP BY PRDT_CD
</select>


<!-- 상품평 남길 수 있는 구매목록 -->
<select id="RSV_S_03" resultMap="RSV_R_03">
SELECT 'AD' AS PRDT_CD
     , USER_ID
     , CORP_ID
     , PRDT_NUM
     , AD.RSV_NUM
     , AD_RSV_NUM AS PRDT_RSV_NUM
      /*,AD.RSV_STATUS_CD*/
      /*,RSV.RSV_STATUS_CD*/
     , TO_DATE(USE_DT,'YYYYMMDD')+TO_NUMBER(USE_NIGHT) AS END_DT
     , (SELECT CORP_NM FROM TB_CORP CO WHERE CO.CORP_ID=AD.CORP_ID) AS CORP_NM
     , PRDT_NM
     , PRDT_INF
     , USEEPIL_REG_YN
  FROM TB_AD_RSV AD
  LEFT OUTER JOIN TB_RSV RSV
    ON AD.RSV_NUM = RSV.RSV_NUM
 WHERE USER_ID = #userId#
	<isNotEmpty property="rsvNum">
	AND RSV.RSV_NUM = #rsvNum#
	</isNotEmpty>
	<isNotEmpty property="prdtNum">
	AND AD.AD_RSV_NUM = #prdtNum#
	</isNotEmpty>
   AND (USEEPIL_REG_YN = 'N'  OR USEEPIL_REG_YN IS NULL)
  <![CDATA[ AND SYSDATE BETWEEN TO_DATE(USE_DT, 'YYYYMMDD') + TO_NUMBER(USE_NIGHT) AND ADD_MONTHS(TO_DATE(USE_DT, 'YYYYMMDD') + TO_NUMBER(USE_NIGHT),2) ]]>
  AND (AD.RSV_STATUS_CD ='RS30' OR AD.RSV_STATUS_CD ='RS32')

UNION ALL

SELECT 'RC' AS PRDT_CD
      ,USER_ID
      ,CORP_ID
      ,PRDT_NUM
      ,RC.RSV_NUM
      ,RC_RSV_NUM AS PRDT_RSV_NUM
      /*,RC.RSV_STATUS_CD*/
      /*,RSV.RSV_STATUS_CD*/
      ,TO_DATE(RENT_END_DT,'YYYYMMDD')+1 AS END_DT
      ,(SELECT CORP_NM FROM TB_CORP CO WHERE CO.CORP_ID=RC.CORP_ID) AS CORP_NM
      ,PRDT_NM
      ,PRDT_INF
      ,USEEPIL_REG_YN
FROM TB_RC_RSV RC
LEFT OUTER JOIN
TB_RSV RSV
ON RC.RSV_NUM = RSV.RSV_NUM
WHERE USER_ID=#userId#
	<isNotEmpty property="rsvNum">
	AND RSV.RSV_NUM = #rsvNum#
	</isNotEmpty>
	<isNotEmpty property="prdtNum">
	AND RC.RC_RSV_NUM = #prdtNum#
	</isNotEmpty>
  AND (USEEPIL_REG_YN = 'N'  OR USEEPIL_REG_YN IS NULL)
  <![CDATA[ AND SYSDATE BETWEEN TO_DATE(RENT_END_DT, 'YYYYMMDD') AND ADD_MONTHS(TO_DATE(RENT_END_DT, 'YYYYMMDD'),2) ]]>
  AND (RC.RSV_STATUS_CD ='RS30' OR RC.RSV_STATUS_CD ='RS32')

UNION ALL

SELECT 'SP' AS PRDT_CD
      ,USER_ID
      ,CORP_ID
      ,PRDT_NUM
      ,SP.RSV_NUM
      ,SP_RSV_NUM AS PRDT_RSV_NUM
      /*,SP.RSV_STATUS_CD*/
      /*,RSV.RSV_STATUS_CD*/
      ,TO_DATE(TO_CHAR(USE_DTTM,'YYYYMMDD'),'YYYYMMDD')+1 AS END_DT
      ,'' AS CORP_NM
      ,PRDT_NM
      ,PRDT_INF
      ,USEEPIL_REG_YN
FROM TB_SP_RSV SP
LEFT OUTER JOIN
TB_RSV RSV
ON SP.RSV_NUM = RSV.RSV_NUM
WHERE USER_ID=#userId#
	<isNotEmpty property="rsvNum">
	AND RSV.RSV_NUM = #rsvNum#
	</isNotEmpty>
	<isNotEmpty property="prdtNum">
	AND SP.SP_RSV_NUM = #prdtNum#
	</isNotEmpty>
  AND (USEEPIL_REG_YN = 'N'  OR USEEPIL_REG_YN IS NULL)
  <![CDATA[ AND SYSDATE BETWEEN TO_DATE(TO_CHAR(USE_DTTM, 'YYYYMMDD'), 'YYYYMMDD') AND ADD_MONTHS(TO_CHAR(USE_DTTM, 'YYYYMMDD'),2) ]]>
  AND (SP.RSV_STATUS_CD ='RS30' OR SP.RSV_STATUS_CD ='RS32')

UNION ALL

SELECT 'SV' AS PRDT_CD
      ,USER_ID
      ,CORP_ID
      ,PRDT_NUM
      ,SV.RSV_NUM
      ,SV_RSV_NUM AS PRDT_RSV_NUM
      ,TO_DATE(TO_CHAR(BUY_FIX_DTTM,'YYYYMMDD'),'YYYYMMDD')+1 AS END_DT
      ,'' AS CORP_NM
      ,PRDT_NM
      ,PRDT_INF
      ,USEEPIL_REG_YN
FROM TB_SV_RSV SV
LEFT OUTER JOIN
TB_RSV RSV
ON SV.RSV_NUM = RSV.RSV_NUM
WHERE USER_ID=#userId#
	<isNotEmpty property="rsvNum">
	AND RSV.RSV_NUM = #rsvNum#
	</isNotEmpty>
	<isNotEmpty property="prdtNum">
	AND SV.SV_RSV_NUM = #prdtNum#
	</isNotEmpty>
  AND (USEEPIL_REG_YN = 'N'  OR USEEPIL_REG_YN IS NULL)
  <![CDATA[ AND SYSDATE BETWEEN TO_DATE(TO_CHAR(BUY_FIX_DTTM, 'YYYYMMDD'), 'YYYYMMDD') AND ADD_MONTHS(TO_CHAR(BUY_FIX_DTTM, 'YYYYMMDD'),2) ]]>
  AND (SV.RSV_STATUS_CD ='RS30' OR SV.RSV_STATUS_CD ='RS32')
</select>

<select id="RSV_S_04" resultMap="RSV_R_30">
SELECT *
FROM (
    SELECT T.*, ROWNUM AS RN
    FROM (
    SELECT PRDT_CD
    , (SELECT CD_NM
    FROM TB_CD
    WHERE CD_NUM = PRDT_CD
    ) AS PRDT_CD_NM
    , RSV_NUM
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , CORP_ID
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , (CASE PRDT_CD WHEN 'AD'
    THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
    ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
    END) AS CORP_NM
    , USE_DTTM
    , PRDT_DIV
    , USE_ABLE_DTTM
    , EXPR_END_DT
    , EXPR_START_DT
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
    , CANCEL_CMPL_DTTM
    , CANCEL_RSN
    , DLV_CORP_NM
    , (SELECT GOODSFLOW_DLV_CD FROM TB_DLVCORP WHERE DLV_CORP_NM = T_RSV.DLV_CORP_NM) AS GOODSFLOW_DLV_CD
    , DLV_NUM
    , BUY_FIX_DTTM
    , TO_CHAR(REG_DTTM,'YYYYMMDD') AS REG_DTTM
    , USEEPIL_REG_YN
    , SAVE_PATH
    , SAVE_FILE_NM
    FROM (
    SELECT 'AD' AS PRDT_CD
    , T_AD.RSV_NUM
    , T_AD.AD_RSV_NUM AS PRDT_RSV_NUM
    , T_AD.PRDT_NUM
    , T_AD.PRDT_NM
    , T_AD.RSV_STATUS_CD
    , T_AD.CORP_ID
    , T_AD.PRDT_INF
    , T_AD.NML_AMT
    , T_AD.SALE_AMT
    , T_AD.DIS_AMT
    , T_AD.CANCEL_AMT
    , T_AD.CMSS_AMT
    , T_AD.DIS_CANCEL_AMT
    , NULL AS USE_DTTM
    , NULL AS PRDT_DIV
    , NULL AS USE_ABLE_DTTM
    , NULL AS EXPR_END_DT
    , NULL AS EXPR_START_DT
    , T_AD.CANCEL_REQUEST_DTTM
    , T_AD.REFUND_REQUEST_DTTM
    , T_AD.CANCEL_CMPL_DTTM
    , T_AD.CANCEL_RSN
    , NULL AS DLV_CORP_NM
    , NULL AS DLV_NUM
    , NULL AS BUY_FIX_DTTM
    , REG_DTTM
    , T_AD.USEEPIL_REG_YN
    , T_IMG.SAVE_PATH
    , T_IMG.SAVE_FILE_NM
    FROM TB_RSV T_RSV1
    INNER JOIN TB_AD_RSV T_AD
    ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
    LEFT JOIN TB_CM_IMG T_IMG
    ON T_IMG.LINK_NUM = T_AD.CORP_ID AND T_IMG.IMG_SN = 1
    WHERE T_RSV1.USER_ID = #userId#
    UNION ALL

    SELECT (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD
             , T_SP.RSV_NUM
             , T_SP.SP_RSV_NUM AS PRDT_RSV_NUM
             , T_SP.PRDT_NUM
             , T_SP.PRDT_NM
             , T_SP.RSV_STATUS_CD
             , T_SP.CORP_ID
             , T_SP.PRDT_INF
             , T_SP.NML_AMT
             , T_SP.SALE_AMT
             , T_SP.DIS_AMT
             , T_SP.CANCEL_AMT
		     , T_SP.CMSS_AMT
		     , T_SP.DIS_CANCEL_AMT
		     , T_SP.USE_DTTM
		     , T_SP.PRDT_DIV
		     , T_SP.USE_ABLE_DTTM
		     , T_SP.EXPR_END_DT
		     , T_SP.EXPR_START_DT
		     , T_SP.CANCEL_REQUEST_DTTM
		     , T_SP.REFUND_REQUEST_DTTM
		     , T_SP.CANCEL_CMPL_DTTM
		     , T_SP.CANCEL_RSN
		     , NULL AS DLV_CORP_NM
		     , NULL AS DLV_NUM
		     , NULL AS BUY_FIX_DTTM
             , REG_DTTM
             , T_SP.USEEPIL_REG_YN
             , NVL(T_IMG.SAVE_PATH
             , ( SELECT API_IMG_THUMB FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS SAVE_PATH
             , T_IMG.SAVE_FILE_NM
    FROM TB_RSV T_RSV2
    INNER JOIN TB_SP_RSV T_SP
    ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
    LEFT JOIN TB_CM_IMG T_IMG
    ON T_IMG.LINK_NUM = T_SP.PRDT_NUM  AND T_IMG.IMG_SN = 1
    WHERE T_RSV2.USER_ID = #userId#
    UNION ALL

        SELECT 'RC' AS PRDT_CD
             , T_RC.RSV_NUM
             , T_RC.RC_RSV_NUM AS PRDT_RSV_NUM
             , T_RC.PRDT_NUM
             , T_RC.PRDT_NM
             , T_RC.RSV_STATUS_CD
             , T_RC.CORP_ID
             , T_RC.PRDT_INF || ' [' || ( SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RC.ISR_DIV) || CASE WHEN T_RC.ISR_DIV='ID10' THEN
					CASE WHEN T_RC.ISR_TYPE_DIV='GENL' THEN '-일반자차'
					    WHEN T_RC.ISR_TYPE_DIV='LUXY' THEN '-고급자차'
                    END ELSE '' END || ']' AS PRDT_INF
             , T_RC.NML_AMT
             , T_RC.SALE_AMT
             , T_RC.DIS_AMT
             , T_RC.CANCEL_AMT
             , T_RC.CMSS_AMT
		     , T_RC.DIS_CANCEL_AMT
		     , NULL AS USE_DTTM
		     , NULL AS PRDT_DIV
		     , NULL AS USE_ABLE_DTTM
		     , NULL AS EXPR_END_DT
		     , NULL AS EXPR_START_DT
		     , T_RC.CANCEL_REQUEST_DTTM
		     , T_RC.REFUND_REQUEST_DTTM
		     , T_RC.CANCEL_CMPL_DTTM
		     , T_RC.CANCEL_RSN
		     , NULL AS DLV_CORP_NM
		     , NULL AS DLV_NUM
		     , NULL AS BUY_FIX_DTTM
             , REG_DTTM
             , T_RC.USEEPIL_REG_YN
             , (SELECT CAR_IMG FROM TB_RC_CARDIV WHERE RC_CARDIV_NUM = T_RP.RC_CARDIV_NUM) AS SAVE_PATH
             , '' AS SAVE_FILE_NM FROM TB_RSV T_RSV4
         INNER JOIN TB_RC_RSV T_RC
            ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
          LEFT JOIN TB_RC_PRDTINF T_RP
            ON T_RP.PRDT_NUM = T_RC.PRDT_NUM
         WHERE T_RSV4.USER_ID = #userId#
		 UNION ALL
        SELECT 'SV' AS PRDT_CD
             , T_SV.RSV_NUM
             , T_SV.SV_RSV_NUM AS PRDT_RSV_NUM
             , T_SV.PRDT_NUM
             , T_SV.PRDT_NM
             , T_SV.RSV_STATUS_CD
             , T_SV.CORP_ID
             , T_SV.PRDT_INF
             , T_SV.NML_AMT
             , T_SV.SALE_AMT
             , T_SV.DIS_AMT
             , T_SV.CANCEL_AMT
		     , T_SV.CMSS_AMT
		     , T_SV.DIS_CANCEL_AMT
		     , NULL AS USE_DTTM
		     , NULL AS PRDT_DIV
		     , NULL AS USE_ABLE_DTTM
		     , NULL AS EXPR_END_DT
		     , NULL AS EXPR_START_DT
             , T_SV.CANCEL_REQUEST_DTTM
		     , T_SV.REFUND_REQUEST_DTTM
		     , T_SV.CANCEL_CMPL_DTTM
		     , T_SV.CANCEL_RSN
		     , T_SV.DLV_CORP_NM
		     , T_SV.DLV_NUM
		     , T_SV.BUY_FIX_DTTM
             , REG_DTTM
             , T_SV.USEEPIL_REG_YN
             , T_IMG.SAVE_PATH
             , T_IMG.SAVE_FILE_NM
          FROM TB_RSV T_RSV5
         INNER JOIN TB_SV_RSV T_SV
            ON T_SV.RSV_NUM = T_RSV5.RSV_NUM
         LEFT JOIN TB_CM_IMG T_IMG
            ON T_IMG.LINK_NUM = T_SV.PRDT_NUM  AND T_IMG.IMG_SN = 1
         WHERE T_RSV5.USER_ID = #userId#
       ) T_RSV
         WHERE 1=1
         <isNotEmpty property="sFromDt">
         AND REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sFromDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
         </isNotEmpty>
         <isNotEmpty property="sToDt">
         AND REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sToDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
         </isNotEmpty>
    ORDER BY RSV_NUM DESC
    ) T
    WHERE 1 = 1
    <isEqual property="autoCancelYn" compareValue="N">
	AND RSV_STATUS_CD <![CDATA[<>]]> 'RS99'
    </isEqual>
    <isNotEmpty property="sPrdtNm">
    AND UPPER(PRDT_NM) LIKE '%' || UPPER(#sPrdtNm#) || '%'
    </isNotEmpty>
    <isNotEmpty property="sPrdtCd">
    AND PRDT_CD = #sPrdtCd#
    </isNotEmpty>
)
WHERE RN BETWEEN TO_NUMBER(#firstIndex#) AND TO_NUMBER(#lastIndex#)

</select>

<select id="RSV_S_33" resultClass="int">
    SELECT COUNT(*)
    FROM (
    SELECT RSV_NUM, RSV_STATUS_CD, PRDT_NM, PRDT_CD, REG_DTTM
    FROM (
    SELECT T_AD.RSV_NUM, T_AD.RSV_STATUS_CD, T_AD.PRDT_NM, 'AD' AS PRDT_CD, REG_DTTM
    FROM TB_RSV T_RSV1
    INNER JOIN TB_AD_RSV T_AD ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
    WHERE T_RSV1.USER_ID = #userId#

    UNION ALL

    SELECT T_SP.RSV_NUM, T_SP.RSV_STATUS_CD, T_SP.PRDT_NM,
    (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD,
    REG_DTTM
    FROM TB_RSV T_RSV2
    INNER JOIN TB_SP_RSV T_SP ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
    WHERE T_RSV2.USER_ID = #userId#

    UNION ALL

    SELECT T_RC.RSV_NUM, T_RC.RSV_STATUS_CD, T_RC.PRDT_NM, 'RC' AS PRDT_CD, REG_DTTM
    FROM TB_RSV T_RSV4
    INNER JOIN TB_RC_RSV T_RC ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
    WHERE T_RSV4.USER_ID = #userId#

    UNION ALL

    SELECT T_SV.RSV_NUM, T_SV.RSV_STATUS_CD, T_SV.PRDT_NM, 'SV' AS PRDT_CD, REG_DTTM
    FROM TB_RSV T_RSV5
    INNER JOIN TB_SV_RSV T_SV ON T_SV.RSV_NUM = T_RSV5.RSV_NUM
    WHERE T_RSV5.USER_ID = #userId#
    ) T_RSV
    WHERE 1 = 1
    <isEqual property="autoCancelYn" compareValue="N">
        AND RSV_STATUS_CD <![CDATA[<>]]> 'RS99'
    </isEqual>
    <isNotEmpty property="sPrdtNm">
        AND UPPER(PRDT_NM) LIKE '%' || UPPER(#sPrdtNm#) || '%'
    </isNotEmpty>
    <isNotEmpty property="sPrdtCd">
        AND PRDT_CD = #sPrdtCd#
    </isNotEmpty>
    <isNotEmpty property="sFromDt">
        AND REG_DTTM <![CDATA[>=]]> TO_DATE(REPLACE(#sFromDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
    </isNotEmpty>
    <isNotEmpty property="sToDt">
        AND REG_DTTM <![CDATA[<=]]> TO_DATE(REPLACE(#sToDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
    </isNotEmpty>
    )
</select>
<select id="RSV_S_05" resultMap="RSV_R_05">    
SELECT RSV_NUM          /*예약 번호*/
    , RSV_STATUS_CD    /*예약 상태 코드*/
    , USER_ID          /*사용자 아이디*/
    , RSV_NM           /*예약 명*/
    , RSV_EMAIL        /*예약 이메일*/
    , RSV_TELNUM       /*예약 전화번호*/
    , USE_NM           /*사용 명*/
    , USE_EMAIL        /*사용 이메일*/
    , USE_TELNUM       /*사용 전화번호*/
    , PAY_DIV          /*결제 구분*/
    , TOTAL_NML_AMT    /*총 정상 금액*/
    , TOTAL_SALE_AMT   /*총 판매 금액*/
    , TOTAL_PAY_AMT    /*총 결제 금액*/
    , TOTAL_DIS_AMT    /*총 할인 금액*/
    , TOTAL_CANCEL_AMT /*총 취소 금액*/
    , LPOINT_USE_POINT /*LPOINT 사용 포인트*/
    , REG_DTTM         /*등록 일시*/
    , REG_IP           /*등록 아이피*/
    , MOD_DTTM         /*수정 일시*/
    , MOD_IP           /*수정 아이피*/
    , TOTAL_CMSS_AMT   /*총 수수료 금액*/
    , TOTAL_DIS_CANCEL_AMT	/*총 할인 취소 금액*/
    , APP_DIV			/*앱구분*/
    , NVL(USE_POINT,0) AS USE_POINT /* 파트너 포인트 */
FROM (SELECT

    ROWNUM AS RN
        , RSV_NUM          /*예약 번호*/
        , RSV_STATUS_CD    /*예약 상태 코드*/
        , USER_ID          /*사용자 아이디*/
        , RSV_NM           /*예약 명*/
        , RSV_EMAIL        /*예약 이메일*/
        , RSV_TELNUM       /*예약 전화번호*/
        , USE_NM           /*사용 명*/
        , USE_EMAIL        /*사용 이메일*/
        , USE_TELNUM       /*사용 전화번호*/
        , PAY_DIV          /*결제 구분*/
        , TOTAL_NML_AMT    /*총 정상 금액*/
        , TOTAL_SALE_AMT   /*총 판매 금액*/
        , TOTAL_PAY_AMT    /*총 결제 금액*/
        , TOTAL_DIS_AMT    /*총 할인 금액*/
        , TOTAL_CANCEL_AMT /*총 취소 금액*/
        , NVL(LPOINT_USE_POINT, 0) AS LPOINT_USE_POINT /*LPOINT 사용 포인트*/
        , REG_DTTM         /*등록 일시*/
        , REG_IP           /*등록 아이피*/
        , MOD_DTTM         /*수정 일시*/
        , MOD_IP           /*수정 아이피*/
        , TOTAL_CMSS_AMT   /*총 수수료 금액*/
        , TOTAL_DIS_CANCEL_AMT	/*총 할인 취소 금액*/
        , APP_DIV			/*앱구분*/
        , USE_POINT /* 파트너 포인트 */
    FROM (SELECT
            <isEmpty property="userId"><isEmpty property="sRsvNm"><isEmpty property="sUseNm"><isEmpty property="sRsvTelnum"><isEmpty property="sUseTelnum">
            /*+ INDEX_DESC(T1 IDX_RSV_PK) */
            </isEmpty></isEmpty></isEmpty></isEmpty></isEmpty>
              RSV_NUM          /*예약 번호*/
            , RSV_STATUS_CD    /*예약 상태 코드*/
            , USER_ID          /*사용자 아이디*/
            , RSV_NM           /*예약 명*/
            , RSV_EMAIL        /*예약 이메일*/
            , RSV_TELNUM       /*예약 전화번호*/
            , USE_NM           /*사용 명*/
            , USE_EMAIL        /*사용 이메일*/
            , USE_TELNUM       /*사용 전화번호*/
            , PAY_DIV          /*결제 구분*/
            , TOTAL_NML_AMT    /*총 정상 금액*/
            , TOTAL_SALE_AMT   /*총 판매 금액*/
            , TOTAL_PAY_AMT    /*총 결제 금액*/
            , TOTAL_DIS_AMT    /*총 할인 금액*/
            , TOTAL_CANCEL_AMT /*총 취소 금액*/
            , LPOINT_USE_POINT /*LPOINT 사용 포인트*/
            , REG_DTTM         /*등록 일시*/
            , REG_IP           /*등록 아이피*/
            , MOD_DTTM         /*수정 일시*/
            , MOD_IP           /*수정 아이피*/
            , TOTAL_CMSS_AMT   /*총 수수료 금액*/
            , TOTAL_DIS_CANCEL_AMT	/*총 할인 취소 금액*/
            , APP_DIV			/*앱구분*/
            , NVL(USE_POINT,0)  AS USE_POINT /* 파트너 포인트 */
        FROM TB_RSV T1
        WHERE 1=1
        <isNotEmpty property="partnerCode">
            <isNotEqual property="partnerCode" compareValue="tamnao">
                AND T1.PARTNER_CODE = #partnerCode#
            </isNotEqual>
        </isNotEmpty>
            <isNotEmpty property="sRsvNm">
                AND RSV_NM LIKE '%' || #sRsvNm# || '%'
            </isNotEmpty>
            <isNotEmpty property="sUseNm">
                AND USE_NM LIKE '%' || #sUseNm# || '%'
            </isNotEmpty>
            <isNotEmpty property="sRsvNum">
                AND RSV_NUM = #sRsvNum#
            </isNotEmpty>
            <isNotEmpty property="sRsvTelnum">
                AND REPLACE(RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
            </isNotEmpty>
            <isNotEmpty property="sUseTelnum">
                AND REPLACE(USE_TELNUM, '-', '') LIKE '%'||REPLACE(#sUseTelnum#, '-', '')||'%'
            </isNotEmpty>
            <isNotEmpty property="sRsvStatusCd">
                <isNotEqual property="sRsvStatusCd" compareValue="RS13">
                    AND RSV_NUM IN (
                	<isNotEqual property="sPrdtCd" compareValue="SV">
                        SELECT RSV_NUM
                        	FROM TB_AD_RSV
                        WHERE RSV_STATUS_CD = #sRsvStatusCd#

                        UNION ALL

                        SELECT RSV_NUM
                        	FROM TB_RC_RSV
                        WHERE RSV_STATUS_CD = #sRsvStatusCd#

                        UNION ALL

                        SELECT RSV_NUM
                        	FROM TB_SP_RSV
                        WHERE RSV_STATUS_CD = #sRsvStatusCd#
                	</isNotEqual>
                	<isEqual property="sPrdtCd" compareValue="SV">
                		SELECT RSV_NUM
                        	FROM TB_SV_RSV
                        WHERE RSV_STATUS_CD = #sRsvStatusCd#
                	</isEqual>
                    )
                </isNotEqual>
                <isEqual property="sRsvStatusCd" compareValue="RS13">
                    AND RSV_NUM IN (
                    <isNotEqual property="sPrdtCd" compareValue="SV">
                        SELECT RSV_NUM
                        	FROM TB_AD_RSV
                        WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL

                        UNION ALL

                        SELECT RSV_NUM
                        	FROM TB_RC_RSV
                        WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL

                        UNION ALL

                        SELECT RSV_NUM
                        	FROM TB_SP_RSV
                        WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL
					</isNotEqual>
                	<isEqual property="sPrdtCd" compareValue="SV">
                		SELECT RSV_NUM
                        	FROM TB_SV_RSV
                        WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL
                	</isEqual>
                    )
                </isEqual>
            </isNotEmpty>
            <isNotEmpty property="userId">
                AND USER_ID = #userId#
            </isNotEmpty>
            <isNotEmpty property="sAutoCancelViewYn">
                <isEqual property="sAutoCancelViewYn" compareValue="N">
                    AND RSV_STATUS_CD NOT IN ('RS99')
                </isEqual>
            </isNotEmpty>
            <isNotEmpty property="sStartDt">
                <![CDATA[
                AND REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
                ]]>
            </isNotEmpty>
            <isNotEmpty property="sEndDt">
                <![CDATA[
                AND REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
                ]]>
            </isNotEmpty>
            <isNotEmpty property="sUsedStartDt">
                <isNotEmpty property="sUsedEndDt">
                    AND RSV_NUM IN (
                        SELECT RSV_NUM
                        FROM TB_AD_RSV
                        WHERE USE_DT BETWEEN REPLACE(#sUsedStartDt#, '-', '') AND REPLACE(#sUsedEndDt#, '-', '')

                        UNION ALL

                        SELECT RSV_NUM
                        FROM TB_RC_RSV
                        WHERE RENT_START_DT BETWEEN REPLACE(#sUsedStartDt#, '-', '') AND REPLACE(#sUsedEndDt#, '-', '')
                            OR RENT_END_DT BETWEEN REPLACE(#sUsedStartDt#, '-', '') AND REPLACE(#sUsedEndDt#, '-', '')

                        UNION ALL

                        SELECT RSV_NUM
                        FROM TB_SP_RSV
                        WHERE USE_DTTM BETWEEN TO_DATE(REPLACE(#sUsedStartDt#, '-', '')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sUsedEndDt#, '-', '')||'235959', 'YYYYMMDDHH24MISS')
                    )
                </isNotEmpty>
            </isNotEmpty>
            <isNotEmpty property="sCorpNm">
                AND RSV_NUM IN (
                    <isNotEqual property="sPrdtCd" compareValue="SV">
                        SELECT RSV_NUM
                        FROM TB_AD_RSV T_AD
                        INNER JOIN TB_AD_DFTINF T_ADDFT
                            ON T_ADDFT.CORP_ID = T_AD.CORP_ID
                                AND T_ADDFT.AD_NM LIKE '%' || #sCorpNm# || '%'

                        UNION ALL

                        SELECT RSV_NUM
                        FROM TB_RC_RSV T_RC
                        INNER JOIN TB_CORP T_CORP
                            ON T_CORP.CORP_ID = T_RC.CORP_ID
                                AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'

                        UNION ALL

                        SELECT RSV_NUM
                        FROM TB_SP_RSV T_SP
                        INNER JOIN TB_CORP T_CORP
                            ON T_CORP.CORP_ID = T_SP.CORP_ID
                                AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
                    </isNotEqual>
                    <isEqual property="sPrdtCd" compareValue="SV">
                        SELECT RSV_NUM
                        FROM TB_SV_RSV T_SV
                        INNER JOIN TB_CORP T_CORP
                                ON T_CORP.CORP_ID = T_SV.CORP_ID
                                AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
                    </isEqual>
                )
            </isNotEmpty>
            <isNotEmpty property="sPrdtNm">
                AND RSV_NUM IN (
                    <isNotEqual property="sPrdtCd" compareValue="SV">
                        SELECT RSV_NUM
                        FROM TB_AD_RSV
                        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'

                        UNION ALL

                        SELECT RSV_NUM
                        FROM TB_RC_RSV
                        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'

                        UNION ALL

                        SELECT RSV_NUM
                        FROM TB_SP_RSV
                        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'
                    </isNotEqual>
                    <isEqual property="sPrdtCd" compareValue="SV">
                        SELECT RSV_NUM
                        FROM TB_SV_RSV
                        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'
                    </isEqual>
                )
            </isNotEmpty>
            <isEqual property="sPrdtCd" compareValue="SV">
                AND EXISTS (SELECT /*+ NO_UNNEST */ COUNT(SV_RSV_NUM) FROM    TB_SV_RSV A WHERE   RSV_NUM = T1.RSV_NUM)
            </isEqual>
            <isNotEqual property="sPrdtCd" compareValue="SV">
                AND NOT EXISTS (SELECT
                 /*+ NO_UNNEST */
                 COUNT(SV_RSV_NUM) FROM    TB_SV_RSV A WHERE   RSV_NUM = T1.RSV_NUM)
            </isNotEqual>
            <isNotEmpty property="sAppDiv">
                AND APP_DIV = #sAppDiv#
            </isNotEmpty>
            <isEqual property="sLpointDiv" compareValue="use">
                AND LPOINT_USE_POINT > 0
            </isEqual>
            <isEqual property="sLpointDiv" compareValue="save">
                AND LPOINT_SAVE_POINT > 0
            </isEqual>
            <isEqual property="sLpointDiv" compareValue="dont">
                AND LPOINT_USE_POINT = 0
                AND LPOINT_SAVE_POINT = 0
            </isEqual>
        ORDER BY RSV_NUM DESC
    )
    <!-- 
    <![CDATA[
    WHERE ROWNUM <= TO_NUMBER(#lastIndex#)
    ]]>
     -->
)
<![CDATA[
WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
]]>
</select>

<select id="RSV_S_06" resultClass="int">
SELECT COUNT(RSV_NUM) AS CNT
FROM TB_RSV T1
WHERE 1=1
<isNotEmpty property="partnerCode">
    <isNotEqual property="partnerCode" compareValue="tamnao">
        AND T1.PARTNER_CODE = #partnerCode#
    </isNotEqual>
</isNotEmpty>
<isNotEmpty property="sRsvNm">
    AND RSV_NM LIKE '%' || #sRsvNm# || '%'
</isNotEmpty>
<isNotEmpty property="sUseNm">
    AND USE_NM LIKE '%' || #sUseNm# || '%'
</isNotEmpty>
<isNotEmpty property="sRsvNum">
    AND RSV_NUM = #sRsvNum#
</isNotEmpty>
<isNotEmpty property="sRsvTelnum">
    AND REPLACE(RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
</isNotEmpty>
<isNotEmpty property="sUseTelnum">
    AND REPLACE(USE_TELNUM, '-', '') LIKE '%'||REPLACE(#sUseTelnum#, '-', '')||'%'
</isNotEmpty>
<isNotEmpty property="sRsvStatusCd">
    <isNotEqual property="sRsvStatusCd" compareValue="RS13">
        AND RSV_NUM IN (
        <isNotEqual property="sPrdtCd" compareValue="SV">
            SELECT RSV_NUM
            FROM TB_AD_RSV
            WHERE RSV_STATUS_CD = #sRsvStatusCd#

            UNION ALL

            SELECT RSV_NUM
            FROM TB_RC_RSV
            WHERE RSV_STATUS_CD = #sRsvStatusCd#

            UNION ALL

            SELECT RSV_NUM
            FROM TB_SP_RSV
            WHERE RSV_STATUS_CD = #sRsvStatusCd#
        </isNotEqual>
        <isEqual property="sPrdtCd" compareValue="SV">
            SELECT RSV_NUM
            FROM TB_SV_RSV
            WHERE RSV_STATUS_CD = #sRsvStatusCd#
        </isEqual>
        )
    </isNotEqual>
    <isEqual property="sRsvStatusCd" compareValue="RS13">
        AND RSV_NUM IN (
        <isNotEqual property="sPrdtCd" compareValue="SV">
            SELECT RSV_NUM
            FROM TB_AD_RSV
            WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL

            UNION ALL

            SELECT RSV_NUM
            FROM TB_RC_RSV
            WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL

            UNION ALL

            SELECT RSV_NUM
            FROM TB_SP_RSV
            WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL
        </isNotEqual>
        <isEqual property="sPrdtCd" compareValue="SV">
            SELECT RSV_NUM
            FROM TB_SV_RSV
            WHERE RSV_STATUS_CD = 'RS20' AND REFUND_REQUEST_DTTM IS NOT NULL
        </isEqual>
        )
    </isEqual>
</isNotEmpty>
<isNotEmpty property="userId">
    AND USER_ID = #userId#
</isNotEmpty>
<isNotEmpty property="sAutoCancelViewYn">
    <isEqual property="sAutoCancelViewYn" compareValue="N">
        AND RSV_STATUS_CD NOT IN ('RS99')
    </isEqual>
</isNotEmpty>
<isNotEmpty property="sStartDt">
    <![CDATA[
            AND REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
</isNotEmpty>
<isNotEmpty property="sEndDt">
    <![CDATA[
            AND REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
</isNotEmpty>
<isNotEmpty property="sUsedStartDt">
    <isNotEmpty property="sUsedEndDt">
        AND RSV_NUM IN (
        SELECT RSV_NUM
        FROM TB_AD_RSV
        WHERE USE_DT BETWEEN REPLACE(#sUsedStartDt#, '-', '') AND REPLACE(#sUsedEndDt#, '-', '')

        UNION ALL

        SELECT RSV_NUM
        FROM TB_RC_RSV
        WHERE RENT_START_DT BETWEEN REPLACE(#sUsedStartDt#, '-', '') AND REPLACE(#sUsedEndDt#, '-', '')
           OR RENT_END_DT BETWEEN REPLACE(#sUsedStartDt#, '-', '') AND REPLACE(#sUsedEndDt#, '-', '')

        UNION ALL

        SELECT RSV_NUM
        FROM TB_SP_RSV
        WHERE USE_DTTM BETWEEN TO_DATE(REPLACE(#sUsedStartDt#, '-', '')||'000000', 'YYYYMMDDHH24MISS') AND TO_DATE(REPLACE(#sUsedEndDt#, '-', '')||'235959', 'YYYYMMDDHH24MISS')
        )
    </isNotEmpty>
</isNotEmpty>
<isNotEmpty property="sCorpNm">
    AND RSV_NUM IN (
    <isNotEqual property="sPrdtCd" compareValue="SV">
        SELECT RSV_NUM
        FROM TB_AD_RSV T_AD
        INNER JOIN TB_AD_DFTINF T_ADDFT
        ON T_ADDFT.CORP_ID = T_AD.CORP_ID
        AND T_ADDFT.AD_NM LIKE '%' || #sCorpNm# || '%'

        UNION ALL

        SELECT RSV_NUM
        FROM TB_RC_RSV T_RC
        INNER JOIN TB_CORP T_CORP
        ON T_CORP.CORP_ID = T_RC.CORP_ID
        AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'

        UNION ALL

        SELECT RSV_NUM
        FROM TB_SP_RSV T_SP
        INNER JOIN TB_CORP T_CORP
        ON T_CORP.CORP_ID = T_SP.CORP_ID
        AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
    </isNotEqual>
    <isEqual property="sPrdtCd" compareValue="SV">
        SELECT RSV_NUM
        FROM TB_SV_RSV T_SV
        INNER JOIN TB_CORP T_CORP
        ON T_CORP.CORP_ID = T_SV.CORP_ID
        AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
    </isEqual>
    )
</isNotEmpty>
<isNotEmpty property="sPrdtNm">
    AND RSV_NUM IN (
    <isNotEqual property="sPrdtCd" compareValue="SV">
        SELECT RSV_NUM
        FROM TB_AD_RSV
        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'

        UNION ALL

        SELECT RSV_NUM
        FROM TB_RC_RSV
        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'

        UNION ALL

        SELECT RSV_NUM
        FROM TB_SP_RSV
        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'
    </isNotEqual>
    <isEqual property="sPrdtCd" compareValue="SV">
        SELECT RSV_NUM
        FROM TB_SV_RSV
        WHERE PRDT_NM LIKE '%' || #sPrdtNm# || '%'
    </isEqual>
    )
</isNotEmpty>
<isEqual property="sPrdtCd" compareValue="SV">
    AND EXISTS (SELECT COUNT(SV_RSV_NUM) FROM    TB_SV_RSV A WHERE   RSV_NUM = T1.RSV_NUM)
</isEqual>
<isNotEqual property="sPrdtCd" compareValue="SV">
    AND NOT EXISTS (SELECT COUNT(SV_RSV_NUM) FROM    TB_SV_RSV A WHERE   RSV_NUM = T1.RSV_NUM)
</isNotEqual>
<isNotEmpty property="sAppDiv">
    AND APP_DIV = #sAppDiv#
</isNotEmpty>
<isEqual property="sLpointDiv" compareValue="use">
    AND LPOINT_USE_POINT > 0
</isEqual>
<isEqual property="sLpointDiv" compareValue="save">
    AND LPOINT_SAVE_POINT > 0
</isEqual>
<isEqual property="sLpointDiv" compareValue="dont">
    AND LPOINT_USE_POINT = 0
    AND LPOINT_SAVE_POINT = 0
</isEqual>
</select>

<select id="RSV_S_07" resultMap="RSV_R_07">
SELECT PRDT_CD
     , (SELECT CD_NM
          FROM TB_CD
         WHERE CD_NUM = PRDT_CD
       ) AS PRDT_CD_NM
     , RSV_NUM
     , PRDT_RSV_NUM
     , PRDT_NUM
     , PRDT_NM
     , RSV_STATUS_CD
     , CORP_ID
     , PRDT_INF
     , NML_AMT
     , SALE_AMT
     , DIS_AMT
     , CANCEL_AMT
     , CMSS_AMT
     , DIS_CANCEL_AMT
     , (CASE PRDT_CD WHEN 'AD'
                     THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
                     ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
         END) AS CORP_NM
     , USE_DTTM
	 , PRDT_DIV
	 , USE_ABLE_DTTM
	 , EXPR_END_DT
	 , EXPR_START_DT
	 , CANCEL_REQUEST_DTTM
	 , REFUND_REQUEST_DTTM
	 , CANCEL_CMPL_DTTM
	 , CANCEL_RSN
	 , DLV_CORP_NM
	 , DLV_NUM
	 , BUY_FIX_DTTM
	 , DIRECT_RECV_YN
	 , USER_ID
  FROM (SELECT 'AD' AS PRDT_CD
             , T_AD.RSV_NUM
             , T_AD.AD_RSV_NUM AS PRDT_RSV_NUM
             , T_AD.PRDT_NUM
             , T_AD.PRDT_NM
             , T_AD.RSV_STATUS_CD
             , T_AD.CORP_ID
             , T_AD.PRDT_INF
             , T_AD.NML_AMT
             , T_AD.SALE_AMT
             , T_AD.DIS_AMT
             , T_AD.CANCEL_AMT
		     , T_AD.CMSS_AMT
		     , T_AD.DIS_CANCEL_AMT
		     , NULL AS USE_DTTM
		     , NULL AS PRDT_DIV
		     , NULL AS USE_ABLE_DTTM
		     , NULL AS EXPR_END_DT
		     , NULL AS EXPR_START_DT
		     , T_AD.CANCEL_REQUEST_DTTM
			 , T_AD.REFUND_REQUEST_DTTM
			 , T_AD.CANCEL_CMPL_DTTM
		     , T_AD.CANCEL_RSN
		     , NULL AS DLV_CORP_NM
		     , NULL AS DLV_NUM
		     , NULL AS BUY_FIX_DTTM
		     , NULL AS DIRECT_RECV_YN
		     , USER_ID
          FROM TB_RSV         T_RSV1
         INNER JOIN TB_AD_RSV T_AD
            ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
         WHERE 1=1
          <dynamic prepend="AND T_RSV1.RSV_NUM IN ">
		 	<iterate open="(" close=")" conjunction="," property="sRsvNumList">
		 		#sRsvNumList[]#
		 	</iterate>
		 </dynamic>
		<isNotEmpty property="sRsvStatusCd">
			<isNotEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_AD.RSV_STATUS_CD = #sRsvStatusCd#
			</isNotEqual>
			<isEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_AD.RSV_STATUS_CD = 'RS20'
			AND T_AD.REFUND_REQUEST_DTTM IS NOT NULL
			</isEqual>
        </isNotEmpty>

         UNION ALL

        SELECT (SELECT HRK_CD_NUM
                  FROM TB_CD
                 WHERE CD_NUM = (SELECT CTGR
                                   FROM TB_SP_PRDTINF
                                  WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD
             , T_SP.RSV_NUM
             , T_SP.SP_RSV_NUM AS PRDT_RSV_NUM
             , T_SP.PRDT_NUM
             , T_SP.PRDT_NM
             , T_SP.RSV_STATUS_CD
             , T_SP.CORP_ID
             , T_SP.PRDT_INF
             , T_SP.NML_AMT
             , T_SP.SALE_AMT
             , T_SP.DIS_AMT
             , T_SP.CANCEL_AMT
		     , T_SP.CMSS_AMT
		     , T_SP.DIS_CANCEL_AMT
		     , T_SP.USE_DTTM
		     , T_SP.PRDT_DIV
		     , T_SP.USE_ABLE_DTTM
		     , T_SP.EXPR_END_DT
		     , T_SP.EXPR_START_DT
		     , T_SP.CANCEL_REQUEST_DTTM
			 , T_SP.REFUND_REQUEST_DTTM
			 , T_SP.CANCEL_CMPL_DTTM
		     , T_SP.CANCEL_RSN
		     , NULL AS DLV_CORP_NM
		     , NULL AS DLV_NUM
		     , NULL AS BUY_FIX_DTTM
		     , NULL AS DIRECT_RECV_YN
		     , USER_ID
          FROM TB_RSV         T_RSV2
         INNER JOIN TB_SP_RSV T_SP
            ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
         WHERE 1=1
          <dynamic prepend="AND T_RSV2.RSV_NUM IN ">
		 	<iterate open="(" close=")" conjunction="," property="sRsvNumList">
		 		#sRsvNumList[]#
		 	</iterate>
		 </dynamic>
		<isNotEmpty property="sRsvStatusCd">
			<isNotEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_SP.RSV_STATUS_CD = #sRsvStatusCd#
			</isNotEqual>
			<isEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_SP.RSV_STATUS_CD = 'RS20'
			AND T_SP.REFUND_REQUEST_DTTM IS NOT NULL
			</isEqual>
        </isNotEmpty>

         UNION ALL

        SELECT 'RC' AS PRDT_CD
             , T_RC.RSV_NUM
             , T_RC.RC_RSV_NUM AS PRDT_RSV_NUM
             , T_RC.PRDT_NUM
             , T_RC.PRDT_NM
             , T_RC.RSV_STATUS_CD
             , T_RC.CORP_ID
             , T_RC.PRDT_INF || ' [' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RC.ISR_DIV) ||
             	CASE WHEN T_RC.ISR_DIV='ID10' THEN
					CASE
						WHEN T_RC.ISR_TYPE_DIV='GENL' THEN '-일반자차'
						WHEN T_RC.ISR_TYPE_DIV='LUXY' THEN '-고급자차'
					END
		     	  ELSE ''
		     	END
              || ']' AS PRDT_INF
             , T_RC.NML_AMT
             , T_RC.SALE_AMT
             , T_RC.DIS_AMT
             , T_RC.CANCEL_AMT
		     , T_RC.CMSS_AMT
		     , T_RC.DIS_CANCEL_AMT
		     , NULL AS USE_DTTM
		     , NULL AS PRDT_DIV
		     , NULL AS USE_ABLE_DTTM
		     , NULL AS EXPR_END_DT
		     , NULL AS EXPR_START_DT
		     , T_RC.CANCEL_REQUEST_DTTM
			 , T_RC.REFUND_REQUEST_DTTM
			 , T_RC.CANCEL_CMPL_DTTM
		     , T_RC.CANCEL_RSN
		     , NULL AS DLV_CORP_NM
		     , NULL AS DLV_NUM
		     , NULL AS BUY_FIX_DTTM
		     , NULL AS DIRECT_RECV_YN
		     , USER_ID
          FROM TB_RSV         T_RSV4
         INNER JOIN TB_RC_RSV T_RC
            ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
         WHERE 1=1
          <dynamic prepend="AND T_RSV4.RSV_NUM IN ">
		 	<iterate open="(" close=")" conjunction="," property="sRsvNumList">
		 		#sRsvNumList[]#
		 	</iterate>
		 </dynamic>
		<isNotEmpty property="sRsvStatusCd">
			<isNotEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_RC.RSV_STATUS_CD = #sRsvStatusCd#
			</isNotEqual>
			<isEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_RC.RSV_STATUS_CD = 'RS20'
			AND T_RC.REFUND_REQUEST_DTTM IS NOT NULL
			</isEqual>
        </isNotEmpty>

		 UNION ALL

        SELECT 'SV' AS PRDT_CD
             , T_SV.RSV_NUM
             , T_SV.SV_RSV_NUM AS PRDT_RSV_NUM
             , T_SV.PRDT_NUM
             , T_SV.PRDT_NM
             , T_SV.RSV_STATUS_CD
             , T_SV.CORP_ID
             , T_SV.PRDT_INF
             , T_SV.NML_AMT
             , T_SV.SALE_AMT
             , T_SV.DIS_AMT
             , T_SV.CANCEL_AMT
		     , T_SV.CMSS_AMT
		     , T_SV.DIS_CANCEL_AMT
		     , NULL AS USE_DTTM
		     , NULL AS PRDT_DIV
		     , NULL AS USE_ABLE_DTTM
		     , NULL AS EXPR_END_DT
		     , NULL AS EXPR_START_DT
		     , T_SV.CANCEL_REQUEST_DTTM
			 , T_SV.REFUND_REQUEST_DTTM
			 , T_SV.CANCEL_CMPL_DTTM
		     , T_SV.CANCEL_RSN
		     , T_SV.DLV_CORP_NM
		     , T_SV.DLV_NUM
		     , T_SV.BUY_FIX_DTTM
		     , T_SV.DIRECT_RECV_YN
		     , USER_ID
          FROM TB_RSV         T_RSV5
         INNER JOIN TB_SV_RSV T_SV
            ON T_SV.RSV_NUM = T_RSV5.RSV_NUM
         WHERE 1=1
          <dynamic prepend="AND T_RSV5.RSV_NUM IN ">
		 	<iterate open="(" close=")" conjunction="," property="sRsvNumList">
		 		#sRsvNumList[]#
		 	</iterate>
		 </dynamic>
		<isNotEmpty property="sRsvStatusCd">
			<isNotEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_SV.RSV_STATUS_CD = #sRsvStatusCd#
			</isNotEqual>
			<isEqual property="sRsvStatusCd" compareValue="RS13">
			AND T_SV.RSV_STATUS_CD = 'RS20'
			AND T_SV.REFUND_REQUEST_DTTM IS NOT NULL
			</isEqual>
        </isNotEmpty>
       ) T_RSV
</select>

<!-- 사용자 예약내역 조회 -->
<select id="RSV_S_08" resultMap="RSV_R_05">
SELECT RSV_NUM          /*예약 번호*/
     , RSV_STATUS_CD    /*예약 상태 코드*/
     , USER_ID          /*사용자 아이디*/
     , RSV_NM           /*예약 명*/
     , RSV_EMAIL        /*예약 이메일*/
     , RSV_TELNUM       /*예약 전화번호*/
     , USE_NM           /*사용 명*/
     , USE_EMAIL        /*사용 이메일*/
     , USE_TELNUM       /*사용 전화번호*/
     , PAY_DIV          /*결제 구분*/
     , TOTAL_NML_AMT    /*총 정상 금액*/
     , TOTAL_SALE_AMT   /*총 판매 금액*/
     , TOTAL_PAY_AMT    /*총 결제 금액*/
     , TOTAL_DIS_AMT    /*총 할인 금액*/
     , TOTAL_CANCEL_AMT /*총 취소 금액*/
     , LPOINT_USE_POINT /*LPOINT 사용 포인트*/
     , REG_DTTM         /*등록 일시*/
     , REG_IP           /*등록 아이피*/
     , MOD_DTTM         /*수정 일시*/
     , MOD_IP           /*수정 아이피*/
     , TOTAL_CMSS_AMT   /*총 수수료 금액*/
     , TOTAL_DIS_CANCEL_AMT	/*총 할인 취소 금액*/
     , APP_DIV			/*앱구분*/
    , NVL(USE_POINT,0) AS USE_POINT /* 파트너 포인트 */
  FROM TB_RSV
 WHERE 1=1
 AND USER_ID = #userId#
 <![CDATA[
   AND 1 = (CASE WHEN RSV_STATUS_CD = 'RS00'
                 THEN (CASE WHEN REG_DTTM >= SYSDATE - (#waitingTime# / 60 / 24) THEN 1 ELSE 0 END)
                 ELSE 1
             END)
        ]]>
<isNotEmpty property="rsvNum">
   AND RSV_NUM = #rsvNum#
</isNotEmpty>
<isNotEmpty property="rsvTelnum">
   AND RSV_TELNUM = #rsvTelnum#
</isNotEmpty>
<isNotEmpty property="rsvNm">
   AND RSV_NM = #rsvNm#
</isNotEmpty>
<isEqual property="autoCancelYn" compareValue="N">
<![CDATA[
   AND RSV_STATUS_CD <> 'RS99'
]]>
</isEqual>
 ORDER BY RSV_NUM DESC
</select>


<select id="RSV_S_09" resultMap="RSV_R_09">
SELECT PRDT_CD
     , (SELECT CD_NM
          FROM TB_CD
         WHERE CD_NUM = PRDT_CD
       ) AS PRDT_CD_NM
     , RSV_NUM
     , PRDT_RSV_NUM
     , PRDT_NUM
     , PRDT_NM
     , RSV_STATUS_CD
     , CORP_ID
     , PRDT_INF
     , NML_AMT
     , SALE_AMT
     , DIS_AMT
     , CANCEL_AMT
     , CMSS_AMT
     , DIS_CANCEL_AMT
     , (CASE PRDT_CD WHEN 'AD'
                     THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
                     ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
         END) AS CORP_NM
     , USE_DTTM
     , PRDT_DIV
     , USE_ABLE_DTTM
     , EXPR_END_DT
     , EXPR_START_DT
     , CANCEL_GUIDE
  FROM (SELECT 'AD' AS PRDT_CD
             , T_ADRSV.RSV_NUM
             , T_ADRSV.AD_RSV_NUM AS PRDT_RSV_NUM
             , T_ADRSV.PRDT_NUM
             , T_ADRSV.PRDT_NM
             , T_ADRSV.RSV_STATUS_CD
             , T_ADRSV.CORP_ID
             , T_ADRSV.PRDT_INF
             , T_ADRSV.NML_AMT
             , T_ADRSV.SALE_AMT
             , T_ADRSV.DIS_AMT
             , T_ADRSV.CANCEL_AMT
             , T_ADRSV.CMSS_AMT
             , T_ADRSV.DIS_CANCEL_AMT
             , NULL AS USE_DTTM
             , NULL AS PRDT_DIV
             , NULL AS USE_ABLE_DTTM
             , NULL AS EXPR_END_DT
             , NULL AS EXPR_START_DT
             , CANCEL_GUIDE
          FROM TB_AD_RSV T_ADRSV
         INNER JOIN TB_AD_DFTINF T_AD_DFT
            ON T_AD_DFT.CORP_ID = T_ADRSV.CORP_ID
         WHERE 1=1
         	<isNotEmpty property="prdtRsvNum">
    		     	AND T_ADRSV.AD_RSV_NUM = #prdtRsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvNum">
    		     	AND T_ADRSV.RSV_NUM = #rsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvStatusCd">
    		     	AND T_ADRSV.RSV_STATUS_CD = #rsvStatusCd#
    		</isNotEmpty>

         UNION ALL

        SELECT (SELECT HRK_CD_NUM
                  FROM TB_CD
                 WHERE CD_NUM = (SELECT CTGR
                                   FROM TB_SP_PRDTINF
                                  WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS PRDT_CD
             , T_SPRSV.RSV_NUM
             , T_SPRSV.SP_RSV_NUM AS PRDT_RSV_NUM
             , T_SPRSV.PRDT_NUM
             , T_SPRSV.PRDT_NM
             , T_SPRSV.RSV_STATUS_CD
             , T_SPRSV.CORP_ID
             , T_SPRSV.PRDT_INF
             , T_SPRSV.NML_AMT
             , T_SPRSV.SALE_AMT
             , T_SPRSV.DIS_AMT
             , T_SPRSV.CANCEL_AMT
             , T_SPRSV.CMSS_AMT
             , T_SPRSV.DIS_CANCEL_AMT
             , T_SPRSV.USE_DTTM
             , T_SPRSV.PRDT_DIV
             , T_SPRSV.USE_ABLE_DTTM
             , T_SPRSV.EXPR_END_DT
             , T_SPRSV.EXPR_START_DT
             , CANCEL_GUIDE
          FROM TB_SP_RSV T_SPRSV
         INNER JOIN TB_SP_PRDTINF T_SP_PRDT
            ON T_SP_PRDT.PRDT_NUM = T_SPRSV.PRDT_NUM
         WHERE 1=1
         	<isNotEmpty property="prdtRsvNum">
    		     	AND T_SPRSV.SP_RSV_NUM = #prdtRsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvNum">
    		     	AND T_SPRSV.RSV_NUM = #rsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvStatusCd">
    		     	AND T_SPRSV.RSV_STATUS_CD = #rsvStatusCd#
    		</isNotEmpty>

         UNION ALL

        SELECT 'RC' AS PRDT_CD
             , T_RCRSV.RSV_NUM
             , T_RCRSV.RC_RSV_NUM AS PRDT_RSV_NUM
             , T_RCRSV.PRDT_NUM
             , T_RCRSV.PRDT_NM
             , T_RCRSV.RSV_STATUS_CD
             , T_RCRSV.CORP_ID
             , T_RCRSV.PRDT_INF
             , T_RCRSV.NML_AMT
             , T_RCRSV.SALE_AMT
             , T_RCRSV.DIS_AMT
             , T_RCRSV.CANCEL_AMT
             , T_RCRSV.CMSS_AMT
             , T_RCRSV.DIS_CANCEL_AMT
             , NULL AS USE_DTTM
             , NULL AS PRDT_DIV
             , NULL AS USE_ABLE_DTTM
             , NULL AS EXPR_END_DT
             , NULL AS EXPR_START_DT
             , CANCEL_GUIDE
          FROM TB_RC_RSV T_RCRSV
         INNER JOIN TB_RC_DFTINF T_RC_DFT
            ON T_RC_DFT.CORP_ID = T_RCRSV.CORP_ID
         WHERE 1=1
         	<isNotEmpty property="prdtRsvNum">
    		     	AND T_RCRSV.RC_RSV_NUM = #prdtRsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvNum">
    		     	AND T_RCRSV.RSV_NUM = #rsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvStatusCd">
    		     	AND T_RCRSV.RSV_STATUS_CD = #rsvStatusCd#
    		</isNotEmpty>

    	 UNION ALL

        SELECT 'SV' AS PRDT_CD
             , T_SVRSV.RSV_NUM
             , T_SVRSV.SV_RSV_NUM AS PRDT_RSV_NUM
             , T_SVRSV.PRDT_NUM
             , T_SVRSV.PRDT_NM
             , T_SVRSV.RSV_STATUS_CD
             , T_SVRSV.CORP_ID
             , T_SVRSV.PRDT_INF
             , T_SVRSV.NML_AMT
             , T_SVRSV.SALE_AMT
             , T_SVRSV.DIS_AMT
             , T_SVRSV.CANCEL_AMT
             , T_SVRSV.CMSS_AMT
             , T_SVRSV.DIS_CANCEL_AMT
             , NULL AS USE_DTTM
             , NULL AS PRDT_DIV
             , NULL AS USE_ABLE_DTTM
             , NULL AS EXPR_END_DT
             , NULL AS EXPR_START_DT
             , CANCEL_GUIDE
          FROM TB_SV_RSV T_SVRSV
         INNER JOIN TB_SV_PRDTINF T_SV_PRDT
            ON T_SV_PRDT.PRDT_NUM = T_SVRSV.PRDT_NUM
         WHERE 1=1
         	<isNotEmpty property="prdtRsvNum">
    		     	AND T_SVRSV.SV_RSV_NUM = #prdtRsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvNum">
    		     	AND T_SVRSV.RSV_NUM = #rsvNum#
    		</isNotEmpty>
    		<isNotEmpty property="rsvStatusCd">
    		     	AND T_SVRSV.RSV_STATUS_CD = #rsvStatusCd#
    		</isNotEmpty>
       ) T_RSV
</select>


<select id="RSV_S_10" resultClass="int">
SELECT COUNT(PRDT_RSV_NUM)
FROM (SELECT RSV_NUM
         , PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , (SELECT REG_DTTM FROM TB_RSV WHERE RSV_NUM = T_RSV.RSV_NUM) AS REG_DTTM
      FROM (SELECT RSV_NUM
                 , AD_RSV_NUM AS PRDT_RSV_NUM
                 , PRDT_NUM
                 , PRDT_NM
                 , RSV_STATUS_CD
                 , CORP_ID
              FROM TB_AD_RSV
             WHERE CORP_ID=#sCorpId#
               AND RSV_STATUS_CD = 'RS02'

             UNION ALL

            SELECT RSV_NUM
                 , SP_RSV_NUM AS PRDT_RSV_NUM
                 , PRDT_NUM
                 , PRDT_NM
                 , RSV_STATUS_CD
                 , CORP_ID
              FROM TB_SP_RSV T_SPRSV
             WHERE CORP_ID=#sCorpId#
               AND RSV_STATUS_CD = 'RS02'

             UNION ALL

            SELECT RSV_NUM
                 , SV_RSV_NUM AS PRDT_RSV_NUM
                 , PRDT_NUM
                 , PRDT_NM
                 , RSV_STATUS_CD
                 , CORP_ID
              FROM TB_SV_RSV T_SVRSV
             WHERE CORP_ID=#sCorpId#
               AND RSV_STATUS_CD = 'RS02'

             UNION ALL

            SELECT RSV_NUM
                 , RC_RSV_NUM AS PRDT_RSV_NUM
                 , PRDT_NUM
                 , PRDT_NM
                 , RSV_STATUS_CD
                 , CORP_ID
              FROM TB_RC_RSV
             WHERE CORP_ID=#sCorpId#
               AND RSV_STATUS_CD = 'RS02'
           ) T_RSV
     )
  WHERE TO_CHAR(REG_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE, 'YYYYMMDD')
</select>


<select id="RSV_S_11" resultClass="int">
SELECT COUNT(PRDT_RSV_NUM)
FROM (SELECT RSV_NUM
         , AD_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_AD_RSV
     WHERE CORP_ID=#sCorpId#
     <isNotEmpty property="sRsvStatusCd">
       		AND RSV_STATUS_CD= #sRsvStatusCd#
     </isNotEmpty>

     UNION ALL

    SELECT RSV_NUM
         , SP_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_SP_RSV T_SPRSV
     WHERE CORP_ID=#sCorpId#
     <isNotEmpty property="sRsvStatusCd">
       		AND RSV_STATUS_CD= #sRsvStatusCd#
     </isNotEmpty>

     UNION ALL

    SELECT RSV_NUM
         , SV_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_SV_RSV T_SVRSV
     WHERE CORP_ID=#sCorpId#
     <isNotEmpty property="sRsvStatusCd">
       		AND RSV_STATUS_CD= #sRsvStatusCd#
     </isNotEmpty>

     UNION ALL

    SELECT RSV_NUM
         , RC_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_RC_RSV
     WHERE CORP_ID=#sCorpId#
     <isNotEmpty property="sRsvStatusCd">
       		AND RSV_STATUS_CD= #sRsvStatusCd#
     </isNotEmpty>
   ) T_RSV
</select>


<select id="RSV_S_12" resultClass="int">
SELECT COUNT(PRDT_RSV_NUM)
FROM (SELECT RSV_NUM
         , AD_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_AD_RSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , SP_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_SP_RSV T_SPRSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , SV_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_SV_RSV T_SVRSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , RC_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
      FROM TB_RC_RSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>
   ) T_RSV
</select>


<select id="RSV_S_13" resultClass="long">
SELECT NVL(SUM(SALE_AMT),0)
FROM (SELECT RSV_NUM
         , AD_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_AD_RSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , SP_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_SP_RSV T_SPRSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , SV_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_SV_RSV T_SVRSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , RC_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_RC_RSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>
   ) T_RSV
</select>


<select id="RSV_S_14" resultClass="int">
SELECT NVL(SUM(CANCEL_AMT), 0)
FROM (SELECT RSV_NUM
         , AD_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_AD_RSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , SP_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_SP_RSV T_SPRSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , SV_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_SV_RSV T_SVRSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>

     UNION ALL

    SELECT RSV_NUM
         , RC_RSV_NUM AS PRDT_RSV_NUM
         , PRDT_NUM
         , PRDT_NM
         , RSV_STATUS_CD
         , CORP_ID
         , NVL(SALE_AMT, 0) AS SALE_AMT
         , NVL(CANCEL_AMT, 0) AS CANCEL_AMT
      FROM TB_RC_RSV
     WHERE CORP_ID=#sCorpId#
     <![CDATA[  AND RSV_STATUS_CD<>'RS99' ]]>
   ) T_RSV
</select>

<!-- 환불 요청건 리스트 조회 -->
<select id="RSV_S_15" resultMap="RSV_R_15">
SELECT RN
	, PRDT_CD
    , PRDT_CD_NM
    , RSV_NUM
    , USER_ID
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , CORP_ID
    , CORP_NM
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , USE_DTTM
    , PRDT_DIV
    , USE_ABLE_DTTM
    , RSV_NM
    , RSV_TELNUM
    , REFUND_BANK_CODE
    , REFUND_BANK_NM
    , REFUND_ACC_NUM
    , REFUND_DEPOSITOR
    , REFUND_RSN
    , PAY_DIV
    , REG_DTTM
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
FROM( SELECT ROWNUM AS RN
    ,PRDT_CD
    , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = PRDT_CD) AS PRDT_CD_NM
    , RSV_NUM
    , USER_ID
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , CORP_ID
    , (CASE PRDT_CD
            WHEN 'AD' THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
            ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
        END) AS CORP_NM
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , USE_DTTM
    , PRDT_DIV
    , USE_ABLE_DTTM
    , RSV_NM
    , RSV_TELNUM
    , REFUND_BANK_CODE
    , (SELECT CD_NM FROM TB_CD WHERE HRK_CD_NUM = 'RFAC' AND CD_NUM = REFUND_BANK_CODE) AS REFUND_BANK_NM
    , REFUND_ACC_NUM
    , REFUND_DEPOSITOR
    , REFUND_RSN
    , PAY_DIV
    , REG_DTTM
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
FROM (SELECT 'AD' AS PRDT_CD
        , T_ADRSV.RSV_NUM
        , T_ADRSV.AD_RSV_NUM AS PRDT_RSV_NUM
        , T_ADRSV.PRDT_NUM
        , T_ADRSV.PRDT_NM
        , T_ADRSV.RSV_STATUS_CD
        , T_ADRSV.CORP_ID
        , T_ADRSV.PRDT_INF
        , T_ADRSV.NML_AMT
        , T_ADRSV.SALE_AMT
        , T_ADRSV.DIS_AMT
        , T_ADRSV.CANCEL_AMT
        , T_ADRSV.CMSS_AMT
        , T_ADRSV.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_ADRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_ADRSV.CANCEL_REQUEST_DTTM
        , T_ADRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_AD_RSV T_ADRSV ON T_ADRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
       				AND T_ADRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_ADRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_ADRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_ADRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_ADRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_ADRSV.AD_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>

    UNION ALL

    SELECT (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS PRDT_CD
        , T_SPRSV.RSV_NUM
        , T_SPRSV.SP_RSV_NUM AS PRDT_RSV_NUM
        , T_SPRSV.PRDT_NUM
        , T_SPRSV.PRDT_NM
        , T_SPRSV.RSV_STATUS_CD
        , T_SPRSV.CORP_ID
        , T_SPRSV.PRDT_INF
        , T_SPRSV.NML_AMT
        , T_SPRSV.SALE_AMT
        , T_SPRSV.DIS_AMT
        , T_SPRSV.CANCEL_AMT
        , T_SPRSV.CMSS_AMT
        , T_SPRSV.DIS_CANCEL_AMT
        , T_SPRSV.USE_DTTM
        , T_SPRSV.PRDT_DIV
        , T_SPRSV.USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_SPRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_SPRSV.CANCEL_REQUEST_DTTM
        , T_SPRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_SP_RSV T_SPRSV ON T_SPRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
	       			AND T_SPRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_SPRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_SPRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_SPRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_SPRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_SPRSV.SP_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>

    UNION ALL

    SELECT (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SV_PRDTINF WHERE PRDT_NUM = T_SVRSV.PRDT_NUM)) AS PRDT_CD
        , T_SVRSV.RSV_NUM
        , T_SVRSV.SV_RSV_NUM AS PRDT_RSV_NUM
        , T_SVRSV.PRDT_NUM
        , T_SVRSV.PRDT_NM
        , T_SVRSV.RSV_STATUS_CD
        , T_SVRSV.CORP_ID
        , T_SVRSV.PRDT_INF
        , T_SVRSV.NML_AMT
        , T_SVRSV.SALE_AMT
        , T_SVRSV.DIS_AMT
        , T_SVRSV.CANCEL_AMT
        , T_SVRSV.CMSS_AMT
        , T_SVRSV.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , T_SVRSV.PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_SVRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_SVRSV.CANCEL_REQUEST_DTTM
        , T_SVRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_SV_RSV T_SVRSV ON T_SVRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
					AND T_SVRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_SVRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_SVRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_SVRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_SVRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_SVRSV.SV_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>

    UNION ALL

    SELECT 'RC' AS PRDT_CD
        , T_RCRSV.RSV_NUM
        , T_RCRSV.RC_RSV_NUM AS PRDT_RSV_NUM
        , T_RCRSV.PRDT_NUM
        , T_RCRSV.PRDT_NM
        , T_RCRSV.RSV_STATUS_CD
        , T_RCRSV.CORP_ID
        , T_RCRSV.PRDT_INF
        , T_RCRSV.NML_AMT
        , T_RCRSV.SALE_AMT
        , T_RCRSV.DIS_AMT
        , T_RCRSV.CANCEL_AMT
        , T_RCRSV.CMSS_AMT
        , T_RCRSV.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_RCRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_RCRSV.CANCEL_REQUEST_DTTM
        , T_RCRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_RC_RSV T_RCRSV ON T_RCRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
       				AND T_RCRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_RCRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_RCRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_RCRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_RCRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_RCRSV.RC_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>
		ORDER BY CANCEL_REQUEST_DTTM DESC
	) T_RSV
) WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
</select>

<select id="RSV_S_32"  resultClass="int">
SELECT COUNT(*)
FROM( SELECT PRDT_CD
    , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = PRDT_CD) AS PRDT_CD_NM
    , RSV_NUM
    , USER_ID
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , CORP_ID
    , (CASE PRDT_CD
            WHEN 'AD' THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
            ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
        END) AS CORP_NM
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , USE_DTTM
    , PRDT_DIV
    , USE_ABLE_DTTM
    , RSV_NM
    , RSV_TELNUM
    , REFUND_BANK_CODE
    , (SELECT CD_NM FROM TB_CD WHERE HRK_CD_NUM = 'RFAC' AND CD_NUM = REFUND_BANK_CODE) AS REFUND_BANK_NM
    , REFUND_ACC_NUM
    , REFUND_DEPOSITOR
    , REFUND_RSN
    , PAY_DIV
    , REG_DTTM
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
FROM (SELECT 'AD' AS PRDT_CD
        , T_ADRSV.RSV_NUM
        , T_ADRSV.AD_RSV_NUM AS PRDT_RSV_NUM
        , T_ADRSV.PRDT_NUM
        , T_ADRSV.PRDT_NM
        , T_ADRSV.RSV_STATUS_CD
        , T_ADRSV.CORP_ID
        , T_ADRSV.PRDT_INF
        , T_ADRSV.NML_AMT
        , T_ADRSV.SALE_AMT
        , T_ADRSV.DIS_AMT
        , T_ADRSV.CANCEL_AMT
        , T_ADRSV.CMSS_AMT
        , T_ADRSV.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_ADRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_ADRSV.CANCEL_REQUEST_DTTM
        , T_ADRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_AD_RSV T_ADRSV ON T_ADRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
       				AND T_ADRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_ADRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_ADRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_ADRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_ADRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_ADRSV.AD_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>

    UNION ALL

    SELECT
        (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS PRDT_CD
        , T_SPRSV.RSV_NUM
        , T_SPRSV.SP_RSV_NUM AS PRDT_RSV_NUM
        , T_SPRSV.PRDT_NUM
        , T_SPRSV.PRDT_NM
        , T_SPRSV.RSV_STATUS_CD
        , T_SPRSV.CORP_ID
        , T_SPRSV.PRDT_INF
        , T_SPRSV.NML_AMT
        , T_SPRSV.SALE_AMT
        , T_SPRSV.DIS_AMT
        , T_SPRSV.CANCEL_AMT
        , T_SPRSV.CMSS_AMT
        , T_SPRSV.DIS_CANCEL_AMT
        , T_SPRSV.USE_DTTM
        , T_SPRSV.PRDT_DIV
        , T_SPRSV.USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_SPRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_SPRSV.CANCEL_REQUEST_DTTM
        , T_SPRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_SP_RSV T_SPRSV ON T_SPRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
	       			AND T_SPRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_SPRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_SPRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_SPRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_SPRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_SPRSV.SP_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>

    UNION ALL

    SELECT
        (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SV_PRDTINF WHERE PRDT_NUM = T_SVRSV.PRDT_NUM)) AS PRDT_CD
        , T_SVRSV.RSV_NUM
        , T_SVRSV.SV_RSV_NUM AS PRDT_RSV_NUM
        , T_SVRSV.PRDT_NUM
        , T_SVRSV.PRDT_NM
        , T_SVRSV.RSV_STATUS_CD
        , T_SVRSV.CORP_ID
        , T_SVRSV.PRDT_INF
        , T_SVRSV.NML_AMT
        , T_SVRSV.SALE_AMT
        , T_SVRSV.DIS_AMT
        , T_SVRSV.CANCEL_AMT
        , T_SVRSV.CMSS_AMT
        , T_SVRSV.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , T_SVRSV.PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_SVRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_SVRSV.CANCEL_REQUEST_DTTM
        , T_SVRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_SV_RSV T_SVRSV ON T_SVRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
					AND T_SVRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_SVRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_SVRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_SVRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_SVRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_SVRSV.SV_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>

    UNION ALL

    SELECT 'RC' AS PRDT_CD
        , T_RCRSV.RSV_NUM
        , T_RCRSV.RC_RSV_NUM AS PRDT_RSV_NUM
        , T_RCRSV.PRDT_NUM
        , T_RCRSV.PRDT_NM
        , T_RCRSV.RSV_STATUS_CD
        , T_RCRSV.CORP_ID
        , T_RCRSV.PRDT_INF
        , T_RCRSV.NML_AMT
        , T_RCRSV.SALE_AMT
        , T_RCRSV.DIS_AMT
        , T_RCRSV.CANCEL_AMT
        , T_RCRSV.CMSS_AMT
        , T_RCRSV.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , T_RSV.RSV_NM
        , T_RSV.USER_ID
        , T_RSV.RSV_TELNUM
        , T_RSV.REFUND_BANK_CODE
        , T_RSV.REFUND_ACC_NUM
        , T_RSV.REFUND_DEPOSITOR
        , T_RCRSV.REFUND_RSN
        , T_RSV.PAY_DIV
        , T_RSV.REG_DTTM
        , T_RCRSV.CANCEL_REQUEST_DTTM
        , T_RCRSV.REFUND_REQUEST_DTTM
    FROM TB_RSV T_RSV
        INNER JOIN TB_RC_RSV T_RCRSV ON T_RCRSV.RSV_NUM = T_RSV.RSV_NUM
	        <isNotEmpty property="sRsvDiv">
	       		<isEqual property="sRsvDiv" compareValue="sRsvDivAll">
       				AND T_RCRSV.RSV_STATUS_CD IN ('RS11', 'RS12', 'RS20') AND T_RCRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv1">
       				AND T_RCRSV.RSV_STATUS_CD IN ('RS11', 'RS12')
	       		</isEqual>
	       		<isEqual property="sRsvDiv" compareValue="sRsvDiv2">
		       		AND T_RCRSV.RSV_STATUS_CD = 'RS20'
		       		AND T_RCRSV.REFUND_REQUEST_DTTM IS NOT NULL
	       		</isEqual>
	        </isNotEmpty>
            <isNotEmpty property="sPrdtRsvNum">
                AND T_RCRSV.RC_RSV_NUM = #sPrdtRsvNum#
            </isNotEmpty>
    WHERE 1=1
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sPayDivs">
            <iterate prepend="AND T_RSV.PAY_DIV IN " open="(" close=")" conjunction="," property="sPayDivs">
                #sPayDivs[]#
            </iterate>
        </isNotEmpty>
	) T_RSV
)
</select>

<select id="RSV_S_16" resultClass="int">
SELECT COUNT(RSV_NUM) FROM TB_RSV
WHERE 1=1
  AND RSV_STATUS_CD=#rsvStatusCd#
  AND REG_DTTM BETWEEN TRUNC(SYSDATE) AND TRUNC(SYSDATE) + 1
</select>

<!-- 상품별 예약조회 -->
<select id="RSV_S_17" resultMap="RSV_R_17">
SELECT PRDT_CD
	     , (SELECT CD_NM
	          FROM TB_CD
	         WHERE CD_NUM = PRDT_CD
	       ) AS PRDT_CD_NM
	     , RSV_NUM
	     , PRDT_RSV_NUM
	     , PRDT_NUM
	     , PRDT_NM
	     , RSV_STATUS_CD
	     , CORP_ID
	     , PRDT_INF
	     , NML_AMT
	     , SALE_AMT
	     , DIS_AMT
	     , CANCEL_AMT
	     , CMSS_AMT
	     , DIS_CANCEL_AMT
	     , CORP_NM
	     , USE_DTTM
		 , PRDT_DIV
		 , USE_ABLE_DTTM
		 , EXPR_END_DT
		 , EXPR_START_DT
	     , ADJ_DT
	     , USER_ID          /*사용자 아이디*/
	     , RSV_NM           /*예약 명*/
	     , RSV_EMAIL        /*예약 이메일*/
	     , RSV_TELNUM       /*예약 전화번호*/
	     , USE_NM           /*사용 명*/
	     , USE_EMAIL        /*사용 이메일*/
	     , USE_TELNUM       /*사용 전화번호*/
	     , PAY_DIV          /*결제 구분*/
	     , REG_DTTM
	     , CANCEL_REQUEST_DTTM
		 , REFUND_REQUEST_DTTM
		 , CANCEL_CMPL_DTTM
		 , CANCEL_RSN
		 , EVNT_CD
	  FROM (SELECT ROWNUM AS RN
			     , PRDT_CD
			     , (SELECT CD_NM
			          FROM TB_CD
			         WHERE CD_NUM = PRDT_CD
			       ) AS PRDT_CD_NM
			     , RSV_NUM
			     , PRDT_RSV_NUM
			     , PRDT_NUM
			     , PRDT_NM
			     , RSV_STATUS_CD
			     , CORP_ID
			     , PRDT_INF
			     , NML_AMT
			     , SALE_AMT
			     , DIS_AMT
			     , CANCEL_AMT
			     , CMSS_AMT
			     , DIS_CANCEL_AMT
			     , CORP_NM
			     , USE_DTTM
				 , PRDT_DIV
				 , USE_ABLE_DTTM
				 , EXPR_END_DT
				 , EXPR_START_DT
			     , ADJ_DT
			     , USER_ID          /*사용자 아이디*/
			     , RSV_NM           /*예약 명*/
			     , RSV_EMAIL        /*예약 이메일*/
			     , RSV_TELNUM       /*예약 전화번호*/
			     , USE_NM           /*사용 명*/
			     , USE_EMAIL        /*사용 이메일*/
			     , USE_TELNUM       /*사용 전화번호*/
			     , PAY_DIV          /*결제 구분*/
			     , REG_DTTM
			     , CANCEL_REQUEST_DTTM
		     	 , REFUND_REQUEST_DTTM
		     	 , CANCEL_CMPL_DTTM
		     	 , CANCEL_RSN
		     	 , EVNT_CD
			  FROM (SELECT
                        PRDT_CD
					     , (SELECT CD_NM
					          FROM TB_CD
					         WHERE CD_NUM = PRDT_CD
					       ) AS PRDT_CD_NM
					     , RSV_NUM
					     , PRDT_RSV_NUM
					     , PRDT_NUM
					     , PRDT_NM
					     , RSV_STATUS_CD
					     , CORP_ID
					     , PRDT_INF
					     , NML_AMT
					     , SALE_AMT
					     , DIS_AMT
					     , CANCEL_AMT
					     , CMSS_AMT
					     , DIS_CANCEL_AMT
					     , CORP_NM
					     , USE_DTTM
						 , PRDT_DIV
						 , USE_ABLE_DTTM
						 , EXPR_END_DT
						 , EXPR_START_DT
					     , ADJ_DT
					     , USER_ID          /*사용자 아이디*/
					     , RSV_NM           /*예약 명*/
					     , RSV_EMAIL        /*예약 이메일*/
					     , RSV_TELNUM       /*예약 전화번호*/
					     , USE_NM           /*사용 명*/
					     , USE_EMAIL        /*사용 이메일*/
					     , USE_TELNUM       /*사용 전화번호*/
					     , PAY_DIV          /*결제 구분*/
					     , REG_DTTM
					     , CANCEL_REQUEST_DTTM
					     , REFUND_REQUEST_DTTM
					     , CANCEL_CMPL_DTTM
					     , CANCEL_RSN
					     , EVNT_CD
					  FROM (SELECT /*+ INDEX_DESC(T_RSV1 IDX_RSV_05)  */ 'AD' AS PRDT_CD
					             , T_AD.RSV_NUM
					             , T_AD.AD_RSV_NUM AS PRDT_RSV_NUM
					             , T_AD.PRDT_NUM
					             , T_AD.PRDT_NM
					             , T_AD.RSV_STATUS_CD
					             , T_AD.CORP_ID
					             , T_AD.PRDT_INF
					             , T_AD.NML_AMT
					             , T_AD.SALE_AMT
					             , T_AD.DIS_AMT
					             , T_AD.CANCEL_AMT
							     , T_AD.CMSS_AMT
							     , T_AD.DIS_CANCEL_AMT
							     , NULL AS USE_DTTM
							     , NULL AS PRDT_DIV
							     , NULL AS USE_ABLE_DTTM
							     , NULL AS EXPR_END_DT
							     , NULL AS EXPR_START_DT
					             , T_AD.ADJ_DT
					             , T_ADDFT.AD_NM AS CORP_NM
					             , T_RSV1.USER_ID          /*사용자 아이디*/
					             , T_RSV1.RSV_NM           /*예약 명*/
					             , T_RSV1.RSV_EMAIL        /*예약 이메일*/
					             , T_RSV1.RSV_TELNUM       /*예약 전화번호*/
					             , T_RSV1.USE_NM           /*사용 명*/
					             , T_RSV1.USE_EMAIL        /*사용 이메일*/
					             , T_RSV1.USE_TELNUM       /*사용 전화번호*/
					             , T_RSV1.PAY_DIV          /*결제 구분*/
					             , T_RSV1.REG_DTTM
					             , T_AD.CANCEL_REQUEST_DTTM
							     , T_AD.REFUND_REQUEST_DTTM
							     , T_AD.CANCEL_CMPL_DTTM
							     , T_AD.CANCEL_RSN
							     , T_RSV1.EVNT_CD			/*이벤트 코드*/
					          FROM TB_RSV         T_RSV1
					         INNER JOIN TB_AD_RSV T_AD
					            ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
					         INNER JOIN TB_AD_DFTINF T_ADDFT
					            ON T_ADDFT.CORP_ID = T_AD.CORP_ID
					        <isNotEmpty property="sCorpNm">
					           AND T_ADDFT.AD_NM LIKE '%'||#sCorpNm#||'%'
					        </isNotEmpty>
					         WHERE 1=1
					         AND ROWNUM <![CDATA[<=]]> TO_NUMBER(#lastIndex#)
					         <isNotEmpty property="sRsvCorpId">
					           AND T_RSV1.RSV_CORP_ID = #sRsvCorpId#
					        </isNotEmpty>
					        <isNotEmpty property="sEvntCd">
					           AND T_RSV1.EVNT_CD = #sEvntCd#
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtCd">
					                <isNotEqual property="sPrdtCd" compareValue="AD">
					           AND 1=0
					           		</isNotEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sRsvNm">
					           AND T_RSV1.RSV_NM = #sRsvNm#
					        </isNotEmpty>
					        <isNotEmpty property="sUseNm">
					           AND T_RSV1.USE_NM = #sUseNm#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvNum">
					           AND T_RSV1.RSV_NUM = #sRsvNum#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvStatusCd">
					           		<isNotEqual property="sRsvStatusCd" compareValue="RS13">
					           AND T_AD.RSV_STATUS_CD = #sRsvStatusCd#
                                    </isNotEqual>
                                    <isEqual property="sRsvStatusCd" compareValue="RS13">
                               AND T_AD.RSV_STATUS_CD = 'RS20'
                               AND T_AD.REFUND_REQUEST_DTTM IS NOT NULL
                                    </isEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sRsvTelnum">
					           AND REPLACE(T_RSV1.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
					         </isNotEmpty>
					         <isNotEmpty property="sAutoCancelViewYn">
					                <isEqual property="sAutoCancelViewYn" compareValue="N">
					           AND T_RSV1.RSV_STATUS_CD NOT IN ('RS99')
					                </isEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtNm">
					           AND T_AD.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
					         </isNotEmpty>
					         <isNotEmpty property="sStartDt">
					            <![CDATA[
					           AND T_RSV1.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
					            ]]>
					         </isNotEmpty>
					        <isNotEmpty property="sEndDt">
					            <![CDATA[
					           AND T_RSV1.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
					            ]]>
					         </isNotEmpty>
					         <isNotEmpty property="sGuestYn">
					        		<isEqual property="sGuestYn" compareValue="Y">
					        			AND T_RSV1.USER_ID = 'GUEST'
					        		</isEqual>
					        		<isEqual property="sGuestYn" compareValue="N">
					        			<![CDATA[
					        			AND T_RSV1.USER_ID <> 'GUEST'
					        			]]>
					        		</isEqual>
					         </isNotEmpty>

					         UNION ALL

					        SELECT /*+ INDEX_DESC(T_RSV2 IDX_RSV_05) */ (SELECT HRK_CD_NUM
					                  FROM TB_CD
					                 WHERE CD_NUM = (SELECT CTGR
					                                   FROM TB_SP_PRDTINF
					                                  WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD
					             , T_SP.RSV_NUM
					             , T_SP.SP_RSV_NUM AS PRDT_RSV_NUM
					             , T_SP.PRDT_NUM
					             , T_SP.PRDT_NM
					             , T_SP.RSV_STATUS_CD
					             , T_SP.CORP_ID
					             , T_SP.PRDT_INF
					             , T_SP.NML_AMT
					             , T_SP.SALE_AMT
					             , T_SP.DIS_AMT
					             , T_SP.CANCEL_AMT
							     , T_SP.CMSS_AMT
							     , T_SP.DIS_CANCEL_AMT
							     , T_SP.USE_DTTM
							     , T_SP.PRDT_DIV
							     , T_SP.USE_ABLE_DTTM
							     , T_SP.EXPR_END_DT
							     , T_SP.EXPR_START_DT
					             , T_SP.ADJ_DT
					             , T_CORP.CORP_NM AS CORP_NM
					             , T_RSV2.USER_ID          /*사용자 아이디*/
					             , T_RSV2.RSV_NM           /*예약 명*/
					             , T_RSV2.RSV_EMAIL        /*예약 이메일*/
					             , T_RSV2.RSV_TELNUM       /*예약 전화번호*/
					             , T_RSV2.USE_NM           /*사용 명*/
					             , T_RSV2.USE_EMAIL        /*사용 이메일*/
					             , T_RSV2.USE_TELNUM       /*사용 전화번호*/
					             , T_RSV2.PAY_DIV          /*결제 구분*/
					             , T_RSV2.REG_DTTM
					             , T_SP.CANCEL_REQUEST_DTTM
							     , T_SP.REFUND_REQUEST_DTTM
							     , T_SP.CANCEL_CMPL_DTTM
							     , T_SP.CANCEL_RSN
							     , T_RSV2.EVNT_CD			/*이벤트 코드*/
					          FROM TB_RSV         T_RSV2
					         INNER JOIN TB_SP_RSV T_SP
					            ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
					         INNER JOIN TB_CORP T_CORP
					            ON T_CORP.CORP_ID = T_SP.CORP_ID
					        <isNotEmpty property="sCorpNm">
					           AND T_CORP.CORP_NM LIKE '%'||#sCorpNm#||'%'
					        </isNotEmpty>
					         WHERE 1=1
					           AND ROWNUM <![CDATA[<=]]> TO_NUMBER(#lastIndex#)
					         <isNotEmpty property="sRsvCorpId">
					           AND T_RSV2.RSV_CORP_ID = #sRsvCorpId#
					        </isNotEmpty>
					        <isNotEmpty property="sEvntCd">
					           AND T_RSV2.EVNT_CD = #sEvntCd#
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtCd">
					           AND (SELECT HRK_CD_NUM
					                  FROM TB_CD
					                 WHERE CD_NUM = (SELECT CTGR
					                                   FROM TB_SP_PRDTINF
					                                  WHERE PRDT_NUM = T_SP.PRDT_NUM)) = #sPrdtCd#
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtSubCd">
					           AND (SELECT CTGR
	                                    FROM TB_SP_PRDTINF
	                                  WHERE PRDT_NUM = T_SP.PRDT_NUM) = #sPrdtSubCd#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvNm">
					           AND T_RSV2.RSV_NM = #sRsvNm#
					        </isNotEmpty>
					        <isNotEmpty property="sUseNm">
					           AND T_RSV2.USE_NM = #sUseNm#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvNum">
					           AND T_RSV2.RSV_NUM = #sRsvNum#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvStatusCd">
					           		<isNotEqual property="sRsvStatusCd" compareValue="RS13">
					           AND T_SP.RSV_STATUS_CD = #sRsvStatusCd#
                                    </isNotEqual>
                                    <isEqual property="sRsvStatusCd" compareValue="RS13">
                               AND T_SP.RSV_STATUS_CD = 'RS20'
                               AND T_SP.REFUND_REQUEST_DTTM IS NOT NULL
                                    </isEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sRsvTelnum">
					           AND REPLACE(T_RSV2.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
					         </isNotEmpty>
					         <isNotEmpty property="sAutoCancelViewYn">
					                <isEqual property="sAutoCancelViewYn" compareValue="N">
					           AND T_RSV2.RSV_STATUS_CD NOT IN ('RS99')
					                </isEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtNm">
					           AND T_SP.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
					         </isNotEmpty>
					         <isNotEmpty property="sStartDt">
					            <![CDATA[
					           AND T_RSV2.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
					            ]]>
					         </isNotEmpty>
					        <isNotEmpty property="sEndDt">
					            <![CDATA[
					           AND T_RSV2.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
					            ]]>
					         </isNotEmpty>
					         <isNotEmpty property="sGuestYn">
					        		<isEqual property="sGuestYn" compareValue="Y">
					        			AND T_RSV2.USER_ID = 'GUEST'
					        		</isEqual>
					        		<isEqual property="sGuestYn" compareValue="N">
					        			<![CDATA[
					        			AND T_RSV2.USER_ID <> 'GUEST'
					        			]]>
					        		</isEqual>
					         </isNotEmpty>

					         UNION ALL

					        SELECT /*+ INDEX_DESC(T_RSV4 IDX_RSV_05) */ 'RC' AS PRDT_CD
					             , T_RC.RSV_NUM
					             , T_RC.RC_RSV_NUM AS PRDT_RSV_NUM
					             , T_RC.PRDT_NUM
					             , T_RC.PRDT_NM || ' / ' ||
					             	CASE
                                      WHEN T_RC.ISR_DIV='ID00' THEN '자차자율'
                                      WHEN T_RC.ISR_DIV='ID10' THEN
                                        CASE
                                          WHEN T_RC.ISR_TYPE_DIV='GENL' THEN '자차포함(일반자차)'
                                          WHEN T_RC.ISR_TYPE_DIV='LUXY' THEN '자차포함(고급자차)'
                                          ELSE '자차포함'
                                        END
                                      WHEN T_RC.ISR_DIV='ID20' THEN '자차필수'
                                    END AS PRDT_NM
					             , T_RC.RSV_STATUS_CD
					             , T_RC.CORP_ID
					             , T_RC.PRDT_INF
					             , T_RC.NML_AMT
					             , T_RC.SALE_AMT
					             , T_RC.DIS_AMT
					             , T_RC.CANCEL_AMT
							     , T_RC.CMSS_AMT
							     , T_RC.DIS_CANCEL_AMT
							     , NULL AS USE_DTTM
							     , NULL AS PRDT_DIV
							     , NULL AS USE_ABLE_DTTM
							     , NULL AS EXPR_END_DT
							     , NULL AS EXPR_START_DT
					             , T_RC.ADJ_DT
					             , T_CORP.CORP_NM AS CORP_NM
					             , T_RSV4.USER_ID          /*사용자 아이디*/
					             , T_RSV4.RSV_NM           /*예약 명*/
					             , T_RSV4.RSV_EMAIL        /*예약 이메일*/
					             , T_RSV4.RSV_TELNUM       /*예약 전화번호*/
					             , T_RSV4.USE_NM           /*사용 명*/
					             , T_RSV4.USE_EMAIL        /*사용 이메일*/
					             , T_RSV4.USE_TELNUM       /*사용 전화번호*/
					             , T_RSV4.PAY_DIV          /*결제 구분*/
					             , T_RSV4.REG_DTTM
					             , T_RC.CANCEL_REQUEST_DTTM
							     , T_RC.REFUND_REQUEST_DTTM
							     , T_RC.CANCEL_CMPL_DTTM
							     , T_RC.CANCEL_RSN
							     , T_RSV4.EVNT_CD			/*이벤트 코드*/
					          FROM TB_RSV         T_RSV4
					         INNER JOIN TB_RC_RSV T_RC
					            ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
					         INNER JOIN TB_CORP T_CORP
					            ON T_CORP.CORP_ID = T_RC.CORP_ID
                             INNER JOIN TB_RC_PRDTINF T_RC_PRDT
                                ON T_RC.PRDT_NUM = T_RC_PRDT.PRDT_NUM
                            <isNotEmpty property="sCorpNm">
					           AND T_CORP.CORP_NM LIKE '%'||#sCorpNm#||'%'
					        </isNotEmpty>
					         WHERE 1=1
					         AND ROWNUM <![CDATA[<=]]> TO_NUMBER(#lastIndex#)
					        <isNotEmpty property="sRsvCorpId">
					           AND T_RSV4.RSV_CORP_ID = #sRsvCorpId#
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtCd">
					                <isNotEqual property="sPrdtCd" compareValue="RC">
					           AND 1=0
					           		</isNotEqual>
					        </isNotEmpty>
                            <isNotEmpty property="sPrdtSubCd">
                                    AND T_RC_PRDT.CAR_DIV = #sPrdtSubCd#
                            </isNotEmpty>
					        <isNotEmpty property="sRsvNm">
					           AND T_RSV4.RSV_NM = #sRsvNm#
					        </isNotEmpty>
					        <isNotEmpty property="sUseNm">
					           AND T_RSV4.USE_NM = #sUseNm#
					        </isNotEmpty>
					        <isNotEmpty property="sEvntCd">
					           AND T_RSV4.EVNT_CD = #sEvntCd#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvNum">
					           AND T_RSV4.RSV_NUM = #sRsvNum#
					        </isNotEmpty>
					        <isNotEmpty property="sRsvStatusCd">
					            	<isNotEqual property="sRsvStatusCd" compareValue="RS13">
					           AND T_RC.RSV_STATUS_CD = #sRsvStatusCd#
                                    </isNotEqual>
                                    <isEqual property="sRsvStatusCd" compareValue="RS13">
                               AND T_RC.RSV_STATUS_CD = 'RS20'
                               AND T_RC.REFUND_REQUEST_DTTM IS NOT NULL
                                    </isEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sRsvTelnum">
					           AND REPLACE(T_RSV4.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
					         </isNotEmpty>
					         <isNotEmpty property="sAutoCancelViewYn">
					                <isEqual property="sAutoCancelViewYn" compareValue="N">
					           AND T_RSV4.RSV_STATUS_CD NOT IN ('RS99')
					                </isEqual>
					        </isNotEmpty>
					        <isNotEmpty property="sPrdtNm">
					           AND T_RC.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
					         </isNotEmpty>
					        <isNotEmpty property="sStartDt">
					            <![CDATA[
					           AND T_RSV4.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
					            ]]>
					         </isNotEmpty>
					        <isNotEmpty property="sEndDt">
					            <![CDATA[
					           AND T_RSV4.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
					            ]]>
					         </isNotEmpty>
					         <isNotEmpty property="sGuestYn">
					        		<isEqual property="sGuestYn" compareValue="Y">
					        			AND T_RSV4.USER_ID = 'GUEST'
					        		</isEqual>
					        		<isEqual property="sGuestYn" compareValue="N">
					        			<![CDATA[
					        			AND T_RSV4.USER_ID <> 'GUEST'
					        			]]>
					        		</isEqual>
					         </isNotEmpty>
					       ) T_RSV
					 ORDER BY RSV_NUM DESC
					 )
<![CDATA[
		  WHERE ROWNUM <= TO_NUMBER(#lastIndex#)
		  )
 WHERE RN >= TO_NUMBER(#firstIndex#)+1
]]>
</select>

<!-- 상품별 예약 건수 -->
<select id="RSV_S_18" resultClass="int">
SELECT COUNT(PRDT_RSV_NUM) AS CNT
  FROM (SELECT 'AD' AS PRDT_CD
             , T_AD.RSV_NUM
             , T_AD.AD_RSV_NUM AS PRDT_RSV_NUM
          FROM TB_RSV         T_RSV1
         INNER JOIN TB_AD_RSV T_AD
            ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
         INNER JOIN TB_AD_DFTINF T_ADDFT
            ON T_ADDFT.CORP_ID = T_AD.CORP_ID
         <isNotEmpty property="sCorpNm">
           AND T_ADDFT.AD_NM LIKE '%'||#sCorpNm#||'%'
        </isNotEmpty>
         WHERE 1=1
        <isNotEmpty property="sRsvCorpId">
           AND T_RSV1.RSV_CORP_ID = #sRsvCorpId#
        </isNotEmpty>
        <isNotEmpty property="sPrdtCd">
                <isNotEqual property="sPrdtCd" compareValue="AD">
           AND 1=0
           		</isNotEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
           AND T_RSV1.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sUseNm">
           AND T_RSV1.USE_NM = #sUseNm#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
           AND T_RSV1.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
           AND T_RSV1.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            	<isNotEqual property="sRsvStatusCd" compareValue="RS13">
           AND T_AD.RSV_STATUS_CD = #sRsvStatusCd#
				</isNotEqual>
				<isEqual property="sRsvStatusCd" compareValue="RS13">
		   AND T_AD.RSV_STATUS_CD = 'RS20'
		   AND T_AD.REFUND_REQUEST_DTTM IS NOT NULL
				</isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
           AND REPLACE(T_RSV1.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
         </isNotEmpty>
         <isNotEmpty property="sAutoCancelViewYn">
                <isEqual property="sAutoCancelViewYn" compareValue="N">
           AND T_RSV1.RSV_STATUS_CD NOT IN ('RS99')
                </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sPrdtNm">
           AND T_AD.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
         </isNotEmpty>
         <isNotEmpty property="sStartDt">
            <![CDATA[
           AND T_RSV1.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
           AND T_RSV1.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
         <isNotEmpty property="sGuestYn">
        		<isEqual property="sGuestYn" compareValue="Y">
        			AND T_RSV1.USER_ID = 'GUEST'
        		</isEqual>
        		<isEqual property="sGuestYn" compareValue="N">
        			<![CDATA[
        			AND T_RSV1.USER_ID <> 'GUEST'
        			]]>
        		</isEqual>
         </isNotEmpty>
         UNION ALL
        SELECT (SELECT HRK_CD_NUM
                  FROM TB_CD
                 WHERE CD_NUM = (SELECT CTGR
                                   FROM TB_SP_PRDTINF
                                  WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD
             , T_SP.RSV_NUM
             , T_SP.SP_RSV_NUM AS PRDT_RSV_NUM
          FROM TB_RSV         T_RSV2
         INNER JOIN TB_SP_RSV T_SP
            ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID = T_SP.CORP_ID
         <isNotEmpty property="sCorpNm">
           AND T_CORP.CORP_NM LIKE '%'||#sCorpNm#||'%'
        </isNotEmpty>
         WHERE 1=1
        <isNotEmpty property="sRsvCorpId">
           AND T_RSV2.RSV_CORP_ID = #sRsvCorpId#
        </isNotEmpty>
        <isNotEmpty property="sPrdtCd">
           AND (SELECT HRK_CD_NUM
                  FROM TB_CD
                 WHERE CD_NUM = (SELECT CTGR
                                   FROM TB_SP_PRDTINF
                                  WHERE PRDT_NUM = T_SP.PRDT_NUM)) = #sPrdtCd#
        </isNotEmpty>
        <isNotEmpty property="sPrdtSubCd">
           AND (SELECT CTGR
                                FROM TB_SP_PRDTINF
                              WHERE PRDT_NUM = T_SP.PRDT_NUM) = #sPrdtSubCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
           AND T_RSV2.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sUseNm">
           AND T_RSV2.USE_NM = #sUseNm#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
           AND T_RSV2.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
           AND T_RSV2.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            	<isNotEqual property="sRsvStatusCd" compareValue="RS13">
           AND T_SP.RSV_STATUS_CD = #sRsvStatusCd#
				</isNotEqual>
				<isEqual property="sRsvStatusCd" compareValue="RS13">
		   AND T_SP.RSV_STATUS_CD = 'RS20'
		   AND T_SP.REFUND_REQUEST_DTTM IS NOT NULL
				</isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
           AND REPLACE(T_RSV2.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
         </isNotEmpty>
         <isNotEmpty property="sAutoCancelViewYn">
                <isEqual property="sAutoCancelViewYn" compareValue="N">
           AND T_RSV2.RSV_STATUS_CD NOT IN ('RS99')
                </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sPrdtNm">
           AND T_SP.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
         </isNotEmpty>
         <isNotEmpty property="sStartDt">
            <![CDATA[
           AND T_RSV2.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
           AND T_RSV2.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
         <isNotEmpty property="sGuestYn">
        		<isEqual property="sGuestYn" compareValue="Y">
        			AND T_RSV2.USER_ID = 'GUEST'
        		</isEqual>
        		<isEqual property="sGuestYn" compareValue="N">
        			<![CDATA[
        			AND T_RSV2.USER_ID <> 'GUEST'
        			]]>
        		</isEqual>
         </isNotEmpty>
         UNION ALL
        SELECT 'RC' AS PRDT_CD
             , T_RC.RSV_NUM
             , T_RC.RC_RSV_NUM AS PRDT_RSV_NUM
          FROM TB_RSV         T_RSV4
         INNER JOIN TB_RC_RSV T_RC
            ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
         INNER JOIN TB_CORP T_CORP
            ON T_CORP.CORP_ID = T_RC.CORP_ID
         INNER JOIN TB_RC_PRDTINF T_RC_PRDT
            ON T_RC.PRDT_NUM = T_RC_PRDT.PRDT_NUM
         <isNotEmpty property="sCorpNm">
           AND T_CORP.CORP_NM LIKE '%'||#sCorpNm#||'%'
        </isNotEmpty>
         WHERE 1=1
        <isNotEmpty property="sRsvCorpId">
           AND T_RSV4.RSV_CORP_ID = #sRsvCorpId#
        </isNotEmpty>
        <isNotEmpty property="sPrdtCd">
                <isNotEqual property="sPrdtCd" compareValue="RC">
           AND 1=0
           		</isNotEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
           AND T_RSV4.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sUseNm">
           AND T_RSV4.USE_NM = #sUseNm#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
           AND T_RSV4.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
           AND T_RSV4.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            	<isNotEqual property="sRsvStatusCd" compareValue="RS13">
           AND T_RC.RSV_STATUS_CD = #sRsvStatusCd#
				</isNotEqual>
				<isEqual property="sRsvStatusCd" compareValue="RS13">
		   AND T_RC.RSV_STATUS_CD = 'RS20'
		   AND T_RC.REFUND_REQUEST_DTTM IS NOT NULL
				</isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
           AND REPLACE(T_RSV4.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
         </isNotEmpty>
         <isNotEmpty property="sAutoCancelViewYn">
                <isEqual property="sAutoCancelViewYn" compareValue="N">
           AND T_RSV4.RSV_STATUS_CD NOT IN ('RS99')
                </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sPrdtNm">
           AND T_RC.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
         </isNotEmpty>
        <isNotEmpty property="sPrdtSubCd">
                AND T_RC_PRDT.CAR_DIV = #sPrdtSubCd#
        </isNotEmpty>
        <isNotEmpty property="sStartDt">
            <![CDATA[
           AND T_RSV4.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
           AND T_RSV4.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
         <isNotEmpty property="sGuestYn">
        		<isEqual property="sGuestYn" compareValue="Y">
        			AND T_RSV4.USER_ID = 'GUEST'
        		</isEqual>
        		<isEqual property="sGuestYn" compareValue="N">
        			<![CDATA[
        			AND T_RSV4.USER_ID <> 'GUEST'
        			]]>
        		</isEqual>
         </isNotEmpty>
       ) T_RSV
</select>

<!-- 상품별 예약조회 -->
<select id="RSV_S_19" resultMap="RSV_R_31">
SELECT PRDT_CD
    , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = PRDT_CD) AS PRDT_CD_NM
    , RSV_NUM
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , CORP_ID
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , CORP_NM
    , START_DT
    , USE_DTTM
    , PRDT_DIV
    , USE_ABLE_DTTM
    , EXPR_END_DT
    , EXPR_START_DT
    , ADJ_DT
    , USER_ID          /*사용자 아이디*/
    , (SELECT EMAIL FROM TB_USER WHERE USER_ID = T_RSV.USER_ID) AS EMAIL
    , RSV_NM           /*예약 명*/
    , RSV_EMAIL        /*예약 이메일*/
    , RSV_TELNUM       /*예약 전화번호*/
    , USE_NM           /*사용 명*/
    , USE_EMAIL        /*사용 이메일*/
    , USE_TELNUM       /*사용 전화번호*/
    , PAY_DIV          /*결제 구분*/
    , REG_DTTM
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
    , CANCEL_CMPL_DTTM
    , CANCEL_RSN
    , EVNT_CD
    , LPOINT_USE_POINT
    , LPOINT_SAVE_POINT
    , APP_DIV
    , TOTAL_NML_AMT
    , TOTAL_DIS_AMT
    , TOTAL_SALE_AMT
    , (SELECT CP_NM FROM TB_CP WHERE CP_ID =  (SELECT CP_ID FROM TB_USER_CP WHERE USE_RSV_NUM = PRDT_RSV_NUM AND USE_YN = 'Y')) AS CP_NM
    , PARTNER
    ,SUBSTR((SELECT LISTAGG(SUBSTR(CONTENTS,0,100), '||') WITHIN GROUP(ORDER BY SUBJECT) RESULT_XMLAGG
      FROM TB_NOTICE
      WHERE BBS_NUM = 'CALL' AND SUBJECT = T_RSV.RSV_NUM
    ),0,500) AS NOTICE
    , PARTNER_CODE                  /* 파트너코드*/
    , NVL(POINT,0) AS USE_POINT /* 결제 시 사용 파트너포인트*/
FROM (SELECT 'AD' AS PRDT_CD
        , T_AD.RSV_NUM
        , T_AD.AD_RSV_NUM AS PRDT_RSV_NUM
        , T_AD.PRDT_NUM
        , T_AD.PRDT_NM
        , T_AD.RSV_STATUS_CD
        , T_AD.CORP_ID
        , T_AD.PRDT_INF
        , T_AD.NML_AMT
        , T_AD.SALE_AMT
        , T_AD.DIS_AMT
        , T_AD.CANCEL_AMT
        , T_AD.CMSS_AMT
        , T_AD.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , T_AD.ADJ_DT
        , T_ADDFT.AD_NM AS CORP_NM
        , T_AD.USE_DT AS START_DT
        , T_RSV1.USER_ID          /*사용자 아이디*/
        , T_RSV1.RSV_NM           /*예약 명*/
        , T_RSV1.RSV_EMAIL        /*예약 이메일*/
        , T_RSV1.RSV_TELNUM       /*예약 전화번호*/
        , T_RSV1.USE_NM           /*사용 명*/
        , T_RSV1.USE_EMAIL        /*사용 이메일*/
        , T_RSV1.USE_TELNUM       /*사용 전화번호*/
        , T_RSV1.PAY_DIV          /*결제 구분*/
        , T_RSV1.REG_DTTM
        , T_AD.CANCEL_REQUEST_DTTM
        , T_AD.REFUND_REQUEST_DTTM
        , T_AD.CANCEL_CMPL_DTTM
        , T_AD.CANCEL_RSN
        , T_RSV1.EVNT_CD			/*이벤트 코드*/
        , T_RSV1.LPOINT_USE_POINT
        , T_RSV1.LPOINT_SAVE_POINT
        , T_RSV1.APP_DIV
        , T_RSV1.TOTAL_NML_AMT
        , T_RSV1.TOTAL_DIS_AMT
        , T_RSV1.TOTAL_SALE_AMT
        , T_RSV1.PARTNER
        , T_PNT.PARTNER_CODE         /* 파트너코드*/
        , T_PNT.POINT                /* 결제 시 사용 파트너포인트*/
    FROM TB_RSV T_RSV1
        INNER JOIN TB_AD_RSV T_AD
        ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
        INNER JOIN TB_AD_DFTINF T_ADDFT
        ON T_ADDFT.CORP_ID = T_AD.CORP_ID
            <isNotEmpty property="sCorpNm">
                AND T_ADDFT.AD_NM LIKE '%' || #sCorpNm# || '%'
            </isNotEmpty>
        LEFT JOIN (
                SELECT
                    SUM((CASE WHEN PLUS_MINUS = 'M' THEN POINT ELSE 0 END) - (CASE WHEN PLUS_MINUS = 'P' THEN POINT ELSE 0 END)) AS POINT,
                    DTL_RSV_NUM,
                    MAX(PARTNER_CODE) AS PARTNER_CODE
                    FROM TB_POINT
                    WHERE
                    TYPES IN ('USE','CANCEL')
                    GROUP BY DTL_RSV_NUM
                ) T_PNT
        ON T_AD.AD_RSV_NUM = T_PNT.DTL_RSV_NUM
        WHERE 1=1
        <isNotEmpty property="sPrdtCd">
            <isNotEqual property="sPrdtCd" compareValue="AD">
                AND 1=0
            </isNotEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV1.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
            AND T_RSV1.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
            AND T_RSV1.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            <isNotEqual property="sRsvStatusCd" compareValue="RS13">
		        AND T_AD.RSV_STATUS_CD = #sRsvStatusCd#
            </isNotEqual>
            <isEqual property="sRsvStatusCd" compareValue="RS13">
		        AND T_AD.RSV_STATUS_CD = 'RS20'
		        AND T_AD.REFUND_REQUEST_DTTM IS NOT NULL
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV1.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sAutoCancelViewYn">
            <isEqual property="sAutoCancelViewYn" compareValue="N">
                AND T_RSV1.RSV_STATUS_CD NOT IN ('RS99')
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sPrdtNm">
            AND T_AD.PRDT_NM LIKE '%' || #sPrdtNm# || '%'
        </isNotEmpty>
        <isNotEmpty property="sStartDt">
            <![CDATA[
            AND T_RSV1.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
            AND T_RSV1.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="userId">
            <![CDATA[
            AND T_RSV1.USER_ID = #userId#
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sUsedStartDt">
            <![CDATA[
            AND USE_DT >= REPLACE(#sUsedStartDt#, '-','')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sUsedEndDt">
            <![CDATA[
            AND USE_DT <= REPLACE(#sUsedEndDt#, '-','')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sAppDiv">
            AND APP_DIV = #sAppDiv#
        </isNotEmpty>
        <isNotEmpty property="sGuestYn">
            <isEqual property="sGuestYn" compareValue="Y">
                AND T_RSV1.USER_ID = 'GUEST'
            </isEqual>
            <isEqual property="sGuestYn" compareValue="N">
                AND T_RSV1.USER_ID != 'GUEST'
            </isEqual>
        </isNotEmpty>
        <isEqual property="sLpointDiv" compareValue="use">
            AND T_RSV1.LPOINT_USE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="save">
            AND T_RSV1.LPOINT_SAVE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="dont">
            AND T_RSV1.LPOINT_USE_POINT = 0
            AND T_RSV1.LPOINT_SAVE_POINT = 0
        </isEqual>

    UNION ALL

    SELECT (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD
        , T_SP.RSV_NUM
        , T_SP.SP_RSV_NUM AS PRDT_RSV_NUM
        , T_SP.PRDT_NUM
        , T_SP.PRDT_NM
        , T_SP.RSV_STATUS_CD
        , T_SP.CORP_ID
        , T_SP.PRDT_INF
        , T_SP.NML_AMT
        , T_SP.SALE_AMT
        , T_SP.DIS_AMT
        , T_SP.CANCEL_AMT
        , T_SP.CMSS_AMT
        , T_SP.DIS_CANCEL_AMT
        , T_SP.USE_DTTM
        , T_SP.PRDT_DIV
        , T_SP.USE_ABLE_DTTM
        , T_SP.EXPR_END_DT
        , T_SP.EXPR_START_DT
        , T_SP.ADJ_DT
        , T_CORP.CORP_NM AS CORP_NM
        , TO_CHAR(USE_DTTM,'YYYYMMDD') AS START_DT
        , T_RSV2.USER_ID          /*사용자 아이디*/
        , T_RSV2.RSV_NM           /*예약 명*/
        , T_RSV2.RSV_EMAIL        /*예약 이메일*/
        , T_RSV2.RSV_TELNUM       /*예약 전화번호*/
        , T_RSV2.USE_NM           /*사용 명*/
        , T_RSV2.USE_EMAIL        /*사용 이메일*/
        , T_RSV2.USE_TELNUM       /*사용 전화번호*/
        , T_RSV2.PAY_DIV          /*결제 구분*/
        , T_RSV2.REG_DTTM
        , T_SP.CANCEL_REQUEST_DTTM
        , T_SP.REFUND_REQUEST_DTTM
        , T_SP.CANCEL_CMPL_DTTM
        , T_SP.CANCEL_RSN
        , T_RSV2.EVNT_CD			/*이벤트 코드*/
        , T_RSV2.LPOINT_USE_POINT
        , T_RSV2.LPOINT_SAVE_POINT
        , T_RSV2.APP_DIV
        , T_RSV2.TOTAL_NML_AMT
        , T_RSV2.TOTAL_DIS_AMT
        , T_RSV2.TOTAL_SALE_AMT
        , T_RSV2.PARTNER
        , T_PNT.PARTNER_CODE         /* 파트너코드*/
        , T_PNT.POINT                /* 결제 시 사용 파트너포인트*/
    FROM TB_RSV T_RSV2
        INNER JOIN TB_SP_RSV T_SP
        ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
        INNER JOIN TB_CORP T_CORP
        ON T_CORP.CORP_ID = T_SP.CORP_ID
            <isNotEmpty property="sCorpNm">
                AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotEmpty>
        LEFT JOIN (
                SELECT
                    SUM((CASE WHEN PLUS_MINUS = 'M' THEN POINT ELSE 0 END) - (CASE WHEN PLUS_MINUS = 'P' THEN POINT ELSE 0 END)) AS POINT,
                    DTL_RSV_NUM,
                    MAX(PARTNER_CODE) AS PARTNER_CODE
                    FROM TB_POINT
                    WHERE
                    TYPES IN ('USE','CANCEL')
                    GROUP BY DTL_RSV_NUM
                ) T_PNT
        ON T_SP.SP_RSV_NUM = T_PNT.DTL_RSV_NUM
    WHERE 1=1
        <isNotEmpty property="sPrdtCd">
            AND (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SP.PRDT_NUM)) = #sPrdtCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV2.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
            AND T_RSV2.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
            AND T_RSV2.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            <isNotEqual property="sRsvStatusCd" compareValue="RS13">
                AND T_SP.RSV_STATUS_CD = #sRsvStatusCd#
            </isNotEqual>
            <isEqual property="sRsvStatusCd" compareValue="RS13">
                AND T_SP.RSV_STATUS_CD = 'RS20'
                AND T_SP.REFUND_REQUEST_DTTM IS NOT NULL
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV2.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sAutoCancelViewYn">
            <isEqual property="sAutoCancelViewYn" compareValue="N">
                AND T_RSV2.RSV_STATUS_CD NOT IN ('RS99')
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sPrdtNm">
            AND T_SP.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
        </isNotEmpty>
        <isNotEmpty property="sStartDt">
            <![CDATA[
            AND T_RSV2.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
         </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
            AND T_RSV2.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sUsedStartDt">
            <![CDATA[
            AND USE_DTTM >= TO_DATE(REPLACE(#sUsedStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sUsedEndDt">
            <![CDATA[
            AND USE_DTTM <= TO_DATE(REPLACE(#sUsedEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
    </isNotEmpty>
        <isNotEmpty property="sAppDiv">
            AND APP_DIV = #sAppDiv#
        </isNotEmpty>
        <isNotEmpty property="sGuestYn">
            <isEqual property="sGuestYn" compareValue="Y">
                AND T_RSV2.USER_ID = 'GUEST'
            </isEqual>
            <isEqual property="sGuestYn" compareValue="N">
                AND T_RSV2.USER_ID != 'GUEST'
            </isEqual>
        </isNotEmpty>
        <isEqual property="sLpointDiv" compareValue="use">
           AND T_RSV2.LPOINT_USE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="save">
           AND T_RSV2.LPOINT_SAVE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="dont">
           AND T_RSV2.LPOINT_USE_POINT = 0
           AND T_RSV1.LPOINT_SAVE_POINT = 0
        </isEqual>

    UNION ALL

    SELECT 'RC' AS PRDT_CD
        , T_RC.RSV_NUM
        , T_RC.RC_RSV_NUM AS PRDT_RSV_NUM
        , T_RC.PRDT_NUM
        , T_RC.PRDT_NM
        , T_RC.RSV_STATUS_CD
        , T_RC.CORP_ID
        , T_RC.PRDT_INF
        , T_RC.NML_AMT
        , T_RC.SALE_AMT
        , T_RC.DIS_AMT
        , T_RC.CANCEL_AMT
        , T_RC.CMSS_AMT
        , T_RC.DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , T_RC.ADJ_DT
        , T_CORP.CORP_NM AS CORP_NM
        , T_RC.RENT_START_DT AS START_DT
        , T_RSV4.USER_ID          /*사용자 아이디*/
        , T_RSV4.RSV_NM           /*예약 명*/
        , T_RSV4.RSV_EMAIL        /*예약 이메일*/
        , T_RSV4.RSV_TELNUM       /*예약 전화번호*/
        , T_RSV4.USE_NM           /*사용 명*/
        , T_RSV4.USE_EMAIL        /*사용 이메일*/
        , T_RSV4.USE_TELNUM       /*사용 전화번호*/
        , T_RSV4.PAY_DIV          /*결제 구분*/
        , T_RSV4.REG_DTTM
        , T_RC.CANCEL_REQUEST_DTTM
        , T_RC.REFUND_REQUEST_DTTM
        , T_RC.CANCEL_CMPL_DTTM
        , T_RC.CANCEL_RSN
        , T_RSV4.EVNT_CD			/*이벤트 코드*/
        , T_RSV4.LPOINT_USE_POINT
        , T_RSV4.LPOINT_SAVE_POINT
        , T_RSV4.APP_DIV
        , T_RSV4.TOTAL_NML_AMT
        , T_RSV4.TOTAL_DIS_AMT
        , T_RSV4.TOTAL_SALE_AMT
        , T_RSV4.PARTNER
        , T_PNT.PARTNER_CODE         /* 파트너코드*/
        , T_PNT.POINT                /* 결제 시 사용 파트너포인트*/
    FROM TB_RSV T_RSV4
        INNER JOIN TB_RC_RSV T_RC
        ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
        INNER JOIN TB_CORP T_CORP
        ON T_CORP.CORP_ID = T_RC.CORP_ID
        <isNotEmpty property="sCorpNm">
            AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
        </isNotEmpty>
        LEFT JOIN (
                SELECT
                    SUM((CASE WHEN PLUS_MINUS = 'M' THEN POINT ELSE 0 END) - (CASE WHEN PLUS_MINUS = 'P' THEN POINT ELSE 0 END)) AS POINT,
                    DTL_RSV_NUM,
                    MAX(PARTNER_CODE) AS PARTNER_CODE
                    FROM TB_POINT
                    WHERE
                    TYPES IN ('USE','CANCEL')
                    GROUP BY DTL_RSV_NUM
                ) T_PNT
        ON T_RC.RC_RSV_NUM = T_PNT.DTL_RSV_NUM
    WHERE 1=1
        <isNotEmpty property="sPrdtCd">
            <isNotEqual property="sPrdtCd" compareValue="RC">
                AND 1=0
            </isNotEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV4.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
            AND T_RSV4.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
            AND T_RSV4.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            <isNotEqual property="sRsvStatusCd" compareValue="RS13">
		        AND T_RC.RSV_STATUS_CD = #sRsvStatusCd#
            </isNotEqual>
            <isEqual property="sRsvStatusCd" compareValue="RS13">
		        AND T_RC.RSV_STATUS_CD = 'RS20'
		        AND T_RC.REFUND_REQUEST_DTTM IS NOT NULL
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV4.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sAutoCancelViewYn">
            <isEqual property="sAutoCancelViewYn" compareValue="N">
                AND T_RSV4.RSV_STATUS_CD NOT IN ('RS99')
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sPrdtNm">
            AND T_RC.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
        </isNotEmpty>
        <isNotEmpty property="sStartDt">
            <![CDATA[
            AND T_RSV4.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
            AND T_RSV4.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sUsedStartDt">
            <![CDATA[
            AND RENT_START_DT >= REPLACE(#sUsedStartDt#, '-','')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sUsedEndDt">
            <![CDATA[
            AND RENT_START_DT <= REPLACE(#sUsedEndDt#, '-','')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sAppDiv">
            AND APP_DIV = #sAppDiv#
        </isNotEmpty>
        <isNotEmpty property="sGuestYn">
            <isEqual property="sGuestYn" compareValue="Y">
                AND T_RSV4.USER_ID = 'GUEST'
            </isEqual>
            <isEqual property="sGuestYn" compareValue="N">
                AND T_RSV4.USER_ID != 'GUEST'
            </isEqual>
        </isNotEmpty>
        <isEqual property="sLpointDiv" compareValue="use">
			AND T_RSV4.LPOINT_USE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="save">
            AND T_RSV4.LPOINT_SAVE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="dont">
		    AND T_RSV4.LPOINT_USE_POINT = 0
		    AND T_RSV1.LPOINT_SAVE_POINT = 0
        </isEqual>
) T_RSV
WHERE 1=1
<isNotEqual property="partnerCode" compareValue="tamnao">
AND PARTNER_CODE = #partnerCode#
</isNotEqual>
ORDER BY REG_DTTM DESC
</select>


<!-- 비회원 예약내역 조회 -->
<select id="RSV_S_20" resultMap="RSV_R_05">
SELECT RSV_NUM          /*예약 번호*/
     , RSV_STATUS_CD    /*예약 상태 코드*/
     , USER_ID          /*사용자 아이디*/
     , RSV_NM           /*예약 명*/
     , RSV_EMAIL        /*예약 이메일*/
     , RSV_TELNUM       /*예약 전화번호*/
     , USE_NM           /*사용 명*/
     , USE_EMAIL        /*사용 이메일*/
     , USE_TELNUM       /*사용 전화번호*/
     , PAY_DIV          /*결제 구분*/
     , TOTAL_NML_AMT    /*총 정상 금액*/
     , TOTAL_SALE_AMT   /*총 판매 금액*/
     , TOTAL_PAY_AMT    /*총 결제 금액*/
     , TOTAL_DIS_AMT    /*총 할인 금액*/
     , TOTAL_CANCEL_AMT /*총 취소 금액*/
     , LPOINT_USE_POINT /*LPOINT 사용 포인트*/
     , REG_DTTM         /*등록 일시*/
     , REG_IP           /*등록 아이피*/
     , MOD_DTTM         /*수정 일시*/
     , MOD_IP           /*수정 아이피*/
     , TOTAL_CMSS_AMT   /*총 수수료 금액*/
     , TOTAL_DIS_CANCEL_AMT	/*총 할인 취소 금액*/
     , APP_DIV			/*앱 구분*/
     , NVL(USE_POINT,0) AS USE_POINT /* 파트너 포인트 */
  FROM TB_RSV
 WHERE 1=1
 <![CDATA[
   AND 1 = (CASE WHEN RSV_STATUS_CD = 'RS00'
                 THEN (CASE WHEN REG_DTTM >= SYSDATE - (#waitingTime# / 60 / 24) THEN 1 ELSE 0 END)
                 ELSE 1
             END)
        ]]>
   AND USER_ID = 'GUEST'
   AND RSV_TELNUM = #rsvTelnum#
   AND RSV_NM = #rsvNm#
<isEqual property="autoCancelYn" compareValue="N">
<![CDATA[
   AND RSV_STATUS_CD <> 'RS99'
]]>
</isEqual>
 ORDER BY RSV_NUM DESC
</select>


<select id="RSV_S_21" resultMap="RSV_R_30">
    SELECT *
    FROM (
    SELECT T.*, ROWNUM AS RN
    FROM (
        SELECT PRDT_CD
             , (SELECT CD_NM
                  FROM TB_CD
                 WHERE CD_NUM = PRDT_CD
               ) AS PRDT_CD_NM
             , RSV_NUM
             , PRDT_RSV_NUM
             , PRDT_NUM
             , PRDT_NM
             , RSV_STATUS_CD
             , CORP_ID
             , PRDT_INF
             , NML_AMT
             , SALE_AMT
             , DIS_AMT
             , CANCEL_AMT
             , CMSS_AMT
             , DIS_CANCEL_AMT
             , (CASE PRDT_CD WHEN 'AD'
                             THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
                             ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
                 END) AS CORP_NM
              , USE_DTTM
              , PRDT_DIV
              , USE_ABLE_DTTM
              , EXPR_END_DT
              , EXPR_START_DT
              , CANCEL_REQUEST_DTTM
              , REFUND_REQUEST_DTTM
              , CANCEL_CMPL_DTTM
              , CANCEL_RSN
              , DLV_CORP_NM
              , (SELECT GOODSFLOW_DLV_CD FROM TB_DLVCORP WHERE DLV_CORP_NM = T_RSV.DLV_CORP_NM) AS GOODSFLOW_DLV_CD
              , DLV_NUM
              , BUY_FIX_DTTM
              , REG_DTTM
              , SAVE_PATH
              , SAVE_FILE_NM
              , USEEPIL_REG_YN
          FROM (SELECT 'AD' AS PRDT_CD
                     , T_AD.RSV_NUM
                     , T_AD.AD_RSV_NUM AS PRDT_RSV_NUM
                     , T_AD.PRDT_NUM
                     , T_AD.PRDT_NM
                     , T_AD.RSV_STATUS_CD
                     , T_AD.CORP_ID
                     , T_AD.PRDT_INF
                     , T_AD.NML_AMT
                     , T_AD.SALE_AMT
                     , T_AD.DIS_AMT
                     , T_AD.CANCEL_AMT
                     , T_AD.CMSS_AMT
                     , T_AD.DIS_CANCEL_AMT
                     , NULL AS USE_DTTM
                     , NULL AS PRDT_DIV
                     , NULL AS USE_ABLE_DTTM
                     , NULL AS EXPR_END_DT
                     , NULL AS EXPR_START_DT
                     , T_AD.CANCEL_REQUEST_DTTM
                     , T_AD.REFUND_REQUEST_DTTM
                     , T_AD.CANCEL_CMPL_DTTM
                     , T_AD.CANCEL_RSN
                     , NULL AS DLV_CORP_NM
                     , NULL AS DLV_NUM
                     , NULL AS BUY_FIX_DTTM
                     , TO_CHAR(REG_DTTM,'YYYYMMDD') AS REG_DTTM
                     , T_IMG.SAVE_PATH
                     , T_IMG.SAVE_FILE_NM
                     , T_AD.USEEPIL_REG_YN
                  FROM TB_RSV         T_RSV1
                 INNER JOIN TB_AD_RSV T_AD
                    ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
                 LEFT JOIN TB_CM_IMG AS T_IMG
                    ON T_AD.CORP_ID = T_IMG.LINK_NUM AND T_IMG.IMG_SN = 1
                 WHERE T_RSV1.USER_ID = 'GUEST'
                   AND T_RSV1.RSV_TELNUM = #rsvTelnum#
                   AND T_RSV1.RSV_NM = #rsvNm#
                 <isEqual property="autoCancelYn" compareValue="N">
                    <![CDATA[
                   AND T_RSV1.RSV_STATUS_CD <> 'RS99'
                    ]]>
                 </isEqual>

                 UNION ALL

                SELECT (SELECT HRK_CD_NUM
                          FROM TB_CD
                         WHERE CD_NUM = (SELECT CTGR
                                           FROM TB_SP_PRDTINF
                                          WHERE PRDT_NUM = T_SP.PRDT_NUM)) AS PRDT_CD
                     , T_SP.RSV_NUM
                     , T_SP.SP_RSV_NUM AS PRDT_RSV_NUM
                     , T_SP.PRDT_NUM
                     , T_SP.PRDT_NM
                     , T_SP.RSV_STATUS_CD
                     , T_SP.CORP_ID
                     , T_SP.PRDT_INF
                     , T_SP.NML_AMT
                     , T_SP.SALE_AMT
                     , T_SP.DIS_AMT
                     , T_SP.CANCEL_AMT
                     , T_SP.CMSS_AMT
                     , T_SP.DIS_CANCEL_AMT
                     , T_SP.USE_DTTM
                     , T_SP.PRDT_DIV
                     , T_SP.USE_ABLE_DTTM
                     , T_SP.EXPR_END_DT
                     , T_SP.EXPR_START_DT
                     , T_SP.CANCEL_REQUEST_DTTM
                     , T_SP.REFUND_REQUEST_DTTM
                     , T_SP.CANCEL_CMPL_DTTM
                     , T_SP.CANCEL_RSN
                     , NULL AS DLV_CORP_NM
                     , NULL AS DLV_NUM
                     , NULL AS BUY_FIX_DTTM
                     , TO_CHAR(REG_DTTM,'YYYYMMDD') AS REG_DTTM
                     , T_IMG.SAVE_PATH
                     , T_IMG.SAVE_FILE_NM
                     , T_SP.USEEPIL_REG_YN
                  FROM TB_RSV         T_RSV2
                 INNER JOIN TB_SP_RSV T_SP
                    ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
                 LEFT JOIN TB_CM_IMG AS T_IMG
                    ON T_IMG.LINK_NUM = T_SP.PRDT_NUM  AND T_IMG.IMG_SN = 1
                 WHERE T_RSV2.USER_ID = 'GUEST'
                   AND T_RSV2.RSV_TELNUM = #rsvTelnum#
                   AND T_RSV2.RSV_NM = #rsvNm#
                 <isEqual property="autoCancelYn" compareValue="N">
                    <![CDATA[
                   AND T_RSV2.RSV_STATUS_CD <> 'RS99'
                    ]]>
                 </isEqual>

                 UNION ALL

                SELECT 'RC' AS PRDT_CD
                     , T_RC.RSV_NUM
                     , T_RC.RC_RSV_NUM AS PRDT_RSV_NUM
                     , T_RC.PRDT_NUM
                     , T_RC.PRDT_NM
                     , T_RC.RSV_STATUS_CD
                     , T_RC.CORP_ID
                     , T_RC.PRDT_INF
                     , T_RC.NML_AMT
                     , T_RC.SALE_AMT
                     , T_RC.DIS_AMT
                     , T_RC.CANCEL_AMT
                     , T_RC.CMSS_AMT
                     , T_RC.DIS_CANCEL_AMT
                     , NULL AS USE_DTTM
                     , NULL AS PRDT_DIV
                     , NULL AS USE_ABLE_DTTM
                     , NULL AS EXPR_END_DT
                     , NULL AS EXPR_START_DT
                     , T_RC.CANCEL_REQUEST_DTTM
                     , T_RC.REFUND_REQUEST_DTTM
                     , T_RC.CANCEL_CMPL_DTTM
                     , T_RC.CANCEL_RSN
                     , NULL AS DLV_CORP_NM
                     , NULL AS DLV_NUM
                     , NULL AS BUY_FIX_DTTM
                     , TO_CHAR(REG_DTTM,'YYYYMMDD') AS REG_DTTM
                     , (SELECT CAR_IMG FROM TB_RC_CARDIV WHERE RC_CARDIV_NUM = T_RP.RC_CARDIV_NUM)  AS SAVE_PATH
                     , '' AS SAVE_FILE_NM
                     , T_RC.USEEPIL_REG_YN
                  FROM TB_RSV         T_RSV4
                 INNER JOIN TB_RC_RSV T_RC
                    ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
                LEFT JOIN TB_RC_PRDTINF T_RP
                    ON T_RP.PRDT_NUM = T_RC.PRDT_NUM
                 WHERE T_RSV4.USER_ID = 'GUEST'
                   AND T_RSV4.RSV_TELNUM = #rsvTelnum#
                   AND T_RSV4.RSV_NM = #rsvNm#
                 <isEqual property="autoCancelYn" compareValue="N">
                    <![CDATA[
                   AND T_RSV4.RSV_STATUS_CD <> 'RS99'
                    ]]>
                 </isEqual>

                 UNION ALL

                SELECT 'SV' AS PRDT_CD
                     , T_SV.RSV_NUM
                     , T_SV.SV_RSV_NUM AS PRDT_RSV_NUM
                     , T_SV.PRDT_NUM
                     , T_SV.PRDT_NM
                     , T_SV.RSV_STATUS_CD
                     , T_SV.CORP_ID
                     , T_SV.PRDT_INF
                     , T_SV.NML_AMT
                     , T_SV.SALE_AMT
                     , T_SV.DIS_AMT
                     , T_SV.CANCEL_AMT
                     , T_SV.CMSS_AMT
                     , T_SV.DIS_CANCEL_AMT
                     , NULL AS USE_DTTM
                     , NULL AS PRDT_DIV
                     , NULL AS USE_ABLE_DTTM
                     , NULL AS EXPR_END_DT
                     , NULL AS EXPR_START_DT
                     , T_SV.CANCEL_REQUEST_DTTM
                     , T_SV.REFUND_REQUEST_DTTM
                     , T_SV.CANCEL_CMPL_DTTM
                     , T_SV.CANCEL_RSN
                     , T_SV.DLV_CORP_NM
                     , T_SV.DLV_NUM
                     , T_SV.BUY_FIX_DTTM
                     , TO_CHAR(REG_DTTM,'YYYYMMDD') AS REG_DTTM
                     , T_IMG.SAVE_PATH
                     , T_IMG.SAVE_FILE_NM
                     , T_SV.USEEPIL_REG_YN
                  FROM TB_RSV         T_RSV5
                 INNER JOIN TB_SV_RSV T_SV
                    ON T_SV.RSV_NUM = T_RSV5.RSV_NUM
                 LEFT JOIN TB_CM_IMG AS T_IMG
                    ON T_IMG.LINK_NUM = T_SV.PRDT_NUM  AND T_IMG.IMG_SN = 1
                 WHERE T_RSV5.USER_ID = 'GUEST'
                  AND T_RSV5.RSV_TELNUM = #rsvTelnum#
                  AND T_RSV5.RSV_NM = #rsvNm#
                 <isEqual property="autoCancelYn" compareValue="N">
                    <![CDATA[
                   AND T_RSV5.RSV_STATUS_CD <> 'RS99'
                    ]]>
                 </isEqual>
               ) T_RSV
    ORDER BY RSV_NUM DESC
    ) T
    )
    WHERE RN BETWEEN TO_NUMBER(#firstIndex#) AND TO_NUMBER(#lastIndex#)
</select>
<select id="RSV_S_34" resultClass="int">
    SELECT COUNT(*)
    FROM (
    SELECT RSV_NUM
    FROM (
    SELECT T_AD.RSV_NUM
    FROM TB_RSV T_RSV1
    INNER JOIN TB_AD_RSV T_AD ON T_AD.RSV_NUM = T_RSV1.RSV_NUM
    WHERE T_RSV1.USER_ID = 'GUEST'
    AND T_RSV1.RSV_TELNUM = #rsvTelnum#
    AND T_RSV1.RSV_NM = #rsvNm#
    <isEqual property="autoCancelYn" compareValue="N">
        <![CDATA[
            AND T_RSV1.RSV_STATUS_CD <> 'RS99'
            ]]>
    </isEqual>

    UNION ALL

    SELECT T_SP.RSV_NUM
    FROM TB_RSV T_RSV2
    INNER JOIN TB_SP_RSV T_SP ON T_SP.RSV_NUM = T_RSV2.RSV_NUM
    WHERE T_RSV2.USER_ID = 'GUEST'
    AND T_RSV2.RSV_TELNUM = #rsvTelnum#
    AND T_RSV2.RSV_NM = #rsvNm#
    <isEqual property="autoCancelYn" compareValue="N">
        <![CDATA[
            AND T_RSV2.RSV_STATUS_CD <> 'RS99'
            ]]>
    </isEqual>

    UNION ALL

    SELECT T_RC.RSV_NUM
    FROM TB_RSV T_RSV4
    INNER JOIN TB_RC_RSV T_RC ON T_RC.RSV_NUM = T_RSV4.RSV_NUM
    WHERE T_RSV4.USER_ID = 'GUEST'
    AND T_RSV4.RSV_TELNUM = #rsvTelnum#
    AND T_RSV4.RSV_NM = #rsvNm#
    <isEqual property="autoCancelYn" compareValue="N">
        <![CDATA[
            AND T_RSV4.RSV_STATUS_CD <> 'RS99'
            ]]>
    </isEqual>

    UNION ALL

    SELECT T_SV.RSV_NUM
    FROM TB_RSV T_RSV5
    INNER JOIN TB_SV_RSV T_SV ON T_SV.RSV_NUM = T_RSV5.RSV_NUM
    WHERE T_RSV5.USER_ID = 'GUEST'
    AND T_RSV5.RSV_TELNUM = #rsvTelnum#
    AND T_RSV5.RSV_NM = #rsvNm#
    <isEqual property="autoCancelYn" compareValue="N">
        <![CDATA[
            AND T_RSV5.RSV_STATUS_CD <> 'RS99'
            ]]>
    </isEqual>
    ) T_RSV
    )

</select>


<select id="RSV_S_22" resultMap="RSV_R_22">
SELECT POST_NUM
	 , ROAD_NM_ADDR
	 , DTL_ADDR
	 , USE_NM
	 , USE_TELNUM
  FROM (SELECT ROWNUM AS RN
			 , POST_NUM
			 , ROAD_NM_ADDR
			 , DTL_ADDR
			 , USE_NM
			 , USE_TELNUM
		 FROM (
				SELECT POST_NUM
					 , ROAD_NM_ADDR
					 , DTL_ADDR
					 , USE_NM
					 , USE_TELNUM
				  FROM TB_RSV
				 WHERE USER_ID = #userId#
				   AND POST_NUM IS NOT NULL
				ORDER BY REG_DTTM DESC ) )
 WHERE RN = 1
</select>

<select id="RSV_S_23" resultMap="RSV_R_23">
SELECT DISTINCT USE_NM,
        USE_EMAIL,
        USE_TELNUM
      FROM TB_RSV
      WHERE RSV_NUM IN (
        SELECT RSV_NUM
          FROM (SELECT RSV_NUM
                  FROM TB_AD_RSV
                 WHERE RSV_STATUS_CD IN ('RS30', 'RS31')
					<![CDATA[
                   AND USE_DT >= TO_CHAR(SYSDATE - 15, 'YYYYMMDD') AND USE_DT <= TO_CHAR(SYSDATE - 9, 'YYYYMMDD')
                    ]]>

                UNION

                SELECT RSV_NUM
                  FROM TB_RC_RSV
                 WHERE RSV_STATUS_CD IN ('RS30', 'RS31')
                 	<![CDATA[
                   AND RENT_START_DT >= TO_CHAR(SYSDATE - 15, 'YYYYMMDD') AND RENT_START_DT <= TO_CHAR(SYSDATE - 9, 'YYYYMMDD')
                   	]]>

                UNION

                SELECT RSV_NUM
                  FROM TB_SP_RSV
                 WHERE RSV_STATUS_CD IN ('RS30', 'RS31')
                 	<![CDATA[
                   AND TO_CHAR(USE_DTTM, 'YYYYMMDD') >= TO_CHAR(SYSDATE - 15, 'YYYYMMDD') AND TO_CHAR(USE_DTTM, 'YYYYMMDD') <= TO_CHAR(SYSDATE - 9, 'YYYYMMDD')
                    ]]>

                UNION

                SELECT RSV_NUM
                  FROM TB_SV_RSV
                  	<![CDATA[
                 WHERE TO_CHAR(BUY_FIX_DTTM, 'YYYYMMDD') >= TO_CHAR(SYSDATE - 15, 'YYYYMMDD') AND TO_CHAR(BUY_FIX_DTTM, 'YYYYMMDD') <= TO_CHAR(SYSDATE - 9, 'YYYYMMDD')
                 	]]>
                   AND RSV_STATUS_CD = 'RS30'
               )
       )
       AND USE_EMAIL !=' '
       AND USER_ID !='GUEST'
</select>

<!-- 관광/기념품 상품별 예약관리 -->
<select id="RSV_S_24" resultMap="RSV_R_24">
SELECT PRDT_CD
	 , (SELECT CD_NM
          FROM TB_CD
         WHERE CD_NUM = PRDT_CD
       ) AS PRDT_CD_NM
     , RSV_NUM
     , PRDT_RSV_NUM
     , PRDT_NUM
     , PRDT_NM
     , RSV_STATUS_CD
     , CORP_ID
     , PRDT_INF
     , NML_AMT
     , SALE_AMT
     , DIS_AMT
     , CANCEL_AMT
     , CMSS_AMT
     , DIS_CANCEL_AMT
     , PRDT_DIV
     , EXPR_END_DT
     , ADJ_DT
     , CORP_NM
     , USER_ID          /*사용자 아이디*/
     , RSV_NM           /*예약 명*/
     , RSV_EMAIL        /*예약 이메일*/
     , RSV_TELNUM       /*예약 전화번호*/
     , USE_NM           /*사용 명*/
     , USE_EMAIL        /*사용 이메일*/
     , USE_TELNUM       /*사용 전화번호*/
     , PAY_DIV          /*결제 구분*/
     , REG_DTTM
     , CANCEL_REQUEST_DTTM
     , REFUND_REQUEST_DTTM
     , CANCEL_CMPL_DTTM
     , CANCEL_RSN
     , DLV_CORP_NM
     , DLV_NUM
     , DLV_DTTM
     , DLV_AMT
     , BUY_FIX_YN
     , BUY_FIX_DTTM
     , EVNT_CD
  FROM (SELECT ROWNUM AS RN
             , PRDT_CD
             , RSV_NUM
             , PRDT_RSV_NUM
             , PRDT_NUM
             , PRDT_NM
             , RSV_STATUS_CD
             , CORP_ID
             , PRDT_INF
             , NML_AMT
             , SALE_AMT
             , DIS_AMT
             , CANCEL_AMT
             , CMSS_AMT
             , DIS_CANCEL_AMT
             , PRDT_DIV
             , EXPR_END_DT
             , ADJ_DT
             , CORP_NM
             , USER_ID          /*사용자 아이디*/
             , RSV_NM           /*예약 명*/
             , RSV_EMAIL        /*예약 이메일*/
             , RSV_TELNUM       /*예약 전화번호*/
             , USE_NM           /*사용 명*/
             , USE_EMAIL        /*사용 이메일*/
             , USE_TELNUM       /*사용 전화번호*/
             , PAY_DIV          /*결제 구분*/
             , REG_DTTM
             , CANCEL_REQUEST_DTTM
             , REFUND_REQUEST_DTTM
             , CANCEL_CMPL_DTTM
             , CANCEL_RSN
             , DLV_CORP_NM
             , DLV_NUM
             , DLV_DTTM
             , DLV_AMT
             , BUY_FIX_YN
             , BUY_FIX_DTTM
             , EVNT_CD
          FROM (SELECT T_PRDT.CTGR AS PRDT_CD
                     , T_SV.RSV_NUM
                     , T_SV.SV_RSV_NUM AS PRDT_RSV_NUM
                     , T_SV.PRDT_NUM
                     , T_SV.PRDT_NM
                     , T_SV.RSV_STATUS_CD
                     , T_SV.CORP_ID
                     , T_SV.PRDT_INF
                     , T_SV.NML_AMT
                     , T_SV.SALE_AMT
                     , T_SV.DIS_AMT
                     , T_SV.CANCEL_AMT
                     , T_SV.CMSS_AMT
                     , T_SV.DIS_CANCEL_AMT
                     , T_SV.PRDT_DIV
                     , T_SV.EXPR_END_DT
                     , T_SV.ADJ_DT
                     , T_CORP.CORP_NM AS CORP_NM
                     , T_RSV2.USER_ID          /*사용자 아이디*/
                     , T_RSV2.RSV_NM           /*예약 명*/
                     , T_RSV2.RSV_EMAIL        /*예약 이메일*/
                     , T_RSV2.RSV_TELNUM       /*예약 전화번호*/
                     , T_RSV2.USE_NM           /*사용 명*/
                     , T_RSV2.USE_EMAIL        /*사용 이메일*/
                     , T_RSV2.USE_TELNUM       /*사용 전화번호*/
                     , T_RSV2.PAY_DIV          /*결제 구분*/
                     , T_RSV2.REG_DTTM
                     , T_SV.CANCEL_REQUEST_DTTM
                     , T_SV.REFUND_REQUEST_DTTM
                     , T_SV.CANCEL_CMPL_DTTM
                     , T_SV.CANCEL_RSN
                     , T_SV.DLV_CORP_NM
                     , T_SV.DLV_NUM
                     , T_SV.DLV_DTTM
                     , T_SV.DLV_AMT
                     , T_SV.BUY_FIX_YN
                     , T_SV.BUY_FIX_DTTM
                     , T_RSV2.EVNT_CD
                  FROM TB_RSV         T_RSV2
                 INNER JOIN TB_SV_RSV T_SV
                    ON T_SV.RSV_NUM = T_RSV2.RSV_NUM
                 INNER JOIN TB_CORP T_CORP
                    ON T_CORP.CORP_ID = T_SV.CORP_ID
                <isNotEmpty property="sCorpNm">
                   AND T_CORP.CORP_NM LIKE '%'||#sCorpNm#||'%'
                </isNotEmpty>
                 INNER JOIN TB_SV_PRDTINF T_PRDT
                    ON T_PRDT.PRDT_NUM = T_SV.PRDT_NUM
                 WHERE 1=1
                 <isNotEmpty property="sRsvCorpId">
                   AND T_RSV2.RSV_CORP_ID = #sRsvCorpId#
                </isNotEmpty>
                <isNotEmpty property="sPrdtCd">
                   AND T_PRDT.CTGR = #sPrdtCd#
                </isNotEmpty>
                <isNotEmpty property="sEvntCd">
		           AND T_RSV2.EVNT_CD = #sEvntCd#
		        </isNotEmpty>
                <isNotEmpty property="sRsvNm">
                   AND T_RSV2.RSV_NM = #sRsvNm#
                </isNotEmpty>
                <isNotEmpty property="sUseNm">
                   AND T_RSV2.USE_NM = #sUseNm#
                </isNotEmpty>
                <isNotEmpty property="sRsvNum">
                   AND T_RSV2.RSV_NUM = #sRsvNum#
                </isNotEmpty>
                <isNotEmpty property="sRsvStatusCd">
                        <isNotEqual property="sRsvStatusCd" compareValue="RS13">
                   AND T_SV.RSV_STATUS_CD = #sRsvStatusCd#
                        </isNotEqual>
                        <isEqual property="sRsvStatusCd" compareValue="RS13">
                   AND T_SV.RSV_STATUS_CD = 'RS20'
                   AND T_SV.REFUND_REQUEST_DTTM IS NOT NULL
                        </isEqual>
                </isNotEmpty>
                <isNotEmpty property="sRsvTelnum">
                   AND REPLACE(T_RSV2.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
                 </isNotEmpty>
                 <isNotEmpty property="sAutoCancelViewYn">
                        <isEqual property="sAutoCancelViewYn" compareValue="N">
                   AND T_RSV2.RSV_STATUS_CD NOT IN ('RS99')
                        </isEqual>
                </isNotEmpty>
                <isNotEmpty property="sPrdtNm">
                   AND T_SV.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
                 </isNotEmpty>
                 <isNotEmpty property="sStartDt">
                    <![CDATA[
                   AND T_RSV2.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
                    ]]>
                 </isNotEmpty>
                <isNotEmpty property="sEndDt">
                    <![CDATA[
                   AND T_RSV2.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
                    ]]>
                 </isNotEmpty>
                 <isNotEmpty property="sGuestYn">
                        <isEqual property="sGuestYn" compareValue="Y">
                            AND T_RSV2.USER_ID = 'GUEST'
                        </isEqual>
                        <isEqual property="sGuestYn" compareValue="N">
                            <![CDATA[
                            AND T_RSV2.USER_ID <> 'GUEST'
                            ]]>
                        </isEqual>
                 </isNotEmpty>
                 ORDER BY REG_DTTM DESC
               )
       )
 WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
</select>


<select id="RSV_S_25" resultClass="int">
SELECT COUNT(*) AS CNT
  FROM TB_RSV         T_RSV2
 INNER JOIN TB_SV_RSV T_SV
    ON T_SV.RSV_NUM = T_RSV2.RSV_NUM
 INNER JOIN TB_CORP T_CORP
    ON T_CORP.CORP_ID = T_SV.CORP_ID
 INNER JOIN TB_SV_PRDTINF T_PRDT
    ON T_PRDT.PRDT_NUM = T_SV.PRDT_NUM
<isNotEmpty property="sCorpNm">
   AND T_CORP.CORP_NM LIKE '%'||#sCorpNm#||'%'
</isNotEmpty>
 WHERE 1=1
 <isNotEmpty property="sRsvCorpId">
   AND T_RSV2.RSV_CORP_ID = #sRsvCorpId#
</isNotEmpty>
<isNotEmpty property="sPrdtCd">
   AND T_PRDT.CTGR = #sPrdtCd#
</isNotEmpty>
<isNotEmpty property="sRsvNm">
   AND T_RSV2.RSV_NM = #sRsvNm#
</isNotEmpty>
<isNotEmpty property="sUseNm">
   AND T_RSV2.USE_NM = #sUseNm#
</isNotEmpty>
<isNotEmpty property="sEvntCd">
   AND T_RSV2.EVNT_CD = #sEvntCd#
</isNotEmpty>
<isNotEmpty property="sRsvNum">
   AND T_RSV2.RSV_NUM = #sRsvNum#
</isNotEmpty>
<isNotEmpty property="sRsvStatusCd">
        <isNotEqual property="sRsvStatusCd" compareValue="RS13">
   AND T_SV.RSV_STATUS_CD = #sRsvStatusCd#
        </isNotEqual>
        <isEqual property="sRsvStatusCd" compareValue="RS13">
   AND T_SV.RSV_STATUS_CD = 'RS20'
   AND T_SV.REFUND_REQUEST_DTTM IS NOT NULL
        </isEqual>
</isNotEmpty>
<isNotEmpty property="sRsvTelnum">
   AND REPLACE(T_RSV2.RSV_TELNUM, '-', '') LIKE '%'||REPLACE(#sRsvTelnum#, '-', '')||'%'
 </isNotEmpty>
 <isNotEmpty property="sAutoCancelViewYn">
        <isEqual property="sAutoCancelViewYn" compareValue="N">
   AND T_RSV2.RSV_STATUS_CD NOT IN ('RS99')
        </isEqual>
</isNotEmpty>
<isNotEmpty property="sPrdtNm">
   AND T_SV.PRDT_NM LIKE '%'||#sPrdtNm#||'%'
 </isNotEmpty>
 <isNotEmpty property="sStartDt">
    <![CDATA[
   AND T_RSV2.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
    ]]>
 </isNotEmpty>
<isNotEmpty property="sEndDt">
    <![CDATA[
   AND T_RSV2.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
    ]]>
 </isNotEmpty>
 <isNotEmpty property="sGuestYn">
        <isEqual property="sGuestYn" compareValue="Y">
            AND T_RSV2.USER_ID = 'GUEST'
        </isEqual>
        <isEqual property="sGuestYn" compareValue="N">
            <![CDATA[
            AND T_RSV2.USER_ID <> 'GUEST'
            ]]>
        </isEqual>
 </isNotEmpty>
</select>

<!-- 관광/기념품 상품별 EXCEL 다운로드용 -->
<select id="RSV_S_26" resultMap="RSV_R_26">
SELECT PRDT_CD
    , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = PRDT_CD) AS PRDT_CD_NM
    , RSV_NUM
    , PRDT_RSV_NUM
    , PRDT_NUM
    , PRDT_NM
    , RSV_STATUS_CD
    , CORP_ID
    , PRDT_INF
    , NML_AMT
    , SALE_AMT
    , DIS_AMT
    , CANCEL_AMT
    , CMSS_AMT
    , DIS_CANCEL_AMT
    , PRDT_DIV
    , EXPR_END_DT
    , ADJ_DT
    , CORP_NM
    , USER_ID          /*사용자 아이디*/
    , EMAIL            /*사용자 이메일*/
    , RSV_NM           /*예약 명*/
    , RSV_EMAIL        /*예약 이메일*/
    , RSV_TELNUM       /*예약 전화번호*/
    , USE_NM           /*사용 명*/
    , USE_EMAIL        /*사용 이메일*/
    , USE_TELNUM       /*사용 전화번호*/
    , PAY_DIV          /*결제 구분*/
    , REG_DTTM
    , CANCEL_REQUEST_DTTM
    , REFUND_REQUEST_DTTM
    , CANCEL_CMPL_DTTM
    , CANCEL_RSN
    , DLV_CORP_NM
    , DLV_NUM
    , DLV_DTTM
    , DLV_AMT
    , BUY_FIX_YN
    , BUY_FIX_DTTM
    , EVNT_CD
    , LPOINT_USE_POINT
    , LPOINT_SAVE_POINT
    , APP_DIV
    , TOTAL_NML_AMT
    , TOTAL_DIS_AMT
    , TOTAL_SALE_AMT
    , ROAD_NM_ADDR
    , POST_NUM
    , PARTNER
    , (SELECT LISTAGG(CONTENTS, '||') WITHIN GROUP (ORDER BY SUBJECT DESC, ANS_SN ASC) FROM TB_NOTICE WHERE BBS_NUM = 'CALL' AND SUBJECT = T_RSV.RSV_NUM) AS NOTICE
    , PARTNER_CODE                        /* 파트너코드*/
    , NVL(POINT,0) AS USE_POINT                 /* 결제 시 사용 파트너포인트*/
    , CP_NM /* 쿠폰 명*/
    FROM (SELECT T_PRDT.CTGR AS PRDT_CD
        , T_SV.RSV_NUM
        , T_SV.SV_RSV_NUM AS PRDT_RSV_NUM
        , T_SV.PRDT_NUM
        , T_SV.PRDT_NM
        , T_SV.RSV_STATUS_CD
        , T_SV.CORP_ID
        , T_SV.PRDT_INF
        , T_SV.NML_AMT
        , T_SV.SALE_AMT
        , T_SV.DIS_AMT
        , T_SV.CANCEL_AMT
        , T_SV.CMSS_AMT
        , T_SV.DIS_CANCEL_AMT
        , T_SV.PRDT_DIV
        , T_SV.EXPR_END_DT
        , T_SV.ADJ_DT
        , T_CORP.CORP_NM AS CORP_NM
        , T_RSV2.USER_ID
        , (SELECT EMAIL FROM TB_USER WHERE USER_ID = T_RSV2.USER_ID) AS EMAIL
        , T_RSV2.RSV_NM
        , T_RSV2.RSV_EMAIL
        , T_RSV2.RSV_TELNUM
        , T_RSV2.USE_NM
        , T_RSV2.USE_EMAIL
        , T_RSV2.USE_TELNUM
        , T_RSV2.PAY_DIV
        , T_RSV2.REG_DTTM
        , T_SV.CANCEL_REQUEST_DTTM
        , T_SV.REFUND_REQUEST_DTTM
        , T_SV.CANCEL_CMPL_DTTM
        , T_SV.CANCEL_RSN
        , T_SV.DLV_CORP_NM
        , T_SV.DLV_NUM
        , T_SV.DLV_DTTM
        , T_SV.DLV_AMT
        , T_SV.BUY_FIX_YN
        , T_SV.BUY_FIX_DTTM
        , T_RSV2.EVNT_CD
        , T_RSV2.LPOINT_USE_POINT
        , T_RSV2.LPOINT_SAVE_POINT
        , T_RSV2.APP_DIV
        , T_RSV2.TOTAL_NML_AMT
        , T_RSV2.TOTAL_DIS_AMT
        , T_RSV2.TOTAL_SALE_AMT
        , (T_RSV2.ROAD_NM_ADDR || ' ' || T_RSV2.DTL_ADDR) AS ROAD_NM_ADDR
        , T_RSV2.POST_NUM
        , T_RSV2.PARTNER
        , T_PNT.PARTNER_CODE
        , T_PNT.POINT
        , TUC.CP_NM
    FROM TB_RSV T_RSV2
        INNER JOIN TB_SV_RSV T_SV
        ON T_SV.RSV_NUM = T_RSV2.RSV_NUM
        INNER JOIN TB_CORP T_CORP
        ON T_CORP.CORP_ID = T_SV.CORP_ID
            <isNotEmpty property="sCorpNm">
                AND T_CORP.CORP_NM LIKE '%' || #sCorpNm# || '%'
            </isNotEmpty>
        INNER JOIN TB_SV_PRDTINF T_PRDT
        ON T_PRDT.PRDT_NUM = T_SV.PRDT_NUM
        LEFT JOIN (
                SELECT
                    SUM((CASE WHEN PLUS_MINUS = 'M' THEN POINT ELSE 0 END) - (CASE WHEN PLUS_MINUS = 'P' THEN POINT ELSE 0 END)) AS POINT,
                    DTL_RSV_NUM,
                    MAX(PARTNER_CODE) AS PARTNER_CODE
                    FROM TB_POINT
                    WHERE
                    TYPES IN ('USE','CANCEL')
                    GROUP BY DTL_RSV_NUM
                ) T_PNT
        ON T_SV.SV_RSV_NUM = T_PNT.DTL_RSV_NUM
        LEFT JOIN TB_USER_CP TUC
        ON T_SV.SV_RSV_NUM = TUC.USE_RSV_NUM
    WHERE 1=1
        <isNotEmpty property="sRsvCorpId">
            AND T_RSV2.RSV_CORP_ID = #sRsvCorpId#
        </isNotEmpty>
        <isNotEmpty property="sPrdtCd">
            AND T_PRDT.CTGR = #sPrdtCd#
        </isNotEmpty>
        <isNotEmpty property="sRsvNm">
            AND T_RSV2.RSV_NM = #sRsvNm#
        </isNotEmpty>
        <isNotEmpty property="sEvntCd">
            AND T_RSV2.EVNT_CD = #sEvntCd#
        </isNotEmpty>
        <isNotEmpty property="sUseNm">
            AND T_RSV2.USE_NM = #sUseNm#
        </isNotEmpty>
        <isNotEmpty property="sRsvNum">
            AND T_RSV2.RSV_NUM = #sRsvNum#
        </isNotEmpty>
        <isNotEmpty property="userId">
            AND T_RSV2.USER_ID = #userId#
        </isNotEmpty>
        <isNotEmpty property="sRsvStatusCd">
            <isNotEqual property="sRsvStatusCd" compareValue="RS13">
                AND T_SV.RSV_STATUS_CD = #sRsvStatusCd#
            </isNotEqual>
            <isEqual property="sRsvStatusCd" compareValue="RS13">
                AND T_SV.RSV_STATUS_CD = 'RS20'
                AND T_SV.REFUND_REQUEST_DTTM IS NOT NULL
            </isEqual>
        </isNotEmpty>
        <isNotEmpty property="sRsvTelnum">
            AND REPLACE(T_RSV2.RSV_TELNUM, '-', '') LIKE '%' || REPLACE(#sRsvTelnum#, '-', '') || '%'
        </isNotEmpty>
        <isNotEmpty property="sAutoCancelViewYn">
            <isEqual property="sAutoCancelViewYn" compareValue="N">
                AND T_RSV2.RSV_STATUS_CD NOT IN ('RS99')
            </isEqual>
        </isNotEmpty>
            <isNotEmpty property="sPrdtNm">
                AND T_SV.PRDT_NM LIKE '%' || #sPrdtNm# || '%'
            </isNotEmpty>
        <isNotEmpty property="sStartDt">
            <![CDATA[
            AND T_RSV2.REG_DTTM >= TO_DATE(REPLACE(#sStartDt#, '-')||'000000', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sEndDt">
            <![CDATA[
            AND T_RSV2.REG_DTTM <= TO_DATE(REPLACE(#sEndDt#, '-')||'235959', 'YYYYMMDDHH24MISS')
            ]]>
        </isNotEmpty>
        <isNotEmpty property="sGuestYn">
            <isEqual property="sGuestYn" compareValue="Y">
                AND T_RSV2.USER_ID = 'GUEST'
            </isEqual>
            <isEqual property="sGuestYn" compareValue="N">
                AND T_RSV2.USER_ID != 'GUEST'
            </isEqual>
        </isNotEmpty>
        <isEqual property="sLpointDiv" compareValue="use">
            AND T_RSV2.LPOINT_USE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="save">
            AND T_RSV2.LPOINT_SAVE_POINT > 0
        </isEqual>
        <isEqual property="sLpointDiv" compareValue="dont">
            AND T_RSV2.LPOINT_USE_POINT = 0
            AND T_RSV2.LPOINT_SAVE_POINT = 0
        </isEqual>
        <isNotEqual property="partnerCode" compareValue="tamnao">
        AND T_PNT.PARTNER_CODE = #partnerCode#
        </isNotEqual>
    ORDER BY REG_DTTM DESC
)T_RSV
</select>

<!-- 탐나오 이벤트 관련 예약 카테고리 건수 , 'RS30' -->
<select id="RSV_S_27" resultClass="int">
 SELECT COUNT(*) AS NUM FROM
    (SELECT COUNT(*) AS RSV_NUM FROM TB_RSV T_RSV
            INNER JOIN TB_AD_RSV T_AD ON T_AD.RSV_NUM=T_RSV.RSV_NUM AND USE_DT BETWEEN #sEvntStartDt# AND #sEvntEndDt#
        WHERE
        	<isNotEmpty property="sUserId">
        		USER_ID=#sUserId#
        	</isNotEmpty>
        	<isEmpty property="sUserId">
        		USER_ID='GUEST'
        	</isEmpty>
        	AND RSV_NM=#sRsvNm# AND RSV_TELNUM=#sRsvTelnum#
        AND TO_CHAR(REG_DTTM, 'YYYYMMDD') BETWEEN #sEvntStartDt# AND #sEvntEndDt# AND T_AD.RSV_STATUS_CD IN ('RS02', 'RS03', 'RS12', 'RS30')
  UNION ALL
    SELECT COUNT(*) AS RSV_NUM FROM TB_RSV T_RSV
            INNER JOIN TB_RC_RSV T_RC ON T_RC.RSV_NUM=T_RSV.RSV_NUM AND RENT_START_DT BETWEEN #sEvntStartDt# AND #sEvntEndDt#
        WHERE
        	<isNotEmpty property="sUserId">
        		USER_ID=#sUserId#
        	</isNotEmpty>
        	<isEmpty property="sUserId">
        		USER_ID='GUEST'
        	</isEmpty>
        	AND RSV_NM=#sRsvNm# AND RSV_TELNUM=#sRsvTelnum#
        AND TO_CHAR(REG_DTTM, 'YYYYMMDD') BETWEEN #sEvntStartDt# AND #sEvntEndDt# AND T_RC.RSV_STATUS_CD IN ('RS02', 'RS03', 'RS12', 'RS30')
  UNION ALL
    SELECT COUNT(*) AS RSV_NUM FROM TB_RSV T_RSV
            INNER JOIN TB_SP_RSV T_SP ON T_SP.RSV_NUM=T_RSV.RSV_NUM
        WHERE
        	<isNotEmpty property="sUserId">
        		USER_ID=#sUserId#
        	</isNotEmpty>
        	<isEmpty property="sUserId">
        		USER_ID='GUEST'
        	</isEmpty>
        	AND RSV_NM=#sRsvNm# AND RSV_TELNUM=#sRsvTelnum#
            AND TO_CHAR(REG_DTTM, 'YYYYMMDD') BETWEEN #sEvntStartDt# AND #sEvntEndDt# AND T_SP.RSV_STATUS_CD IN ('RS02', 'RS03', 'RS12', 'RS30')
  UNION ALL
    SELECT COUNT(*) AS RSV_NUM FROM TB_RSV T_RSV
            INNER JOIN TB_SV_RSV T_SV ON T_SV.RSV_NUM=T_RSV.RSV_NUM
        WHERE
        	<isNotEmpty property="sUserId">
        		USER_ID=#sUserId#
        	</isNotEmpty>
        	<isEmpty property="sUserId">
        		USER_ID='GUEST'
        	</isEmpty>
        	AND RSV_NM=#sRsvNm# AND RSV_TELNUM=#sRsvTelnum#
             AND TO_CHAR(REG_DTTM, 'YYYYMMDD') BETWEEN #sEvntStartDt# AND #sEvntEndDt# AND T_SV.RSV_STATUS_CD IN ('RS02', 'RS03', 'RS12', 'RS30')
    )
    WHERE RSV_NUM > 0
</select>

<select id="RSV_S_28" resultMap="RSV_R_28">
SELECT DISTINCT USE_NM,
        USE_EMAIL,
        USE_TELNUM,
        T_RSV.USER_ID
      FROM TB_RSV T_RSV
        INNER JOIN TB_USER T_USR ON T_USR.USER_ID=T_RSV.USER_ID
      WHERE RSV_NUM IN (
        SELECT RSV_NUM
          FROM (SELECT RSV_NUM
                  FROM TB_AD_RSV
                 WHERE RSV_STATUS_CD IN ('RS02')
                   AND USE_DT = TO_CHAR(SYSDATE + 7, 'YYYYMMDD')
                UNION
                SELECT RSV_NUM
                  FROM TB_RC_RSV
                 WHERE RSV_STATUS_CD IN ('RS02')
                   AND RENT_START_DT = TO_CHAR(SYSDATE + 7, 'YYYYMMDD')
                UNION
                SELECT RSV_NUM
                  FROM TB_SP_RSV
                 WHERE RSV_STATUS_CD IN ('RS02')
                   AND TO_CHAR(USE_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE + 7, 'YYYYMMDD')
               )
       )
       AND USE_EMAIL!=' '
       AND EMAIL_RCV_AGR_YN='Y'
</select>

<select id="RSV_S_29" resultMap="RSV_R_29">
SELECT T_RSV.USER_ID
          , CORP_NM
          , PRDT_NM
          , PRDT_INF
          , IMG_PATH
          , T_DET.ROAD_NM_ADDR
          , RSV_TEL_NUM AS RSV_TELNUM
                  FROM TB_RSV T_RSV
                  INNER JOIN TB_USER T_USR ON T_USR.USER_ID=T_RSV.USER_ID
                  INNER JOIN (
                        SELECT PRDT_INF
                          , AD_NM AS CORP_NM
                          , PRDT_NM
                          , RSV_NUM
                          , SAVE_PATH || 'thumb/' || SAVE_FILE_NM AS IMG_PATH
                          , ROAD_NM_ADDR || ' ' || DTL_ADDR AS ROAD_NM_ADDR
                          , RSV_TEL_NUM
                        FROM TB_AD_RSV T_AD
                          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_AD.CORP_ID
                          INNER JOIN TB_AD_DFTINF T_DFT ON T_DFT.CORP_ID=T_CORP.CORP_ID
                          LEFT OUTER JOIN TB_CM_IMG T_IMG ON T_IMG.LINK_NUM = T_CORP.CORP_ID
                            AND T_IMG.IMG_SN   = 1
                          WHERE RSV_STATUS_CD IN ('RS02')
                           AND USE_DT = TO_CHAR(SYSDATE + 7, 'YYYYMMDD')
                      UNION ALL
                        SELECT PRDT_INF
                          , CORP_NM
                          , T_RC.PRDT_NM
                          , RSV_NUM
                          , CAR_IMG AS IMG_PATH
                          , ROAD_NM_ADDR || ' ' || DTL_ADDR AS ROAD_NM_ADDR
                          , RSV_TEL_NUM
                        FROM TB_RC_RSV T_RC
                          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_RC.CORP_ID
                          INNER JOIN TB_RC_PRDTINF T_PRD ON T_PRD.PRDT_NUM=T_RC.PRDT_NUM
                          INNER JOIN TB_RC_CARDIV T_DIV ON T_DIV.RC_CARDIV_NUM=T_PRD.RC_CARDIV_NUM AND USE_YN='Y'
                        WHERE RSV_STATUS_CD IN ('RS02')
                           AND RENT_START_DT = TO_CHAR(SYSDATE + 7, 'YYYYMMDD')
                      UNION ALL
                        SELECT PRDT_INF
                          , CORP_NM
                          , PRDT_NM
                          , RSV_NUM
                          , SAVE_PATH || 'thumb/' || SAVE_FILE_NM AS IMG_PATH
                          , ROAD_NM_ADDR || ' ' || DTL_ADDR AS ROAD_NM_ADDR
                          , RSV_TEL_NUM
                        FROM TB_SP_RSV T_SP
                          INNER JOIN TB_CORP T_CORP ON T_CORP.CORP_ID=T_SP.CORP_ID
                          LEFT OUTER JOIN TB_CM_IMG T_IMG ON T_IMG.LINK_NUM = T_SP.PRDT_NUM
                            AND T_IMG.IMG_SN   = 1
                          WHERE RSV_STATUS_CD IN ('RS02')
                           AND TO_CHAR(USE_DTTM, 'YYYYMMDD') = TO_CHAR(SYSDATE + 7, 'YYYYMMDD')
                  ) T_DET ON T_DET.RSV_NUM=T_RSV.RSV_NUM
              WHERE EMAIL_RCV_AGR_YN='Y'
</select>


<select id="RSV_S_30" resultMap="RSV_R_04">
    SELECT
        ROW_NUMBER() OVER(PARTITION BY T_RSV.CORP_ID ORDER BY PRDT_RSV_NUM)  AS RN_CORP
		, COUNT(T_RSV.CORP_ID) OVER(PARTITION BY T_RSV.CORP_ID )  AS CORP_MAX_COUNT
        , PRDT_CD
        , (SELECT CD_NM
        FROM TB_CD
        WHERE CD_NUM = PRDT_CD
        ) AS PRDT_CD_NM
        , CTGR_NM
        , RSV_NUM
        , PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , T1.CORP_ID
        , PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , (CASE PRDT_CD WHEN 'AD'
        THEN (SELECT AD_NM FROM TB_AD_DFTINF WHERE CORP_ID = T_RSV.CORP_ID)
        ELSE (SELECT CORP_NM FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
        END) AS CORP_NM
        , (CASE PRDT_CD WHEN 'AD'
        THEN (SELECT ROAD_NM_ADDR || ' ' || DTL_ADDR AS LOAD_NM_ADDR FROM TB_CORP WHERE CORP_ID = T_RSV.CORP_ID)
        ELSE ''
        END) AS ROAD_NM_ADDR
        , USE_DTTM
        , PRDT_DIV
        , USE_ABLE_DTTM
        , EXPR_END_DT
        , EXPR_START_DT
        , SP_DIV_SN
        , SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , CANCEL_GUIDE
        , DLV_CORP_NM
        , DLV_NUM
        , DLV_AMT
        , DLV_AMT_DIV
        , PRDT_CNT
        , '' AS LS_LINK_PRDT_NUM
        , '' AS LS_LINK_OPT_NUM
        , '' AS LS_LINK_YN
        , ADJ_YN
        , (SELECT USE_NM FROM TB_RSV WHERE RSV_NUM = T_RSV.RSV_NUM) AS USE_NM
        , (SELECT USE_TELNUM FROM TB_RSV WHERE RSV_NUM = T_RSV.RSV_NUM) AS USE_TELNUM
        , NML_AMT -  TRUNC(NML_AMT * ADJ_APL_PCT / 100, -1) AS PRE_ADJ_AMT
        , PRDC
        , 0 AS PAY_POINT
        , 0 AS USE_POINT
        , '' AS CP_NM
        , '' AS CP_ID
    FROM(
        SELECT 'AD' AS PRDT_CD
        , '숙박' AS CTGR_NM
        , RSV_NUM
        , AD_RSV_NUM AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , NULL AS SP_DIV_SN
        , NULL AS SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_AD_DFTINF WHERE CORP_ID=T_ADRSV.CORP_ID) AS CANCEL_GUIDE
        , NULL AS DLV_CORP_NM
        , NULL AS DLV_NUM
        , NULL AS DLV_AMT
        , NULL AS DLV_AMT_DIV
        , 1 AS PRDT_CNT
        , ADJ_YN
        , NULL AS PRDC
        FROM TB_AD_RSV T_ADRSV
        WHERE RSV_NUM = #rsvNum#

        UNION ALL

        SELECT
        (SELECT HRK_CD_NUM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS PRDT_CD
        , (SELECT CD_NM FROM TB_CD WHERE CD_NUM = (SELECT CTGR FROM TB_SP_PRDTINF WHERE PRDT_NUM = T_SPRSV.PRDT_NUM)) AS CTGR_NM
        , RSV_NUM
        , MAX(SP_RSV_NUM) AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , CASE WHEN COUNT(*) > 1 THEN WM_CONCAT(   '('|| PRDT_INF ||')') ELSE WM_CONCAT(PRDT_INF ) END  AS PRDT_INF
        , SUM(NML_AMT) AS NML_AMT
        , SUM(SALE_AMT) AS SALE_AMT
        , SUM(DIS_AMT) AS DIS_AMT
        , SUM(CANCEL_AMT) AS CANCEL_AMT
        , SUM(CMSS_AMT) AS CMSS_AMT
        , SUM(DIS_CANCEL_AMT) AS DIS_CANCEL_AMT
        , MAX(USE_DTTM) AS USE_DTTM
        , MAX(PRDT_DIV) AS PRDT_DIV
        , MAX(USE_ABLE_DTTM) AS USE_ABLE_DTTM
        , MAX(EXPR_END_DT) AS EXPR_END_DT
        , MAX(EXPR_START_DT) AS EXPR_START_DT
        , SP_DIV_SN
        , MAX(SP_OPT_SN) AS SP_OPT_SN
        , MAX(CANCEL_REQUEST_DTTM) AS CANCEL_REQUEST_DTTM
        , MAX(REFUND_REQUEST_DTTM) AS REFUND_REQUEST_DTTM
        , MAX(CANCEL_CMPL_DTTM) AS CANCEL_CMPL_DTTM
        , MAX(CANCEL_RSN) AS CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_SP_PRDTINF WHERE PRDT_NUM=T_SPRSV.PRDT_NUM) AS CANCEL_GUIDE
        , NULL AS DLV_CORP_NM
        , NULL AS DLV_NUM
        , NULL AS DLV_AMT
        , NULL AS DLV_AMT_DIV
        , SUM(BUY_NUM) AS PRDT_CNT
        , MAX(ADJ_YN) AS ADJ_YN
        , NULL AS PRDC
        FROM TB_SP_RSV T_SPRSV
        WHERE RSV_NUM = #rsvNum#
        GROUP BY RSV_NUM,PRDT_NUM,PRDT_NM,RSV_STATUS_CD,CORP_ID,SP_DIV_SN

        UNION ALL

        SELECT 'RC' AS PRDT_CD
        , '렌터카' AS CTGR_NM
        , RSV_NUM
        , RC_RSV_NUM AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , PRDT_INF || ' [' || (SELECT CD_NM FROM TB_CD WHERE CD_NUM=T_RCRSV.ISR_DIV) ||
        CASE WHEN T_RCRSV.ISR_DIV='ID10' THEN
        CASE
        WHEN T_RCRSV.ISR_TYPE_DIV='GENL' THEN '-일반자차'
        WHEN T_RCRSV.ISR_TYPE_DIV='LUXY' THEN '-고급자차'
        END
        ELSE ''
        END
        || ']' AS PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , NULL AS SP_DIV_SN
        , NULL AS SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_RC_DFTINF WHERE CORP_ID=T_RCRSV.CORP_ID) AS CANCEL_GUIDE
        , NULL AS DLV_CORP_NM
        , NULL AS DLV_NUM
        , NULL AS DLV_AMT
        , NULL AS DLV_AMT_DIV
        , 1 AS PRDT_CNT
        , ADJ_YN
        , NULL AS PRDC
        FROM TB_RC_RSV T_RCRSV
        WHERE RSV_NUM = #rsvNum#

        UNION ALL

        SELECT 'SV' AS PRDT_CD
        , (SELECT CD_NM
        FROM TB_CD
        WHERE CD_NUM = (SELECT CTGR
        FROM TB_SV_PRDTINF
        WHERE PRDT_NUM = T_SVRSV.PRDT_NUM)) AS CTGR_NM
        , RSV_NUM
        , SV_RSV_NUM AS PRDT_RSV_NUM
        , PRDT_NUM
        , PRDT_NM
        , RSV_STATUS_CD
        , CORP_ID
        , PRDT_INF
        , NML_AMT
        , SALE_AMT
        , DIS_AMT
        , CANCEL_AMT
        , CMSS_AMT
        , DIS_CANCEL_AMT
        , NULL AS USE_DTTM
        , NULL AS PRDT_DIV
        , NULL AS USE_ABLE_DTTM
        , NULL AS EXPR_END_DT
        , NULL AS EXPR_START_DT
        , NULL AS SP_DIV_SN
        , NULL AS SP_OPT_SN
        , CANCEL_REQUEST_DTTM
        , REFUND_REQUEST_DTTM
        , CANCEL_CMPL_DTTM
        , CANCEL_RSN
        , (SELECT CANCEL_GUIDE FROM TB_SV_PRDTINF WHERE PRDT_NUM=T_SVRSV.PRDT_NUM) AS CANCEL_GUIDE
        , DLV_CORP_NM
        , DLV_NUM
        , DLV_AMT
        , DLV_AMT_DIV
        , BUY_NUM AS PRDT_CNT
        , ADJ_YN
        , (SELECT PRDC FROM TB_SV_PRDTINF WHERE PRDT_NUM = T_SVRSV.PRDT_NUM) AS PRDC
        FROM TB_SV_RSV T_SVRSV
        WHERE RSV_NUM = #rsvNum#
    ) AS T_RSV
    JOIN TB_CORP AS T1
    ON T1.CORP_ID = T_RSV.CORP_ID
    JOIN TB_CMSS AS T2
    ON T1.CMSS_NUM = T2.CMSS_NUM
</select>


<select id="RSV_S_31" resultMap="RSV_R_05">
SELECT RSV_NUM
  , RSV_STATUS_CD
  , USER_ID
  , RSV_NM
  , RSV_EMAIL
  , RSV_TELNUM
  , USE_NM
  , USE_EMAIL
  , USE_TELNUM
  , PAY_DIV
  , TOTAL_NML_AMT
  , TOTAL_SALE_AMT
  , TOTAL_PAY_AMT
  , TOTAL_DIS_AMT
  , TOTAL_CANCEL_AMT
  , LPOINT_USE_POINT
  , REG_DTTM
  , REG_IP
  , MOD_DTTM
  , MOD_IP
  , TOTAL_CMSS_AMT
  , TOTAL_DIS_CANCEL_AMT
  , APP_DIV
  , NVL(USE_POINT,0) AS USE_POINT /* 파트너 포인트 */
FROM TB_RSV
WHERE RSV_STATUS_CD = 'RS00'
    <![CDATA[
    AND REG_DTTM > SYSDATE - ((#waitingTime# - 10) / 60 / 24)
    ]]>
    AND TAMNACARD_REF_ID IS NULL
    <isNotEqual property="userId" compareValue="GUEST">
        AND USER_ID = #userId#
    </isNotEqual>
    <isEqual property="userId" compareValue="GUEST">
        AND USER_ID = 'GUEST'
        AND RSV_TELNUM = #rsvTelnum#
        AND RSV_NM = #rsvNm#
    </isEqual>
ORDER BY RSV_NUM DESC
</select>

<insert id="RSV_I_00">
INSERT INTO TB_RSV
     ( RSV_NUM          /*예약 번호*/
     , RSV_STATUS_CD    /*예약 상태 코드*/
     , USER_ID          /*사용자 아이디*/
     , RSV_NM           /*예약 명*/
     , RSV_EMAIL        /*예약 이메일*/
     , RSV_TELNUM       /*예약 전화번호*/
     , USE_NM           /*사용 명*/
     , USE_EMAIL        /*사용 이메일*/
     , USE_TELNUM       /*사용 전화번호*/
     , PAY_DIV          /*결제 구분*/
     , TOTAL_NML_AMT    /*총 정상 금액*/
     , TOTAL_SALE_AMT   /*총 판매 금액*/
     , TOTAL_PAY_AMT    /*총 결제 금액*/
     , TOTAL_DIS_AMT    /*총 할인 금액*/
     , TOTAL_CANCEL_AMT /*총 취소 금액*/
     , REG_DTTM         /*등록 일시*/
     , REG_IP           /*등록 아이피*/
     , MOD_DTTM         /*수정 일시*/
     , MOD_IP           /*수정 아이피*/
     , TOTAL_CMSS_AMT   /*총 수수료 금액*/
     )
VALUES
     ( #rsvNum#
     , #rsvStatusCd#
     , #userId#
     , #rsvNm#
     , #rsvEmail#
     , #rsvTelnum#
     , #useNm#
     , #useEmail#
     , #useTelnum#
     , #payDiv#
     , #totalNmlAmt#
     , #totalSaleAmt#
     , #totalPayAmt#
     , #totalDisAmt#
     , #totalCancelAmt#
     , #regDttm#
     , #regIp#
     , #modDttm#
     , #modIp#
     , #totalCmssAmt#
     )
</insert>

<insert id="RSV_I_01">
<selectKey keyProperty="rsvNum" resultClass="String">
SELECT 'RV'||TO_CHAR(SYSDATE, 'YYMMDD')||LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(SUBSTR(RSV_NUM,9))),0) + 1), 6,'0') AS RSV_NUM
  FROM TB_RSV
 WHERE RSV_NUM LIKE 'RV'||TO_CHAR(SYSDATE, 'YYMMDD') || '%'
</selectKey>
INSERT INTO TB_RSV
     ( RSV_NUM          /*예약 번호*/
     , RSV_STATUS_CD    /*예약 상태 코드*/
     , USER_ID          /*사용자 아이디*/
     , RSV_NM           /*예약 명*/
     , RSV_EMAIL        /*예약 이메일*/
     , RSV_TELNUM       /*예약 전화번호*/
     , USE_NM           /*사용 명*/
     , USE_EMAIL        /*사용 이메일*/
     , USE_TELNUM       /*사용 전화번호*/
     , PAY_DIV          /*결제 구분*/
     , TOTAL_NML_AMT    /*총 정상 금액*/
     , TOTAL_SALE_AMT   /*총 판매 금액*/
     , TOTAL_PAY_AMT    /*총 결제 금액*/
     , TOTAL_DIS_AMT    /*총 할인 금액*/
     , TOTAL_CANCEL_AMT /*총 취소 금액*/
     , REG_DTTM         /*등록 일시*/
     , REG_IP           /*등록 아이피*/
     , MOD_DTTM         /*수정 일시*/
     , MOD_IP           /*수정 아이피*/
     , TOTAL_CMSS_AMT   /*총 수수료 금액*/
     , TOTAL_DIS_CANCEL_AMT   /*총 수수료 금액*/
     , POST_NUM 		/* 우편번호 */
     , ROAD_NM_ADDR		/* 도로명 주소 */
     , DTL_ADDR			/* 상세 주소 */
     , DLV_REQUEST_INF  /* 배송요청정보 */
     , RSV_CORP_ID		/* 예약 업체 아이디 */
     , APP_DIV			/* 앱 구분 */
     , FLOW_PATH		/* 유입 경로 */
     , EVNT_CD			/*이벤트 코드*/
     , LPOINT_USE_POINT	/*L.Point 사용 포인트*/
     , LPOINT_SAVE_POINT/*L.Point 적립 포인트*/
     , USER_SMS_YN
     , PARTNER
     , PARTNER_CODE
     , USE_POINT
     )
VALUES
     ( #rsvNum#
     , 'RS00'
     , #userId#
     , #rsvNm#
     , #rsvEmail#
     , #rsvTelnum#
     , #useNm#
     , #useEmail#
     , #useTelnum#
     , ''
     , 0
     , 0
     , 0
     , 0
     , 0
     , SYSDATE
     , #regIp#
     , SYSDATE
     , #modIp#
     , 0
     , 0
     , #postNum#
     , #roadNmAddr#
     , #dtlAddr#
     , #dlvRequestInf#
     , #rsvCorpId#
     , #appDiv#
     , #flowPath#
     , #evntCd#
     , #lpointUsePoint#
     , #lpointSavePoint#
     , #userSmsYn#
     , #partner#
     , #partnerCode#
     , #usePoint#
     )
</insert>


<update id="RSV_U_00">
UPDATE TB_RSV
   SET RSV_STATUS_CD    = #rsvStatusCd#
     , USER_ID          = #userId#
     , RSV_NM           = #rsvNm#
     , RSV_EMAIL        = #rsvEmail#
     , RSV_TELNUM       = #rsvTelnum#
     , USE_NM           = #useNm#
     , USE_EMAIL        = #useEmail#
     , USE_TELNUM       = #useTelnum#
     , PAY_DIV          = #payDiv#
     , TOTAL_NML_AMT    = #totalNmlAmt#
     , TOTAL_SALE_AMT   = #totalSaleAmt#
     , TOTAL_PAY_AMT    = #totalPayAmt#
     , TOTAL_DIS_AMT    = #totalDisAmt#
     , TOTAL_CANCEL_AMT = #totalCancelAmt#
     , REG_DTTM         = #regDttm#
     , REG_IP           = #regIp#
     , MOD_DTTM         = #modDttm#
     , MOD_IP           = #modIp#
     , TOTAL_CMSS_AMT   = #totalCmssAmt#
 WHERE RSV_NUM          = #rsvNum#
</update>

<update id="RSV_U_01">
UPDATE TB_RSV
   SET (
       TOTAL_NML_AMT
     , TOTAL_SALE_AMT
     , TOTAL_DIS_AMT
     ) = (
SELECT NVL(SUM(NML_AMT), 0)  AS TOTAL_NML_AMT
     , NVL(SUM(SALE_AMT), 0) - LPOINT_USE_POINT - #usePoint# AS TOTAL_SALE_AMT
     , NVL(SUM(DIS_AMT), 0)  AS TOTAL_DIS_AMT
  FROM (SELECT NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_AD_RSV
         WHERE RSV_NUM = #rsvNum#
           AND RSV_STATUS_CD = 'RS00'

         UNION ALL

        SELECT NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_SP_RSV
         WHERE RSV_NUM = #rsvNum#
           AND RSV_STATUS_CD = 'RS00'

         UNION ALL

        SELECT NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_RC_RSV
         WHERE RSV_NUM = #rsvNum#
           AND RSV_STATUS_CD = 'RS00'

         UNION ALL

        SELECT NML_AMT
             , SALE_AMT
             , DIS_AMT
          FROM TB_SV_RSV
         WHERE RSV_NUM = #rsvNum#
           AND RSV_STATUS_CD = 'RS00'
       ))
 WHERE RSV_NUM = #rsvNum#
</update>


<update id="RSV_U_03">
UPDATE
	<isEqual property="prdtCd" compareValue="AD">
		TB_AD_RSV
	</isEqual>
	<isEqual property="prdtCd" compareValue="GL">
		TB_GL_RSV
	</isEqual>
	<isEqual property="prdtCd" compareValue="RC">
		TB_RC_RSV
	</isEqual>
	<isEqual property="prdtCd" compareValue="SP">
		TB_SP_RSV
	</isEqual>
	<isEqual property="prdtCd" compareValue="SV">
		TB_SV_RSV
	</isEqual>
SET USEEPIL_REG_YN = #useepilRegYn#
	<isEqual property="prdtCd" compareValue="AD">
	 WHERE AD_RSV_NUM = #prdtRsvNum#
	</isEqual>
	<isEqual property="prdtCd" compareValue="GL">
	 WHERE GL_RSV_NUM = #prdtRsvNum#
	</isEqual>
	<isEqual property="prdtCd" compareValue="RC">
	 WHERE RC_RSV_NUM = #prdtRsvNum#
	</isEqual>
	<isEqual property="prdtCd" compareValue="SP">
	 WHERE SP_RSV_NUM = #prdtRsvNum#
	</isEqual>
	<isEqual property="prdtCd" compareValue="SV">
	 WHERE SV_RSV_NUM = #prdtRsvNum#
	</isEqual>
</update>

<!-- 결제 완료 예약상태 변경 -->
<update id="RSV_U_04">
UPDATE TB_RSV
   SET RSV_STATUS_CD = #rsvStatusCd#
     , PAY_DIV = #payDiv#
     , MOD_DTTM = SYSDATE
 WHERE RSV_NUM = #rsvNum#
</update>

<!-- 예약 취소 시 금액 변경 -->
<update id="RSV_U_05">
UPDATE TB_RSV
   SET TOTAL_CANCEL_AMT     = TOTAL_CANCEL_AMT + #totalCancelAmt#
     , TOTAL_CMSS_AMT       = TOTAL_CMSS_AMT + #totalCmssAmt#
     , TOTAL_DIS_CANCEL_AMT = TOTAL_DIS_CANCEL_AMT + #totalDisCancelAmt#
     , MOD_DTTM             = SYSDATE
     , MOD_IP               = #modIp#
 WHERE RSV_NUM              = #rsvNum#
</update>

<!-- 예약 자동취소 처리 -->
<update id="RSV_U_06">
<![CDATA[
UPDATE TB_RSV
   SET RSV_STATUS_CD = 'RS99'
     , MOD_DTTM      = SYSDATE
 WHERE RSV_NUM IN (SELECT RSV_NUM
                     FROM TB_RSV
                    WHERE 1 = (CASE WHEN RSV_STATUS_CD = 'RS00'
                                    THEN (CASE WHEN REG_DTTM <= SYSDATE - (#waitingTime# / 60 / 24) THEN 1 ELSE 0 END)
                                    ELSE 0
                                END))
   AND RSV_STATUS_CD = 'RS00'
]]>
</update>

<!-- 환불정보 업데이트 -->
<update id="RSV_U_07">
UPDATE TB_RSV
   SET REFUND_BANK_NM = #refundBankNm#
     , REFUND_ACC_NUM = #refundAccNum#
     , REFUND_DEPOSITOR = #refundDepositor#
     , REFUND_BANK_CODE = #refundBankCode#
 WHERE RSV_NUM = (SELECT RSV_NUM
                    FROM TB_AD_RSV
                   WHERE AD_RSV_NUM = #prdtRsvNum#

                   UNION

                  SELECT RSV_NUM
                    FROM TB_RC_RSV
                   WHERE RC_RSV_NUM = #prdtRsvNum#

                   UNION

                  SELECT RSV_NUM
                    FROM TB_SP_RSV
                   WHERE SP_RSV_NUM = #prdtRsvNum#

                   UNION

                  SELECT RSV_NUM
                    FROM TB_SV_RSV
                   WHERE SV_RSV_NUM = #prdtRsvNum#
                 )
</update>

<!-- 환불정보 업데이트 -->
<update id="RSV_U_08">
UPDATE TB_RSV
   SET USE_NM = #useNm#
   	 , USE_TELNUM = #useTelnum#
     , POST_NUM = #postNum#
     , ROAD_NM_ADDR = #roadNmAddr#
     , DTL_ADDR = #dtlAddr#
 WHERE RSV_NUM = #rsvNum#
</update>

<update id="RSV_U_09">
UPDATE TB_RSV
   SET RSV_STATUS_CD = 'RS99'
     , MOD_DTTM      = SYSDATE
 WHERE RSV_NUM       = #rsvNum#
</update>

<update id="RSV_U_14">
    UPDATE TB_RSV
    SET RSV_STATUS_CD = 'RS01'
      , MOD_DTTM      = SYSDATE
    WHERE RSV_NUM       = #rsvNum#
</update>

<update id="RSV_U_10">
UPDATE TB_RSV
   SET LPOINT_USE_POINT = #lpointUsePoint#
     , LPOINT_SAVE_POINT = #lpointSavePoint#
 WHERE RSV_NUM       = #rsvNum#
</update>

<update id="RSV_U_11">
UPDATE TB_RSV
   SET REFUND_BANK_CODE = #refundBankCode#
     , REFUND_ACC_NUM = #refundAccNum#
     , REFUND_DEPOSITOR = #refundDepositor#
 WHERE RSV_NUM       = #rsvNum#
</update>

<update id="RSV_U_12">
UPDATE
    <isEqual property="prdtCd" compareValue="AD">
        TB_AD_RSV
    </isEqual>
    <isEqual property="prdtCd" compareValue="RC">
        TB_RC_RSV
    </isEqual>
    <isEqual property="prdtCd" compareValue="SP">
        TB_SP_RSV
    </isEqual>
    <isEqual property="prdtCd" compareValue="SV">
        TB_SV_RSV
    </isEqual>
SET REFUND_RSN = #refundRsn#
WHERE
    <isEqual property="prdtCd" compareValue="AD">
        AD_RSV_NUM = #prdtRsvNum#
    </isEqual>
    <isEqual property="prdtCd" compareValue="RC">
        RC_RSV_NUM = #prdtRsvNum#
    </isEqual>
    <isEqual property="prdtCd" compareValue="SP">
        SP_RSV_NUM = #prdtRsvNum#
    </isEqual>
    <isEqual property="prdtCd" compareValue="SV">
        SV_RSV_NUM = #prdtRsvNum#
    </isEqual>
</update>

<!--관리자 직접 예약 시 예약처리 후 금액 합계 처리-->
<update id="RSV_U_13">
        UPDATE TB_RSV
        SET (
                RSV_STATUS_CD
                ,  TOTAL_NML_AMT
                , TOTAL_SALE_AMT
                , TOTAL_DIS_AMT
                , PAY_DIV
                ) = (
                SELECT
                    'RS02'
                     , NVL(SUM(NML_AMT), 0)  AS TOTAL_NML_AMT
                     , NVL(SUM(SALE_AMT), 0) AS TOTAL_SALE_AMT
                     , NVL(SUM(DIS_AMT), 0)  AS TOTAL_DIS_AMT
                     , #payDiv#
                FROM (SELECT NML_AMT
                           , SALE_AMT
                           , DIS_AMT
                      FROM TB_$corpDiv$_RSV
                      WHERE RSV_NUM = #rsvNum#
                     ))
        WHERE RSV_NUM = #rsvNum#
    </update>

<update id="RSV_U_15">
    UPDATE TB_RSV SET
        TAMNACARD_REF_ID = #tamnacardRefId#,
        TAMNACARD_REF_HASHID = #tamnacardRefHashid#,
        TAMNACARD_LINK_URL = #tamnacardLinkUrl#
    WHERE RSV_NUM = #rsvNum#
</update>

<select id="AV_RSV_S_00" resultMap="RSV_R_18">
SELECT SALE_CORP_DIV,
		RSV_NUM,
		RSV_NM,
		RSV_DTTM,
		AV_CORP_DIV,
		START_COURSE_DIV,
		END_COURSE_DIV,
		USE_DTTM,
		MEM,
		SALE_AMT,
		RSV_STATUS_CD
	FROM (SELECT ROWNUM AS RN,
					SALE_CORP_DIV,
					RSV_NUM,
					RSV_NM,
					RSV_DTTM,
					AV_CORP_DIV,
					START_COURSE_DIV,
					END_COURSE_DIV,
					USE_DTTM,
					MEM,
					SALE_AMT,
					RSV_STATUS_CD
	    FROM (SELECT SALE_CORP_DIV,
	    				RSV_NUM,
	    				RSV_NM,
	    				RSV_DTTM,
	    				AV_CORP_DIV,
	    				START_COURSE_DIV,
	    				END_COURSE_DIV,
	    				USE_DTTM,
	    				MEM,
	    				SALE_AMT,
	    				RSV_STATUS_CD
	    	FROM TB_AV_RSV
	    	WHERE 1=1
	    	<isNotEqual property="sSaleCorp" compareValue="ALL">
			 	AND SALE_CORP_DIV=#sSaleCorp#
			</isNotEqual>
			<isNotEqual property="sRsvStatus" compareValue="ALL">
			 	AND RSV_STATUS_CD=#sRsvStatus#
			</isNotEqual>

			<isNotEmpty property="sStartDt">
			    <isNotEmpty property="sEndDt">
			 	AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
			 	</isNotEmpty>
			</isNotEmpty>

			<isNotEmpty property="sUsedStartDt">
		        <isNotEmpty property="sUsedEndDt">
		       AND TO_CHAR(USE_DTTM, 'YYYY-MM-DD') BETWEEN #sUsedStartDt# AND #sUsedEndDt#
		        </isNotEmpty>
		    </isNotEmpty>

			<isNotEmpty property="sRsvNm">
			 		AND RSV_NM LIKE '%'||#sRsvNm#||'%'
			</isNotEmpty>
	    	ORDER BY RSV_DTTM DESC)
	    )
    WHERE RN BETWEEN TO_NUMBER(#firstIndex#)+1 AND TO_NUMBER(#lastIndex#)
</select>

<select id="AV_RSV_S_01" resultClass="int">
SELECT COUNT(*) FROM TB_AV_RSV
	WHERE 1=1
	<isNotEqual property="sSaleCorp" compareValue="ALL">
	 	AND SALE_CORP_DIV=#sSaleCorp#
	</isNotEqual>
	<isNotEqual property="sRsvStatus" compareValue="ALL">
	 	AND RSV_STATUS_CD=#sRsvStatus#
	</isNotEqual>
	<isNotEmpty property="sStartDt">
	    <isNotEmpty property="sEndDt">
	 	AND TO_CHAR(RSV_DTTM, 'YYYY-MM-DD') BETWEEN #sStartDt# AND #sEndDt#
		</isNotEmpty>
	</isNotEmpty>

	<isNotEmpty property="sUsedStartDt">
		<isNotEmpty property="sUsedEndDt">
		AND TO_CHAR(USE_DTTM, 'YYYY-MM-DD') BETWEEN #sUsedStartDt# AND #sUsedEndDt#
		</isNotEmpty>
	</isNotEmpty>

	<isNotEmpty property="sRsvNm">
	 		AND RSV_NM LIKE '%'||#sRsvNm#||'%'
	</isNotEmpty>
</select>

<insert id="AV_RSV_I_00">
	<selectKey keyProperty="avRsvNum" resultClass="String">
SELECT 'AV'||TO_CHAR(SYSDATE, 'YYMMDD')||LPAD(TO_CHAR(NVL(MAX(TO_NUMBER(SUBSTR(AV_RSV_NUM,9))),0) + 1), 6,'0') AS AV_RSV_NUM
  FROM TB_AV_RSV
 WHERE SUBSTR(AV_RSV_NUM,0,8) = 'AV'||TO_CHAR(SYSDATE, 'YYMMDD')
	</selectKey>

 MERGE INTO TB_AV_RSV AV1
 USING (SELECT #rsvNum# AS RSV_NUM
 				, #useDttm# AS USE_DTTM
          FROM DUAL) AV2
    ON (AV2.RSV_NUM = AV1.RSV_NUM AND AV2.USE_DTTM = AV1.USE_DTTM)
  WHEN MATCHED THEN
UPDATE SET
       SALE_CORP_DIV = #saleCorpDiv#
       , RSV_NM = #rsvNm#
       , RSV_DTTM = #rsvDttm#
       , AV_CORP_DIV = #avCorpDiv#
       , START_COURSE_DIV = #startCourseDiv#
       , END_COURSE_DIV = #endCourseDiv#
       , MEM = #mem#
       , SALE_AMT = #saleAmt#
       , RSV_STATUS_CD = #rsvStatusCd#
  WHEN NOT MATCHED THEN
INSERT
     ( AV_RSV_NUM, SALE_CORP_DIV, RSV_NUM, RSV_NM, RSV_DTTM, AV_CORP_DIV, START_COURSE_DIV, END_COURSE_DIV, USE_DTTM, MEM, SALE_AMT, RSV_STATUS_CD )
VALUES
     ( #avRsvNum#, #saleCorpDiv#, #rsvNum#, #rsvNm#, #rsvDttm#, #avCorpDiv#, #startCourseDiv#, #endCourseDiv#, #useDttm#, #mem#, #saleAmt#, #rsvStatusCd# )
</insert>

    <!-- MMS 메시지 재전송백업 -->
    <insert id="MMS_BACKUP_MSG_I_00">
      INSERT INTO TB_MMSMSG_MNG(
            RSV_NUM,
            PRDT_RSV_NUM,
            SUBJECT,
            MSG,
            PHONE1,
            PHONE2,
            REG_DTTM
        )VALUES(
            #rsvNum#,
            #prdtRsvNum#,
            #subject#,
            #msg#,
            #phone1#,
            #phone2#,
            SYSDATE
        )
    </insert>

    <!-- MMS 메시지 재전송 -->
    <select id="MMS_BACKUP_MSG_S_00" resultMap="MMS_BACKUP_MSG_R_00">
        SELECT
            SUBJECT,
            MSG
        FROM
            TB_MMSMSG_MNG
        WHERE
            RSV_NUM = #rsvNum#
    </select>

    <!-- 에스크로 배송등록 정보 GET -->
    <select id="ESCROW_S_00" resultMap="ESCROW_R_00">
        SELECT
            TC.CORP_CD
             , TR.PAY_DIV
             , TSR.RSV_NUM
             , TSR.SV_RSV_NUM
             , TR.RSV_NM
             , TR.RSV_TELNUM
             , (SELECT ESCROW_DLV_CD FROM TB_DLVCORP WHERE  DLV_CORP_CD = #dlvCorpCd#) AS ESCROW_DLV_CD
        FROM TB_SV_RSV TSR
        INNER JOIN TB_RSV TR ON TSR.RSV_NUM = TR.RSV_NUM
        INNER JOIN TB_CORP TC ON TSR.CORP_ID = TC.CORP_ID
        WHERE SV_RSV_NUM = #svRsvNum#
    </select>

    <!-- 에스크로 처리결과 수신 insert -->
    <insert id="ESCROW_I_00">
        INSERT INTO TB_ESCROW_RCVLOG(
            SEQ
            , TXTYPE
            , MID
            , TID
            , OID
            , HASHDATA
            , HASHDATA2
            , HASH_CHECK_YN
            , PRODUCT_ID
            , RESDATE
        )VALUES(
            SEQ_ESCROWRE_SN.NEXTVAL
            , #txtype#
            , #mid#
            , #tid#
            , #oid#
            , #hashdata#
            , #hashdata2#
            , #hashCheckYn#
            , #productid#
            , #resdate#
        )
    </insert>

    <!-- 에스크로 발송정보 insert -->
    <insert id="ESCROW_I_01">
        INSERT INTO TB_ESCROW_SENDLOG(
              SEQ
            , RSV_NUM
            , SV_RSV_NUM
            , SEND_MSG
            , RESP_MSG
            , RESP
        )VALUES(
           SEQ_ESCROWSE_SN.NEXTVAL
           , #oid#
           , #svRsvNum#
           , #sendMsg#
           , #respMsg#
           , #resp#
       )
    </insert>

    <!-- 관리자 직접 예약 시스템에서 [엑셀 상품 등록]  insert -->
    <insert id="OSSRSV_I_00">
        INSERT INTO TB_EXCELUP_RSV(
            SEQ
            , GROUP_NO
            , RSV_NM
            , RSV_TELNUM
            , USE_NM
            , USE_TELNUM
            , POST_NUM
            , ROAD_NM_ADDR
            , DTL_ADDR
            , PRDT_NUM
            , DIV_SN
            , OPT_SN
            , ADD_OPT_SN
            , BUY_NUM
            , DLV_REQUEST_INF
            , DLV_AMT
            , PAY_DIV
            , DIRECT_RECV_YN
            , S_PRDT_NM
            , S_OPT_NM
            , CORP_DIV
        )VALUES(
            SEQ_EXCELUP_RSV_SN.NEXTVAL
            , #groupNo#
            , #rsvNm#
            , #rsvTelnum#
            , #useNm#
            , #useTelnum#
            , #postNum#
            , #roadNmAddr#
            , #dtlAddr#
            , #prdtNum#
            , #divSn#
            , #optSn#
            , #addOptSn#
            , #buyNum#
            , #dlvRequestInf#
            , #dlvAmt#
            , #payDiv#
            , #directRecvYn#
            , #sPrdtNm#
            , #sOptNm#
            , #corpDiv#
        )
    </insert>

    <select id="OSSRSV_S_00" resultClass="int">
        SELECT NVL(MAX(GROUP_NO), 0) + 1
        FROM TB_EXCELUP_RSV
    </select>

    <select id="OSSRSV_S_01" resultMap="OSSRSV_R_00">
        SELECT SEQ
             , TER.RSV_NM
             , TER.RSV_TELNUM
             , TER.USE_NM
             , TER.USE_TELNUM
             , TER.POST_NUM
             , TER.ROAD_NM_ADDR
             , TER.DTL_ADDR
             , TER.DLV_REQUEST_INF
             , CASE WHEN T_CORP.SHOP_NM IS NULL THEN T_CORP.CORP_NM ELSE T_CORP.SHOP_NM END AS CORP_NM
             , T_PRDT.PRDT_NM
             , T_DIV.PRDT_DIV_NM
             , T_OPT.OPT_NM
             , NVL(T_OPT.SALE_AMT,0) AS SALE_AMT
             , T_ADD.ADD_OPT_NM
             , NVL(T_ADD.ADD_OPT_AMT,0) AS ADD_OPT_AMT
             , TER.BUY_NUM
             , NVL(TER.DLV_AMT,0) AS DLV_AMT
             , TER.PAY_DIV
             , TER.PRDT_NUM
             , TER.DIV_SN
             , TER.OPT_SN
             , TER.ADD_OPT_SN
             , TER.DIRECT_RECV_YN
             , T_CORP.CORP_ID
             , CONCAT(CONCAT(TER.S_PRDT_NM,'||'), TER.S_OPT_NM) AS S_PRDT_OPT_NM
             , RSV_COMPLETE_YN
            <isEqual property="corpDiv" compareValue="SV">
             , T_OPT.DLV_AMT_DIV
            </isEqual>
            <isNotEqual property="corpDiv" compareValue="SV">
             , '' AS DLV_AMT_DIV
            </isNotEqual>

            <isEqual property="corpDiv" compareValue="SP">
             , T_PRDT.PRDT_DIV
             , T_PRDT.EXPR_DAYNUM_YN
             , T_PRDT.EXPR_DAYNUM
             , T_PRDT.EXPR_END_DT
             , T_PRDT.EXPR_START_DT
             , T_PRDT.USE_ABLE_TM
            </isEqual>
            <isNotEqual property="corpDiv" compareValue="SP">
             , '' AS PRDT_DIV
             , '' AS EXPR_DAYNUM_YN
             , '' AS EXPR_DAYNUM
             , '' AS EXPR_END_DT
             , '' AS EXPR_START_DT
             , '' AS USE_ABLE_TM
            </isNotEqual>
        FROM TB_EXCELUP_RSV TER
        LEFT JOIN TB_$corpDiv$_PRDTINF T_PRDT ON TER.PRDT_NUM = T_PRDT.PRDT_NUM
        LEFT JOIN TB_$corpDiv$_DIVINF T_DIV ON T_PRDT.PRDT_NUM = T_DIV.PRDT_NUM AND T_DIV.$corpDiv$_DIV_SN = TER.DIV_SN
        LEFT JOIN TB_$corpDiv$_OPTINF T_OPT ON T_PRDT.PRDT_NUM = T_OPT.PRDT_NUM AND T_DIV.$corpDiv$_DIV_SN = T_OPT.$corpDiv$_DIV_SN AND T_OPT.$corpDiv$_OPT_SN = TER.OPT_SN AND T_OPT.DDL_YN = 'N'
        LEFT JOIN TB_CORP T_CORP ON T_PRDT.CORP_ID = T_CORP.CORP_ID AND T_CORP.TRADE_STATUS_CD = 'TS03'
        LEFT JOIN TB_$corpDiv$_ADDOPT T_ADD ON T_PRDT.PRDT_NUM = T_ADD.PRDT_NUM AND T_ADD.ADD_OPT_SN = TER.ADD_OPT_SN
        WHERE TER.GROUP_NO = #groupNo# AND TER.CORP_DIV = #corpDiv#
        ORDER BY S_PRDT_OPT_NM, SEQ
    </select>

    <select id="OSSRSV_S_02" resultClass="int">
        SELECT COUNT(1)
        FROM TB_EXCELUP_RSV
        WHERE GROUP_NO = #groupNo# AND CORP_DIV = #corpDiv#
    </select>

    <select id="OSSRSV_S_03" resultClass="String">
        SELECT MAX(GROUP_NO) AS LAST_GROUP_NO
        FROM TB_EXCELUP_RSV
        WHERE CORP_DIV = #corpDiv#
    </select>

    <select id="OSSRSV_S_04" resultMap="OSSRSV_R_01">
    SELECT CONCAT(CONCAT(S_PRDT_NM,'||'), S_OPT_NM) AS S_PRDT_OPT_NM
    FROM TB_EXCELUP_RSV
    WHERE GROUP_NO = #groupNo# AND CORP_DIV = #corpDiv#
    GROUP BY S_PRDT_NM, S_OPT_NM
    ORDER BY S_PRDT_NM, S_OPT_NM
    </select>

    <select id="OSSRSV_S_05" resultClass="int">
        SELECT COUNT(1)
        FROM TB_EXCELUP_RSV TER
        INNER JOIN TB_$corpDiv$_PRDTINF T_PRDT ON TER.PRDT_NUM = T_PRDT.PRDT_NUM
        INNER JOIN TB_$corpDiv$_DIVINF T_DIV ON T_PRDT.PRDT_NUM = T_DIV.PRDT_NUM AND T_DIV.$corpDiv$_DIV_SN = TER.DIV_SN
        INNER JOIN TB_$corpDiv$_OPTINF T_OPT ON T_PRDT.PRDT_NUM = T_OPT.PRDT_NUM AND T_DIV.$corpDiv$_DIV_SN = T_OPT.$corpDiv$_DIV_SN AND T_OPT.$corpDiv$_OPT_SN = TER.OPT_SN AND T_OPT.DDL_YN = 'N'
        INNER JOIN TB_CORP T_CORP ON T_PRDT.CORP_ID = T_CORP.CORP_ID AND T_CORP.TRADE_STATUS_CD = 'TS03'
        LEFT JOIN TB_$corpDiv$_ADDOPT T_ADD ON T_PRDT.PRDT_NUM = T_ADD.PRDT_NUM AND T_ADD.ADD_OPT_SN = TER.ADD_OPT_SN
        WHERE TER.GROUP_NO = #groupNo# AND CORP_DIV = #corpDiv#
    </select>

    <update id="OSSRSV_U_00">
        UPDATE TB_EXCELUP_RSV
        SET PRDT_NUM   = #prdtNum#
          , DIV_SN     = #divSn#
          , OPT_SN     = #optSn#
          , ADD_OPT_SN = #addOptSn#
          , DLV_AMT    = #dlvAmt#
          , PAY_DIV    = #payDiv#
        WHERE GROUP_NO = #groupNo# AND REPLACE(CONCAT(CONCAT(S_PRDT_NM, '||'), S_OPT_NM), ' ', '')  = #sPrdtOptNm#
    </update>

    <update id="OSSRSV_U_01">
        UPDATE TB_EXCELUP_RSV
        SET RSV_COMPLETE_YN   = 'Y'
        WHERE SEQ = #seq#
    </update>

    <update id="OSSRSV_U_02">
        UPDATE TB_RSV
        SET RSV_NM      = #rsvNm#
        , RSV_EMAIL     = #rsvEmail#
        , RSV_TELNUM    = #rsvTelnum#
        , USE_NM        = #useNm#
        , USE_EMAIL     = #useEmail#
        , USE_TELNUM    = #useTelnum#
        WHERE RSV_NUM   = #rsvNum#
    </update>

	<insert id="RSV_HCONECARD_I_00">
		INSERT INTO TB_HC_ONECARD
		     ( PRDT_RSV_NUM
		     , RSV_NUM
		     , PRDT_NUM
		     , USER_ID
		     , RSV_EMAIL
		     , RSV_TELNUM
		     , URL_TYPE
		     , FRST_REG_DTTM
		     )
		VALUES
		     ( #prdtRsvNum#
		     , #rsvNum#
		     , #prdtNum#
		     , #userId#
		     , #rsvEmail#
		     , #rsvTelnum#
		     , #urlType#
		     , SYSDATE
		     )
	</insert>


</sqlMap>
